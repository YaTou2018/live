"use strict";function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.YS=window.YS||{},window.L=window.L||{},window.YS_ERR={DEVICE_ERROR_UnknownError:2501,DEVICE_ERROR_NotFoundError:2502,DEVICE_ERROR_NotAllowedError:2503,DEVICE_ERROR_NotReadableError:2504,DEVICE_ERROR_OverconstrainedError:2505,DEVICE_ERROR_TypeError:2506,ROOM_JOIN_FAILED:2507,ROOM_NOT_CONNECT:2508,CHECK_USERDesktopMediaError:2509,Server_Exception:2510,NOT_SUPPORT:2511},window.L=window.L||{},window.YS=window.YS||{},YS.LOG_DEBUG=0,YS.LOG_TRACE=1,YS.LOG_INFO=2,YS.LOG_WARNING=3,YS.LOG_ERROR=4,YS.LOG_NONE=5,L.Logger=function(c){function d(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,o=e.getDate(),r=e.getHours(),n=e.getMinutes(),a=e.getSeconds();return i<10&&(i="0"+i),o<10&&(o="0"+o),r<10&&(r="0"+r),n<10&&(n="0"+n),a<10&&(a="0"+a),t+"/"+i+"/"+o+" "+r+":"+n+":"+a}var u,s,l="",p=!1,o=!1,f=((new Date).getTime(),{peerid:"undefined peerid",serial:"undefined serial"}),r=void 0,n=void 0,a=void 0,m=[];return u=function(e,t){try{if(r=console,!n&&(!window.Logline||-1<window.navigator.userAgent.toLowerCase().indexOf("edge"))){var s=[],i=void 0;window.Logline=function(n){function a(e,t,i){if(!e||!t||!t.peerid)return null;var o="2";if("debug"===e?o="3":"info"===e?o="4":"warn"===e?o="5":"error"===e&&(o="6"),Number(o)<4)return null;var r="";i.forEach(function(e,t){t<=1||("string"!=typeof e&&e&&e.constructor?e.constructor===Array?function i(e){e.forEach(function(e,t){"string"!=typeof e&&e&&e.constructor?e.constructor===Array?i(e):r+=JSON.stringify(e):r+=e})}(e):r+=JSON.stringify(e):r+=e)}),s.push({ts:(new Date).getTime(),level:o,log:r,file:"",serial:t&&t.serial?t.serial:"",peerid:t&&t.peerid?t.peerid:"",line:null})}function e(e,t){var i=[];i.push(n+" "+e.toUpperCase()+" ("+d()+")");for(var o=t[1],r=0;r<t.length;r++)1!=r&&i.push(t[r]);console[e].apply(console,i),a(e,o,i)}return{debug:function(){e("debug",arguments)},info:function(){e("info",arguments)},log:function(){e("log",arguments)},warn:function(){e("warn",arguments),i&&i()},error:function(){e("error",arguments),i&&i()}}},window.Logline.all=function(e){var t=s;s=[],e&&e(t)},window.Logline.keepfrom=function(e){},window.Logline.reportwarning=function(e){i=e}}if(window.Logline){if(n=n||new window.Logline("[ys-sdk]"),r=n,null!==a)return m.push({args:e,level:t}),void(void 0===a&&(a=setTimeout(function(){clearTimeout(a),a=null;for(var e=0,t=m.length;e<t;e++)u(m[e].args,m[e].level)},300)))}else e[1]=e[0],e[0]="[ys-sdk] ("+d()+")";switch(t){case c.Logger.DEBUG:o?r.warn.apply(r,e):r.debug.apply(r,e);break;case c.Logger.TRACE:r.trace.apply(r,e);break;case c.Logger.INFO:o?r.warn.apply(r,e):r.info.apply(r,e);break;case c.Logger.WARNING:r.warn.apply(r,e);break;case c.Logger.ERROR:r.error.apply(r,e);break;case c.Logger.NONE:r.warn("log level is none!");break;default:o?r.warn.apply(r,e):r.log.apply(r,e)}}catch(e){console.error("outputFunction err:",e)}},{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(e){o=e},enableLogPanel:function(){c.Logger.panel=document.createElement("textarea"),c.Logger.panel.setAttribute("id","licode-logs"),c.Logger.panel.setAttribute("style","position:fixed;left:0;top:0;width: 100%; height: 100%; display: none;z-index:9999;  user-select: text ;-webkit-user-select: text; -moz-user-select: text ; -ms-user-select: text ;"),c.Logger.panel.setAttribute("rows","20"),c.Logger.panel.setAttribute("cols","20"),c.Logger.panel.setAttribute("readOnly",!0);var e=document.createElement("button");e.innerHTML="open log",e.setAttribute("style","opacity:1;pointer-events:auto;position:fixed;left:0;top:0;z-index:10000;background:gold;"),e.onclick=function(){"open log"===e.innerHTML?(c.Logger.panel.style.display="block",e.innerHTML="close log"):(c.Logger.panel.style.display="none",e.innerHTML="open log")},document.body.appendChild(e),document.body.appendChild(c.Logger.panel)},setLogLevel:function(e){e>c.Logger.NONE?e=c.Logger.NONE:e<c.Logger.DEBUG&&(e=c.Logger.DEBUG),c.Logger.logLevel=e},setOutputFunction:function(e){u=e},registerLogListener:function(e){s=e},setLogPrefix:function(e){l=e},setIsFormatLog:function(e){p=e},print:function(e){var t=l;if(!(e<c.Logger.logLevel)){e===c.Logger.DEBUG?t+="DEBUG":e===c.Logger.TRACE?t+="TRACE":e===c.Logger.INFO?t+="INFO":e===c.Logger.WARNING?t+="WARNING":e===c.Logger.ERROR&&(t+="ERROR"),t+=":";var i=[];if(void 0!==c.Logger.panel||p){for(var o=1;o<arguments.length;o++)i.push(arguments[o]);for(var r="",n=0,a=i.length;n<a;n++){r=r+("string"==typeof i[n]?i[n]:Array.isArray(i[n])?"["+i[n].join(",")+"]":i[n]instanceof window.HTMLElement?"HTMLElement["+(arguments[o].id||""+arguments[o])+"]":"object"===qt(i[n])?c.Utils.toJsonStringify(i[n]):i[n])+" "}(i=[t]).push(f),i.push(r)}else{i.push(t),i.push(f);for(o=1;o<arguments.length;o++)i.push(arguments[o]instanceof window.HTMLElement?"HTMLElement["+(arguments[o].id||""+arguments[o])+"]":arguments[o])}void 0!==c.Logger.panel&&(c.Logger.panel.value=c.Logger.panel.value+"\n"+r),u.apply(c.Logger,[i,e]),"function"==typeof s&&s(i,e)}},debug:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.Logger.print.apply(c.Logger,[c.Logger.DEBUG].concat(e))},trace:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.Logger.print.apply(c.Logger,[c.Logger.TRACE].concat(e))},info:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.Logger.print.apply(c.Logger,[c.Logger.INFO].concat(e))},warning:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.Logger.print.apply(c.Logger,[c.Logger.WARNING].concat(e))},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.Logger.print.apply(c.Logger,[c.Logger.ERROR].concat(e))},getAllLog:function(t,i,o){Logline.all(function(e){e?c.Utils.isFunction(i)&&i(function(e,t){switch(e){case"3":break;case"4":t=t.filter(function(e,t){return"3"!=e.level});break;case"5":t=t.filter(function(e,t){return"3"!=e.level&&"4"!=e.level});break;case"6":t=t.filter(function(e,t){return"3"!=e.level&&"4"!=e.level&&"5"!=e.level})}return t}(t,e)):c.Utils.isFunction(o)&&o()})},keep:function(e){Logline.keepfrom(e)},setLogStaicPrefix:function(e,t){e&&"string"==typeof e&&(f.peerid=e),t&&"string"==typeof t&&(f.serial=t)},setReportwarning:function(e){Logline.reportwarning(e)}}}(L),YS.ysLogPrintConfig=function(e,t,i){e=e||{},i=i||{};var o=null==(t=t||{}).development||t.development,r=null!=t.logLevel?t.logLevel:0,n=null==e.debug||e.debug,a=null==i.webrtcLogDebug||i.webrtcLogDebug;if(L.Logger.setLogDevelopment(o),L.Logger.setLogLevel(r),L&&L.Utils&&L.Utils.localStorage){var s=n?"*":"none";L.Utils.localStorage.setItem("debug",s)}else try{if(window.localStorage){s=n?"*":"none";window.localStorage.setItem("debug",s)}else console.warn("window.localStorage is not exist!")}catch(e){console.warn("Browser does not support localStorage!")}window.webrtcLogDebug=a},YS.ysLogPrintConfig({debug:!1},{development:!1,logLevel:YS.LOG_INFO},{webrtcLogDebug:!1}),YS.Logger=L.Logger,window.L&&window.L._onLoadFinshInitSDK&&window.L._onLoadFinshInitSDK(),window.YS=window.YS||{},window.L=window.L||{},window.YS.ROADOFRECODER={STATE_ROOM_CONNECTED:0},window.YS_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002},window.YS.ROOM_ROLE={TEACHER:0,ASSISTANT:1,STUDENT:2,AUDIT:3,PATROL:4,SYSTEM_ADMIN:10,ENTERPRISE_ADMIN:11,ADMIN:12,PLAYBACK:-1},window.YS.ROOM_MODE={NORMAL_ROOM:"normalRoom",BIG_ROOM:"bigRoom"},window.YS.NET_QUALITY={YS_NET_QUALITY_EXCELLENT:1,YS_NET_QUALITY_GOOD:2,YS_NET_QUALITY_ACCEPTED:3,YS_NET_QUALITY_BAD:4,YS_NET_QUALITY_VERYBAD:5},window.YS.MEDIA_TYPE={DEVICE_AV:"video",FILE:"file",SCREEN:"screen",MEDIA:"media"},window.YS.EVENT_TYPE={roomConnected:"room-connected",roomCheckroom:"room-checkroom",roomCheckroomPlayback:"room-checkroom-playback",roomError:"room-error",roomConnectFail:"room-connect-fail",roomLeaveRoom:"room-leaveroom",roomServerAddressUpdate:"room-serveraddress-update",roomDisconnected:"room-disconnected",roomFiles:"room-files",roomReconnecting:"room-reconnecting",roomParticipantEvicted:"room-participant_evicted",roomMsgList:"room-msglist",roomReconnected:"room-reconnected",roomAudioVideoStateSwitched:"room-audiovideostate-switched",roomDeleteFile:"room-delete-file",roomAddFile:"room-add-file",roomUpdateFile:"room-update-file",roomUserAudioStateChanged:"room-useraudiostate-changed",roomErrorNotice:"room-error-notice",roomInfoNotice:"room-info-notice",roomWarnNotice:"room-warn-notice",roomUserNetworkStateChanged:"room-usernetworkstate-changed",roomParticipantLeave:"room-participant_leave",roomParticipantJoin:"room-participant_join",roomTextMessage:"room-text-message",roomModeChanged:"room-mode-changed",roomPubmsg:"room-pubmsg",roomDelmsg:"room-delmsg",roomUserPropertyChanged:"room-userproperty-changed",roomUserMainCameraChanged:"room-usermaincamera-changed",roomPlaybackClear_all:"room-playback-clear_all",roomPlaybackDuration:"room-playback-duration",roomPlaybackPlaybackEnd:"room-playback-playbackEnd",roomPlaybackPlayback_updatetime:"room-playback-playback_updatetime",roomClientNotificationOnMediaFileEnded:"room-clientNotification-onMediaFileEnded",roomNativeNotification:"room-native-notification",roomClientClose:"room-client-close",roomUserVideoStateChanged:"room-uservideostate-changed",roomUserMediaStateChanged:"room-usermediastate-changed",roomUserScreenStateChanged:"room-userscreenstate-changed",roomUserFileStateChanged:"room-userfilestate-changed",roomVideoNetworkStateChanged:"room-videonetworkstate-changed",roomMediaNetworkStateChanged:"room-medianetworkstate-changed",roomScreenNetworkStateChanged:"room-screennetworkstate-changed",roomFileNetworkStateChanged:"room-filenetworkstate-changed",roomConnectTime:"room-connect-time",deviceFailure:"device-failure",deviceNotAvailable:"device-not-available",deviceSuccess:"device-success",roomUserVideoAttributesUpdate:"room-uservideoattributes-update",roomUserMediaAttributesUpdate:"room-usermediaattributes-update",roomUserScreenAttributesUpdate:"room-userscreenattributes-update",roomUserFileAttributesUpdate:"room-userfileattributes-update",roomFirstVideoFrame:"room-first-video-frame",roomFirstAudioFrame:"room-first-audio-frame",getUserMediaSuccess:"getUserMedia_success",getUserMediaFailure:"getUserMedia_failure",getUserMediaFailureReGetOnlyAudioStream:"getUserMedia_failure_reGetOnlyAudioStream",getUserMediaFailureReGetOnlyVideoStream:"getUserMedia_failure_reGetOnlyVideoStream",roomRtcStatsReportEvent:"room-rtcStatsReportEvent"},window.YS.ERROR_NOTICE={ERR_OK:0,ERR_NOT_INITIALIZED:101,ERR_INVALID_STATUS:102,ERR_BAD_PARAMETERS:103,ERR_NO_THIS_USER:104,ERR_HTTP_REQUEST_FAILED:111,ERR_PUBLISH_FAILED:131,ERR_PUBLISH_TIMEOUT:132,ERR_PUBLISH_ROOMMAXVIDEOLIMITED:133,ERR_PUBLISH_MAX_RECONNECT_COUNT:134,ERR_SUBSCRIBE_FAILED:141,ERR_SUBSCRIBE_TIMEOUT:142,ERR_SUBSCRIBE_STREAM_NOTFOUND:143,ERR_SWITCH_SERVER_FAILED:151},window.YS.INFO_NOTICE={INFO_PUBLISH_COMPLETED:2001,INFO_SUBSCRIBE_COMPLETED:2002},window.YS.WARNING_NOTICE={WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM:1011,WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM:1012,WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT:1013,WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT:1014,WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1015,WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE:1016},window.YS.DEVICE_STATE={DEVICE_REMOVE:0,DEVICE_ADD:1},window.YS.REC_TYPE={RECFILE:0,VIDEOLIST:1,MP3:2,MIXVIDEO:3},L.Constant=(L,{deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",videoinput:"videoinputDeviceId"},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}),YS.Constant=L.Constant,window.YS=window.YS||{},window.L=window.L||{},window.YS.storage={},L.aexInstance=void 0,window.YS.storage={},Object.keys=Object.keys||function(e){var t=[];if(e&&"object"===qt(e))for(var i in e)t.push(i);return t},Object.values=Object.values||function(e){var t=[];if(e&&"object"===qt(e))for(var i in e)t.push(e[i]);return t},function(){var b={cipher:function(e,t){for(var i=t.length/4-1,o=[[],[],[],[]],r=0;r<16;r++)o[r%4][Math.floor(r/4)]=e[r];o=b.addRoundKey(o,t,0,4);for(var n=1;n<i;n++)o=b.subBytes(o,4),o=b.shiftRows(o,4),o=b.mixColumns(o,4),o=b.addRoundKey(o,t,n,4);o=b.subBytes(o,4),o=b.shiftRows(o,4),o=b.addRoundKey(o,t,i,4);var a=new Array(16);for(r=0;r<16;r++)a[r]=o[r%4][Math.floor(r/4)];return a},keyExpansion:function(e){for(var t=e.length/4,i=6+t,o=new Array(4*(1+i)),r=new Array(4),n=0;n<t;n++){var a=[e[4*n],e[4*n+1],e[4*n+2],e[4*n+3]];o[n]=a}for(n=t;n<4*(1+i);n++){o[n]=new Array(4);for(var s=0;s<4;s++)r[s]=o[n-1][s];if(n%t==0){r=b.subWord(b.rotWord(r));for(s=0;s<4;s++)r[s]^=b.rCon[n/t][s]}else 6<t&&n%t==4&&(r=b.subWord(r));for(s=0;s<4;s++)o[n][s]=o[n-t][s]^r[s]}return o},subBytes:function(e,t){for(var i=0;i<4;i++)for(var o=0;o<t;o++)e[i][o]=b.sBox[e[i][o]];return e},shiftRows:function(e,t){for(var i=new Array(4),o=1;o<4;o++){for(var r=0;r<4;r++)i[r]=e[o][(r+o)%t];for(r=0;r<4;r++)e[o][r]=i[r]}return e},mixColumns:function(e,t){for(var i=0;i<4;i++){for(var o=new Array(4),r=new Array(4),n=0;n<4;n++)o[n]=e[n][i],r[n]=128&e[n][i]?e[n][i]<<1^283:e[n][i]<<1;e[0][i]=r[0]^o[1]^r[1]^o[2]^o[3],e[1][i]=o[0]^r[1]^o[2]^r[2]^o[3],e[2][i]=o[0]^o[1]^r[2]^o[3]^r[3],e[3][i]=o[0]^r[0]^o[1]^o[2]^r[3]}return e},addRoundKey:function(e,t,i,o){for(var r=0;r<4;r++)for(var n=0;n<o;n++)e[r][n]^=t[4*i+n][r];return e},subWord:function(e){for(var t=0;t<4;t++)e[t]=b.sBox[e[t]];return e},rotWord:function(e){for(var t=e[0],i=0;i<3;i++)e[i]=e[i+1];return e[3]=t,e},sBox:[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],Ctr:{}};b.Ctr.encrypt=function(e,t,i){t=t||"roadof_2019_@beijing_20190916_roadof_2019_@beijing";if(128!=(i=i||256)&&192!=i&&256!=i)return"";e=I.encode(e),t=I.encode(t);for(var o=i/8,r=new Array(o),n=0;n<o;n++)r[n]=isNaN(t.charCodeAt(n))?0:t.charCodeAt(n);var a=b.cipher(r,b.keyExpansion(r));a=a.concat(a.slice(0,o-16));var s=new Array(16),c=(new Date).getTime(),d=c%1e3,u=Math.floor(c/1e3),l=Math.floor(65535*Math.random());for(n=0;n<2;n++)s[n]=d>>>8*n&255;for(n=0;n<2;n++)s[n+2]=l>>>8*n&255;for(n=0;n<4;n++)s[n+4]=u>>>8*n&255;var p="";for(n=0;n<8;n++)p+=String.fromCharCode(s[n]);for(var f=b.keyExpansion(a),m=Math.ceil(e.length/16),g=new Array(m),v=0;v<m;v++){for(var h=0;h<4;h++)s[15-h]=v>>>8*h&255;for(h=0;h<4;h++)s[15-h-4]=v/4294967296>>>8*h;var S=b.cipher(s,f),y=v<m-1?16:(e.length-1)%16+1,_=new Array(y);for(n=0;n<y;n++)_[n]=S[n]^e.charCodeAt(16*v+n),_[n]=String.fromCharCode(_[n]);g[v]=_.join("")}var L=p+g.join("");return L=w.encode(L)},b.Ctr.decrypt=function(e,t,i){t=t||"roadof_2019_@beijing_20190916_roadof_2019_@beijing";if(128!=(i=i||256)&&192!=i&&256!=i)return"";e=w.decode(e),t=I.encode(t);for(var o=i/8,r=new Array(o),n=0;n<o;n++)r[n]=isNaN(t.charCodeAt(n))?0:t.charCodeAt(n);var a=b.cipher(r,b.keyExpansion(r));a=a.concat(a.slice(0,o-16));var s=new Array(8),c="";c=e.slice(0,8);for(n=0;n<8;n++)s[n]=c.charCodeAt(n);for(var d=b.keyExpansion(a),u=Math.ceil((e.length-8)/16),l=new Array(u),p=0;p<u;p++)l[p]=e.slice(8+16*p,8+16*p+16);e=l;var f=new Array(e.length);for(p=0;p<u;p++){for(var m=0;m<4;m++)s[15-m]=p>>>8*m&255;for(m=0;m<4;m++)s[15-m-4]=(p+1)/4294967296-1>>>8*m&255;var g=b.cipher(s,d),v=new Array(e[p].length);for(n=0;n<e[p].length;n++)v[n]=g[n]^e[p].charCodeAt(n),v[n]=String.fromCharCode(v[n]);f[p]=v.join("")}var h=f.join("");return h=I.decode(h)};var w={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e,t){t=void 0!==t&&t;var i,o,r,n,a,s,c,d,u=[],l="",p=w.code;if(0<(s=(c=t?e.encodeUTF8():e).length%3))for(;s++<3;)l+="=",c+="\0";for(s=0;s<c.length;s+=3)o=(i=c.charCodeAt(s)<<16|c.charCodeAt(s+1)<<8|c.charCodeAt(s+2))>>18&63,r=i>>12&63,n=i>>6&63,a=63&i,u[s/3]=p.charAt(o)+p.charAt(r)+p.charAt(n)+p.charAt(a);return d=(d=u.join("")).slice(0,d.length-l.length)+l},decode:function(e,t){t=void 0!==t&&t;var i,o,r,n,a,s,c,d,u=[],l=w.code;d=t?e.decodeUTF8():e;for(var p=0;p<d.length;p+=4)i=(s=l.indexOf(d.charAt(p))<<18|l.indexOf(d.charAt(p+1))<<12|(n=l.indexOf(d.charAt(p+2)))<<6|(a=l.indexOf(d.charAt(p+3))))>>>16&255,o=s>>>8&255,r=255&s,u[p/4]=String.fromCharCode(i,o,r),64==a&&(u[p/4]=String.fromCharCode(i,o)),64==n&&(u[p/4]=String.fromCharCode(i));return c=u.join(""),t?c.decodeUTF8():c}},I={encode:function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|63&t)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|63&t)})},decode:function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2);return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(31&e.charCodeAt(0))<<6|63&e.charCodeAt(1);return String.fromCharCode(t)})}};L.aexInstance=b.Ctr}(),L.Utils=function(){var s=void 0,o={localStorage:!1,sessionStorage:!1},p="Utils ";return s={handleMediaPlayOnEvent:function(r,n,e){try{if(L.Utils.removeEvent(r,"canplay",s.handleMediaPlayOnEvent.bind(null,r,n)),L.Utils.removeEvent(r,"loadedmetadata",s.handleMediaPlayOnEvent.bind(null,r,n)),L.Utils.removeEvent(r,"loadeddata",s.handleMediaPlayOnEvent.bind(null,r,n)),r&&r.play&&"function"==typeof r.play&&"play"===r.getAttribute("customdata-playstate")){var t=r.play();L.Utils.isFunction(e)&&e(0),t&&t.catch&&"function"==typeof t.catch&&t.catch(function(e){var t=e,i=!1;if("object"===qt(e))for(var o in t={},e)"function"==typeof e[o]||"code"!==o&&"name"!==o&&"message"!==o||(t[o]=e[o],"message"===o&&/The operation was aborted/g.test(e[o])&&(i=!0));L.Logger[i?"info":"error"](p,"media play err:",L.Utils.toJsonStringify(t),n?" , media element id is "+n:" media element:",n?"":r)})}}catch(e){var i=e,o=!1;if("object"===qt(e))for(var a in i={},e)"function"==typeof e[a]||"code"!==a&&"name"!==a&&"message"!==a||(i[a]=e[a],"message"===a&&/The operation was aborted/g.test(e[a])&&(o=!0));L.Logger[o?"info":"error"](p,"media play error:",L.Utils.toJsonStringify(i),n?" , media element id is "+n:" media element:",n?"":r)}},handleMediaPauseOnEvent:function(r,n){try{if(L.Utils.removeEvent(r,"canplay",s.handleMediaPauseOnEvent.bind(null,r,n)),L.Utils.removeEvent(r,"loadedmetadata",s.handleMediaPauseOnEvent.bind(null,r,n)),L.Utils.removeEvent(r,"loadeddata",s.handleMediaPauseOnEvent.bind(null,r,n)),r&&r.pause&&"function"==typeof r.pause&&"pause"===r.getAttribute("customdata-playstate")){var e=r.pause();e&&e.catch&&"function"==typeof e.catch&&e.catch(function(e){var t=e,i=!1;if("object"===qt(e))for(var o in t={},e)"function"==typeof e[o]||"code"!==o&&"name"!==o&&"message"!==o||(t[o]=e[o],"message"===o&&/The operation was aborted/g.test(e[o])&&(i=!0));L.Logger[i?"info":"error"](p,"media pause err:",L.Utils.toJsonStringify(t),n?" , media element id is "+n:" media element:",n?"":r)})}}catch(e){var t=e;if("object"===qt(e)){var i=!(t={});for(var o in e)"function"==typeof e[o]||"code"!==o&&"name"!==o&&"message"!==o||(t[o]=e[o],"message"===o&&/The operation was aborted/g.test(e[o])&&(i=!0))}L.Logger[i?"info":"error"](p,"media pause error:",L.Utils.toJsonStringify(t),n?" , media element id is "+n:" media element:",n?"":r)}}},{addEvent:function(e,t,i,o){o=null!=o&&null!=o&&o,e.addEventListener?e.addEventListener(t,i,o):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},removeEvent:function(e,t,i,o){o=null!=o&&null!=o&&o,e.removeEventListener?e.removeEventListener(t,i,o):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null},toJsonStringify:function(e,t){if(!(t=null==t||t))return e;if(!e)return e;try{if("object"!==qt(e))return e;var i=JSON.stringify(e);i&&(e=i)}catch(e){}return e},toJsonParse:function(e,t){if(!(t=null==t||t))return e;if(!e)return e;try{if("string"!=typeof e)return e;var i=JSON.parse(e);i&&(e=i)}catch(e){}return e},encrypt:function(e,t,i,o){if(!e)return e;i=i||YS.hexEncryptDecryptKey,o=o||YS.hexEncryptDecryptBit,t=null!=t?t:"roadof_2019_@beijing";var r=L.aexInstance.encrypt(e,i,o);return r=t+r+t},decrypt:function(e,t,i,o){if(!e)return e;i=i||YS.hexEncryptDecryptKey,o=o||YS.hexEncryptDecryptBit,t=null!=t?t:"roadof_2019_@beijing";var r=new RegExp(t,"gm");return e=e.replace(r,""),L.aexInstance.decrypt(e,i,o)},mediaPlay:function(e,t){var i=void 0;e&&"string"==typeof e?e=document.getElementById(e):e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&e.getAttribute&&"function"==typeof e.getAttribute&&(i=e.getAttribute("id")),e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&(e.setAttribute("customdata-playstate","play"),0!==e.readyState||"safari"===L.Utils.getBrowserInfo(!0).info.browserName?s.handleMediaPlayOnEvent(e,i,t):(L.Utils.removeEvent(e,"canplay",s.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.removeEvent(e,"loadedmetadata",s.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.removeEvent(e,"loadeddata",s.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"canplay",s.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"loadedmetadata",s.handleMediaPlayOnEvent.bind(null,e,i,t)),L.Utils.addEvent(e,"loadeddata",s.handleMediaPlayOnEvent.bind(null,e,i,t))))},mediaPause:function(e){var t=void 0;e&&"string"==typeof e?e=document.getElementById(e):e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&e.getAttribute&&"function"==typeof e.getAttribute&&(t=e.getAttribute("id")),e&&/(audio|video)/g.test(e.nodeName.toLowerCase())&&(e.setAttribute("customdata-playstate","pause"),0!==e.readyState||"safari"===L.Utils.getBrowserInfo(!0).info.browserName?s.handleMediaPauseOnEvent(e,t):(L.Utils.removeEvent(e,"canplay",s.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.removeEvent(e,"loadedmetadata",s.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.removeEvent(e,"loadeddata",s.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"canplay",s.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"loadedmetadata",s.handleMediaPauseOnEvent.bind(null,e,t)),L.Utils.addEvent(e,"loadeddata",s.handleMediaPauseOnEvent.bind(null,e,t))))},localStorage:{setItem:function(t,i){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(t,i):L.Logger.warning(p,"Browser does not support localStorage.setItem , key is "+t+" , value is "+i+"!"):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage!")),window.YS.storage[t]=i)}catch(e){o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.YS.storage[t]=i}},getItem:function(t){try{return window.localStorage?window.localStorage.getItem?window.localStorage.getItem(t):(L.Logger.warning(p,"Browser does not support localStorage.getItem , key is "+t+" !"),""):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage!")),window.YS.storage[t]||"")}catch(e){return o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.YS.storage[t]||""}},removeItem:function(t){try{return window.localStorage?window.localStorage.removeItem?window.localStorage.removeItem(t):(L.Logger.warning(p,"Browser does not support localStorage.removeItem , key is "+t+" !"),""):(o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage!")),window.YS.storage[t]&&delete window.YS.storage[t],"")}catch(e){return o.localStorage||(o.localStorage=!0,L.Logger.warning(p,"Browser does not support localStorage , error info:",L.Utils.toJsonStringify(e))),window.YS.storage[t]&&delete window.YS.storage[t],""}}},sessionStorage:{setItem:function(e,t){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(e,t):L.Logger.warning(p,"Browser does not support sessionStorage.setItem , key is "+e+" , value is "+t+"!"):o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage!"))}catch(e){o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e)))}},getItem:function(e){try{return window.sessionStorage?window.sessionStorage.getItem?window.sessionStorage.getItem(e):(L.Logger.warning(p,"Browser does not support sessionStorage.getItem , key is "+e+" !"),""):(o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage!")),"")}catch(e){return o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e))),""}},removeItem:function(e){try{return window.sessionStorage?window.sessionStorage.removeItem?window.sessionStorage.removeItem(e):(L.Logger.warning(p,"Browser does not support sessionStorage.removeItem , key is "+e+" !"),""):(o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage!")),"")}catch(e){return o.sessionStorage||(o.sessionStorage=!0,L.Logger.warning(p,"Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(e))),""}}},getBrowserInfo:function(e){if(e&&window._ysBrowserInfo)return window._ysBrowserInfo;var t,i,o=window.navigator.userAgent,r=/(msie\s|trident.*rv:)([\w.]+)/,n=/edge\/(\d+).(\d+)$/,a=/(firefox)\/([\w.]+)/,s=/(opera).+version\/([\w.]+)/,c=/(chrome)\/([\w.]+)/,d=/(crios)\/([\w.]+)/,u=/version\/([\w.]+).*(safari)/,l=(t=o.toLowerCase(),(i=r.exec(t))?{browser:"ie",version:i[2]||"0"}:(i=n.exec(t))?{browser:"edge",version:i[2]||"0"}:(i=a.exec(t))?{browser:i[1]||"firefox",version:i[2]||"0"}:(i=s.exec(t))?{browser:i[1]||"opera",version:i[2]||"0"}:(i=c.exec(t))?{browser:i[1]||"chrome",version:i[2]||"0"}:(i=d.exec(t))?{browser:"chrome",version:i[2]||"0"}:(i=u.exec(t))&&-1===t.indexOf("android")?{browser:i[2]||"safari",version:i[1]||"0"}:{browser:"unknown",version:"unknown"}),p=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language,f={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{edge:-1<e.indexOf("Edge"),trident:-1<e.indexOf("Trident"),presto:-1<e.indexOf("Presto"),webKit:-1<e.indexOf("AppleWebKit"),gecko:-1<e.indexOf("Gecko")&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/)||-1<e.indexOf("Android")||-1<e.indexOf("iPhone")||-1<e.indexOf("iPad")||-1<e.indexOf("iPod")||-1<e.indexOf("Mac")&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints&&1<navigator.maxTouchPoints,ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<e.indexOf("Android"),iPhone:-1<e.indexOf("iPhone"),iPad:-1<e.indexOf("iPad")||-1<e.indexOf("Mac")&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints&&1<navigator.maxTouchPoints,safari:"safari"===l.browser}}(),language:p?p.toLowerCase():void 0,cpuarchitecture:-1<o.toLowerCase().indexOf("wow64")||-1<o.toLowerCase().indexOf("x64")?"x64":"x86",info:{browserName:l.browser,browserVersion:l.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}};return window._ysBrowserInfo=f},getJsonLength:function(e){var t=0;if("object"===qt(e))for(var i in e)e.hasOwnProperty(i)&&++t;return t},detectOS:function(){try{var e=navigator.userAgent;if(L.Utils.getBrowserInfo(!0).versions.mobile){if(-1<e.indexOf("Android")){var t=e.substring(e.indexOf("Android"));if(-1<(t=t.substring(0,t.indexOf(";"))).indexOf("Android")){var i=e.substring(e.indexOf(t)),o=(i=i.substring(i.indexOf(";")+1)).indexOf("/");return-1===o&&(o=i.indexOf(";")),-1===o&&(o=i.indexOf(")")),t+((i=i.substring(0,o))?"("+i+")":"")}return"Android"}if(-1<e.indexOf("iPhone")){var r=e.substring(e.indexOf("CPU ")).replace("CPU ","").replace("iPhone OS ","");return"iPhone"+((r=r.substring(0,r.indexOf(" like")))?"("+r+")":"")}if(-1<e.indexOf("iPad")){var n=e.substring(e.indexOf("CPU ")).replace("CPU ","").replace("OS ","");return"iPad"+((n=n.substring(0,n.indexOf(" like")))?"("+n+")":"")}if(-1<e.indexOf("iPod")){var a=e.substring(e.indexOf("CPU ")).replace("CPU ","").replace("OS ","");return"iPod"+((a=a.substring(0,a.indexOf(" like")))?"("+a+")":"")}if(-1<e.indexOf("Mac")&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints&&1<navigator.maxTouchPoints)return"iPad_MacIntel"}var s="Win32"===navigator.platform||"Windows"===navigator.platform,c="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(c)return"Mac";if("X11"===navigator.platform&&!s&&!c)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(s){if(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))return"Win2000";if(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))return"WinXP";if(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))return"Win2003";if(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))return"WinVista";if(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))return"Win7";if(-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8"))return"Win8";if(-1<e.indexOf("Windows NT 10.0")||-1<e.indexOf("Windows 10"))return"Win10"}return"Other"}catch(e){return L.Logger.error(p,"detectOS method error:",e),"Other"}},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isBoolean:function(e){return"boolean"==typeof e},isArray:function(e){return Array.isArray(e)},isHTMLCollection:function(e){return"object"===qt(e)&&window.HTMLCollection&&e instanceof window.HTMLCollection},isNull:function(e){return!e&&0!==e&&"boolean"!=typeof e},getFileName:function(e){if("string"!=typeof e)return"";var t=e.lastIndexOf("/"),i=e.lastIndexOf("\\"),o=Math.max(t,i);return e.substring(o+1)},copy:function(e){return L.Utils.toJsonParse(L.Utils.toJsonStringify(e))},stopTrack:function(e,t){if(!L.Utils.getBrowserInfo(!0).versions.mobile||"safari"!==L.Utils.getBrowserInfo(!0).info.browserName)return t?(e._custom_id&&e._custom_id!==e._custom_parent_id&&YS.coreEventController.dispatchEvent(YS.RoadofEvent({type:"sdk-track-stop",data:{force:t,custom_id:e._custom_id,kind:e.kind}}),!1),delete e._custom_id,delete e._custom_parent_id,e._custom_stoped=!0,void(e&&e.stop())):void(L.Utils.getBrowserInfo(!0).versions.mobile||e&&"video"===e.kind&&YS.notStopVideoTrack||e&&"audio"===e.kind&&YS.notStopAudioTrack||e&&"function"==typeof e.stop&&(e._custom_id&&e._custom_id!==e._custom_parent_id&&YS.coreEventController.dispatchEvent(YS.RoadofEvent({type:"sdk-track-stop",data:{force:t,custom_id:e._custom_id,kind:e.kind}}),!1),delete e._custom_id,delete e._custom_parent_id,e._custom_stoped=!0,e.stop()))},cloneTrack:function(e){var t=void 0;return e&&L.Utils.isFunction(e.clone)?(t=e.clone(),e._custom_id=e._custom_id||L.Utils.generategGuid()+":"+(new Date).getTime(),t._custom_parent_id=e._custom_id,t._custom_deviceId=e._custom_deviceId):t=e,t},removeTrack:function(e,t){e&&t&&e.removeTrack(t)},checkMediaStreamVideoVaild:function(e){var t=!0;if(!e||!e.getVideoTracks)return t;var i=e.getVideoTracks();if(!i||i.length<=0)return t;for(var o=0;o<i.length;o++){var r=i[o];if(r&&!0===r.muted){t=!1;break}}return t},forceStopMediaStream:function(e){if(e){if(e.getVideoTracks)for(var t=e.getVideoTracks(),i=0;i<t.length;i++){(o=t[i])&&"function"==typeof o.stop&&L.Utils.stopTrack(o,!0)}if(e.getAudioTracks)for(t=e.getAudioTracks(),i=0;i<t.length;i++){var o;(o=t[i])&&"function"==typeof o.stop&&L.Utils.stopTrack(o,!0)}}},cloneMediaStream:function(e,t,i){if(t="boolean"!=typeof t||t,i="boolean"!=typeof i||i,!e)return e;if(!window.MediaStream||"function"!=typeof window.MediaStream)return L.Logger.error(p,"borwser not support MediaStream!"),e;try{var o=new window.MediaStream;if(t&&0<e.getAudioTracks().length)for(var r=0,n=e.getAudioTracks().length;r<n;r++){var a=e.getAudioTracks()[r];o.addTrack(L.Utils.cloneTrack(a))}if(i&&0<e.getVideoTracks().length)for(r=0,n=e.getVideoTracks().length;r<n;r++){var s=e.getVideoTracks()[r];o.addTrack(L.Utils.cloneTrack(s))}return o}catch(e){L.Logger.error(p,"cloneMediaStream err:",e)}},sdkAjax:function(e){var n=/\[\]$/;function a(e,t){var i,o,r,n,a,s=0;if(n=!!(o=e)&&"length"in o&&o.length,a=c(o),L.Utils.isFunction(o)||null!=(r=o)&&r===r.window||!("array"===a||0===n||"number"==typeof n&&0<n&&n-1 in o)){for(s in e)if(!1===t.call(e[s],s,e[s]))break}else for(i=e.length;s<i&&!1!==t.call(e[s],s,e[s]);s++);return e}function c(e){return null==e?e+"":"object"===qt(e)||"function"==typeof e?{}[{}.toString.call(e)]||"object":qt(e)}function t(e){var t="";return e&&"object"===qt(e)?t=function(e,t){function i(e,t){var i=L.Utils.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)}var o,r=[];if(null==e)return"";if(Array.isArray(e)||!s(e))a(e,function(){i(this.name,this.value)});else for(o in e)d(o,e[o],t,i);return r.join("&")}(e):"string"==typeof e&&(t=e),t}function s(e){var t,i;return!(!e||"[object Object]"!==toString.call(e))&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(i={}.hasOwnProperty.call(t,"constructor")&&t.constructor)&&{}.hasOwnProperty.toString.call(i)==={}.hasOwnProperty.toString.call(Object))}function d(i,e,o,r){var t;if(Array.isArray(e))a(e,function(e,t){o||n.test(i)?r(i,t):d(i+"["+("object"===qt(t)&&null!=t?e:"")+"]",t,o,r)});else if(o||"object"!==c(e))r(i,e);else for(t in e)d(i+"["+t+"]",e[t],o,r)}var i={type:e.type||"GET",url:e.url||"",data:e.data||null,async:e.async||!0,dataType:e.dataType||"text",contentType:e.contentType||"application/x-www-form-urlencoded;charset=UTF-8",isupLoadFile:e.isupLoadFile,success:e.success,error:e.error,progress:e.progress,start:e.progress,end:e.end};i.type=i.type.toUpperCase();var o=void 0,r=void 0;window.XMLHttpRequest?o=new XMLHttpRequest:window.ActiveXObject?o=new ActiveXObject("Microsoft.XMLHTTP"):L.Logger.error(p,"[myAjax] Your browser does not support it : XMLHttpRequest and  ActiveXObject "),i.progress&&(o.upload.onprogress=i.progress),o.onreadystatechange=function(){if(4===o.readyState)if(200<=o.status&&o.status<300||304===o.status)switch(o.upload.onprogress=null,i.dataType){case"text":case"TEXT":i.success&&i.success(o.responseText);break;case"json":case"JSON":var e={};try{e=JSON.parse(o.responseText)}catch(e){L.Logger.warning(p," xmlHttp request url : "+i.url+", result : "+o.responseText)}i.success&&i.success(e);break;case"xml":case"XML":i.success&&i.success(o.responseXML)}else o.upload.onprogress=null,i.error&&i.error(o.status)},i.start&&(o.onloadstart=function(){i.start()}),i.end&&(o.onloadend=function(){i.end()});var u=-1===i.url.indexOf("?")?"?":"&";if(i.url.indexOf("?")===i.url.length-1&&(u=""),"GET"===i.type){var l=t(i.data);0!==l.length&&(l=u+l),r=i.url+l,o.open(i.type,r,i.async),o.send()}else"POST"===i.type&&(r=i.url,o.open(i.type,r,i.async),i.isupLoadFile?o.send(i.data):(o.setRequestHeader("Content-Type",i.contentType),o.send(t(i.data))));return o},getUserMediaFailCode:function(e){var t=window.YS_ERR.DEVICE_ERROR_UnknownError;switch(e){case"NotFoundError":case"DevicesNotFoundError":t=window.YS_ERR.DEVICE_ERROR_NotFoundError;break;case"NotAllowedError":case"PermissionDeniedError":t=window.YS_ERR.DEVICE_ERROR_NotAllowedError;break;case"NotReadableError":case"SourceUnavailableError":case"TrackStartError":t=window.YS_ERR.DEVICE_ERROR_NotReadableError;break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":t=window.YS_ERR.DEVICE_ERROR_OverconstrainedError;break;case"NotSupportedError":case"TypeError":t=window.YS_ERR.DEVICE_ERROR_UnknownError}return t},getMaxBPS:function(e,t){return e<=80?t<20?64:96:e<=176?t<20?128:192:e<=320?t<20?256:384:e<=640?t<20?384:512:e<=1280?t<15?1024:15<=t&&t<=20?1280:1536:t<15?1280:15<=t&&t<=20?1536:2048},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},generategGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},getNetLevel:function(e,t){var i=L.Utils.getNetPacketsLostRateLevel(e),o=L.Utils.getNetDelayLevel(t);return Math.max(i,o)},getNetPacketsLostRateLevel:function(e){window.YS.NET_QUALITY.YS_NET_QUALITY_VERYBAD;return e<1?window.YS.NET_QUALITY.YS_NET_QUALITY_EXCELLENT:e<5?window.YS.NET_QUALITY.YS_NET_QUALITY_GOOD:e<10?window.YS.NET_QUALITY.YS_NET_QUALITY_ACCEPTED:e<20?window.YS.NET_QUALITY.YS_NET_QUALITY_BAD:window.YS.NET_QUALITY.YS_NET_QUALITY_VERYBAD},getNetDelayLevel:function(e){window.YS.NET_QUALITY.YS_NET_QUALITY_VERYBAD;return e<80?window.YS.NET_QUALITY.YS_NET_QUALITY_EXCELLENT:e<150?window.YS.NET_QUALITY.YS_NET_QUALITY_GOOD:e<300?window.YS.NET_QUALITY.YS_NET_QUALITY_ACCEPTED:e<500?window.YS.NET_QUALITY.YS_NET_QUALITY_BAD:window.YS.NET_QUALITY.YS_NET_QUALITY_VERYBAD},randomWord:function(e){e=e||1024;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=t.length,o="",r=0;r<e;r++)o+=t.charAt(Math.floor(Math.random()*i));return o.toLowerCase(),o},setMaxBWToSdp:function(e,t,i){var o,r;return e=L.Utils.formatSdp(e),t&&t.video&&t.maxVideoBW&&(null==(r=(e=e.replace(/b=AS:.*\r\n/g,"")).match(/m=video.*\r\n/))&&(r=e.match(/m=video.*\n/)),r&&0<r.length&&(o=r[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(r[0],o))),i&&i.audio&&i.maxAudioBW&&(null==(r=e.match(/m=audio.*\r\n/))&&(r=e.match(/m=audio.*\n/)),r&&0<r.length&&(o=r[0]+"b=AS:"+i.maxAudioBW+"\r\n",e=e.replace(r[0],o))),e},setHiFiToSdp:function(e){var t,i;e=L.Utils.formatSdp(e),YS.isHiFi&&(null==(i=(e=e.replace(new RegExp("a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate="+YS.maxaveragebitrateToHifi+";maxplaybackrate=48000;stereo=1\r\n","g"),"")).match(/a=rtpmap:111.*\r\n/))&&(i=e.match(/a=rtpmap:111.*\n/)),i&&0<i.length&&(t=i[0]+"a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate="+YS.maxaveragebitrateToHifi+";maxplaybackrate=48000;stereo=1\r\n",e=e.replace(i[0],t)));return e},formatSdp:function(e){return e=e.replace(/\r?\n/g,"#roadofcloudFormatSdp_r_n#").replace(/#roadofcloudFormatSdp_r_n#/g,"\r\n")},getBrowser:function(){var e="none";return"chrome"===L.Utils.getBrowserInfo(!0).info.browserName?(e="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(e="electron")):"firefox"===L.Utils.getBrowserInfo(!0).info.browserName?e="mozilla":"safari"===L.Utils.getBrowserInfo(!0).info.browserName?e="safari":"edge"===L.Utils.getBrowserInfo(!0).info.browserName?e="edge":null!==window.navigator.userAgent.match("Bowser")?e="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(e="bowser"),e},createMediaStream:function(e,t){var i=void 0;if(window.MediaStream&&"function"==typeof window.MediaStream){i=new window.MediaStream;e&&i.addTrack(e),t&&i.addTrack(t)}else L.Logger.error(p,"The browser does not support the creation of mediaStream!");return i},replaceHostname:function(e,t){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(e)&&t&&e){var i=e.indexOf(".");if(0<i){var o=e.substring(0,i),r=new RegExp(o);e=e.replace(r,t)}}return e},speedNetwordk:function(e,t,i,o,r){(r=r||{}).infoLog=!L.Utils.isBoolean(r.infoLog)||r.infoLog,r.errorLog=!L.Utils.isBoolean(r.errorLog)||r.errorLog;var n=r.randomWordLength||512,a=(new Date).getTime(),s=e+"://"+t+":"+i+"/speed.php?ts="+a,c=L.Utils.randomWord(n);return L.Utils.sdkAjax({url:s,type:"GET",async:!0,data:{data:c},dataType:"text",success:function(e){var t=(new Date).getTime();r.infoLog&&L.Logger.info(p,(r.source||"")+"speedNetwordk finshed,url is "+s+" ,elapsed time is "+(t-a)+" ms"),L.Utils.isFunction(o)&&o(0,t-a,a,t,e)},error:function(e){var t=(new Date).getTime();r.errorLog&&L.Logger.error(p,(r.source||"")+"speedNetwordk fail,url is "+s+" ,elapsed time is "+(t-a)+" ms, error info:",e),L.Utils.isFunction(o)&&o(-1,t-a,a,t,e)}})},nativeMediaStream:function(e,t){var i={},o=[],r=[];return e&&(o=[e]),t&&(r=[t]),i.getAudioTracks=function(){return r},i.getVideoTracks=function(){return o},i.addTrack=function(e){e&&e.kind&&e.id?"video"===e.kind?o.push(e):"audio"===e.kind&&r.push(e):L.Logger.error(p,"Native addTrack Parameters are not! ")},i.removeTrack=function(t){t&&t.kind&&t.id?"video"===t.kind?o=o.filter(function(e){return e.id!==t.id}):"audio"===t.kind&&(r=r.filter(function(e){return e.id!==t.id})):L.Logger.error(p,"Native addTrack Parameters are not! ")},i},isVideoinputDeviceIdFromDeviceList:function(e){var t=!1;if(YS.deviceInfoMap&&YS.deviceInfoMap.videoinput&&YS.deviceInfoMap.videoinput.length)for(var i=0,o=YS.deviceInfoMap.videoinput.length;i<o;i++)if(YS.deviceInfoMap.videoinput[i]&&YS.deviceInfoMap.videoinput[i].deviceId===e){t=!0;break}return t},isAudioinputDeviceIdFromDeviceList:function(e){var t=!1;if(YS.deviceInfoMap&&YS.deviceInfoMap.audioinput&&YS.deviceInfoMap.audioinput.length)for(var i=0,o=YS.deviceInfoMap.audioinput.length;i<o;i++)if(YS.deviceInfoMap.audioinput[i]&&YS.deviceInfoMap.audioinput[i].deviceId===e){t=!0;break}return t},isSupportMediaStreamTrackMethod:function(e){try{if(!YS.isYsNative&&window.MediaStreamTrack&&window.MediaStreamTrack.prototype)return window.MediaStreamTrack.prototype.hasOwnProperty(e)}catch(e){L.Logger.error(p,"getMediaStreamTrackSupport error:",e)}return!1},isSupportRTCRtpSenderMethod:function(e){try{if(!YS.isYsNative&&window.RTCRtpSender&&window.RTCRtpSender.prototype)return window.RTCRtpSender.prototype.hasOwnProperty(e);if(YS.isYsNative)return!0}catch(e){L.Logger.error(p,"getMediaStreamTrackSupport error:",e)}return!1},getBrowserName:function(){try{return(e=function(){var e=function(){if("ie"===L.Utils.getBrowserInfo(!0).info.browserName)return"ie";if("edge"===L.Utils.getBrowserInfo(!0).info.browserName)return"edge";if(/dingtalk/.test(navigator.userAgent.toLowerCase()))return"dingding";if(/alipayclient/.test(navigator.userAgent.toLowerCase()))return"alipay";if(/micromessenger/.test(navigator.userAgent.toLowerCase()))return"wechat";if(/qqbrowser/.test(navigator.userAgent.toLowerCase())||/ qq/.test(navigator.userAgent.toLowerCase()))return"qq";if(t(/^sogou/i,0))return"sogou";if(t(/^liebao/i,0))return"liebao";if(function(e,t){var i=navigator.mimeTypes;for(var o in i)if(i[o][e]==t)return!0;return!1}("type","application/vnd.chromium.remoting-viewer"))return"360";if("opera"===L.Utils.getBrowserInfo(!0).info.browserName)return"opera";if(/bidubrowser/.test(navigator.userAgent.toLowerCase()))return"baidu";if(/ubrowser/.test(navigator.userAgent.toLowerCase()))return"uc";if(/maxthon/.test(navigator.userAgent.toLowerCase()))return"maxthon";return"chrome"!==L.Utils.getBrowserInfo(!0).info.browserName?"other":"chrome"}();function t(e,t){var i=window.external||{};for(var o in i)if(e.test(t?i[o]:o))return!0;return!1}return{isIE:function(){return"ie"===e},isEdge:function(){return"edge"===e},isChrome:function(){return"chrome"===e},is360:function(){return"360"===e},isLiebao:function(){return"liebao"===e},isSogou:function(){return"sogou"===e},isQQ:function(){return"qq"===e},isWechat:function(){return"wechat"===e},isDingding:function(){return"dingding"===e},isAlipay:function(){return"alipay"===e},isSafari:function(){return"safari"===L.Utils.getBrowserInfo(!0).info.browserName},isFirefox:function(){return"firefox"===L.Utils.getBrowserInfo(!0).info.browserName},isOpera:function(){return"opera"===e},isBaidu:function(){return"baidu"===e},isUC:function(){return"uc"===e},isMaxthon:function(){return"maxthon"===e}}}()).isIE()?"ie":e.isEdge()?"edge":e.is360()?"360":e.isLiebao()?"liebao":e.isSogou()?"sogou":e.isAlipay()?L.Utils.getBrowserInfo(!0).versions.mobile?"mobileAlipayBrowser":"alipayBrowser":e.isDingding()?L.Utils.getBrowserInfo(!0).versions.mobile?"mobileDingdingBrowser":"dingdingBrowser":e.isWechat()?L.Utils.getBrowserInfo(!0).versions.mobile?"mobileWechatBrowser":"wechatBrowser":e.isQQ()?L.Utils.getBrowserInfo(!0).versions.mobile?/ qq/.test(navigator.userAgent.toLowerCase())?"mobileQQInAppBrowser":"mobileQQBrowser":"qq":e.isSafari()?"safari":e.isFirefox()?"firefox":e.isOpera()?"opera":e.isBaidu()?"baidu":e.isUC()?"UC":e.isMaxthon()?"maxthon":e.isChrome()?"chrome":"other"}catch(e){return L.Logger.error(p,"getBrowserName err:",e),"unknown"}var e},createTack:function(){return document.createElement("canvas").captureStream().getTracks()[0]},getUserMediaFailAdapter:function(e,t){var i={};if("object"===qt(e)){i.name=e.name,i.message=e.message;var o=L.Utils.getBrowserInfo(!0);if("safari"===o.info.browserName){if("Error"===e.name&&e.constructor&&e.constructor.name){if(i.name=e.constructor.name,t&&"object"===qt(t.video)&&t.video.deviceId&&/(OverconstrainedError|ConstraintNotSatisfiedError)/g.test(i.name)){var r="object"===qt(t.video.deviceId)?t.video.deviceId.exact:t.video.deviceId;L.Utils.isVideoinputDeviceIdFromDeviceList(r)||(L.Logger.info(p,"safari getUserMedia print OverconstrainedError,but not video debiceId, so OverconstrainedError change to NotFoundError!",r,t),i.name="NotFoundError")}if(t&&"object"===qt(t.audio)&&t.audio.deviceId&&/(OverconstrainedError|ConstraintNotSatisfiedError)/g.test(i.name)){r="object"===qt(t.audio.deviceId)?t.audio.deviceId.exact:t.audio.deviceId;L.Utils.isAudioinputDeviceIdFromDeviceList(r)||(L.Logger.info(p,"safari getUserMedia print OverconstrainedError,but not audio debiceId, so OverconstrainedError change to NotFoundError!",r,t),i.name="NotFoundError")}}}else if("edge"===o.info.browserName&&"NotFoundError"===i.name&&"object"===qt(t.video)&&t.video.deviceId){r="object"===qt(t.video.deviceId)?t.video.deviceId.exact:t.video.deviceId;L.Utils.isVideoinputDeviceIdFromDeviceList(r)&&(L.Logger.info(p,"edge getUserMedia print NotFoundError,but video debiceId is exist, so NotFoundError change to OverconstrainedError!",r,t),i.name="OverconstrainedError")}i.code=e.code||L.Utils.getUserMediaFailCode(i.name),e.constraintName&&(i.constraintName=e.constraintName),e.constraint&&(i.constraint=e.constraint)}else i={code:-1,name:"UnknownError",message:e};return i},_getUserMedia:function(t,i,o){try{var r=!1,e=function(e){if("edge"===L.Utils.getBrowserInfo(!0).info.browserName&&"object"===qt(t.video)&&!e.getVideoTracks().length)return L.Logger.info(p,"getUserMedia set OverconstrainedError, edge getUserMedia success,but not video track!",t),o&&o({name:"OverconstrainedError",message:"edge getUserMedia success,but not video track!"}),void(e=void 0);e.getTracks().forEach(function(e){"video"===e.kind?e._custom_deviceId="object"===qt(t.video)&&t.video.deviceId&&t.video.deviceId.exact:e._custom_deviceId="object"===qt(t.audio)&&t.audio.deviceId&&t.audio.deviceId.exact}),r||(i&&i.apply(null,arguments),r=!0)},n=function(){r||(o&&o.apply(null,arguments),r=!0)};L.Logger.debug(p,"getUserMedia constraints:"+L.Utils.toJsonStringify(t)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(e).catch(n):(L.Logger.warning(p,"adapter`s getUserMedia un-defined ?!",L.Utils.toJsonStringify(adapter&&adapter.browserDetails)),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia?navigator.getMedia(t,e,n):L.Logger.error(p,"adapter`s navigator.getMedia un-defined ?!"))}catch(e){L.Logger.error(p,"utils:getUserMedia err:",e)}},getUserMedia:function(r,n,a){try{var s=L.Utils.getBrowserInfo(!0);if(r=L.Utils.copy(r),"object"===qt(r.video)&&"firefox"===s.info.browserName&&delete r.video.frameRate,("safari"===s.info.browserName||"edge"===s.info.browserName)&&"object"===qt(r.video)){var e="object"===qt(r.video.width)?r.video.width.ideal:r.video.width,t="object"===qt(r.video.height)?r.video.height.ideal:r.video.height,i=window.YS._getFitVideoResolution(e,t,!0);e===i.width&&t===i.height||L.Logger.info(p,"getUserMedia change video resolution:"+e+"*"+t+" to "+i.width+"*"+i.height,s.versions.mobile,s.info.browserName,s.info.browserVersion),"object"===qt(r.video.width)?(r.video.width.ideal=i.width,r.video.width.hasOwnProperty("max")&&r.video.width.max<r.video.width.ideal&&(r.video.width.max=r.video.width.ideal)):r.video.width=i.width,"object"===qt(r.video.height)?(r.video.height.ideal=i.height,r.video.height.hasOwnProperty("max")&&r.video.height.max<r.video.height.ideal&&(r.video.height.max=r.video.height.ideal)):r.video.height=i.height}L.Utils._getUserMedia(r,n,function(e){var t=!0,i=L.Utils.getUserMediaFailAdapter(e,r);if(L.Logger.info(p,"getUserMedia failInfo:"+L.Utils.toJsonStringify(i)),/(OverconstrainedError|ConstraintNotSatisfiedError)/g.test(i.name)&&"object"===qt(r.video)&&r.video.hasOwnProperty("frameRate")){t=!1;var o="object"===qt(r.video.frameRate)?r.video.frameRate.ideal:r.video.frameRate;"safari"===s.info.browserName&&16<=o&&o<=23?(L.Logger.info(p,"getUserMedia video fail,frameRate range in [16,23], cahnge frameRate regain, constraints:"+L.Utils.toJsonStringify(r)),o<20?"object"===qt(r.video.frameRate)?r.video.frameRate.ideal=15:r.video.frameRate=15:"object"===qt(r.video.frameRate)?r.video.frameRate.ideal=24:r.video.frameRate=24):(L.Logger.info(p,"getUserMedia video fail,delete frameRate regain, constraints:"+L.Utils.toJsonStringify(r)),delete r.video.frameRate),L.Utils.getUserMedia(r,n,a)}t&&a&&a(i)})}catch(e){L.Logger.error(p,"utils:getUserMedia err:",e)}},applyConstraints:function(o,r){var n=o.kind;if(r=L.Utils.copy(r),"video"===n){var a=L.Utils.getBrowserInfo(!0);if(r.hasOwnProperty("frameRate")&&"firefox"===a.info.browserName&&delete r.frameRate,r.hasOwnProperty("noiseSuppression")&&"firefox"===a.info.browserName&&delete r.noiseSuppression,"safari"===a.info.browserName||"edge"===a.info.browserName){var e="object"===qt(r.width)?r.width.ideal:r.width,t="object"===qt(r.height)?r.height.ideal:r.height,i=window.YS._getFitVideoResolution(e,t,!0);e===i.width&&t===i.height||L.Logger.info(p,"applyConstraints change video resolution:"+e+"*"+t+" to "+i.width+"*"+i.height,a.versions.mobile,a.info.browserName,a.info.browserVersion),"object"===qt(r.width)?(r.width.ideal=i.width,r.width.hasOwnProperty("max")&&r.width.max<r.width.ideal&&(r.width.max=r.width.ideal)):r.width=i.width,"object"===qt(r.height)?(r.height.ideal=i.height,r.height.hasOwnProperty("max")&&r.height.max<r.height.ideal&&(r.height.max=r.height.ideal)):r.height=i.height}}return o._custom_stoped?(L.Logger.info(p,n+" track applyConstraints ignore, because track stoped,constraints:"+L.Utils.toJsonStringify(r)," ,trackid:",o.id),Promise.resolve().then(function(){throw{code:-2,name:"TrackStopedError",message:"",constraintName:"",constraint:""}})):(L.Logger.debug(p,n+" track applyConstraints constraints:"+L.Utils.toJsonStringify(r)," ,trackid:",o.id),o.applyConstraints(r).catch(function(e){var t={};if("object"===qt(e)?(t.name="safari"===a.info.browserName&&"Error"===e.name&&e.constructor?e.constructor.name:e.name,t.message=e.message,t.constraintName=e.constraintName,t.constraint=e.constraint,t.code=e.code||L.Utils.getUserMediaFailCode(t.name)):t={code:-1,name:"UnknownError",message:e,constraintName:"",constraint:""},"video"===n&&r.hasOwnProperty("frameRate")){var i="object"===qt(r.frameRate)?r.frameRate.ideal:r.frameRate;return"safari"===a.info.browserName&&16<=i&&i<=23?i<20?"object"===qt(r.frameRate)?r.frameRate.ideal=15:r.frameRate=15:"object"===qt(r.frameRate)?r.frameRate.ideal=24:r.frameRate=24:delete r.frameRate,L.Utils.applyConstraints(o,r)}throw t}))},createOffer:function(t,i,o,r){try{t.createOffer(r).then(function(){i&&i.apply(null,arguments)}).catch(function(){o&&o.apply(null,arguments)})}catch(e){t.createOffer(i,o,r)}},createAnswer:function(t,i,o){try{t.createAnswer().then(function(){i&&i.apply(null,arguments)}).catch(function(){o&&o.apply(null,arguments)})}catch(e){t.createAnswer(i,o)}},setLocalDescription:function(t,i,o,r){try{t.setLocalDescription(i).then(function(){o&&o.apply(null,arguments)}).catch(function(){r&&r.apply(null,arguments)})}catch(e){t.setLocalDescription(i,o,r)}},setRemoteDescription:function(t,i,o,r){try{t.setRemoteDescription(i).then(function(){o&&o.apply(null,arguments)}).catch(function(){r&&r.apply(null,arguments)})}catch(e){t.setRemoteDescription(i,o,r)}},addIceCandidate:function(t,i,o,r){try{t.addIceCandidate(i).then(function(){o&&o.apply(null,arguments)}).catch(function(){r&&r.apply(null,arguments)})}catch(e){t.setRemoteDescription(i,o,r)}},getStats:function(t,i,o,r){try{t.getStats(i).then(function(){o&&o.apply(null,arguments)}).catch(function(){r&&r.apply(null,arguments)})}catch(e){t.getStats(i,o,r)}},attachMediaStream:function(t,i,o){if(i&&("video"===o?i.getVideoTracks().length:"audio"===o?i.getAudioTracks().length:i.getTracks().length)){L.Utils.detachMediaStream(t);try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype)t.srcObject=i;else{var r=window.URL||webkitURL;t.src=r.createObjectURL(i)}}catch(e){L.Logger.warning(p," attachMediaStream. attach by srcObject failed.",o,e,adapter.browserDetails);r=window.URL||webkitURL;t.src=r.createObjectURL(i)}L.Utils.mediaPlay(t)}},detachMediaStream:function(t){try{if(window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){if(t.srcObject&&L.Utils.isFunction(t.srcObject.removeTrack)&&L.Utils.isFunction(t.srcObject.getTracks))for(var e=t.srcObject.getTracks(),i=e.length-1;0<=i;i--)t.srcObject.removeTrack(e[i]);t.srcObject=null}else t.src=""}catch(e){L.Logger.warning(p,"detachMediaStream. attach by srcObject failed.",e,adapter.browserDetails),t.src=""}},addStream:function(t,i){try{t.addTrack?i.getTracks().forEach(function(e){t.addTrack(e,i)}):t.addStream(i)}catch(e){t.addStream(i)}},getLocalMicMediaStreamDestination:function(){try{return L.Utils.variables=L.Utils.variables||{},L.Utils.variables.localMicMediastreamDest?L.Utils.variables.localMicMediastreamDest:(L.Utils.variables.localMicMediastreamDest=YS.audioContext.createMediaStreamDestination(),L.Utils.variables.localMicMediastreamDest)}catch(e){L.Logger.error(p,"getLocalMicMediaStreamDestination err:",e)}},getLocalMicDynamicsCompressor:function(){try{return L.Utils.variables=L.Utils.variables||{},L.Utils.variables.localMicCompressor?L.Utils.variables.localMicCompressor:(L.Utils.variables.localMicCompressor=YS.audioContext.createDynamicsCompressor(),L.Utils.variables.localMicCompressor)}catch(e){L.Logger.error(p,"getLocalMicDynamicsCompressor err:",e)}},disconnectSourceNode:function(e){try{e&&e.disconnect(0)}catch(e){L.Logger.error(p,"disconnectSourceNode err:",e)}},isSupportMediaStreamMix:function(){return!!(!YS.isYsNative&&YS.audioContext&&YS.audioContext.createDynamicsCompressor&&YS.audioContext.createMediaStreamDestination&&YS.audioContext.createMediaStreamSource&&YS.audioContext.createMediaElementSource)}}}(L),window.L._onLoadFinshInitSDK=function(){if((!window.L||!window.L._isFinshInitSDK)&&window.L&&window.L.Logger&&window.L.Utils&&window.YS&&window.YS._videoResolutions&&window.YS.DeviceMgrImpl){try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,window.YS.audioContext=window.YS.audioContext||new window.AudioContext}catch(e){L.Logger.error(logType,"not support AudioContext, err:",e)}window.L._isFinshInitSDK=!0;var e=L.Utils.getBrowserInfo(!0);if("edge"!==e.info.browserName&&"safari"===e.info.browserName)for(var t=window.YS._videoResolutions.length-1;0<=t;t--){var i=window.YS._videoResolutions[t];if(e.versions.mobile){var o=e.info.browserVersion.split("."),r=Number(o[0]||0),n=Number(o[1]||0);!isNaN(r)&&(r<=11||12===r&&0===n)?i[0]<=640&&i[1]<480&&window.YS._videoResolutions.splice(t,1):!isNaN(r)&&r<=12&&1<=n?i[0]<=320&&i[1]<240&&window.YS._videoResolutions.splice(t,1):!isNaN(r)&&13<=r&&1280<i[0]&&720<i[1]&&window.YS._videoResolutions.splice(t,1)}else 176===i[0]&&144===i[1]&&(window.YS._videoResolutions[t][1]=145)}"chrome"!==e.info.browserName||e.versions.mobile||(YS.notStopVideoTrack=!0,YS.notStopAudioTrack=!0,L.Logger.info("change notStopVideoTrack and notStopAudioTrack default value, value change to true!",e.versions.mobile,e.info.browserName,e.info.browserVersion)),YS&&YS.DeviceMgrImpl&&"function"==typeof YS.DeviceMgrImpl.getDevices&&"safari"!==e.info.browserName&&YS.DeviceMgrImpl.getDevices()}},window.L&&window.L._onLoadFinshInitSDK&&window.L._onLoadFinshInitSDK(),window.YS=window.YS||{},window.L=window.L||{},YS.EventDispatcher=function(a){var o="Events ",s={};return(a=a||{}).dispatcher={},a.dispatcher.eventListeners={},a.dispatcher.backupListerners={},s.addEventListener=function(e,t,i){null!=e&&(void 0===a.dispatcher.eventListeners[e]&&(a.dispatcher.eventListeners[e]=[]),a.dispatcher.eventListeners[e].push(t),i&&(void 0===a.dispatcher.backupListerners[i]&&(a.dispatcher.backupListerners[i]=[]),a.dispatcher.backupListerners[i].push({eventType:e,listener:t})))},s.removeEventListener=function(e,t){var i;a.dispatcher.eventListeners[e]?-1!==(i=a.dispatcher.eventListeners[e].indexOf(t))&&a.dispatcher.eventListeners[e].splice(i,1):L.Logger.info(o,"not event type: "+e)},s.removeAllEventListener=function(e){if((n=e)&&"object"===qt(n)&&"number"==typeof n.length&&"function"==typeof n.splice&&!n.propertyIsEnumerable("length"))for(var t in e){var i=e[t];delete a.dispatcher.eventListeners[i]}else if("string"==typeof e)delete a.dispatcher.eventListeners[e];else if("object"===qt(e))for(var o in e){i=o;var r=e[o];s.removeEventListener(i,r)}var n},s.dispatchEvent=function(e,t){var i;for(i in(t=null==t||t)&&L.Logger.debug(o,"sdk-dispatchEvent , event type: "+e.type+", evnet:",e),a.dispatcher.eventListeners[e.type])a.dispatcher.eventListeners[e.type].hasOwnProperty(i)&&a.dispatcher.eventListeners[e.type][i](e)},s.removeBackupListerner=function(e){if(e&&a.dispatcher.backupListerners[e]){for(var t=0;t<a.dispatcher.backupListerners[e].length;t++){var i=a.dispatcher.backupListerners[e][t];s.removeEventListener(i.eventType,i.listener)}a.dispatcher.backupListerners[e].length=0,delete a.dispatcher.backupListerners[e]}},s},YS.RoadofEvent=function(e){var t={};return t.type=e.type,t.data=e.data,t},YS.RoomEvent=function(e,t){var i=YS.RoadofEvent(e);if(i.streams=e.streams,i.message=e.message,i.user=e.user,i.userid=e.user?e.user.id:void 0,i.userId=i.userid,t&&"object"===qt(t))for(var o in t)i[o]=t[o];return i},YS.StreamEvent=function(e,t){var i=YS.RoadofEvent(e);if(i.stream=e.stream,i.message=e.message,i.bandwidth=e.bandwidth,i.attrs=e.attrs,i.userid=e.stream&&e.stream.extensionId&&e.stream.getAttributes&&e.stream.getAttributes()&&e.stream.getAttributes().type?e.stream.extensionId.replace(new RegExp(":"+e.stream.getAttributes().type,"g"),""):void 0,i.userId=i.userid,i.streamType=e.stream&&e.stream.extensionId&&e.stream.getAttributes&&e.stream.getAttributes()&&e.stream.getAttributes().type?e.stream.getAttributes().type:void 0,i.streamInfo={audio:!(!e.stream||!e.stream.hasAudio)&&e.stream.hasAudio(),video:!(!e.stream||!e.stream.hasVideo)&&e.stream.hasVideo(),attributes:e.stream&&e.stream.getAttributes?e.stream.getAttributes():{}},t&&"object"===qt(t))for(var o in t)i[o]=t[o];return i},YS.coreEventController=YS.EventDispatcher({}),window.YS=window.YS||{},window.L=window.L||{},YS.CONNECTION_TYPE={UP:0,DOWN:1},YS.NativeConnection=function(e){var a={},r=void 0,t=e.connectionId,i=!0,o=!0,n=e.connectionType,s=e.extraData||{},c=e.extraData.extensionId,d="create_offer_success",u="create_offer_failure",l="NativeConnection ",p=0,f=1,m=2,g={};function v(){return s.media?f:s.screen?m:p}function h(){var e=t;if(!t)throw Error("Invalid native-peer-connection ID");return e.toString()}function S(){var e=c;if(!c)throw Error("Invalid extensionId ID");return e.toString()}function y(e){var t=e.data.name;if(e.data.connectionId==S())if("onLocalDescription"===t){var i=e.data.sdp,o={};o.sdp=i,o.type="offer",L.Utils.isFunction(a[d])&&a[d](),delete a[d],delete a[u],L.Utils.isFunction(g.onOfferGenerated)&&g.onOfferGenerated(h(),o)}else if("onIceCandidate"===t){if(!L.Utils.isFunction(g.onIceCandidate))return;var r={type:"candidate",candidate:{}};r.candidate.sdpMLineIndex=e.data.sdpMLineIndex,r.candidate.sdpMid=e.data.sdpMid,r.candidate.candidate="a="+e.data.candidate,g.onIceCandidate(h(),r)}else if("onIceStatusChanged"===t){if(!L.Utils.isFunction(g.onIceConnectionStateChange))return;var n=e.data.state;1==n?g.onIceConnectionStateChange(h(),"checking"):2==n?g.onIceConnectionStateChange(h(),"connected"):3==n?g.onIceConnectionStateChange(h(),"completed"):4==n?g.onIceConnectionStateChange(h(),"failed"):5==n?g.onIceConnectionStateChange(h(),"disconnected"):6==n&&g.onIceConnectionStateChange(h(),"closed")}else if("onAddStream"===t){if(!L.Utils.isFunction(g.onAddStream))return;g.onAddStream(h(),{stream:{}})}else if("onRemoveStream"===t){if(!L.Utils.isFunction(g.onRemoveStream))return;g.onRemoveStream(h())}}return g.isNative=!0,g.getConnectionId=function(){return t},g.createOffer=function(e,t){var i=n===YS.CONNECTION_TYPE.UP;window.ysnative.postMessage({command:"createOffer",streamId:S(),offerToSend:i}),a[d]=e,a[u]=t},g.createAnswer=function(e,t){window.ysnative.postMessage({command:"createOffer",streamId:S(),offerToSend:!1}),a[d]=e,a[u]=t},g.setRemoteDescription=function(e,t,i){if(L.Utils.isNull(e))return L.Logger.error(l," Connection::setRemoteDescription: sdp object is null"),void(L.Utils.isFunction(i)&&i("sdp object is null"));window.ysnative.postMessage({command:"setRemoteDescription",sdpAnswer:e.sdp,streamId:S()}),L.Utils.isFunction(t)&&t()},g.addIceCandidate=function(e){var t=e.candidate,i=e.sdpMLineIndex;ysnative.postMessage({command:"setIceCandidate",candidate:t,sdpMid:0,sdpMLineIndex:i,streamId:S()})},g.setMediaStream=function(e,t,i){if(t&&L.Utils.isFunction(t)){var o=t(e);o?e=o:L.Logger.error(l,"setStreamMethod Wrong return result.")}n===YS.CONNECTION_TYPE.UP&&(window.ysnative&&window.ysnative.postMessage&&window.ysnative&&window.ysnative.postMessage&&window.ysnative.postMessage({command:"addStream",streamId:S(),type:Number(v())}),r=e)},g.getMediaStream=function(){return r},g.removeMediaStream=function(e){window.ysnative.postMessage({command:"removeStream",streamId:S(),type:Number(v())})},g.getVideoTrack=function(){},g.getAudioTrack=function(){},g.addAudioTrack=function(){},g.addVideoTrack=function(){},g.removeVideoTrack=function(){},g.removeAudioTrack=function(){},g.enableVideo=function(e){i=e,n==YS.CONNECTION_TYPE.UP&&window.ysnative.postMessage({command:"enableVideo",enable:e,connectionId:S()})},g.videoEnabled=function(){return i},g.enableAudio=function(e){o=e,n==YS.CONNECTION_TYPE.UP&&window.ysnative.postMessage({command:"enableAudio",enable:e,connectionId:S()})},g.audioEnabled=function(){return o},g.close=function(){var e=n===YS.CONNECTION_TYPE.UP;window.ysnative.postMessage({command:"closeConnection",streamId:S(),offerToSend:e,type:Number(v())}),window.ysnative.removeEventListener("message",y)},g.getStats=function(e,t){L.Utils.isFunction(e)&&e(void 0,-1)},g.replaceVideoTrack=function(e,t){window.ysnative.postMessage({command:"setCamera",deviceId:e.id})},g.replaceAudioTrack=function(e){window.ysnative.postMessage({command:"setMicrophone",deviceId:e.id})},g.needRePublish=function(){return!1},g.onOfferGenerated=void 0,g.onIceCandidate=void 0,g.onIceConnectionStateChange=void 0,g.onAddStream=void 0,g.onRemoveStream=void 0,g.checkReplaceTrackSupport=function(){return!1},window.ysnative.addEventListener("message",y,!1),g},window.YS=window.YS||{},window.L=window.L||{},YS.AudioPlayer=function(i){i.options=i.options||{};var o=YS.EventDispatcher({}),t=L.Utils.createMediaStream(),r=!1,n=100,a=!1,s="AudioPlayer ";o.id=i.id,o.local=i.local,o.type=i.type,o.elementID=i.elementID,o.bundleId=i.bundleId,o.userid=i.userid,o.userId=o.userid,o.extensionId=i.extensionId,o.streamId=i.streamId;var c=void(o.firstAudioFrameTs=0),d=!1,e=void 0;if(YS.roomInstance&&!i.deviceCheck&&(c=setInterval(function(){YS.roomInstance&&YS.roomInstance._onSendFailNohearEventLog&&!o.local&&!i.deviceCheck&&"video"===o.type?YS.roomInstance._onSendFailNohearEventLog(o.streamId)&&(clearInterval(c),c=void 0):(clearInterval(c),c=void 0)},1e4)),o.updateAudioPlayerSpec=function(e){if("object"===qt(e))for(var t in e)if(o.hasOwnProperty(t))switch(o[t]=e[t],t){case"id":o.div&&o.div.setAttribute("id","audioplayer__"+o.id),o.audio&&o.audio.setAttribute("id","audioplayerstream_"+o.id)}},o.destroy=function(){try{if(d=!0,clearInterval(e),e=void 0,clearInterval(c),c=void 0,YS.coreEventController.removeEventListener("sdk-track-stop",g),o.audio&&(L.Utils.mediaPause(o.audio),m(o.audio)),o.div)try{o.container.removeChild(o.div)}catch(e){L.Logger.error(s,"AudioPlayer removeChild error:",e)}o.removeAudioTrack(),t=void 0}catch(e){L.Logger.error(s,"AudioPlayer destroy error , error info:",e)}},o.div=document.createElement("div"),o.div.setAttribute("id","audioplayer__"+o.id),o.div.setAttribute("data-local",o.local),o.div.setAttribute("data-type",o.type),o.div.setAttribute("data-streamId",o.streamId),o.div.setAttribute("class","Roadof_player"),o.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden; display: none;"),o.audio=void 0,"safari"===L.Utils.getBrowserInfo(!0).info.browserName?o.audio=document.createElement("video"):o.audio=document.createElement("audio"),o.audio.setAttribute("id","audioplayerstream_"+o.id),o.audio.setAttribute("class","Roadof_stream"),o.audio.setAttribute("style","display: none;width: 100%; height: 100%; position: absolute;background-color:#000;"),o.audio.setAttribute("autoplay","autoplay"),o.audio.setAttribute("webkit-playsinline","true"),o.audio.setAttribute("x-webkit-airplay","true"),o.audio.setAttribute("playsinline","true"),o.audio.setAttribute("crossorigin","anonymous"),o.audio.crossOrigin="anonymous",o.audio.muted=!1,o.audio.volume=1,L.Utils.addEvent(o.audio,"canplay",p),L.Utils.addEvent(o.audio,"loadeddata",p),L.Utils.addEvent(o.audio,"loadedmetadata",p),o.hasAudioTrack=function(){var e=!1;return t&&t.getAudioTracks()&&t.getAudioTracks().length&&(e=!0),e},o.getAudioTrack=function(){if(t&&t.getAudioTracks()&&t.getAudioTracks().length)return t.getAudioTracks()[0]},o.removeAudioTrack=function(){o.hasAudioTrack()&&t&&t.removeTrack&&(L.Utils.removeTrack(t,o.getAudioTrack()),m(o.audio))},o.addAudioTrack=function(e){o.hasAudioTrack()&&o.removeAudioTrack(),t&&t.addTrack&&e&&(t.addTrack(e),t&&f(o.audio,t))},o.setMute=function(e){"boolean"==typeof e?(a=o.local&&o.type===YS.STREAM_VIDEO?(L.Logger.debug(s,"audioPlayer setMute:local audio must is mute!"),!0):e,o.audio&&void 0!==o.audio.muted&&(o.audio.muted=a),o.audio&&void 0!==o.audio.muted&&(o.audio.muted=a)):L.Logger.error(s,"Stream setMute isMute type must is boolean!")},o.setVolume=function(e){"number"==typeof e?(n=o.local&&o.type===YS.STREAM_VIDEO?(L.Logger.debug(s,"audioPlayer setVolume:local audio must is mute , volume must is 0!"),0):e,o.audio&&void 0!==o.audio.volume&&(o.audio.volume=n/100),o.audio&&void 0!==o.audio.volume&&(o.audio.volume=n/100)):L.Logger.error(s,"Stream setVolume volume type must is number!")},o.getVolume=function(e){return e&&"function"==typeof e?o.audio&&void 0!==o.audio.volume?(e(parseInt(100*o.audio.volume)),parseInt(100*o.audio.volume)):(L.Logger.warning(s,"audioPlayer getVolume failure , audio is not exist!"),e(n),n):(L.Logger.warning(s,"audioPlayer getVolume callback is not exist , callback must is function!"),n)},o.changeStreamId=function(e){o.streamId=e,o.div&&o.div.setAttribute("data-streamId",o.streamId)},o.updateAudioPlayerOptions=function(e){},o.local&&o.type===YS.STREAM_VIDEO&&(o.setVolume(0),o.setMute(!0)),o.div.appendChild(o.audio),"string"==typeof o.elementID)if(o.container=document.getElementById(o.elementID),o.container){var u=document.getElementById("audioplayer__"+o.id);if(u)try{L.Logger.warning(s,"audioPlayer:There are other nodes in the video player that have not been released,not released element id is "+u.id+" ,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid),o.container.removeChild(u)}catch(e){L.Logger.error(s,"audioPlayer error:",e)}o.container.appendChild(o.div)}else L.Logger.error(s,"audioPlayer error:find element,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid);else L.Logger.error(s,"audioPlayer error:element id must is string,element id is "+o.elementID+",id is "+o.id+",type is "+o.type+",userId is "+o.userid);var l=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);function p(){if(!d&&(o.audio&&(L.Utils.removeEvent(o.audio,"canplay",p),L.Utils.removeEvent(o.audio,"loadeddata",p),L.Utils.removeEvent(o.audio,"loadedmetadata",p)),!r)){if(r=!0,YS.roomInstance&&!i.deviceCheck){var e=o.userid;"_local_default_extension_id_"===e&&(e="");var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomFirstAudioFrame,message:{userId:e,mediaType:o.type}});YS.roomInstance.dispatchEvent(t),L.Logger.info(s,"first audio frame.",o.streamId,o.id,o.extensionId,o.elementID)}clearInterval(c),c=void 0,o.firstAudioFrameTs=(new Date).getTime()}}function f(e,t){L.Utils.attachMediaStream(e,t,"audio")}function m(e){L.Utils.detachMediaStream(e)}function g(e){var t=e&&e.data;if("object"===qt(t)&&t.custom_id&&"audio"===t.kind){var i=o.getAudioTrack();i&&i._custom_parent_id===t.custom_id&&L.Utils.stopTrack(i,t.force)}}return o.audio&&l&&YS.DeviceMgrImpl.associateElementsToSpeaker(o.audio,l),t&&f(o.audio,t),YS.coreEventController.addEventListener("sdk-track-stop",g),o},window.YS=window.YS||{},window.L=window.L||{},YS.NativeVideoPlayer=function(t){t.options=t.options||{},t.options.bar=void 0!==t.options.bar&&t.options.bar,t.options.mirror=t.options.mirror||!1,t.options.mode=t.options.mode||window.YS_VIDEO_MODE.ASPECT_RATIO_CONTAIN,t.options.loader=!L.Utils.isBoolean(t.options.loader)||t.options.loader;var e=void 0!==t.options.audioPlayer&&t.options.audioPlayer,i=YS.EventDispatcher({}),o=t.options.loader,r="NativeVideoPlayer ",n=L.Utils.nativeMediaStream();return i.id=t.id,i.local=t.stream.local,i.videoPlayerMediaStreamClone=t.stream.stream,i.type=t.stream&&t.stream.getAttributes&&t.stream.getAttributes()?t.stream.getAttributes().type:void 0,i.elementID=t.elementID,i.updateVideoPlayerSpec=function(e){if("object"===qt(e))for(var t in e)if(i.hasOwnProperty(t))switch(i[t]=e[t],t){case"id":i.div&&i.div.setAttribute("id","player_"+i.id),i.loader&&i.loader.setAttribute("id","back_"+i.id),i.video&&i.video.setAttribute("id",i.id)}},i.destroy=function(){try{i.container&&i.div&&(i.div.parentNode===i.container?i.container.removeChild(i.div):L.Logger.warning(r,"VideoPlayer removeChild warning: Element removal warning"))}catch(e){L.Logger.error(r,"NativeVideoPlayer removeChild error:",e)}i.videoPlayerMediaStreamClone=void 0,i=n=void 0},i.hasVideoTrack=function(){var e=!1;return n&&n.getVideoTracks()&&n.getVideoTracks().length&&(e=!0),e},i.getVideoTrack=function(){if(n&&n.getVideoTracks()&&n.getVideoTracks().length)return n.getVideoTracks()[0]},i.removeVideoTrack=function(){i.hasVideoTrack()&&n&&n.removeTrack&&L.Utils.removeTrack(n,i.getVideoTrack())},i.addVideoTrack=function(e){i.hasVideoTrack()&&i.removeVideoTrack(),n&&n.addTrack&&e&&n.addTrack(e)},i.showVideo=function(){i.video&&(i.video.style.opacity=1),o&&(i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor="")},i.hideVideo=function(){i.video&&(i.video.style.opacity=0),o&&(i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor="")},i.hideLoading=function(){o=!1,i.loader&&(i.loader.style.display="none"),i.div.style.backgroundColor="transparent"},i.showLoading=function(){o=!0,i.loader&&(i.loader.style.display=""),i.div.style.backgroundColor=""},i.div=document.createElement("div"),i.div.setAttribute("id","player_"+i.id),i.div.setAttribute("class","Roadof_player"),i.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(e?"  display: none;":" ")),t.options.loader&&(i.loader=document.createElement("div"),i.loader.setAttribute("id","back_"+i.id),i.loader.setAttribute("class","Roadof_loader"),i.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;')),i.video=document.createElement("embed"),i.video.setAttribute("id",i.id),i.video.setAttribute("class","Roadof_stream"),i.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(t.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":"")),i.video.setAttribute("ys-render-mode",t.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),i.video.setAttribute("type","application/x-ppapi-proxy"),i.videoSupernatant=document.createElement("div"),i.videoSupernatant.setAttribute("class","Roadof_stream_videoSupernatant"),i.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;"),i.updateVideoPlayerOptions=function(e){if(e&&"object"===qt(e)&&(void 0!==e.mirror&&(t.options.mirror=e.mirror,i.video.style.webkitTransform=e.mirror?"rotateY(180deg)":"",i.video.style.mozTransform=e.mirror?"rotateY(180deg)":"",i.video.style.oTransform=e.mirror?"rotateY(180deg)":"",i.video.style.msTransform=e.mirror?"rotateY(180deg)":"",i.video.style.transform=e.mirror?"rotateY(180deg)":""),void 0!==e.mode&&(t.options.mode=e.mode,i.video.setAttribute("ys-render-mode",t.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),window.ysnative.postMessage({command:"updateRenderMode",args:{connections:[i.id],mode:t.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"}})),void 0!==e.loader))if(t.options.loader=e.loader,t.options.loader&&!i.loader)i.loader=document.createElement("div"),i.loader.setAttribute("id","back_"+i.id),i.loader.setAttribute("class","Roadof_loader"),i.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),o?i.showLoading():i.hideLoading();else if(!t.options.loader&&i.loader){try{i.div&&i.loader&&(i.loader.parentNode===i.div?i.div.removeChild(i.loader):L.Logger.warning(r,"VideoPlayer removeChild loader warning: Element removal warning"))}catch(e){L.Logger.error(r,"NativeVideoPlayer removeChild error:",e)}i.loader=void 0}},i.getVideoPlayerOptions=function(){return t.options},i.showVideoContainer=function(){},i.hideVideoContainer=function(){},YS.isOnlyAudioRoom&&i.hideVideo(),void 0!==i.elementID?"object"===qt(i.elementID)&&"function"==typeof i.elementID.appendChild?i.container=i.elementID:i.container=document.getElementById(i.elementID):i.container=document.body,i.container.appendChild(i.div),i.loader&&(o?i.showLoading():i.hideLoading(),i.div.appendChild(i.loader)),i.div.appendChild(i.video),i.div.appendChild(i.videoSupernatant),i.containerWidth=0,i.containerHeight=0,i.hideLoading(),i},window.YS=window.YS||{},window.L=window.L||{},YS.NativeAudioPlayer=function(e){e.options=e.options||{};var t=YS.EventDispatcher({}),i=100,o="NativeAudioPlayer ";t.id=e.id,t.local=e.local,t.type=e.type,t.elementID=e.elementID,t.bundleId=e.bundleId,t.userid=e.userid,t.userId=t.userid,t.extensionId=e.extensionId;var r=L.Utils.nativeMediaStream();return t.setMute=function(e){"boolean"==typeof e?(t.local&&"video"===t.type?(L.Logger.debug(o,"videoPlayer setMute:local video must is mute!"),!0):e)?window.ysnative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:0}):window.ysnative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:i}):L.Logger.error(o,"Stream setMute isMute type must is boolean!")},t.setVolume=function(e){"number"==typeof e?(e*=2.55,i=t.local&&t.type===YS.STREAM_VIDEO?(L.Logger.debug(o,"videoPlayer setVolume:local video must is mute , volume must is 0!"),0):e,window.ysnative.postMessage({command:"setEmbedVolume",connectionId:t.id,volume:e})):L.Logger.error(o,"Stream setVolume volume type must is number!")},t.getVolume=function(e){return e&&"function"==typeof e?YS.isYsNative?(e(i),i):void 0:(L.Logger.warning(o,"videoPlayer getVolume callback is not exist , callback must is function!"),i)},t.updateAudioPlayerOptions=function(e){},t.updateAudioPlayerSpec=function(e){},t.destroy=function(){try{r=void 0}catch(e){L.Logger.error(o,"AudioPlayer destroy error , error info:",e)}},t.hasAudioTrack=function(){var e=!1;return r&&r.getAudioTracks()&&r.getAudioTracks().length&&(e=!0),e},t.getAudioTrack=function(){if(r&&r.getAudioTracks()&&r.getAudioTracks().length)return r.getAudioTracks()[0]},t.removeAudioTrack=function(){t.hasAudioTrack()&&r&&r.removeTrack&&L.Utils.removeTrack(r,t.getAudioTrack())},t.addAudioTrack=function(e){t.hasAudioTrack()&&t.removeAudioTrack(),r&&r.addTrack&&e&&r.addTrack(e)},t.onRemoteAudioVolume=function(e){e},t.onMicVolumeReport=function(e){t&&t.local&&e},t.local&&t.type===YS.STREAM_VIDEO&&(t.setVolume(0),t.setMute(!0)),t},window.YS=window.YS||{},window.L=window.L||{},YS.VideoPlayer=function(n){n.options=n.options||{},n.options.mirror=n.options.mirror||!1,n.options.mode=n.options.mode||window.YS_VIDEO_MODE.ASPECT_RATIO_CONTAIN,n.options.loader=!L.Utils.isBoolean(n.options.loader)||n.options.loader;var s=YS.EventDispatcher({}),t=n.options.loader,a=!1,c=L.Utils.createMediaStream(),i="",o="",d=n.successFn,u=n.failureFn,l="VideoPlayer ";s.id=n.id,s.local=n.local,s.type=n.type,s.elementID=n.elementID,s.bundleId=n.bundleId,s.userid=n.userid,s.userId=s.userid,s.extensionId=n.extensionId,s.isClone=n.isClone,s.streamId=n.streamId;var p=void(s.firstVideoFrameTs=0),f=!1,r=!0;if("chrome"===L.Utils.getBrowserInfo(!0).info.browserName&&(r=!1),YS.roomInstance&&!n.deviceCheck&&(p=setInterval(function(){YS.roomInstance&&YS.roomInstance._onSendFailNoseeEventLog&&!s.local&&!n.deviceCheck&&"video"===s.type?YS.roomInstance._onSendFailNoseeEventLog(s.streamId)&&(clearInterval(p),p=void 0):(clearInterval(p),p=void 0)},1e4)),s.div=document.createElement("div"),s.div.setAttribute("id","videoplayer_"+s.id),s.div.setAttribute("data-local",s.local),s.div.setAttribute("data-type",s.type),s.div.setAttribute("data-streamId",s.streamId),s.div.setAttribute("class","Roadof_player"),s.div.setAttribute("style","width: 100%; height: 100%; position: relative;background-color: black; overflow: hidden;"),n.options.loader&&(s.loader=document.createElement("div"),s.loader.setAttribute("id","videoplayback_"+s.id),s.loader.setAttribute("class","Roadof_loader"),s.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;')),s.video=document.createElement("video"),s.video.setAttribute("id","videoplaystream_"+s.id),s.video.setAttribute("class","Roadof_stream"),s.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),s.video.setAttribute("autoplay","autoplay"),s.video.setAttribute("webkit-playsinline","true"),s.video.setAttribute("x-webkit-airplay","true"),s.video.setAttribute("playsinline","true"),s.video.setAttribute("x5-video-player-type","h5"),s.video.setAttribute("x5-video-player-fullscreen","true"),s.video.setAttribute("muted","muted"),s.video.setAttribute("crossorigin","anonymous"),s.video.crossOrigin="anonymous",s.video.muted=!0,s.video.volume=0,L.Utils.addEvent(s.video,"canplay",g),L.Utils.addEvent(s.video,"loadeddata",g),L.Utils.addEvent(s.video,"loadedmetadata",g),s.videoSupernatant=document.createElement("div"),s.videoSupernatant.setAttribute("class","Roadof_stream_videoSupernatant"),s.videoSupernatant.setAttribute("style","width: 100%; height: 100%; pointer-events: none; position: absolute;background-color:transparent;left:0;top:0;"),s.video.oncanplay=function(e){L.Utils.isFunction(d)&&d(e)},s.video.onerror=function(e){L.Utils.isFunction(u)&&u(e)},s.changeStreamId=function(e){s.streamId=e,s.div&&s.div.setAttribute("data-streamId",s.streamId)},s.updateVideoPlayerSpec=function(e){if("object"===qt(e))for(var t in e)if(s.hasOwnProperty(t))switch(s[t]=e[t],t){case"id":s.div&&s.div.setAttribute("id","videoplayer_"+s.id),s.loader&&s.loader.setAttribute("id","videoplayback_"+s.id),s.video&&s.video.setAttribute("id","videoplaystream_"+s.id)}},s.destroy=function(){try{if(f=!0,YS.coreEventController.removeEventListener("sdk-track-stop",_),clearInterval(p),p=void 0,clearTimeout(s._checkIsGetVideoDataTimer),s._checkIsGetVideoDataTimer=void 0,s.video&&(L.Utils.mediaPause(s.video),h(s.video)),s.container&&s.div)try{s.div.parentNode===s.container?s.container.removeChild(s.div):L.Logger.warning(l,"VideoPlayer removeChild warning: Element removal warning")}catch(e){L.Logger.error(l,"VideoPlayer removeChild error:",e)}s.removeVideoTrack(),c=void 0}catch(e){L.Logger.error(l,"VideoPlayer destroy error , error info:",e)}},s.updateVideoPlayerOptions=function(e){if(e&&"object"===qt(e)&&(void 0!==e.mirror&&(n.options.mirror=e.mirror,S(s.video)),void 0!==e.mode&&(n.options.mode=e.mode,y(s.video)),void 0!==e.loader))if(n.options.loader=e.loader,n.options.loader&&!s.loader)s.loader=document.createElement("div"),s.loader.setAttribute("id","videoplayback_"+s.id),s.loader.setAttribute("class","Roadof_loader"),s.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'),t?s.showLoading():s.hideLoading();else if(!n.options.loader&&s.loader){try{s.loader.parentNode===s.div?s.div.removeChild(s.loader):L.Logger.warning(l,"VideoPlayer removeChild loader warning: Element removal warning")}catch(e){L.Logger.error(l,"VideoPlayer removeChild error:",e)}s.loader=void 0}},s.getVideoPlayerOptions=function(){return n.options},s.showVideoContainer=function(){s.container&&(s.container.style.display="block")},s.hideVideoContainer=function(){s.container&&(s.container.style.display="none")},s.showVideo=function(){s.video&&(s.video.style.display="block"),t&&s.loader&&(s.loader.style.display="")},s.hideVideo=function(){s.video&&(s.video.style.display="none"),t&&s.loader&&(s.loader.style.display="")},s.hideLoading=function(){t=!1,s.loader&&(s.loader.style.display="none"),s.div.style.backgroundColor="transparent"},s.showLoading=function(){t=!0,s.loader&&(s.loader.style.display=""),s.div.style.backgroundColor=""},s.hasVideoTrack=function(){var e=!1;return c&&c.getVideoTracks&&c.getVideoTracks().length&&(e=!0),e},s.getVideoTrack=function(){if(c&&c.getVideoTracks&&c.getVideoTracks().length)return c.getVideoTracks()[0]},s.removeVideoTrack=function(){s.hasVideoTrack()&&c&&c.removeTrack&&(L.Utils.removeTrack(c,s.getVideoTrack()),h(s.video),y(s.video))},s.addVideoTrack=function(e){s.hasVideoTrack()&&s.removeVideoTrack(),c&&c.addTrack&&e&&(e.enabled=!0,c.addTrack(e),v(s.video,c),y(s.video))},s.replaceVideoTrack=function(e){if(c&&c.addTrack&&e)if(s.hasVideoTrack()){var t=(r=c,n=e,(a={}).video=document.createElement("video"),a.video.setAttribute("id","videoplaystream_"+s.id+"."+L.Utils.randomWord(4)),a.video.setAttribute("class","Roadof_stream"),a.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),a.video.setAttribute("autoplay","autoplay"),a.video.setAttribute("webkit-playsinline","true"),a.video.setAttribute("x-webkit-airplay","true"),a.video.setAttribute("playsinline","true"),a.video.setAttribute("x5-video-player-type","h5"),a.video.setAttribute("x5-video-player-fullscreen","true"),a.video.setAttribute("muted","muted"),a.video.muted=!0,a.video.volume=0,a.video.style.display="none",a.video.oncanplay=function(e){L.Utils.isFunction(d)&&d(e)},a.video.onerror=function(e){L.Utils.isFunction(u)&&u(e)},a.mediaStream=L.Utils.cloneMediaStream(r,!0,!1),a.mediaStream.addTrack(n),v(a.video,a.mediaStream),a),i=t?t.video:void 0,o=t?t.mediaStream:void 0;if(!i||!o)return;S(i),y(i),L.Utils.mediaPlay(i,function(e){if(0===e){i.style.zIndex=s.video.style.zIndex,i.style.display=s.video.style.display,s.div.replaceChild(i,s.video);var t=s.video;s.video=i,c=o,t.display="none",L.Utils.removeEvent(t,"canplay",g),L.Utils.removeEvent(t,"loadeddata",g),L.Utils.removeEvent(t,"loadedmetadata",g),L.Utils.addEvent(s.video,"canplay",g),L.Utils.addEvent(s.video,"loadeddata",g),L.Utils.addEvent(s.video,"loadedmetadata",g)}})}else e.enabled=!0,c.addTrack(L.Utils.cloneTrack(e)),v(s.video,c),y(s.video);var r,n,a},s.checkIsGetVideoData=function(e){clearTimeout(s._checkIsGetVideoDataTimer),s._checkIsGetVideoDataTimer=void 0,s.video||e&&e(!1);var t=s.video.currentTime;s._checkIsGetVideoDataTimer=setTimeout(function(){clearTimeout(s._checkIsGetVideoDataTimer),s._checkIsGetVideoDataTimer=void 0,s.video||e&&e(!1),e&&e(s.video.currentTime>t)},1e3)},s.reloadVideo=function(){if(c){var e=s.getVideoTrack();e&&s.replaceVideoTrack(e)}},s.loader&&(t?s.showLoading():s.hideLoading(),s.div.appendChild(s.loader)),s.div.appendChild(s.video),s.div.appendChild(s.videoSupernatant),"string"==typeof s.elementID)if(s.container=document.getElementById(s.elementID),s.container){s.isClone&&(s.oldContainer=s.container,s.container=s.oldContainer.cloneNode(!0),s.container.style.zIndex="-1",s.oldContainer.parentNode.appendChild(s.container));var e=s.container.getElementsByClassName("Roadof_player");if(e&&e.length)try{for(var m=e.length-1;0<=m;m--)L.Logger.warning(l,"videoPlayer:There are other nodes in the video player that have not been released,not released element id is "+e[m].id+" ,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid),e[m].parentNode===s.container?s.container.removeChild(e[m]):L.Logger.warning(l,"VideoPlayer removeChild  warning -traversal: Element removal warning")}catch(e){L.Logger.error(l,"videoPlayer error:",e)}s.container.appendChild(s.div)}else L.Logger.error(l,"videoPlayer error:find element,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid);else L.Logger.error(l,"videoPlayer error:element id must is string,element id is "+s.elementID+",id is "+s.id+",type is "+s.type+",userId is "+s.userid);function g(){if(!f){if(s.hideLoading(),s.video&&(L.Utils.removeEvent(s.video,"canplay",g),L.Utils.removeEvent(s.video,"loadeddata",g),L.Utils.removeEvent(s.video,"loadedmetadata",g)),!a&&s.video&&0!==s.video.readyState){if(a=!0,YS.roomInstance&&!n.deviceCheck){var e=s.userid;"_local_default_extension_id_"===e&&(e="");var t={userId:e,mediaType:s.type,width:s.video&&s.video.videoWidth||0,height:s.video&&s.video.videoHeight||0};if(s.type===YS.STREAM_VIDEO){var i=new RegExp(s.userid+":","g");if(i.test(s.extensionId)){var o=s.extensionId.replace(i,"");t.deviceId=o}}var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomFirstVideoFrame,message:t});YS.roomInstance.dispatchEvent(r),L.Logger.info(l,"first video frame.",s.streamId,s.id,s.extensionId,s.elementID)}clearInterval(p),p=void 0,s.firstVideoFrameTs=(new Date).getTime()}y(s.video)}}function v(e,t){L.Utils.attachMediaStream(e,t,"video")}function h(e){L.Utils.detachMediaStream(e)}function S(e){i=n.options.mirror?"rotateY(180deg)":"";var t=o+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t}function y(e){if(r&&e.videoWidth&&e.videoHeight&&s.div.clientWidth&&s.div.clientHeight){var t=(o=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"translate(-50%,-50%)":"")+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t,n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?(s.video.videoWidth/s.video.videoHeight>s.div.clientWidth/s.div.clientHeight?(e.style.height="100%",e.style.width="auto"):(e.style.height="auto",e.style.width="100%"),e.style.top="50%",e.style.left="50%"):(e.style.height="100%",e.style.width="100%",e.style.top="0%",e.style.left="0%"),e.style.webkitObjectFit="",e.style.mozObjectFit="",e.style.oObjectFit="",e.style.msObjectFit="",e.style.objectFit=""}else{t=(o="")+(i?" ":"")+i;e.style.webkitTransform=t,e.style.mozTransform=t,e.style.oTransform=t,e.style.msTransform=t,e.style.transform=t,e.style.height="100%",e.style.width="100%",e.style.top="0%",e.style.left="0%",e.style.webkitObjectFit=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.mozObjectFit=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.oObjectFit=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.msObjectFit=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",e.style.objectFit=n.options.mode===window.YS_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""}}function _(e){var t=e&&e.data;if("object"===qt(t)&&t.custom_id&&"video"===t.kind){var i=s.getVideoTrack();i&&i._custom_parent_id===t.custom_id&&L.Utils.stopTrack(i,t.force)}}return c&&v(s.video,c),S(s.video),y(s.video),YS.coreEventController.addEventListener("sdk-track-stop",_),s},window.YS=window.YS||{},window.L=window.L||{},YS.SharePopUp=function(){var c={_containerStyle:{width:"610px",height:"500px",top:"0",zIndex:"99999",position:"fixed",border:"1px solid #c7c6c5",color:"#777",fontSize:"12px",background:"#fff",right:"calc( (100% - 500px) / 2)"},_tabWrapperStyle:{width:"85%",height:"350px",bottom:"15%",right:"7.5%",left:"7.5%",position:"absolute"},_tabDivStyle:{width:"100%",height:"35px",display:"flex",justifyContent:"space-around"},_tabStyle:{width:"50%",paddingTop:"5px",paddingLeft:"8px",color:"#777",fontWeight:"normal",border:"none","text-align":"center"},_activeTabStyle:{width:"50%",borderBottom:"3px solid #4285F4",color:"#4285F4",fontWeight:"bold",zIndex:"10000","text-align":"center"},_blockStyle:{width:"100%",height:"91%",display:"none",opacity:"0",position:"absolute",bottom:"0",border:"1px solid #c7c6c5","overflow-y":"scroll"},_activeBlockStyle:{width:"100%",height:"90%",display:"flex","flex-wrap":"wrap",opacity:"1",bottom:"0",position:"absolute"},_shareBtnStyle:{width:"62px",height:"30px",bottom:"2.5%",right:"17.5%",position:"absolute",border:"1px solid #c7c6c5",background:"#fff",borderRadius:"3px",textAlign:"center",lineHeight:"30px",cursor:"default"},_cancelBtnStyle:{width:"62px",height:"30px",bottom:"2.5%",right:"5%",position:"absolute",background:"#4986EA",color:"#fff",borderRadius:"3px",textAlign:"center",lineHeight:"30px",cursor:"default"},_sourceBlockStyle:{width:"150px",height:"110px","margin-left":"10px","margin-top":"10px","margin-bottom":"15px",position:"relative",border:"3px solid #c7c6c5"},_titleStyle:{color:"#222",margin:"8px 7.5%",fontSize:"18px"},_descStyle:{color:"#222",margin:"0 7.5%",fontSize:"14px"},_spanStyle:{width:"100%",height:"50%","text-align":"center","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},n=/zh/g.test(L.Utils.getBrowserInfo().language);function e(e,t){var i;this.sources=e||[],this.option=t||{},this.windowSources=this.getSourcesByType("window")||[],this.screenSources=this.getSourcesByType("screen")||[],this.activeSource=0<this.screenSources.length&&this.screenSources[0]||0<this.windowSources.length&&this.windowSources[0];var o=t.electron||{};if(o.style)for(var r in o.style)c[r]?Object.assign(c[r],o.style[r]):c[r]=o.style[r];o.lang&&L.Utils.isString(o.lang)&&(n="zh-CN"===o.lang),this.title=this.option.title||(n?"共享屏幕":"Sharing the screen"),this.description=this.option.description||location.host+(n?"想要共享您屏幕上的内容。请选择您希望共享哪些内容。":"want to share content on your screen.Select what you want to share"),this.tabs=[],0<this.screenSources.length&&this.tabs.push({name:"screen",text:n?"您的整个屏幕":"Your entire screen",enable:!0,active:!0,onClick:this.switch.bind(this,"screen"),blacklist:[]}),0<this.windowSources.length&&this.tabs.push({name:"window",text:n?"应用窗口":"The application window",enable:!0,active:this.screenSources.length<=0,onClick:this.switch.bind(this,"window"),blacklist:o.blackwinlist&&L.Utils.isArray(o.blackwinlist)?o.blackwinlist:[]}),this.buttonMap=(a(i={},"share",{text:n?"分享":"Share",onClick:this.onShareBtnClick}),a(i,"cancel",{text:n?"取消":"Cancel",onClick:this.onCancelBtnClick}),i),this.elements={container:void 0,tabWrapper:void 0,tabDiv:void 0,tab:void 0,block:void 0,cancelBtn:void 0,shareBtn:void 0,title:void 0,desc:void 0,sourceBlock:void 0,span:void 0},this.init()}return e.prototype.init=function(){this.createDom()},e.prototype.render=function(){},e.prototype.getSourcesByType=function(e){var t=[],i=new RegExp(e);return this.sources.forEach(function(e){i.test(e.id)&&t.push(e)}),t},e.prototype.createDom=function(){var s=this;for(var e in this.elements){this.elements[e]=document.createElement("div");var t="_"+e+"Style";if(c[t]){var i=this.elements[e].style;for(var o in c[t])i.setProperty(o,c[t][o]),this.elements[e].style[o]=c[t][o]}}this.tabs.forEach(function(n){if(n.enable){var e=s.elements.tab.cloneNode(),a=s.elements.block.cloneNode();if(e.innerText=n.text,n.active){for(var t in c._activeTabStyle)e.style[t]=c._activeTabStyle[t];for(var t in c._activeBlockStyle)a.style[t]=c._activeBlockStyle[t]}e.classList.add(n.name),a.classList.add(n.name+"block"),a.classList.add("block"),e.onclick=n.onClick,s.elements.tabDiv.appendChild(e),s[n.name+"Sources"].forEach(function(e){for(var t=0;t<n.blacklist.length;t++)if(e.name===n.blacklist[t])return;var i=s.elements.sourceBlock.cloneNode(),o=s.elements.span.cloneNode();if(i.id=e.id,i.onclick=s.setActiveSource.bind(s,i.id),o.innerText=e.name,i.classList.add("s-block"),e.thumbnail){var r=new Image;r.src=e.thumbnail.toDataURL(),r.style.width="100%",r.style.height="100%",r.onclick=s.setActiveSource.bind(s,i.id),i.appendChild(r)}i.appendChild(o),a.appendChild(i)}),s.elements.tabWrapper.appendChild(a)}}),this.elements.title.innerText=this.title,this.elements.desc.innerText=this.description,this.elements.shareBtn.innerText=this.buttonMap.share.text,this.elements.cancelBtn.innerText=this.buttonMap.cancel.text,this.elements.tabWrapper.appendChild(this.elements.tabDiv),this.elements.container.appendChild(this.elements.title),this.elements.container.appendChild(this.elements.desc),this.elements.container.appendChild(this.elements.tabWrapper),this.elements.cancelBtn.onclick=this.onCancelBtnClick.bind(this),this.elements.shareBtn.onclick=this.onShareBtnClick.bind(this),this.elements.container.appendChild(this.elements.shareBtn),this.elements.container.appendChild(this.elements.cancelBtn),document.body.appendChild(this.elements.container)},e.prototype.destroy=function(){this.elements.container&&this.elements.container.parentNode.removeChild(this.elements.container)},e.prototype.switch=function(e){for(var t=this.elements.tabDiv.getElementsByClassName(e),i=this.elements.tabWrapper.getElementsByClassName(e+"block"),o=this.elements.tabWrapper.getElementsByClassName("block"),r=0;r<this.elements.tabDiv.children.length;r++)for(var n in c._tabStyle)this.elements.tabDiv.children[r].style[n]=c._tabStyle[n];for(r=0;r<o.length;r++)for(var n in c._blockStyle)o[r].style[n]=c._blockStyle[n];for(r=0;r<t.length;r++)for(var n in c._activeTabStyle)t[r].style[n]=c._activeTabStyle[n];for(r=0;r<i.length;r++)for(var n in c._activeBlockStyle)i[r].style[n]=c._activeBlockStyle[n]},e.prototype.setActiveSource=function(t,e){var i=this;this.sources.forEach(function(e){e.id===t&&(i.activeSource=e)});for(var o=document.getElementsByClassName("s-block"),r=0;r<o.length;r++)o[r].style.borderColor="#c7c6c5",o[r].style.borderWidth="#3px";"IMG"===e.target.tagName?(e.target.parentNode.style.borderColor="#4289F4",e.target.parentNode.style.borderWidth="3px"):e.target.style.borderColor="#4289F4"},e.prototype.onShareBtnClick=function(){this.option.shareFunc&&this.option.shareFunc(this.activeSource),this.destroy()},e.prototype.onCancelBtnClick=function(){this.option.cancelFunc&&this.option.cancelFunc(this.activeSource),this.destroy()},e}(),window.YS=window.YS||{},window.L=window.L||{},YS.deviceInfoMap=YS.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]},YS.hasDevice=YS.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1},YS.notStopVideoTrack=YS.notStopVideoTrack||!1,YS.notStopAudioTrack=YS.notStopVideoTrack||!1,YS.getMediaMaxRetrynum=10,YS.cacheStreams={},YS.defaultGetMediaTimeOutTime=15e3,YS.defaultVideoW=1920,YS.defaultVideoH=1080,YS.defaultVideoFps=30,YS.DeviceMgrImpl=function(){var D={onDevicesSetted:null,onDeviceChanged:null,onCameraSetted:null,onMicrophoneSetted:null,onSpeakerSetted:null,onCameraMuted:null,isNativeSetVideoProfile:!1},s={},r={testing:!1},n={testing:!1},a=void 0,c=void 0,N={},p={sharing:!1,shared:!1},d={},u={width:YS.defaultVideoW,height:YS.defaultVideoH,maxfps:YS.defaultVideoFps},l={width:320,height:180,maxfps:10},f={},m={},g={echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0},U="AVMgr ",i=100,v=[],h=!1,S=!1,y={},_=0;if(-1<navigator.userAgent.indexOf("Electron"))try{if(void 0!==window.require){var e=window.require("electron");e&&e.desktopCapturer&&(p.electronDesktopCapturer=e.desktopCapturer)}if(!p.electronDesktopCapturer){var t=require("electron").desktopCapturer;p.electronDesktopCapturer=t}}catch(e){console.error("this electron version is too low, not supported desktopCapturer.")}var b=function(e,t){if(e){f[e]||(f[e]={},f[e].small={track:void 0,profile:void 0},f[e].normal={track:void 0,profile:void 0});return t?f[e].small:f[e].normal}};function w(o,e,t,i){if(L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")&&f[o]){var r=b(o,t);if(r&&r.track)if(r.profile.width!==e.width||r.profile.height!==e.height||r.profile.maxfps!==e.maxfps){var n={width:{ideal:e.width},height:{ideal:e.height},frameRate:{ideal:e.maxfps,max:30}},a=r.track;if("edge"!==L.Utils.getBrowserInfo(!0).info.browserName&&L.Utils.isFunction(a.getCapabilities)){var s=a.getCapabilities();"{}"!==JSON.stringify(s)&&(s.width.max>n.width.ideal&&(n.width.max=n.width.ideal),s.height.max>n.height.ideal&&(n.height.max=n.height.ideal),s.frameRate.max>n.frameRate.ideal&&(n.frameRate.max=n.frameRate.ideal))}var c=function(){r&&(r.profile=L.Utils.copy(e)),L.Utils.isFunction(i)&&i()},d=YS.cacheStreams[o]&&YS.cacheStreams[o].stream;if(d){var u=d.getVideoTracks()[0];L.Utils.applyConstraints(u,n).then(function(){var e="";if(u&&u.getSettings){var t=u.getSettings();t&&"object"===qt(t)&&(e=L.Utils.toJsonStringify(t))}L.Logger.info(U,"cachestream applyConstraintsToVideoTrack success,apply constraints:"+L.Utils.toJsonStringify(n),", deviceId:",o,e)}).catch(function(e){var t="";if(u&&u.getSettings){var i=u.getSettings();i&&"object"===qt(i)&&(t=L.Utils.toJsonStringify(i))}L.Logger.warning(U,"cachestream applyConstraintsToVideoTrack fail,apply constraints:"+L.Utils.toJsonStringify(n),"reason:",L.Utils.toJsonStringify(e),", deviceId:",o,t)})}L.Utils.applyConstraints(a,n).then(function(){var e="";if(a&&a.getSettings){var t=a.getSettings();t&&"object"===qt(t)&&(e=L.Utils.toJsonStringify(t))}L.Logger.info(U,"applyConstraintsToVideoTrack finshed,applyConstraints videoTrack success,apply constraints:"+L.Utils.toJsonStringify(n),", deviceId:",o,e),c()}).catch(function(e){var t="";if(a&&a.getSettings){var i=a.getSettings();i&&"object"===qt(i)&&(t=L.Utils.toJsonStringify(i))}L.Logger.warning(U,"applyConstraintsToVideoTrack finshed,applyConstraints videoTrack fail,apply constraints:"+L.Utils.toJsonStringify(n),"reason:",L.Utils.toJsonStringify(e),", deviceId:",o,t),c()})}else L.Utils.isFunction(i)&&i()}}function I(e,t,i){if("safari"!==adapter.browserDetails.browser&&L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")&&m[e]&&m[e].track)if(m[e].profile.noiseSuppression!==t.noiseSuppression||m[e].profile.autoGainControl!==t.autoGainControl||m[e].profile.echoCancellation!==t.echoCancellation){var o={noiseSuppression:{exact:t.noiseSuppression},autoGainControl:{exact:t.autoGainControl},echoCancellation:{exact:t.echoCancellation}},r=function(){m[e]&&(m[e].profile=L.Utils.copy(t)),L.Utils.isFunction(i)&&i()},n=m[e].track;L.Utils.applyConstraints(n,o).then(function(){L.Logger.debug(U,"applyConstraintsToAudioTrack finshed,applyConstraints audioTrack success,apply constraints:"+L.Utils.toJsonStringify(o)),r()}).catch(function(e){L.Logger.info(U,"applyConstraintsToAudioTrack finshed,applyConstraints audioTrack fail,apply constraints:"+L.Utils.toJsonStringify(o),"reason:",L.Utils.toJsonStringify(e)),r()})}else L.Utils.isFunction(i)&&i();else L.Utils.isFunction(i)&&i()}function T(o,r,t,n){if(o.video&&"object"===qt(o.video)&&"object"===qt(o.video.deviceId)&&"string"==typeof o.video.deviceId.exact&&!L.Utils.isVideoinputDeviceIdFromDeviceList(o.video.deviceId.exact)||o.audio&&"object"===qt(o.audio)&&"object"===qt(o.audio.deviceId)&&"string"==typeof o.audio.deviceId.exact&&!L.Utils.isAudioinputDeviceIdFromDeviceList(o.audio.deviceId.exact)){var e={code:8,message:"Requested device not found",name:"NotFoundError"};return L.Logger.info(U,"getUserMedia fail,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(o),L.Utils.toJsonStringify(adapter.browserDetails)),void(L.Utils.isFunction(t)&&t(e))}var a=function(e){L.Utils.isFunction(t)&&t(e)};A(L.Utils.copy(o),function e(t){if(!n&&!L.Utils.getBrowserInfo(!0).versions.mobile&&"chrome"===L.Utils.getBrowserInfo(!0).info.browserName&&YS.notStopVideoTrack&&o.video&&o.video.deviceId&&o.video.deviceId.exact&&0<t.getVideoTracks().length){var i=function(i,e){var t=YS.getMediaMaxRetrynum;if(!i)return t;if(YS.cacheStreams.hasOwnProperty(i)){o=YS.cacheStreams[i].video,r=L.Utils.createMediaStream(e.getVideoTracks()[0]);L.Utils.attachMediaStream(o,r),r.getVideoTracks()[0].onmute=YS.cacheStreams[i].onvideomuted,YS.cacheStreams[i].stream=r,YS.cacheStreams[i].retry++,t=YS.cacheStreams[i].retry}else{var o;(o=document.createElement("video")).setAttribute("id","save_videoplaystream_"+L.Utils.randomWord(4)),o.setAttribute("class","Roadof_stream"),o.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;"),o.setAttribute("autoplay","autoplay"),o.setAttribute("webkit-playsinline","true"),o.setAttribute("x-webkit-airplay","true"),o.setAttribute("playsinline","true"),o.setAttribute("x5-video-player-type","h5"),o.setAttribute("x5-video-player-fullscreen","true"),o.setAttribute("muted","muted"),o.muted=!0,o.volume=0,o.style.display="none";var r=L.Utils.createMediaStream(e.getVideoTracks()[0]);L.Utils.attachMediaStream(o,r),t=0,YS.cacheStreams[i]={video:o,stream:r,retry:t},YS.cacheStreams[i].onvideomuted=function(){if(L.Logger.info(U," cacheStreams["+i+"].onvideomuted !!!"),f.hasOwnProperty(i)){var e=f[i];for(var t in e)e[t]&&e[t].track&&L.Utils.stopTrack(e[t].track);f[i]=void 0,delete f[i]}YS.cacheStreams.hasOwnProperty(i)&&L.Utils.forceStopMediaStream(YS.cacheStreams[i].stream);T({video:{deviceId:{exact:i},width:{ideal:u.width},height:{ideal:u.height},frameRate:{ideal:u.maxfps,max:30}},audio:!1},function(e){if(!e||e.getVideoTracks().length<1)L.Logger.error(U,"onvideomuted reget Video got invalid stream");else{if(s.hasOwnProperty(i)&&s[i].testing&&s[i].mediaStream&&s[i].mediaStream.videoPlayer){var t=s[i].mediaStream.getVideoTracks();0<t.length&&L.Utils.removeTrack(s[i].mediaStream,t[0]),s[i].mediaStream.addTrack(e.getVideoTracks()[0]),s[i].mediaStream.videoPlayer.addVideoTrack(e.getVideoTracks()[0])}D.onCameraMuted&&D.onCameraMuted(i)}},function(e){L.Logger.info(U," getUserMedia failed when camera onvideomuted, failure info:",e)})},YS.cacheStreams[i].stream.getVideoTracks()[0].onmute=YS.cacheStreams[i].onvideomuted}return t}(o.video.deviceId.exact,t)+1;if(YS.cacheStreams.hasOwnProperty(o.video.deviceId.exact)){if(i<YS.getMediaMaxRetrynum&&!L.Utils.checkMediaStreamVideoVaild(t))return void(YS.cacheStreams[o.video.deviceId.exact].timer=setTimeout(function(){L.Utils.forceStopMediaStream(t),L.Logger.warning(U," checkMediaStreamVideoVaild failed ,nRetrynum:"+i),A(L.Utils.copy(o),e,function(e){L.Logger.error(U,"getUserMedia failed,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(o),L.Utils.toJsonStringify(adapter.browserDetails)),a(e)})},1e3));YS.cacheStreams[o.video.deviceId.exact].retry=0}}L.Utils.isFunction(r)&&r(t)},function(e){L.Logger.error(U,"getUserMedia failed,fail info(failInfo,config,browserDetails):",L.Utils.toJsonStringify(e),L.Utils.toJsonStringify(o),L.Utils.toJsonStringify(adapter.browserDetails)),a(e)})}function o(i,C){C=C||{},L.Logger.debug(U,"call enumerateDevices!"),C.isSetlocalStorage=null!=C.isSetlocalStorage&&C.isSetlocalStorage;!function(s){var c=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.warning(U,"navigator.mediaDevices.enumerateDevices method not supported."),s&&"function"==typeof s&&s(c,i);var e,t;e=function(e,t){for(var i={},o=0,r=e.length;o<r;o++){var n=e[o];if("communications"!==n.groupId&&"communications"!==n.deviceId&&"通讯"!==n.label){i[n.kind]=i[n.kind]||{};var a={kind:n.kind,label:n.label,deviceId:n.deviceId,groupId:n.groupId};i[n.kind][n.deviceId]=a,c.push(a)}}!navigator.cookieEnabled&&window.YS.storage&&"object"===qt(window.YS.storage)&&(window.YS.storage[L.Constant.deviceStorage.audioinput]=window.YS.storage[L.Constant.deviceStorage.audioinput]||Object.keys(i.audioinput)[0]||void 0,window.YS.storage[L.Constant.deviceStorage.audiooutput]=window.YS.storage[L.Constant.deviceStorage.audiooutput]||Object.keys(i.audiooutput)[0]||void 0,window.YS.storage[L.Constant.deviceStorage.videoinput]=window.YS.storage[L.Constant.deviceStorage.videoinput]||Object.keys(i.videoinput)[0]||void 0),s&&"function"==typeof s&&s(c,t)},t=function(e,t){L.Logger.warning(U,"enumerateDevices error :"+e.name+": "+e.message),s&&"function"==typeof s&&s(c,t)},h?v.push({onSuccess:e,onFailure:t,callback:i}):(h=!0,v.push({onSuccess:e,onFailure:t,callback:i}),navigator.mediaDevices.enumerateDevices().then(function(e){for(var t=!1,i=0,o=e.length;i<o;i++)if(e[i]&&!e[i].deviceId){t=!0;break}if(t&&!S){var r=function(){navigator.mediaDevices.enumerateDevices().then(function(e){var t=v;h=!(v=[]);for(var i=0,o=t.length;i<o;i++)t[i].onSuccess&&t[i].onSuccess(e,t[i].callback)}).catch(function(e){var t=v;h=!(v=[]);for(var i=0,o=t.length;i<o;i++)t[i].onFailure&&t[i].onFailure(e,t[i].callback)})};A({audio:S=!0,video:!1},r,r)}else{var n=v;h=!(v=[]);for(var a=0,s=n.length;a<s;a++)n[a].onSuccess&&n[a].onSuccess(e,n[a].callback)}}).catch(function(e){var t=v;h=!(v=[]);for(var i=0,o=t.length;i<o;i++)t[i].onFailure&&t[i].onFailure(e,t[i].callback)}))}(function(e,t){var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),r=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),n={first:{},defalut:{}},a={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},s=L.Utils.getBrowserInfo();if(s.versions.mobile){"frontCameraDeviceId"!==o&&"backCameraDeviceId"!==o&&(o="frontCameraDeviceId",L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,o));var c={},d=[];for(var u in e){var l={};for(var p in e[u])"function"!=typeof e[u][p]&&(l[p]=e[u][p]);d.push(l)}for(var f=(e=d).length-1;0<=f;f--){var m=e[f];"videoinput"===m.kind&&(c.frontCameraDeviceId?c.backCameraDeviceId?e.splice(f,1):(c.backCameraDeviceId=c.frontCameraDeviceId,c.frontCameraDeviceId=m,c.backCameraDeviceId.deviceId="backCameraDeviceId",c.backCameraDeviceId.label="back camera",m.deviceId="frontCameraDeviceId",m.label="front camera"):((c.frontCameraDeviceId=m).deviceId="frontCameraDeviceId",m.label="front camera"))}}var g=s&&s.language&&s.language.toLowerCase().match(/zh/g)?"chinese":"english",v={videoinput:{label:"chinese"==g?"视频输入设备":"video input device ",num:0},audioinput:{label:"chinese"==g?"音频输入设备":"audio input device ",num:0},audiooutput:{label:"chinese"==g?"音频输出设备":"audio output device ",num:0}};e&&e.forEach&&e.forEach(function(e){if(e){var t={kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId};!t.label&&v[e.kind]&&(t.label=v[e.kind].label+ ++v[e.kind].num),"audioinput"===e.kind&&e.deviceId===i&&(a.useDevices[e.kind]=e.deviceId),"videoinput"===e.kind&&e.deviceId===o&&(a.useDevices[e.kind]=e.deviceId),"audiooutput"===e.kind&&e.deviceId===r&&(a.useDevices[e.kind]=e.deviceId),s.versions.mobile&&"videoinput"===e.kind?n.first[e.kind]="frontCameraDeviceId":n.first[e.kind]=n.first[e.kind]||e.deviceId,a.devices[e.kind].push(t),a.hasdevice[e.kind]=!0,s.versions.mobile&&"videoinput"===e.kind?n.defalut[e.kind]="frontCameraDeviceId":"default"===e.deviceId&&(n.defalut[e.kind]=e.deviceId)}}),a.useDevices.audioinput||(a.useDevices.audioinput=n.defalut.audioinput||n.first.audioinput||""),a.useDevices.videoinput||(a.useDevices.videoinput=n.defalut.videoinput||n.first.videoinput||""),a.useDevices.audiooutput||(a.useDevices.audiooutput=n.defalut.audiooutput||n.first.audiooutput||""),YS.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.hasdevice));var h=L.Utils.toJsonParse(L.Utils.toJsonStringify(YS.deviceInfoMap));for(var S in YS.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.devices)),L.Utils.localStorage?(C.isSetlocalStorage||s.versions.mobile)&&(C.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,a.useDevices.audioinput),C.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,a.useDevices.videoinput),C.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,a.useDevices.audiooutput)):L.Logger.warning(U,"not support localStorage"),a.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""},N={},a.useDevices)if(a.devices[S])for(var y in a.devices[S]){var _=a.devices[S][y];if(_&&_.deviceId===a.useDevices[S]){N[S]=_;break}}var b={},w={};if(C.getDeviceChangeInfo){var I=L.Utils.toJsonParse(L.Utils.toJsonStringify(YS.deviceInfoMap));for(var T in I)for(var E=h[T],A=I[T],k=E.length-1;0<=k;k--)for(var R=A.length-1;0<=R;R--)if(E[k].deviceId===A[R].deviceId){E.splice(k,1),A.splice(R,1);break}for(var T in I)I[T]&&I[T].length&&(b[T]=I[T]);for(var T in h)h[T]&&h[T].length&&(w[T]=h[T])}D._isGetDevicesed=!0,t&&"function"==typeof t&&t(a,C.getDeviceChangeInfo?{addDevices:b,removedDevices:w}:void 0)})}function E(e,i,n,a){if(D.checkIsSupportSetSpeaker()){a=a||{};try{if(!(i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)))return void(n&&"function"==typeof n&&n(!1));var s={number:0},t=function(o,e,r){if(o&&o.nodeName&&/(audio|video)/g.test(o.nodeName.toLowerCase())&&i)if(a.speakerTest||"YSSDK_speakerTest"!==o.id)if(L.Utils.isFunction(o.setSinkId))try{o.setSinkId(i).then(function(){var e=o.getAttribute("id");L.Logger.debug(U,"Audio output device set to "+i,e?" , element id is "+e:"  element:",e?"":o),s.number++,s.number===r&&n&&"function"==typeof n&&n(!0)}).catch(function(e){var t=void 0,i=o.getAttribute("id");e&&"object"===qt(e)&&"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device  "),L.Logger.info(U,"setSinkId error:",e,t||"",i?" , element id is "+i:"  element:",i?"":o),s.number++,s.number===r&&n&&"function"==typeof n&&n(!1)})}catch(e){var t=o.getAttribute("id");L.Logger.warning(U,"setSinkId err:",e,t?" , element id is "+t:"  element:",t?"":o),s.number++,s.number===r&&n&&"function"==typeof n&&n(!1)}else{t=o.getAttribute("id");L.Logger.warning(U,"The browser does not support the setSinkId method,audiooutputDeviceId :",i,t?" , element id is "+t:"  element:",t?"":o),s.number++,s.number===r&&n&&"function"==typeof n&&n(!1)}else s.number++,s.number===r&&n&&"function"==typeof n&&n(!1);else s.number++,s.number===r&&n&&"function"==typeof n&&n(!1)};if(!e){e=[];var o=document.getElementsByTagName("audio"),r=document.getElementsByTagName("video");if(o&&0<o.length)for(var c=0;c<o.length;c++){var d=o[c];e.push(d)}if(r&&0<r.length)for(c=0;c<r.length;c++){d=r[c];e.push(d)}}if(e&&(L.Utils.isArray(e)||L.Utils.isHTMLCollection(e)))if(e&&0<e.length){var u=e.length;for(c=0;c<e.length;c++){d=e[c];t(d,0,u)}}else{u=1;t(e[0],0,u)}else{t(e,0,u=1)}}catch(e){L.Logger.error(U,"setElementSinkIdToAudioouputDevice error:",e),n&&"function"==typeof n&&n(!1)}}else n&&n(!1)}function A(e,n,t,i,a){a=a||{};var s=i||{timeOutID:null,finish:!1},c=L.Utils.copy(e),d=void 0,u=e,l=!1;if(L.Utils.getBrowserInfo(!0).versions.mobile&&"object"===qt(e.video)&&!a.desktopShare){var o={},r=void 0;for(var p in e.video)"deviceId"!==p&&"sourceId"!==p?o[p]=e.video[p]:"object"===qt(e.video[p])&&(r=e.video[p].exact);o.facingMode="backCameraDeviceId"===r?"environment":"user",u={audio:e.audio,video:o}}var f=function(e){_=0,s.timeOutID&&(clearTimeout(s.timeOutID),s.timeOutID=null),s.finish||(s.finish=!0,L.Logger.debug(U,"adapter`s getUserMedia onFailure, ",L.Utils.toJsonStringify(c)),L.Logger.warning(U,"getUserMedia fail, failInfo:"+L.Utils.toJsonStringify(e)),L.Utils.isFunction(t)&&t(e))};try{var m,g=void 0;if(L.Utils.getBrowserInfo(!0).versions.mobile&&YS._mobile_video_mediaStream&&u.video){if(YS._mobile_video_mediaStream._videoFacingMode&&"object"===qt(u.video)&&u.video.facingMode&&u.video.facingMode===YS._mobile_video_mediaStream._videoFacingMode&&YS._mobile_video_mediaStream._videoconfig&&YS._mobile_video_mediaStream._videoconfig===L.Utils.toJsonStringify(c.video)){if(L.Logger.info(U,"mobile exist same video device stream, user cache mediastream.",YS._mobile_video_mediaStream._videoFacingMode,u),d?d.addTrack(YS._mobile_video_mediaStream.getVideoTracks()[0]):d=L.Utils.createMediaStream(YS._mobile_video_mediaStream.getVideoTracks()[0],void 0),!u.audio)return void(L.Utils.isFunction(n)&&n(d));g.video=!1,g.audio=u.audio}L.Logger.info(U,"start mobile getUserMedia,stop other mediastream videotrack.",YS._mobile_video_mediaStream._videoFacingMode,u),YS._mobile_video_mediaStream.getVideoTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_video_mediaStream=void 0}if(L.Utils.getBrowserInfo(!0).versions.mobile&&YS._mobile_audio_mediaStream&&u.audio){if(YS._mobile_audio_mediaStream._audioDeviceId&&"object"===qt(u.audio)&&"object"===qt(u.audio.deviceId)&&u.audio.deviceId.exact&&u.audio.deviceId.exact===YS._mobile_audio_mediaStream._audioDeviceId){if(L.Logger.info(U,"mobile exist same audio device stream, user cache mediastream.",YS._mobile_audio_mediaStream._audioDeviceId,u),d=d||L.Utils.createMediaStream(void 0,YS._mobile_audio_mediaStream.getAudioTracks()[0]),!u.video||d.getVideoTracks().length)return void(L.Utils.isFunction(n)&&n(d));g.video=u.video,g.audio=!1}L.Logger.info(U,"start mobile getUserMedia,stop other mediastream audiotrack.",YS._mobile_audio_mediaStream._audioDeviceId,u),YS._mobile_audio_mediaStream.getAudioTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_audio_mediaStream=void 0}var v=g||u;if(L.Utils.getBrowserInfo(!0).versions.mobile&&YS._mobile_video_mediaStream&&"environment"===YS._mobile_video_mediaStream._videoFacingMode&&YS._mobile_video_mediaStream._videoconfig&&!v.video&&v.audio){l=!0;var h=L.Utils.toJsonParse(YS._mobile_video_mediaStream._videoconfig);delete h.deviceId,h.facingMode="environment",m={audio:v.audio,video:h}}var S=m||g||u;L.Utils.getUserMedia(S,function(t){if(_=0,s.timeOutID&&(clearTimeout(s.timeOutID),s.timeOutID=null),s.finish)L.Utils.forceStopMediaStream(t);else{if(l&&L.Utils.getBrowserInfo(!0).versions.mobile&&t.getVideoTracks().length&&t.getVideoTracks().forEach(function(e){L.Utils.stopTrack(e,!0),L.Utils.removeTrack(t,e)}),d&&d.getTracks().forEach(function(e){t.addTrack(e)}),L.Utils.getBrowserInfo(!0).versions.mobile&&t&&t.getVideoTracks().length&&"object"===qt(u.video)){if(L.Utils.getBrowserInfo(!0).versions.mobile&&YS._mobile_video_mediaStream&&u.video&&(L.Logger.info(U,"mobile getUserMedia onSuccess,stop other mediastream videotrack.",YS._mobile_video_mediaStream._videoFacingMode,u),YS._mobile_video_mediaStream.getVideoTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_video_mediaStream=void 0),YS._mobile_video_mediaStream=t,YS._get_mobile_video_num=YS._get_mobile_video_num||0,"object"===qt(u.video)&&u.video.facingMode){t._videoFacingMode=u.video.facingMode,"object"===qt(c.video)&&(t._videoconfig=L.Utils.toJsonStringify(c.video)),L.Logger.info(U,"mobile getUserMedia success,set video device.",u.video.facingMode,u);var e="environment"===u.video.facingMode?"backCameraDeviceId":"frontCameraDeviceId";0===YS._get_mobile_video_num&&e===L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||D.setCamera(e,void 0,{forceUpdate:!0})}YS._get_mobile_video_num++}L.Utils.getBrowserInfo(!0).versions.mobile&&t&&t.getAudioTracks().length&&"object"===qt(u.audio)&&(L.Utils.getBrowserInfo(!0).versions.mobile&&YS._mobile_audio_mediaStream&&u.audio&&(L.Logger.info(U,"mobile getUserMedia onSuccess,stop other mediastream audiotrack.",YS._mobile_audio_mediaStream._audioDeviceId,u),YS._mobile_audio_mediaStream.getAudioTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_audio_mediaStream=void 0),YS._mobile_audio_mediaStream=t,YS._get_mobile_audio_num=YS._get_mobile_audio_num||0,"object"===qt(u.audio)&&"object"===qt(u.audio.deviceId)&&u.audio.deviceId.exact&&(t._audioDeviceId=u.audio.deviceId.exact,L.Logger.info(U,"mobile getUserMedia success,set audio device.",u.audio.deviceId.exact,u),0===YS._get_mobile_audio_num&&u.audio.deviceId.exact===L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||D.setMicrophone(u.audio.deviceId.exact,void 0,{forceUpdate:!0})),YS._get_mobile_audio_num++),L.Utils.getBrowserInfo(!0).versions.mobile&&!a.desktopShare&&(u.video&&"object"!==qt(u.video)&&t&&t.getVideoTracks().length&&L.Utils.stopTrack(t.getVideoTracks()[0],!0),u.audio&&"object"!==qt(u.audio)&&t&&t.getAudioTracks().length&&L.Utils.stopTrack(t.getAudioTracks()[0],!0)),s.finish=!0;var i="";if(t.getVideoTracks().length&&t.getVideoTracks()[0].getSettings){var o=t.getVideoTracks()[0].getSettings();o&&"object"===qt(o)&&(i=L.Utils.toJsonStringify(o))}if(L.Logger.info(U,"adapter`s getUserMedia onSuccess, ",L.Utils.toJsonStringify(c)+(i?" ,settingsinfo:"+i:"")),L.Utils.isFunction(n)){var r=L.Utils.createMediaStream(t.getVideoTracks()[0],t.getAudioTracks()[0]);n(r)}}},f),!YS.CGetUserMediaRetry||"object"!==qt(S.video)||L.Utils.getBrowserInfo(!0).versions.mobile||a.desktopShare||(s.timeOutID&&(clearTimeout(s.timeOutID),s.timeOutID=null),s.timeOutID=setTimeout(function(){s.finish||(L.Logger.warning(U,"adapter`s getUserMedia OnTimeOut, ",L.Utils.toJsonStringify(c)),"object"===qt(c.video)&&(delete c.video.height,delete c.video.width,(_+=1)<=1?A(c,n,t,s,a):(_=0,f("adapter`s getUserMedia second Timeout"))))},YS.defaultGetMediaTimeOutTime))}catch(e){f(e)}}function k(){var e;r.mediaStream&&((e=r.mediaStream)?e&&e.audioPlayer&&e.audioPlayer.destroy&&(e.audioPlayer.destroy(),e.audioPlayer=void 0,delete e.audioPlayer):L.Logger.error(U,"unplayDeviceStream mediaStream can not be empty!"),L.Utils.stopTrack(r.mediaStream.getAudioTracks()[0]),L.Utils.removeTrack(r.mediaStream,r.mediaStream.getAudioTracks()[0]),r.mediaStream=null),r._soundMeter&&r._soundMeter.stop&&(r._soundMeter.stop(),r._soundMeter=void 0),clearInterval(r._soundMeterTimer),r._soundMeter=void 0,r._soundMeterTimer=void 0}function R(e){try{if(s[e]&&s[e].mediaStream){var t=s[e].mediaStream.videoPlayer&&s[e].mediaStream.videoPlayer._useCachestream;(i=s[e].mediaStream)?i&&i.videoPlayer&&i.videoPlayer.destroy&&(i.videoPlayer.destroy(),i.videoPlayer=void 0,delete i.videoPlayer):L.Logger.error(U,"unplayDeviceStream mediaStream can not be empty!"),t||L.Utils.stopTrack(s[e].mediaStream.getVideoTracks()[0]),L.Utils.removeTrack(s[e].mediaStream,s[e].mediaStream.getVideoTracks()[0]),s[e].mediaStream=null}}catch(e){L.Logger.warning(U,"_stopVideoTestFromSdk Method capture error info:",e)}var i}function C(){var e=document.getElementById("YSSDK_speakerTest");e&&(L.Utils.mediaPause(e),e.src=""),n.audioUrl=null}function Y(e,t,i,o){o=o||{};try{var r=document.getElementById("YSSDK_speakerTest");r?o.loop?r.setAttribute("loop","loop"):r.removeAttribute("loop"):((r=document.createElement("audio")).setAttribute("id","YSSDK_speakerTest"),o.loop&&r.setAttribute("loop","loop"),r.style.display="none",document.body.appendChild(r)),n.audioUrl=t,r.src=n.audioUrl,E([r],e,function(e){e?n.testing?L.Utils.mediaPlay(r):C():L.Utils.isFunction(i)&&i("YS_Speaker_Test_Fail")},{speakerTest:!0})}catch(e){L.Logger.warning(U,"startSpeakerTest err:",e),L.Utils.isFunction(i)&&i("YS_Speaker_Test_Fail",e)}}function P(e,t){var i={};return i[e]=L.Utils.localStorage.getItem(e),i[e]!==t&&L.Utils.localStorage.setItem(e,t),i}function M(){if(p.electronDesktopCapturer)return!0;if(navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia)return!1;try{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getSupportedConstraints()&&navigator.mediaDevices.getSupportedConstraints().hasOwnProperty("mediaSource"))return!navigator.mediaDevices.getSupportedConstraints().mediaSource}catch(e){L.Logger.error(U,"_checkDesktopPlugin err:",e)}return!0}return D.destroyVideoTrack=function(e){if(!YS.cacheStreams||!YS.cacheStreams.hasOwnProperty(e)){var t=f[e];if(t){for(var i in t)t[i]&&t[i].track&&(L.Utils.stopTrack(t[i].track),t[i].track=void 0);f[e]=void 0,delete f[e]}}},D.destroyAllVideoTrack=function(){for(var e in f)D.destroyVideoTrack(e)},D.destroyAudioTrack=function(e){m[e]&&(L.Utils.stopTrack(m[e].track),m[e].track=void 0),m[e]=void 0,delete m[e]},D.destroyAllAudioTrack=function(){for(var e in m)D.destroyAudioTrack(e)},D.hasVideoTrack=function(e){return!!f[e]},D.hasAudioTrack=function(e){return!!m[e]},D.destroyAllCacheStreams=function(){for(var e in YS.cacheStreams){YS.cacheStreams[e].onvideomuted=void 0,clearTimeout(YS.cacheStreams[e].timer),YS.cacheStreams[e].timer=void 0;var t=YS.cacheStreams[e].video;t&&L.Utils.detachMediaStream(t),YS.cacheStreams[e].stream&&YS.cacheStreams[e].stream.getTracks().forEach(function(e){L.Utils.stopTrack(e)}),YS.cacheStreams[e]=void 0,delete YS.cacheStreams[e]}},D.setMaxVideoProfile=function(e,t,i){for(var o in u.width=e||u.width,u.height=t||u.height,u.maxfps=i||u.maxfps,f){var r=D.getUseVideoProfile(o),n=b(o,!1);n&&n.profile&&n.profile.width===r.width&&n.profile.height===r.height&&n.profile.maxfps===r.maxfps||w(o,r)}},D.setSmallVideoProfile=function(e,t,i){if(e&&t&&(e!==l.width||t!==l.height||i!==l.maxfps)){var o=D.getMaxVideoProfile();for(var r in(e>o.width||t>o.height)&&(e=o.width,t=o.height),i&&(l.maxfps=o.maxfps>i?i:o.maxfps),l.width=e||l.width,l.height=t||l.height,f){var n=D.getSmallVideoProfile(),a=b(r,!0);a&&a.profile&&a.profile.width===n.width&&a.profile.height===n.height&&a.profile.maxfps===n.maxfps||w(r,n,!0)}}},D.getSmallVideoProfile=function(){return L.Utils.copy(l)},D.setVideoProfile=function(e,t,i){YS.isMultiCamera||(t="Local");var o=L.Utils.copy(e),r=D.getMaxVideoProfile();if((o.width>r.width||o.height>r.height)&&(o.width=r.width,o.height=r.height),o.maxfps&&(o.maxfps=r.maxfps>o.maxfps?o.maxfps:r.maxfps),d[t]=o,YS.isMultiCamera){w(t,D.getUseVideoProfile(t),!1,i)}else{for(var n in f){o=D.getUseVideoProfile(n);var a=b(n,!1);a&&a.profile&&a.profile.width===o.width&&a.profile.height===o.height&&a.profile.maxfps===o.maxfps||w(n,o,!1)}L.Utils.isFunction(i)&&i()}},D.getVideoProfile=function(e){YS.isMultiCamera||(e="Local");var t={};return d.hasOwnProperty(e)&&(t=L.Utils.copy(d[e])),L.Utils.getJsonLength(t)||(t=L.Utils.copy(u)),t},D.getMaxVideoProfile=function(){return L.Utils.copy(u)},D.getUseVideoProfile=function(e){var t=D.getVideoProfile(e);if(t.width*t.height>u.width*u.height){var i=t.width*t.height/(u.width*u.height);t.width=Math.floor(t.width/i),t.height=Math.floor(t.height/i)}return t.maxfps>u.maxfps&&(t.maxfps=u.maxfps),t},D.setAudioProcessing=function(e){if("safari"!==L.Utils.getBrowserInfo(!0).info.browserName){var t=L.Utils.copy(e);for(var i in e.hasOwnProperty("autoGainControl")||(t.autoGainControl=!0),e.hasOwnProperty("echoCancellation")||(t.echoCancellation=!0),e.hasOwnProperty("noiseSuppression")||(t.noiseSuppression=!0),g=t,m)I(i,t)}},D.getVideoTrack=function(o,r,n,a){if(o){var s=b(o,a);if(s)if(s&&s.track)L.Utils.isFunction(r)&&r(s.track);else{var c={},d=!1;if(a){c=D.getSmallVideoProfile();var e=D.getUseVideoProfile(o);(c.width>e.width||c.height>e.height)&&(c={width:e.width,height:e.height})}else c=D.getUseVideoProfile(o),d=L.Utils.isSupportMediaStreamTrackMethod("applyConstraints");s.profile=d?D.getMaxVideoProfile():c,T({video:{deviceId:{exact:o},width:{ideal:d?u.width:c.width},height:{ideal:d?u.height:c.height},frameRate:{ideal:d?u.maxfps:c.maxfps,max:30}},audio:!1},function(e){var t=e.getVideoTracks()[0];if(t){s.track=t,L.Utils.removeTrack(e,t);var i=function(){L.Utils.isFunction(r)&&r(s.track)};!d||u.width==c.width&&u.height==c.height?i():w(o,c,a,function(){i()})}else L.Utils.isFunction(n)&&n({code:-1,message:"Requested device not video track",name:"UnknownError"});e=void 0},function(e){L.Utils.isFunction(n)&&n(e)},a)}else L.Utils.isFunction(n)&&n({code:8,message:"VideoTrack init local failed",name:"NotFoundError"})}else L.Utils.isFunction(n)&&n({code:8,message:"Requested device not found",name:"NotFoundError"})},D.getAudioTrack=function(o,r,n){if(o)if(m[o]&&m[o].track)L.Utils.isFunction(r)&&r(m[o].track);else{var a=L.Utils.isSupportMediaStreamTrackMethod("applyConstraints")&&"safari"!==adapter.browserDetails.browser;m[o]={profile:a?{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}:L.Utils.copy(g)};var e={deviceId:{exact:o}};a||(g.echoCancellation||(e.echoCancellation={exact:g.echoCancellation}),g.autoGainControl||(e.autoGainControl={exact:g.autoGainControl}),"firefox"===adapter.browserDetails.browser||g.noiseSuppression||(e.noiseSuppression={exact:g.noiseSuppression})),T({audio:e,video:!1},function(e){var t=e.getAudioTracks()[0];if(t){m[o].track=t,L.Utils.removeTrack(e,t);var i=function(){L.Utils.isFunction(r)&&r(m[o].track)};a?I(o,g,function(){i()}):i()}else L.Utils.isFunction(n)&&n({code:-1,message:"Requested device not audio track",name:"UnknownError"})},function(e){L.Utils.isFunction(n)&&n(e)})}else L.Utils.isFunction(n)&&n({code:8,message:"Requested device not found",name:"NotFoundError"})},D.startAudioMix=function(e,t){if(L.Logger.debug(U,"call startAudioMix",e,t),t=t||{},L.Utils.isSupportMediaStreamMix())try{var o=t.isMutex?"local_mutex_mix":e,i=y[o];if(i&&i.ele){if(i.ele.src!==e&&(i.ele.src=e,i.ele.load()),i.filePath=e,i.ele.currentTime=0,L.Utils.mediaPlay(i.ele),!i.sourcenode){var r=L.Utils.getLocalMicDynamicsCompressor();(a=YS.audioContext.createMediaElementSource(i.ele)).connect(r),a.connect(YS.audioContext.destination),i.sourcenode=a}return i.methods}var n=document.createElement("audio");n.setAttribute("crossorigin","anonymous"),n.setAttribute("autoplay","autoplay"),n.setAttribute("webkit-playsinline","true"),n.setAttribute("x-webkit-airplay","true"),n.setAttribute("playsinline","true"),n.setAttribute("preload","auto"),t.loop&&n.setAttribute("loop","loop"),n.crossOrigin="anonymous",n.src=e,n.load(),!t.loop&&t.autoStopAudioMix&&L.Utils.addEvent(n,"ended",function(){D.stopAudioMix(e,{isMutex:t.isMutex})}),L.Utils.mediaPlay(n);var a;r=L.Utils.getLocalMicDynamicsCompressor();return y[o]&&y[o].sourcenode&&L.Utils.disconnectSourceNode(y[o].sourcenode),(a=YS.audioContext.createMediaElementSource(n)).connect(r),a.connect(YS.audioContext.destination),y[o]={ele:n,sourcenode:a,filePath:e,methods:{play:function(){var e=y[o];e&&e.ele&&L.Utils.mediaPlay(e.ele)},pause:function(){var e=y[o];e&&e.ele&&L.Utils.mediaPause(e.ele)},setVolume:function(e){if(L.Utils.isNumber(e)){var t=y[o];t&&t.ele&&(t.ele.volume=e/100)}else L.Logger.error("setVolume volume arg must is number,the range of values is [0,100]")},getVolume:function(){var e=y[o];return e&&e.ele?parseInt(100*e.ele.volume*100)/100:0},seekProgress:function(e){if(L.Utils.isNumber(e)){e<0&&(e=0),1<e&&(e=1);var t=y[o];t&&t.ele&&(t.ele.currentTime=t.ele.duration*e)}else L.Logger.error("seekProgress positionPercent arg must is number,the range of values is [0,1]")},getProgress:function(){var e=y[o];return e&&e.ele?parseInt(e.ele.currentTime/e.ele.duration*100)/100:0},addEleEventListen:function(e,t){var i=y[o];i&&i.ele&&L.Utils.addEvent(i.ele,e,t)},removeEleEventListen:function(e,t){var i=y[o];i&&i.ele&&L.Utils.removeEvent(i.ele,e,t)}}},y[o].methods}catch(e){return void L.Logger.error(U,"startAudioMix err:",e)}else L.Logger.warning(U,"startAudioMixing:not support audio fix")},D.stopAudioMix=function(e,t){L.Logger.debug(U,"call stopAudioMix",e,t);var i=[];if((t=t||{}).isMutex)i.push("local_mutex_mix");else if(e)i.push("local_mutex_mix"),Array.isArray(e)?i=i.concat(e):i.push(e);else for(var o in y)i.push(o);for(var r=0,n=i.length;r<n;r++){o=i[r];if(y[o]){var a=y[o];if("local_mutex_mix"===o&&a.filePath!==e&&!t.isMutex)continue;a.ele&&(a.ele.src="",L.Utils.mediaPause(a.ele)),a.sourcenode&&L.Utils.disconnectSourceNode(a.sourcenode),y[o]=void 0,delete y[o]}}},D.stopAllAudioMix=function(){L.Logger.debug(U,"call stopAllAudioMix"),D.stopAudioMix(),y={}},D.getUserMedia=T,D.getsSoundMeterInstance=function(e,c){try{if(!e)return void L.Logger.error(U,"getsSoundMeterInstance audioContext is not exist!");return new function(e){var n=this,a=void 0,s=c&&"object"===qt(c);return n.audioContext=e,n.instant=0,n.slow=0,n.clip=0,n.script=n.audioContext.createScriptProcessor(2048,1,1),n.script.onaudioprocess=function(e){if(!s||c&&c.mediaStream){var t,i=e.inputBuffer.getChannelData(0),o=0,r=0;for(t=0;t<i.length;++t)o+=i[t]*i[t],.99<Math.abs(i[t])&&(r+=1);n.instant=Math.sqrt(o/i.length),n.slow=.95*n.slow+.05*n.instant,n.clip=r/i.length}else n.stop();"function"==typeof a&&(a(null),a=void 0)},n.connectToSource=function(e,t){L.Logger.debug(U,"SoundMeter connecting");try{e&&e.getAudioTracks&&e.getAudioTracks().length?(n.mic=n.audioContext.createMediaStreamSource(e),n.mic.connect(n.script),n.script.connect(n.audioContext.destination),a=t):(n.stop(),"function"==typeof(a=t)&&(a(null),a=void 0))}catch(e){L.Logger.error(U,"connecToSource error:",e),void 0!==t&&t(e)}},n.stop=function(){n.mic&&n.mic.disconnect&&n.mic.disconnect(),n.script&&n.script.disconnect&&n.script.disconnect()},n}(e)}catch(e){L.Logger.error(U,"getsSoundMeterInstance errorinfo:",e)}},D.registerDeviceChangeListener=function(e){c=e},D.addDeviceChangeListener=function(e){a=e},D.stopVideoTest=function(e,t,i){try{if(e)R(e),s[e]={},s[e].testing=!1,s[e].mediaStream=null,L.Utils.isFunction(t)&&t();else{for(var o in s)s[r=o]?(R(r),s[r].testing=!1,s[r].mediaStream=null):L.Logger.warning(U,"_stopVideoTestFromSdk This operation fails info: No specified device.");L.Utils.isFunction(t)&&t()}}catch(e){L.Utils.isFunction(i)&&i(),L.Logger.warning(U,"_stopVideoTestFromSdk Method capture error info:",e)}var r},D.startVideoTest=function(e,t,i,o,r){s[e]&&s[e].testing&&(R(e),L.Logger.warning(U,"startVideoTest Method Is testing")),s[e]={},s[e].testing=!0,function(i,o,r,n,a){if(r=r||{},!i)return L.Utils.isFunction(a)&&a("YS_ERR_INVALID_ARG"),L.Logger.error(U,"startVideoTest got invalid deviceId");if(!o)return L.Utils.isFunction(a)&&a("YS_ERR_INVALID_ARG"),L.Logger.error(U,"startVideoTest got invalid elementId");R(i);T({video:{deviceId:{exact:i},width:{ideal:u.width},height:{ideal:u.height},frameRate:{ideal:u.maxfps,max:30}},audio:!1},function(e){if(s[i])if(s[i].testing){R(i);var t=L.Utils.createMediaStream(e.getVideoTracks()[0]);s[i].mediaStream=t,function(e,t,i,o,r,n,a){if(r=r||{},!e)return L.Logger.error(U,"playDeviceStream mediaStream can not be empty!");if(!i)return L.Logger.error(U,"playDeviceStream elementID can not be empty!");e.videoPlayer&&e.videoPlayer.destroy&&e.videoPlayer.destroy();e.videoPlayer=YS.VideoPlayer({id:"videoDeviceStream_"+(new Date).getTime(),elementID:i,deviceCheck:!0,options:r,successFn:n,failureFn:a});var s=void 0;if(YS.userCacheStreamVideo&&t&&YS.cacheStreams.hasOwnProperty(t)){var c=YS.cacheStreams[t]||{},d=(c=c.stream||{}).getVideoTracks();d&&d.length&&(s=d[0])}s?(e.videoPlayer.addVideoTrack(s),e.videoPlayer._useCachestream=!0):(e.videoPlayer.addVideoTrack(e.getVideoTracks()[0]),delete e.videoPlayer._useCachestream);"function"==typeof o&&o(e.videoPlayer)}(s[i].mediaStream,i,o,void 0,r,n,a)}else R(i);else L.Logger.error(U,"_startVideoTestFromSdk got invalid stream")},function(e){s[i].testing?(L.Logger.info(U," getUserMedia failed when test camera, failure info:",e),L.Utils.isFunction(a)&&a(e)):R(i)})}(e,t,i,o,r)},D.stopMicrophoneTest=function(){k(),r={testing:!1}},D.startMicrophoneTest=function(e,t,i,o){r.testing=!0,function(e,t,i,o){if(!e)return L.Logger.error(U,"startMicrophoneTest got invalid deviceId"),L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG");k(),T({audio:{deviceId:{exact:e}},video:!1},function(e){if(r.testing){k(),r.mediaStream=L.Utils.createMediaStream(void 0,e.getAudioTracks()[0]),t&&function(e,t,i,o){if(o=o||{},!e)return L.Logger.error(U,"playDeviceStream mediaStream can not be empty!");if(!t)return L.Logger.error(U,"playDeviceStream elementID can not be empty!");e.audioPlayer&&e.audioPlayer.destroy&&e.audioPlayer.destroy();e.audioPlayer=YS.AudioPlayer({id:"audioDeviceStream_"+(new Date).getTime(),elementID:t,deviceCheck:!0,options:o}),e.audioPlayer.addAudioTrack(e.getAudioTracks()[0]),"function"==typeof i&&i(e.audioPlayer)}(r.mediaStream,t);try{r._soundMeter&&r._soundMeter.stop&&(r._soundMeter.stop(),r._soundMeter=void 0),YS.audioContext&&r.mediaStream&&D&&D.getsSoundMeterInstance&&(r._soundMeter=D.getsSoundMeterInstance(YS.audioContext,r),r._soundMeter&&r._soundMeter.connectToSource&&r._soundMeter.connectToSource(r.mediaStream,function(e){if(!e){if(r._soundMeter&&r._soundMeter.instant&&r._soundMeter.instant.toFixed){var t=Math.floor(100*r._soundMeter.instant.toFixed(2));L.Utils.isFunction(i)&&i(t)}else L.Utils.isFunction(i)&&i(0);clearInterval(r._soundMeterTimer),r._soundMeterTimer=setInterval(function(){if(r._soundMeter&&r._soundMeter.instant&&r._soundMeter.instant.toFixed){var e=Math.floor(100*r._soundMeter.instant.toFixed(2));L.Utils.isFunction(i)&&i(e)}else L.Utils.isFunction(i)&&i(0)},100)}}))}catch(e){L.Logger.warning(U,"startMicrophoneTest error:",e)}}else k()},function(e){r.testing?(L.Utils.isFunction(o)&&o(e),L.Logger.info(U," getUserMedia failed when test microphone, failure info:",e)):k()})}(e,t,i,o)},D.stopSpeakerTest=function(){C(),n.testing=!1},D.startSpeakerTest=function(t,i,o,r){return r=r||{loop:!0},D.checkIsSupportSetSpeaker()?t?i?(n.testing=!0,void("edge"===L.Utils.getBrowserInfo(!0).info.browserName?T({video:!1,audio:!0},function(){n.testing&&Y(t,i,o,r)},function(e){L.Logger.error("startSpeakerTest getUserMedia err:",e),n.testing&&Y(t,i,o,r)}):Y(t,i,o,r))):(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.error(U,"startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.error(U,"startSpeakerTest got invalid deviceId")):(L.Logger.warning(L.Utils.getBrowserInfo(!0).info.browserName+" not support speaker test!",t,i),void(L.Utils.isFunction(o)&&o("YS_ERR_NOT_SUPPORT")))},D.setSpeakerTestVolume=function(e){i=e;var t=document.getElementById("YSSDK_speakerTest");t||((t=document.createElement("audio")).setAttribute("id","YSSDK_speakerTest"),t.setAttribute("loop","loop"),t.style.display="none",document.body.appendChild(t)),t.volume=i/100},D.getDevices=function(e,t){o(e,t)},D.getCameras=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.videoinput||[],t)},e)},D.getMicrophones=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.audioinput||[],t)},e)},D.getSpeakers=function(i,e){o(function(e,t){e&&e.devices&&i&&"function"==typeof i&&i(e.devices.audiooutput||[],t)},e)},D.setDevices=function(e,t){!D.checkIsSupportSetSpeaker()&&e.audiooutput&&(L.Logger.warning(U,L.Utils.getBrowserInfo(!0).info.browserName+" not support set audiooutput device!",e.audiooutput),delete e.audiooutput);var i={},o={};for(var r in e=e||{})e[r]&&"undefined"!==e[r]||(L.Logger.warning(U,r+" device lack of key parameters, del "+r+" deviceId!",e[r]),delete e[r]),o[r]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[r]),L.Constant.deviceStorage[r]&&e[r]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[r])&&(i[r]=!0);i.audiooutput&&e.audiooutput&&D.setSpeaker(e.audiooutput),i.videoinput&&e.videoinput&&D.setCamera(e.videoinput),i.audioinput&&e.audioinput&&D.setMicrophone(e.audioinput)},D.setCamera=function(e,t,i){if(!e)return L.Logger.error(U,"Lack of key parameters!",e),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var o=P(L.Constant.deviceStorage.videoinput,e);L.Utils.isFunction(D.onCameraSetted)&&D.onCameraSetted(e,o,t,i)},D.setMicrophone=function(e,t,i){if(!e)return L.Logger.error(U,"Lack of key parameters!",e),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var o=P(L.Constant.deviceStorage.audioinput,e);L.Utils.isFunction(D.onMicrophoneSetted)&&D.onMicrophoneSetted(e,o,t,i)},D.setSpeakerVolume=function(e){},D.checkIsSupportSetSpeaker=function(){var e=!0;return YS.isYsNative||"safari"!==L.Utils.getBrowserInfo(!0).info.browserName&&document.createElement("video").setSinkId||(e=!1),e},D.setSpeaker=function(e,t,i){if(!D.checkIsSupportSetSpeaker())return L.Logger.warning(L.Utils.getBrowserInfo(!0).info.browserName+" not support set speaker!",e),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_SUPPORT"));if(!e)return L.Logger.error(U,"Lack of key parameters!",e),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var o=P(L.Constant.deviceStorage.audiooutput,e);E(),L.Utils.isFunction(D.onSpeakerSetted)&&D.onSpeakerSetted(e,o,t,i)},D.checkVideoInputDevice=function(t,i){t?D.getVideoTrack(t,function(e){D.destroyVideoTrack(t),e?L.Utils.isFunction(i)&&i(!0):L.Utils.isFunction(i)&&i(!1)},function(){L.Utils.isFunction(i)&&i(!1)}):L.Utils.isFunction(i)&&i(!1)},D.checkAudioInputDevice=function(t,i){t?D.getAudioTrack(t,function(e){D.destroyAudioTrack(t),e?L.Utils.isFunction(i)&&i(!0):L.Utils.isFunction(i)&&i(!1)},function(){L.Utils.isFunction(i)&&i(!1)}):L.Utils.isFunction(i)&&i(!1)},D.getUserDesktopMedia=function(o,r,n,e){var t=M();if(L.Logger.info(U,"call getUserDesktopMedia",o," ,isNeedPlugin:",t),o=o||{},!0!==p.sharing){if(!t)try{var i=!o.hasOwnProperty("video")||o.video,a=!o.hasOwnProperty("audio")||o.audio,s=function(){L.Logger.info(U,"close user desktop media, not need plugin."),L.Utils.isFunction(e)&&e()},c=function(e){L.Logger.info(U,"getDesktopMedia success.",i,a),p.shared=!0,p.sharing=!1,(p.mediaStream=e).getVideoTracks()[0]&&(e.getVideoTracks()[0].onended=s),L.Utils.isFunction(r)&&r(e)},d=function(e){var t={code:-1,name:"UnknownError",message:e};"object"===qt(e)&&(t.code=e.code,t.name=e.name,t.message=e.message),p.shared=!1,p.sharing=!1,delete p.mediaStream,L.Logger.warning(U,"getDesktopMedia fail, failInfo:"+L.Utils.toJsonStringify(t)+" ,errorInfo:",e),L.Utils.isFunction(n)&&n(t)};return void(navigator.getDisplayMedia?(L.Logger.info(U,"getDesktopMedia: call share mode 1.",i,a),navigator.getDisplayMedia({video:i,audio:a}).then(c).catch(function(e){"object"===qt(e)&&"TypeError"===e.name&&a?(L.Logger.warning(U,"UserDesktopMedia:navigator.getDisplayMedia TypeError,delete audio again navigator.getDisplayMedia",e.name,e.message),navigator.getDisplayMedia({video:i,audio:!1}).then(c).catch(d)):d.apply(null,arguments)})):navigator.mediaDevices.getDisplayMedia?(L.Logger.info(U,"getDesktopMedia: call share mode 2.",i,a),navigator.mediaDevices.getDisplayMedia({video:i,audio:a}).then(c).catch(function(e){"object"===qt(e)&&"TypeError"===e.name&&a?(L.Logger.warning(U,"UserDesktopMedia:navigator.mediaDevices.getDisplayMedia TypeError,delete audio again navigator.mediaDevices.getDisplayMedia",e.name,e.message),navigator.mediaDevices.getDisplayMedia({video:i,audio:!1}).then(c).catch(d)):d.apply(null,arguments)})):(a=!!o.hasOwnProperty("audio")&&o.audio,"object"!==qt(i)&&(i={mediaSource:"screen"}),i.mediaSource=i.mediaSource||"screen",L.Logger.info(U,"getDesktopMedia: call share mode 3.",i,a),navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"},audio:a}).then(c).catch(function(e){"object"===qt(e)&&"TypeError"===e.name&&a?(L.Logger.warning(U,"UserDesktopMedia:navigator.mediaDevices.getUserMedia TypeError,delete audio again navigator.mediaDevices.getUserMedia",e.name,e.message),navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"},audio:!1}).then(c).catch(d)):d.apply(null,arguments)})))}catch(e){L.Logger.error(U,"getUserDesktopMedia not plugin err:",e)}D.closeUserDesktopMedia();var u=[];if(u=p.electronDesktopCapturer?["screen","window"]:["screen","window","tab"],o.types&&L.Utils.isArray(o.types)&&0<o.types.length&&(u=o.types),p.electronDesktopCapturer)return p.sharing=!0,L.Logger.info(U,"getDesktopMedia: electronDesktopCapturer getSources start.",u),void p.electronDesktopCapturer.getSources({types:u},function(e,t){if(L.Logger.info(U,"getDesktopMedia: electronDesktopCapturer getSources finsh.",e,t.length),e)return L.Utils.isFunction(n)&&n({code:-2,name:"ElectronDesktopCapturer",message:L.Utils.toJsonStringify(e)}),void(p.sharing=!1);0<t.length&&YS.SharePopUp&&(L.Logger.info(U,"getDesktopMedia: electronDesktopCapturer SharePopUp.",t.length),new YS.SharePopUp(t,{shareFunc:function(e){L.Logger.info(U,"getDesktopMedia: electronDesktopCapturer SharePopUp shareFunc.",e),l(e.id,!1),p.shared=!0,p.sharing=!1},cancelFunc:function(){L.Logger.info(U,"getDesktopMedia: electronDesktopCapturer SharePopUp cancelFunc."),p.shared=!1,p.sharing=!1,L.Utils.isFunction(n)&&n({code:1,name:"ElectronDesktopCapturer",message:"PermissionDeniedError"})},electron:o.electron}))});p.sharing=!0,p.istimeoutForGet=!1,p.timeridForGet=setTimeout(function(){L.Logger.warning(U,"getUserDesktopMedia Do TimeOut."),p.istimeoutForGet=!0,p.shared=!1,p.sharing=!1,delete p.mediaStream,L.Utils.isFunction(n)&&n({code:-2,name:"TimeOut",message:"getUserDesktopMedia TimeOut"}),p.eventListenForGet&&(window.removeEventListener("message",p.eventListenForGet),delete p.eventListenForGet)},2e3),p.eventListenForGet&&window.removeEventListener("message",p.eventListenForGet),p.eventListenForGet=function(e){!0!==p.istimeoutForGet&&("ys-reply-clear"===e.data.type?p.timeridForGet&&clearTimeout(p.timeridForGet):"ys-reply-get"===e.data.type&&(0===e.data.error?l(e.data.msg.streamId,e.data.msg.canRequestAudioTrack):(L.Logger.warning(U,"getUserDesktopMedia ys-reply-get errorinfo:",e.data.msg),p.shared=!1,p.sharing=!1,delete p.mediaStream,L.Utils.isFunction(n)&&n({code:-1,name:e.data.type,message:e.data.msg})),window.removeEventListener("message",p.eventListenForGet),delete p.eventListenForGet))},window.addEventListener("message",p.eventListenForGet),window.postMessage({type:"get-custom-sourceId",info:u,url:document.URL},"*")}else L.Logger.warning(U,"one task getUserDesktopMedia is doing.");function l(t){o.hasOwnProperty("audio")?o.audio&&(o.audio={mandatory:{chromeMediaSource:"desktop"}}):o.audio={mandatory:{chromeMediaSource:"desktop"}},p.electronDesktopCapturer&&"Mac"===L.Utils.detectOS()&&(o.audio=!1),o.video=o.video||{},o.video.mandatory=o.video.mandatory||{},o.video.mandatory.chromeMediaSource=o.video.mandatory.chromeMediaSource||"desktop",o.video.mandatory.maxWidth=o.video.mandatory.maxWidth||window.screen.width,o.video.mandatory.maxHeight=o.video.mandatory.maxHeight||window.screen.height,o.video.mandatory.maxFrameRate=o.video.mandatory.maxFrameRate||5,o.video.mandatory.chromeMediaSourceId=t;function i(){L.Logger.info(U,"close user desktop media, need plugin."),L.Utils.isFunction(e)&&e()}L.Logger.info(U,"getDesktopMedia: start getUserMedia.",o),A(o,function(e){L.Logger.info(U,"getDesktopMedia:  getUserMedia success",o),p.shared=!0,p.sharing=!1,(p.mediaStream=e).electronSourceId=t,e.getVideoTracks()[0]&&(e.getVideoTracks()[0].onended=i),L.Utils.isFunction(r)&&r(e)},function(e){L.Logger.error(U,"getDesktopMedia:  getUserMedia fail,err:",e,o),p.shared=!1,p.sharing=!1,delete p.mediaStream,L.Utils.isFunction(n)&&n(e)},void 0,{desktopShare:!0})}},D.getUseDevice=function(){return N},D.closeUserDesktopMedia=function(){if(L.Logger.debug(U,"call closeUserDesktopMedia"),D.cancelUserDesktopMediaDialog(),p.mediaStream){if(L.Logger.info(U,"closeUserDesktopMedia"),p.mediaStream.getVideoTracks&&"function"==typeof p.mediaStream.getVideoTracks){var e=p.mediaStream.getVideoTracks();if(e&&0<e.length)for(var t=0;t<e.length;t++)e[t]&&e[t].stop&&"function"==typeof e[t].stop&&L.Utils.stopTrack(e[t],!0)}if(p.mediaStream.getAudioTracks&&"function"==typeof p.mediaStream.getAudioTracks){var i=p.mediaStream.getAudioTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o]&&i[o].stop&&"function"==typeof i[o].stop&&L.Utils.stopTrack(i[o],!0)}delete p.mediaStream}p.shared=!1},D.cancelUserDesktopMediaDialog=function(){p.electronDesktopCapturer||(L.Logger.info(U,"cancelUserDesktopMediaDialog"),window.postMessage({type:"close-select-dialog"},"*"))},D.checkUserDesktopMediaMode=function(t){var i=M();i?p.electronDesktopCapturer?L.Utils.isFunction(t)&&t(!0,i):(p.istimeoutForCheck=!1,p.timeridForCheck=setTimeout(function(){L.Logger.warning(U,"checkUserDesktopMediaMode DoTimeOut."),p.istimeoutForCheck=!0,L.Utils.isFunction(t)&&t(!1,i),p.eventListenForCheck&&(window.removeEventListener("message",p.eventListenForCheck),delete p.eventListenForCheck)},2e3),p.eventListenForCheck&&window.removeEventListener("message",p.eventListenForCheck),p.eventListenForCheck=function(e){!0!==p.istimeoutForCheck&&"ys-reply-rtcmulticonnection"===e.data.type&&(p.timeridForCheck&&clearTimeout(p.timeridForCheck),L.Utils.isFunction(t)&&t(!0,i),window.removeEventListener("message",p.eventListenForCheck),delete p.eventListenForCheck)},window.addEventListener("message",p.eventListenForCheck),window.postMessage({type:"rtcmulticonnection"},"*")):L.Utils.isFunction(t)&&t(!0,i)},D.checkDesktopIsNeedPlugin=M,D.enumerateDevices=function(e,t){D.getDevices(e,t)},D.setElementSinkIdToAudioouputDevice=function(e,t,i){E(e,t,i)},D.associateElementsToSpeaker=function(e,t,i){E(e,t,i)},navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(r){o(function(e,t){var i={},o={};if(t&&t.addDevices&&(i=t.addDevices),t&&t.removedDevices&&(o=t.removedDevices),L.Utils.getJsonLength(i)&&L.Logger.info(U,"device change finshed ,addDevices:"+L.Utils.toJsonStringify(i)),L.Utils.getJsonLength(o)&&L.Logger.info(U,"device change finshed ,removedDevices:"+L.Utils.toJsonStringify(o)),L.Utils.getJsonLength(i)||L.Utils.getJsonLength(o)){if(0<L.Utils.getJsonLength(o)&&o.hasOwnProperty("videoinput"))o.videoinput.forEach(function(e){!function(e){if(e&&YS.cacheStreams.hasOwnProperty(e)){YS.cacheStreams[e].onvideomuted=void 0,clearTimeout(YS.cacheStreams[e].timer),YS.cacheStreams[e].timer=void 0;var t=YS.cacheStreams[e].video;t&&L.Utils.detachMediaStream(t),delete YS.cacheStreams[e]}}(e.deviceId)});L.Utils.isFunction(D.onDeviceChanged)?D.onDeviceChanged(i,o,r,a):L.Utils.isFunction(a)&&a(i,o,r),L.Utils.isFunction(c)&&(L.Utils.getJsonLength(i)&&c(i,YS.DEVICE_STATE.DEVICE_ADD),L.Utils.getJsonLength(o)&&c(o,YS.DEVICE_STATE.DEVICE_REMOVE))}},{getDeviceChangeInfo:!0})}),D}(),window.L&&window.L._onLoadFinshInitSDK&&window.L._onLoadFinshInitSDK(),window.YS=window.YS||{},window.L=window.L||{},YS.networkTestInfo=YS.networkTestInfo||{protocol:"https",host:"api.roadofcloud.com",port:443,isConnectRoom:!1},window.YS._videoResolutions=[[80,45],[80,48],[80,60],[176,100],[176,144],[200,150],[320,180],[320,240],[640,360],[640,480],[1280,720],[1920,1080]],window.YS._getFitVideoResolution=function(e,t,i){var o={width:e||window.YS._videoResolutions[0][0],height:t||window.YS._videoResolutions[0][1]};if(e||t){for(var r=-1,n=-1,a=0,s=window.YS._videoResolutions.length;a<s;a++){var c=window.YS._videoResolutions[a],d=c[0],u=c[1];e&&e<=d&&-1===r&&(r=a),t&&t<=u&&-1===n&&(n=a)}if(-1!==r&&-1!==n){var l=Math.max(r,n);o={width:window.YS._videoResolutions[l][0],height:window.YS._videoResolutions[l][1]}}else-1!==r?i||!t?o={width:window.YS._videoResolutions[r][0],height:window.YS._videoResolutions[r][1]}:o.width=window.YS._videoResolutions[r][0]:-1!==n?i||!e?o={width:window.YS._videoResolutions[n][0],height:window.YS._videoResolutions[n][1]}:o.height=window.YS._videoResolutions[n][0]:i&&(o={width:window.YS._videoResolutions[window.YS._videoResolutions.length-1][0],height:window.YS._videoResolutions[window.YS._videoResolutions.length-1][1]})}else o={width:window.YS._videoResolutions[0][0],height:window.YS._videoResolutions[0][1]};return o},window.YS._getVideoResolutionCandidates=function(e,t,i,o){for(var r=[],n=!0,a=0,s=window.YS._videoResolutions.length;a<s;a++){var c=window.YS._videoResolutions[a],d=c[0],u=c[1];if(e<=d&&t<=u&&(n=!1),d!==e||u!==t){if(i&&o){if(i<=d&&o<=u)continue}else if(i){if(i<=d)continue}else if(o&&o<=u)continue;n?r.unshift({width:d,height:u}):r.push({width:d,height:u})}}return r},YS.DeviceMgr=function(){var e={},a={testing:!1,timer:void 0};function r(e,t,i,r,n){a.testing?L.Utils.speedNetwordk(e,t,i,function(e,t){if(YS.networkTestInfo.isConnectRoom)s(),a.testing=!1,L.Logger.warning(logType,"The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(n)&&n("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT");else if(a.testing){var i=parseInt(t/2);0!==e&&(i=99999);var o=L.Utils.getNetDelayLevel(i);L.Utils.isFunction(r)&&r(o,i)}else s()},{source:"(NetworkTest)",infoLog:!1}):s()}function s(){clearInterval(a.timer),a.timer=void 0}return e.stopVideoTest=function(e,t,i){YS.DeviceMgrImpl.stopVideoTest(e,t,i)},e.startVideoTest=function(e,t,i,o,r){YS.DeviceMgrImpl.startVideoTest(e,t,i,o,r)},e.stopMicrophoneTest=function(){YS.DeviceMgrImpl.stopMicrophoneTest()},e.startMicrophoneTest=function(e,t,i,o){YS.DeviceMgrImpl.startMicrophoneTest(e,t,i,o)},e.stopSpeakerTest=function(){YS.DeviceMgrImpl.stopSpeakerTest()},e.startSpeakerTest=function(e,t,i,o){YS.DeviceMgrImpl.startSpeakerTest(e,t,i,o)},e.setSpeakerTestVolume=function(e){null==e||e<0||100<e?L.Logger.error(logType," invalid arguments in funciton setSpeakerTestVolume"):YS.DeviceMgrImpl.setSpeakerTestVolume(e)},e.stopNetworkTest=function(){s(),a.testing=!1},e.startNetworkTest=function(e,t){var i,o;a.testing=!0,i=e,o=t,s(),YS.networkTestInfo.isConnectRoom?(s(),a.testing=!1,L.Logger.warning(logType,"The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(o)&&o("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT")):a.testing?(r(YS.networkTestInfo.protocol,YS.networkTestInfo.host,YS.networkTestInfo.port,i,o),a.timer=setInterval(function(){YS.networkTestInfo.isConnectRoom?(s(),a.testing=!1,L.Logger.warning(logType,"The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(o)&&o("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT")):a.testing?r(YS.networkTestInfo.protocol,YS.networkTestInfo.host,YS.networkTestInfo.port,i,o):s()},3e3)):s()},e.getDevices=function(e,t){YS.DeviceMgrImpl.getDevices(e,t)},e.getCameras=function(e){YS.DeviceMgrImpl.getCameras(e)},e.getMicrophones=function(e){YS.DeviceMgrImpl.getMicrophones(e)},e.getSpeakers=function(e){YS.DeviceMgrImpl.getSpeakers(e)},e.setDevices=function(e,t){YS.DeviceMgrImpl.setDevices(e,t)},e.setCamera=function(e,t){YS.DeviceMgrImpl.setCamera(e,t)},e.setMicrophone=function(e,t){YS.DeviceMgrImpl.setMicrophone(e,t)},e.setSpeaker=function(e,t){YS.DeviceMgrImpl.setSpeaker(e,t)},e.setSpeakerVolume=function(e){YS.DeviceMgrImpl.setSpeakerVolume(e)},e.checkIsSupportSetSpeaker=function(){return YS.DeviceMgrImpl.checkIsSupportSetSpeaker()},e.setMaxVideoProfile=function(e,t,i){YS.DeviceMgrImpl.setMaxVideoProfile(e,t,i)},e.registerDeviceChangeListener=function(e){YS.DeviceMgrImpl.registerDeviceChangeListener(e)},e.setAudioProcessing=function(e){YS.DeviceMgrImpl.setAudioProcessing(e)},e.associateElementsToSpeaker=function(e,t,i){YS.DeviceMgrImpl.associateElementsToSpeaker(e,t,i)},e.startCameraTest=function(e,t,i,o,r){L.Logger.info(" startCameraTest and stopCameraTest will be deprecated, please use startVideoTest and stopVideoTest"),YS.DeviceMgrImpl.startVideoTest(e,t,o,r,i)},e.stopCameraTest=function(){L.Logger.info(" startCameraTest and stopCameraTest will be deprecated, please use startVideoTest and stopVideoTest"),YS.DeviceMgrImpl.stopVideoTest()},e.addDeviceChangeListener=function(e){L.Logger.info(" addDeviceChangeListener will be deprecated, please use registerDeviceChangeListener"),YS.DeviceMgrImpl.addDeviceChangeListener(e)},e.enumerateDevices=function(e,t){L.Logger.info(" enumerateDevices will be deprecated, please use getDevices or (getCameras getMicrophones getSpeakers)"),YS.DeviceMgrImpl.enumerateDevices(e,t)},e.checkDesktopIsNeedPlugin=function(){return!!YS.DeviceMgrImpl.checkDesktopIsNeedPlugin&&YS.DeviceMgrImpl.checkDesktopIsNeedPlugin()},e.startAudioMix=function(e,t){return YS.DeviceMgrImpl.startAudioMix&&YS.DeviceMgrImpl.startAudioMix(e,t)},e.stopAudioMix=function(e,t){return YS.DeviceMgrImpl.startAudioMix&&YS.DeviceMgrImpl.stopAudioMix(e,t)},e.stopAllAudioMix=function(){return YS.DeviceMgrImpl.startAudioMix&&YS.DeviceMgrImpl.stopAllAudioMix()},e}(),window.L&&window.L._onLoadFinshInitSDK&&window.L._onLoadFinshInitSDK(),window.YS=window.YS||{},window.L=window.L||{},YS.CONNECTION_TYPE={UP:0,DOWN:1},YS.customStreamFn=void 0,YS.Connection=function(e){var c,d="Connection ";if(L.Utils.isNull(e))throw" got null parameter while creating connection";if(!e.hasOwnProperty("connectionId"))throw" got a parameter without property connectionId while creating connection";if(!e.hasOwnProperty("connectionType"))throw" got a parameter without property connectionType while creating connection";var u=void 0,n=e.connectionId,s=!0,r=!0,l=e.connectionType,p=null,t=e.extensionId,o=null,i=!1,f=null,a=null,m=!1,g={};function v(t,e,i){var o=function(e){var t=void 0;switch(e){case"video":t=g.getVideoTrack();break;case"audio":t=g.getAudioTrack()}return t}(t.kind);if(!t||!o)return L.Logger.warning(d,"replaceTrack fail ( connection_id is "+n+" ) track == null!"),void(L.Utils.isFunction(i)&&i());"audio"===o.kind&&(L.Utils.stopTrack(o),t=t&&L.Utils.cloneTrack(t)),L.Logger.debug(d,"replaceTrack(connection_id is "+n+")",o,t),Promise.resolve().then(function(){var e=c.getSenders().find(function(e){return e.track===o});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){u&&L.Utils.removeTrack(u,o),u&&u.addTrack(t),"video"===t.kind?g.enableVideo(s):"audio"===t.kind&&g.enableAudio(r),L.Utils.isFunction(e)&&e()}).catch(function(e){L.Logger.error(d,"replaceTrack error(connection_id is "+n+"):",e),L.Utils.isFunction(i)&&i(e)})}function h(t){L.Logger.info(d," Connection::onAddStream",n,t.stream.getVideoTracks().length,t.stream.getAudioTracks().length),u=t.stream;var e=g.getVideoTrack();g.enableVideo(s),g.enableAudio(r),"safari"!==L.Utils.getBrowserInfo(!0).info.browserName||e?L.Utils.isFunction(g.onAddStream)&&g.onAddStream(n,t):t.stream.onaddtrack=function(e){L.Utils.isFunction(g.onAddStream)&&g.onAddStream(n,t)}}function S(e){L.Logger.info(d," Connection::onRemoveStream",n,e),u=void 0,L.Utils.isFunction(g.onRemoveStream)&&g.onRemoveStream(n,e)}function y(e){if(L.Logger.debug(d," Connection::onIceCandidate",n,e.candidate),L.Utils.isFunction(g.onIceCandidate)){var t={};if(e.candidate){if(e.candidate.candidate.match(/tcp/))return;var i;e.candidate.candidate.match(/a=/)||(i="a="+e.candidate.candidate),t={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:i}}else t={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"};g.onIceCandidate(n,{type:"candidate",candidate:t})}}function _(e){L.Utils.isNull(c)?L.Logger.info(d," Connection::OnConnectionStateChange null peer:",c):(L.Logger.info(d," Connection::OnConnectionStateChange",n,c.connectionState),"failed"===c.connectionState&&L.Utils.isFunction(g.onIceConnectionStateChange)&&g.onIceConnectionStateChange(n,c.connectionState))}function b(e){L.Utils.isNull(c)?L.Logger.info(d," Connection::onIceConnectionStateChange null peer:",c):(L.Logger.info(d," Connection::onIceConnectionStateChange",n,c.iceConnectionState),m&&"failed"===c.iceConnectionState||L.Utils.isFunction(g.onIceConnectionStateChange)&&g.onIceConnectionStateChange(n,c.iceConnectionState))}return g.setPeerConnection=function(e){(c=e).onaddstream=h,c.onremovestream=S,c.onicecandidate=y,c.oniceconnectionstatechange=b,"chrome"===adapter.browserDetails.browser&&75<adapter.browserDetails.version&&(m=!0,c.onconnectionstatechange=_)},g.getPeerConnection=function(){return c},g.getExtensionId=function(){return t},g.getConnectionId=function(){return n},g.createOffer=function(t,i,e){if(L.Utils.isNull(c)){if(L.Logger.error(d," Connection::createOffer: peerconnection object is null"),L.Utils.isFunction(i)){var o=new DOMException("peerconnection object is null","createOffer-error");i(o)}}else{e=e||{};var r={offerToReceiveAudio:l!==YS.CONNECTION_TYPE.UP,offerToReceiveVideo:!1!==e.video&&l!==YS.CONNECTION_TYPE.UP};L.Utils.createOffer(c,function(e){L.Logger.debug(d,"Local Description(createOffer)",e.sdp),L.Utils.isFunction(t)&&t(e),L.Utils.setLocalDescription(c,e,function(){L.Utils.isFunction(g.onOfferGenerated)&&g.onOfferGenerated(n,e)},function(e){L.Logger.error(d," Connection::setLocalDescription failed",e)})},function(e){L.Logger.error(d," Connection::createOffer failed",e),L.Utils.isFunction(i)&&i(e)},r)}},g.createAnswer=function(){L.Utils.createAnswer(c,function(e){L.Utils.setLocalDescription(c,e,function(){L.Logger.debug(d,"createAnswer setLocalDes",e),L.Utils.isFunction(g.onOfferGenerated)&&g.onOfferGenerated(n,e)},function(e){L.Logger.error(d,"createAnswer setLocalDes error")})},function(){})},g.setBandWidth=function(t,i,o){if(p){if(!s)return f=t,void(L.Utils.isFunction(i)&&i());if("chrome"===adapter.browserDetails.browser&&69<=adapter.browserDetails.version&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var r=g.getVideoTrack(),e=c.getSenders().find(function(e){return e.track===r}),n=e.getParameters();return n.encodings||(n.encodings=[{}]),n.encodings[0].maxBitrate=1e3*t,void e.setParameters(n).then(function(){L.Utils.isFunction(i)&&i()}).catch(function(e){L.Utils.isFunction(o)&&o(e)})}var a={offerToReceiveAudio:l!==YS.CONNECTION_TYPE.UP,offerToReceiveVideo:l!==YS.CONNECTION_TYPE.UP};L.Utils.createOffer(c,function(e){L.Utils.setLocalDescription(c,e,function(){var e={video:!0,maxVideoBW:t};p.sdp=L.Utils.setMaxBWToSdp(p.sdp,e,{audio:!0,maxVideoBW:null}),L.Utils.setRemoteDescription(c,new RTCSessionDescription(p),function(){L.Utils.isFunction(i)&&i()},function(e){L.Utils.isFunction(o)&&o(e)})},function(e){})},function(e){L.Utils.isFunction(o)&&o(e)},a)}},g.setRemoteDescription=function(e,t,i){return L.Utils.isNull(c)?(L.Logger.error(d," Connection::setRemoteDescription: peerconnection object is null"),void(L.Utils.isFunction(i)&&i("peerconnection object is null"))):L.Utils.isNull(e)?(L.Logger.error(d," Connection::setRemoteDescription: sdp object is null"),void(L.Utils.isFunction(i)&&i("sdp object is null"))):(p=e,void L.Utils.setRemoteDescription(c,new RTCSessionDescription(e),function(){L.Utils.isFunction(t)&&t()},function(e){L.Utils.isFunction(i)&&i(e)}))},g.addIceCandidate=function(e){var t=new RTCIceCandidate(e);L.Utils.addIceCandidate(c,t,function(){L.Logger.debug(d,"addIceCandidate success",n,t)},function(){L.Logger.error(d,"addIceCandidate failed",n,t)})},g.setMediaStream=function(t,e,i){if(i=i||{},t.getAudioTracks()&&0<t.getAudioTracks().length){var o=t.getAudioTracks()[0];if(o&&L.Utils.removeTrack(t,o),o&&i.attributes&&i.attributes.type===YS.STREAM_VIDEO&&i.isMix&&YS.audioContext)if(L.Utils.isSupportMediaStreamMix())try{var r=L.Utils.getLocalMicMediaStreamDestination(),n=r.stream;g.micAudioSourceNode&&g.micAudioSourceNode.disconnect(0),g.micAudioSourceNode=YS.audioContext.createMediaStreamSource(L.Utils.createMediaStream(void 0,o));var a=L.Utils.getLocalMicDynamicsCompressor();a.disconnect(0),g.micAudioSourceNode&&g.micAudioSourceNode.connect(a),a.connect(r),t.addTrack(n.getAudioTracks()[0]),g._useLocalMicMediaStreamDestination=!0}catch(e){L.Logger.error(d,"setMediaStream WebAudioAPI err:",e),o&&t.addTrack(L.Utils.cloneTrack(o))}else L.Logger.warning(d,"setMediaStream:not support audio fix"),t.addTrack(L.Utils.cloneTrack(o));else t.addTrack(L.Utils.cloneTrack(o))}if(e&&L.Utils.isFunction(e)){var s=e(t);YS.customStreamFn=e,s?t=s:L.Logger.error(d,"setStreamMethod Wrong return result.")}l!==YS.CONNECTION_TYPE.UP||L.Utils.isNull(c)||L.Utils.isNull(t)||L.Utils.addStream(c,t),u=t},g.getMediaStream=function(){if(!L.Utils.isNull(c))return l===YS.CONNECTION_TYPE.UP?u:l===YS.CONNECTION_TYPE.DOWN?c.getRemoteStreams()[0]:void 0},g.removeMediaStream=function(e){l!==YS.CONNECTION_TYPE.UP||L.Utils.isNull(c)||L.Utils.isNull(e)||c.removeStream(e),u=void 0},g.replaceAudioTrack=function(t){if(g.getAudioTrack())if(g._useLocalMicMediaStreamDestination)try{g.micAudioSourceNode&&g.micAudioSourceNode.disconnect(0),t&&(g.micAudioSourceNode=YS.audioContext.createMediaStreamSource(L.Utils.createMediaStream(void 0,t)));var e=L.Utils.getLocalMicDynamicsCompressor();g.micAudioSourceNode&&g.micAudioSourceNode.connect(e)}catch(e){L.Logger.error(d,"replaceAudioTrack WebAudioAPI err:",e),v(t)}else v(t);else L.Logger.warning(d,"old track is not exist,not support addAudioTrack method!")},g.replaceVideoTrack=function(e,t){if(g.getVideoTrack()||o){if(!g.getVideoTrack()&&o)return void(i=o!==e);v(e,null,t)}else L.Logger.warning(d,"old track is not exist,not support getVideoTrack method!")},g.needRePublish=function(){return i},g.getVideoTrack=function(){return L.Utils.isNull(g.getMediaStream())?void 0:g.getMediaStream().getVideoTracks()[0]},g.getAudioTrack=function(){return L.Utils.isNull(g.getMediaStream())?void 0:g.getMediaStream().getAudioTracks()[0]},g.enableVideo=function(e){(function(e){if(l===YS.CONNECTION_TYPE.UP)if(e){if(!g.getVideoTrack()&&o){if(u.addTrack(o),a&&a.replaceTrack){var t=a.replaceTrack(o);t&&t.then(function(e){L.Logger.debug(" sender replaceTrack success",e)},function(e){L.Logger.error(" sender replaceTrack error info:",e)})}a=o=null}}else o=g.getVideoTrack()||o,c.getSenders()&&!a&&(a=c.getSenders().find(function(e){return e.track===o})),o&&L.Utils.removeTrack(u,o);else{var i=g.getVideoTrack();i&&i.enabled!==e&&(i.enabled=e)}})(s=e),f&&s&&(g.setBandWidth(f),f=null)},g.videoEnabled=function(){return s},g.enableAudio=function(e){var t,i;t=r=e,(i=g.getAudioTrack())&&i.enabled!==t&&(i.enabled=t)},g.audioEnabled=function(){return r},g.close=function(){L.Utils.isNull(c)||(u&&u.getTracks().forEach(function(e){"audio"===e.kind&&L.Utils.stopTrack(e),L.Utils.removeTrack(u,e)}),c.close(),u=null)},g.getStats=function(t,i){L.Utils.isNull(c)&&(L.Logger.error(d," Connection::getStats: peerconnection object is null"),L.Utils.isFunction(i)&&i("peerconnection object is null")),L.Utils.getStats(c,null,function(e){L.Utils.isFunction(t)&&t(e)},function(e){L.Utils.isFunction(i)&&i(e)})},g.onOfferGenerated=void 0,g.onIceCandidate=void 0,g.onIceConnectionStateChange=void 0,g.onAddStream=void 0,g.onRemoveStream=void 0,g},window.YS=window.YS||{},window.L=window.L||{},YS.ConnectionMgr=function(){var a="ConnectionMgr ",s={},e={};return YS.coreEventController.addEventListener("sdk-track-stop",function(e){var t=e&&e.data;if("object"===qt(t)&&t.custom_id)for(var i in s){var o=void 0;s[i]&&(o="video"===t.kind?s[i].getVideoTrack():s[i].getAudioTrack()),o&&o._custom_parent_id===t.custom_id&&L.Utils.stopTrack(o,t.force)}}),e.createUpConnection=function(e,t){if(!L.Utils.isNull(e)){var i=!1,o=void 0,r=void 0;if(L.Utils.isNull(t)||L.Utils.isNull(t.useNative)||!L.Utils.isBoolean(t.useNative)||(i=t.useNative),!L.Utils.isNull(t)&&t.hasOwnProperty("extraData")&&(o=t.extraData),i)r=YS.NativeConnection({connectionId:e,connectionType:YS.CONNECTION_TYPE.UP,extraData:o}),!L.Utils.isNull(t)&&t.hasOwnProperty("mediaStream")&&r.setMediaStream(t.mediaStream,t.extraData.setStreamMethod,t.extraData);else{r=YS.Connection({connectionId:e,connectionType:YS.CONNECTION_TYPE.UP,extensionId:t.extraData.extensionId});var n=new RTCPeerConnection;r.setPeerConnection(n),!L.Utils.isNull(t)&&t.hasOwnProperty("mediaStream")&&r.setMediaStream(t.mediaStream,t.extraData.setStreamMethod,t.extraData)}return s[e]=r}L.Logger.error(a," createUpConnection got invalid parameter")},e.createDownConnection=function(e,t){if(!L.Utils.isNull(e)){var i=!1,o=void 0,r=void 0;if(L.Utils.isNull(t)||L.Utils.isNull(t.useNative)||!L.Utils.isBoolean(t.useNative)||(i=t.useNative),!L.Utils.isNull(t)&&t.hasOwnProperty("extraData")&&(o=t.extraData),i)r=YS.NativeConnection({connectionId:e,connectionType:YS.CONNECTION_TYPE.DOWN,extraData:o});else{r=YS.Connection({connectionId:e,connectionType:YS.CONNECTION_TYPE.DOWN});var n=new RTCPeerConnection;r.setPeerConnection(n)}return s[e]=r}L.Logger.error(a," createUpConnection got invalid parameter")},e.getConnection=function(e){return s[e]},e.getConnectionByExtensionId=function(e){var t=null;for(var i in s)if(s[i].getExtensionId()===e){t=s[i];break}return t},e.getAllConnections=function(){var e=[];for(var t in s)e.push(s[t]);return e},e.closeConnection=function(e){var t=s[e];t&&(t.close(),t=null,delete s[e])},e.closeAllConnections=function(){for(var e in s){var t=s[e];t.close(),t=null}s={}},e.bindIceCandidate=function(e,t){var i=s[e];i&&(i.onIceCandidate=t)},e.bindOfferGenerated=function(e,t){var i=s[e];i&&(i.onOfferGenerated=t)},e.bindIceConnectionStateChange=function(e,t){var i=s[e];i&&(i.onIceConnectionStateChange=t)},e.bindAddStream=function(e,t){var i=s[e];i&&(i.onAddStream=t)},e}(),window.YS=window.YS||{},window.L=window.L||{},window.YS_MODULE=window.YS_MODULE||{},YS.updateApplyConstraintsToCloneTrack=YS.updateApplyConstraintsToCloneTrack||{},window.YS_MODULE.MediaControl=function(){var p="MediaControl ",e={},n=YS.ConnectionMgr;return e.createUpConnection=function(e,t){return t=t||{},n.createUpConnection(e,t)},e.createDownConnection=function(e,t){return n.createDownConnection(e,t)},e.closeConnection=function(e){n.closeConnection(e)},e.closeAllConnections=function(){n.closeAllConnections()},e.hasConnection=function(e){return!!n.getConnection(e)},e.replaceAudioTrack=function(e,t){var i=n.getConnection(e);i&&i.replaceAudioTrack(t)},e.replaceVideoTrack=function(e,t){var i=n.getConnection(e);i&&i.replaceVideoTrack(t)},e.openWebScreen=function(e,t,i,o){try{YS.DeviceMgrImpl.getUserDesktopMedia(e,function(e){L.Utils.isFunction(t)&&(t(e),L.Logger.info(p,"Web Screen sharing success !"))},function(e){L.Logger.warning(p,"Web Screen sharing failed !"),L.Utils.isFunction(i)&&i(e)},o)}catch(e){L.Logger.warning(p,"Web Screen sharing failed !")}},e.closeWebScreen=function(){YS.DeviceMgrImpl.closeUserDesktopMedia()},e.getVideoProfile=function(e){return YS.DeviceMgrImpl.getVideoProfile(e)},e.getDeviceMediaStream=function(e,t,i,o,r){function n(){if(u&&l)if(a||s){var e=YS.isYsNative?YS.isYsMacNative?L.Utils.createMediaStream(a,s):L.Utils.nativeMediaStream(a,s):L.Utils.createMediaStream(a,s);L.Utils.isFunction(i)&&i(e,c,d)}else L.Utils.isFunction(o)&&o(c,d)}var a,s,c,d,u=!1,l=!1;e?YS.DeviceMgrImpl.getVideoTrack(e,function(e){u=!0,a=e,n()},function(e){u=!0,c=e,n()},r):(u=!0,n()),t?YS.DeviceMgrImpl.getAudioTrack(t,function(e){l=!0,s=e,n()},function(e){l=!0,d=e,n()}):(l=!0,n())},e.hasDeviceVideoTrack=function(e){return YS.DeviceMgrImpl.hasVideoTrack(e)},e.hasDeviceAudioTrack=function(e){return YS.DeviceMgrImpl.hasAudioTrack(e)},e.setMaxVideoProfile=function(e,t,i){YS.DeviceMgrImpl.setMaxVideoProfile(e,t,i)},e.setSmallVideoProfile=function(e,t,i){YS.DeviceMgrImpl.setSmallVideoProfile(e,t,i)},e.getSmallVideoProfile=function(){return YS.DeviceMgrImpl.getSmallVideoProfile()},e.destroyVideoTrack=function(e){YS.DeviceMgrImpl.destroyVideoTrack(e)},e.destroyAudioTrack=function(e){YS.DeviceMgrImpl.destroyAudioTrack(e)},e.destroyAllVideoTrack=function(){YS.DeviceMgrImpl.destroyAllVideoTrack()},e.destroyAllAudioTrack=function(){YS.DeviceMgrImpl.destroyAllAudioTrack()},e.getConnectionVideoTrack=function(e){var t=n.getConnection(e);return t?t.getVideoTrack():null},e.getConnectionAudioTrack=function(e){var t=n.getConnection(e);return t?t.getAudioTrack():null},e.createOffer=function(e,t,i,o){var r=n.getConnection(e);r?r.createOffer(t,i,o):L.Utils.isFunction(i)&&i("YS_ERR_NOT_PEERCONNECTION")},e.setRemoteDescription=function(e,t,i,o){var r=n.getConnection(e);r?r.setRemoteDescription(t,i,o):L.Utils.isFunction(o)&&o("YS_ERR_NOT_PEERCONNECTION")},e.setBandWidth=function(e,t,i,o){var r=n.getConnection(e);r?r.setBandWidth(t,i,o):L.Utils.isFunction(o)&&o("YS_ERR_NOT_PEERCONNECTION")},e.getStats=function(e,t,i){var o=n.getConnection(e);o?o.getStats(t,i):L.Utils.isFunction(i)&&i("YS_ERR_NOT_PEERCONNECTION")},e.bindIceCandidate=function(e,t){n.bindIceCandidate(e,t)},e.bindOfferGenerated=function(e,t){n.bindOfferGenerated(e,t)},e.bindIceConnectionStateChange=function(e,t){n.bindIceConnectionStateChange(e,t)},e.bindAddStream=function(e,i){n.bindAddStream(e,function(e,t){L.Utils.isFunction(i)&&i(e,t)})},e.getDeviceMgr=function(){return YS.DeviceMgr},e.checkDeviceAvailability=function(e,t,i){i=i||{};var o=e.devices,r=o.videoinput.slice(0),n=o.audioinput.slice(0),a=null,s=null,c=0;function d(){2<=(c+=1)&&L.Utils.isFunction(t)&&t()}if(r.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput))for(var u=r.length-1;0<=u;u--){var l=r[u];if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)===l.deviceId){r.splice(u,1),r.unshift(l);break}}}else a={code:8,message:"Requested device not found",name:"NotFoundError"};if(n.length){if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput))for(u=n.length-1;0<=u;u--){l=n[u];if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)===l.deviceId){n.splice(u,1),n.unshift(l);break}}}else s={code:8,message:"Requested device not found",name:"NotFoundError"};!function(e){if(e.length){var t=e.shift();YS.DeviceMgrImpl.checkVideoInputDevice(t.deviceId,function(e){e?(i.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t.deviceId),L.Utils.isFunction(i.onVideoSuccess)&&i.onVideoSuccess()):L.Logger.error(p," The equipment is not available deviceId:",t.deviceId),d()})}else L.Utils.isFunction(i.onVideoFailure)&&(a={code:-1,message:"Requested device unknown error",name:"UnknownError"},i.onVideoFailure(a)),d()}(r),function(e){if(e.length){var t=e.shift();YS.DeviceMgrImpl.checkAudioInputDevice(t.deviceId,function(e){e?(i.findAvailabilityDevice&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,t.deviceId),L.Utils.isFunction(i.onAudioSuccess)&&i.onAudioSuccess()):L.Logger.error(p," The equipment is not available deviceId:",t.deviceId),d()})}else L.Utils.isFunction(i.onAudioFailure)&&(s={code:-1,message:"Requested device unknown error",name:"UnknownError"},i.onAudioFailure(s)),d()}(n)},e.videoEnabled=function(e){var t=n.getConnection(e);return!!t&&t.videoEnabled()},e.audioEnabled=function(e){var t=n.getConnection(e);return!!t&&t.audioEnabled()},e.enableVideo=function(e,t){var i=n.getConnection(e);i&&i.enableVideo(t)},e.enableAudio=function(e,t){var i=n.getConnection(e);i&&i.enableAudio(t)},e.hasNativeConnection=function(e){var t=n.getConnection(e);return!(!t||!t.isNative)},e.setVideoProfile=function(e,t,i,o){function r(){L.Utils.isFunction(i)&&i()}YS.DeviceMgrImpl.setVideoProfile(e,t,function(){YS.DeviceMgrImpl.hasVideoTrack(t)?YS.DeviceMgrImpl.getVideoTrack(t,function(e){r()},function(){L.Utils.isFunction(o)&&o()}):r()})},e.getUseVideoProfile=function(e){return YS.DeviceMgrImpl.getUseVideoProfile(e)},e.getMaxVideoProfile=function(){return YS.DeviceMgrImpl.getMaxVideoProfile()},e.needRePublish=function(e){var t=n.getConnection(e);return!!t&&t.needRePublish()},e}(),window.YS=window.YS||{},window.L=window.L||{},YS.deviceInfoMap=YS.deviceInfoMap||{videoinput:[],audioinput:[],audiooutput:[]},YS.hasDevice=YS.hasDevice||{videoinput:!1,audioinput:!1,audiooutput:!1},YS.networkTestInfo=YS.networkTestInfo||{protocol:"https",host:"api.roadofcloud.com",port:443,isConnectRoom:!1},YS.NativeAVMgr=function(){var y="NativeAVMgr ",_={},o={width:1920,height:1080,maxfps:30},r={width:320,height:180,maxfps:10},n={},a={},s={},c={},d={},u=void 0,l=void 0;_.onCameraSetted=null,_.onMicrophoneSetted=null,_.onSpeakerSetted=null,_.room_video_width=320,_.room_video_height=240,_.room_video_fps=10,_.onMicVolumeReportCallback=void 0,_.onDevicesSetted=null,_.onDeviceChanged=null,_.isNativeSetVideoProfile=!0;var b={},w={},p={},e=100,I={},f=function(){return e++},m={player:null},g={audioUrl:null},v={testing:!1,timer:void 0};function h(e,t){try{if(!(e=e||{})[t]||!e[t].deviceId)return"";if("string"==typeof e[t].deviceId)return e[t].deviceId;if("object"!==qt(e[t].deviceId))return"";if("string"==typeof e[t].deviceId.exact)return e[t].deviceId.exact}catch(e){return""}}function T(e,t){L.Logger.debug(y,"call enumerateDevices from client!");var i=f();b[i]=e;var o=t||{};o.isSetlocalStorage=void 0!==t&&(null!=t.isSetlocalStorage&&t.isSetlocalStorage),w[i]=o,window.ysnative.postMessage({command:"enumerateDevices",seq:i})}function S(e,t){var i={};return i[e]=L.Utils.localStorage.getItem(e),i[e]!==t&&L.Utils.localStorage.setItem(e,t),i}function i(e,t,i,r,n){v.testing?L.Utils.speedNetwordk(e,t,i,function(e,t){if(YS.networkTestInfo.isConnectRoom)_.stopNetworkTest(),L.Logger.warning(y,"The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(n)&&n("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT");else if(v.testing){var i=parseInt(t/2);0!==e&&(i=99999);var o=L.Utils.getNetDelayLevel(i);L.Utils.isFunction(r)&&r(o,i)}else _.stopNetworkTest()},{source:"(NetworkTest)",infoLog:!1}):_.stopNetworkTest()}function E(e,i,n){try{if(!(i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)))return void(n&&"function"==typeof n&&n(!1));if(YS.isYsNative&&YS.subscribe_from_native)i=i||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.ysnative.postMessage({command:"setSpeaker",deviceId:i}),n&&"function"==typeof n&&n(!1);else{var a={number:0},t=function(o,e,r){if(o&&o.nodeName&&/(audio|video)/g.test(o.nodeName.toLowerCase())&&i)if(o.setSinkId)try{o.setSinkId(i).then(function(){var e=o.getAttribute("id");L.Logger.debug(y,"Audio output device set to "+i,e?" , element id is "+e:"  element:",e?"":o),a.number++,a.number===r&&n&&"function"==typeof n&&n(!0)}).catch(function(e){var t=void 0,i=o.getAttribute("id");e&&"object"===qt(e)&&"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device  "),L.Logger.info(y,"setSinkId error:",e,t||"",i?" , element id is "+i:"  element:",i?"":o),a.number++,a.number===r&&n&&"function"==typeof n&&n(!1)})}catch(e){var t=o.getAttribute("id");L.Logger.error(y,"setSinkId err:",e,t?" , element id is "+t:"  element:",t?"":o),a.number++,a.number===r&&n&&"function"==typeof n&&n(!1)}else{t=o.getAttribute("id");L.Logger.warning(y,"The browser does not support the setSinkId method,audiooutputDeviceId :",i,t?" , element id is "+t:"  element:",t?"":o),a.number++,a.number===r&&n&&"function"==typeof n&&n(!1)}else a.number++,a.number===r&&n&&"function"==typeof n&&n(!1)};if(!e){e=[];var o=document.getElementsByTagName("audio"),r=document.getElementsByTagName("video");if(o&&0<o.length)for(var s=0;s<o.length;s++){var c=o[s];e.push(c)}if(r&&0<r.length)for(s=0;s<r.length;s++){c=r[s];e.push(c)}}if(e&&(L.Utils.isArray(e)||L.Utils.isHTMLCollection(e)))if(e&&0<e.length){var d=e.length;for(s=0;s<e.length;s++){c=e[s];t(c,0,d)}}else{d=1;t(e[0],0,d)}else{t(e,0,d=1)}}}catch(e){L.Logger.error(y,"setElementSinkIdToAudioouputDevice error:",e),n&&"function"==typeof n&&n(!1)}}return window.ysnative.addEventListener("message",function(S){if(!L.Utils.isNull(S)&&!L.Utils.isNull(S.data)&&!L.Utils.isNull(S.data.name)){var e=S.data.name;if("onEnumerateDevices"===e){if(!w.hasOwnProperty(S.data.seq))return;var i=function(){var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),r=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug(y,"devices in enumerateDevices(client):",S.data);function t(e){if(null!=e&&"communications"!=e.groupId&&"communications"!=e.deiceId&&"通讯"!=e.label){var t={kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId};!t.label&&p[e.kind]&&(t.label=p[e.kind].label+ ++p[e.kind].num),"audioinput"===e.kind&&e.deviceId===i&&(d.useDevices[e.kind]=e.deviceId),"videoinput"===e.kind&&e.deviceId===o&&(d.useDevices[e.kind]=e.deviceId),"audiooutput"===e.kind&&e.deviceId===r&&(d.useDevices[e.kind]=e.deviceId),c.first[e.kind]=c.first[e.kind]||e.deviceId,d.devices[e.kind].push(t),d.hasdevice[e.kind]=!0,"default"===e.deviceId&&(c.defalut[e.kind]=e.deviceId)}}var e=S.data.audioinput,n=S.data.videoinput,a=S.data.audiooutput,s=S.data.seq,c={first:{},defalut:{}},d={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},u=L.Utils.getBrowserInfo(),l=u&&u.language&&u.language.toLowerCase().match(/zh/g)?"chinese":"english",p={videoinput:{label:"chinese"==l?"视频输入设备":"video input device ",num:0},audioinput:{label:"chinese"==l?"音频输入设备":"audio input device ",num:0},audiooutput:{label:"chinese"==l?"音频输入设备":"audio output device ",num:0}};Array.isArray(e)&&e.forEach(function(e){t(e)}),Array.isArray(n)&&n.forEach(function(e){t(e)}),Array.isArray(a)&&a.forEach(function(e){t(e)}),d.useDevices.audioinput||(d.useDevices.audioinput=c.defalut.audioinput||c.first.audioinput||""),d.useDevices.videoinput||(d.useDevices.videoinput=c.defalut.videoinput||c.first.videoinput||""),d.useDevices.audiooutput||(d.useDevices.audiooutput=c.defalut.audiooutput||c.first.audiooutput||"");var f=w[s];YS.hasDevice=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.hasdevice));var m=void 0;for(var g in f.getOldDeviceList&&(m=L.Utils.toJsonParse(L.Utils.toJsonStringify(YS.deviceInfoMap))),YS.deviceInfoMap=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.devices)),L.Utils.localStorage?f.isSetlocalStorage&&(f.ignoreAudioinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.useDevices.audioinput),f.ignoreVideoinputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.useDevices.videoinput),f.ignoreAudiooutputSetLocalStorage||L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.useDevices.audiooutput)):L.Logger.error(y,"not support localStorage"),d.useDevices={audioinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||"",videoinput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",audiooutput:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput)||""},_._isGetDevicesed=!0,I={},d.useDevices)if(d.devices[g])for(var v in d.devices[g]){var h=d.devices[g][v];if(h&&h.deviceId===d.useDevices[g]){I[g]=h;break}}b[s]&&(b[s](d,m),delete b[s]),w[s]&&delete w[s]};YS.isYsNative&&YS.subscribe_from_native?i():navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(e){var t=[];e.forEach(function(e){"audiooutput"===e.kind&&t.push({kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId})}),S.data.audiooutput=t,i()}).catch(function(e){L.Logger.error(y,"enumerateDevices error :"+e.name+": "+e.message),S.data.audiooutput=[],i()}):(L.Logger.error(y,"navigator.mediaDevices.enumerateDevices method not supported."),S.data.audiooutput=[],i())}if("onMicVolumeReport"===e){if(null==(t=S.data.volume))return;b["detecte-mic-callback"]&&"function"==typeof b["detecte-mic-callback"]&&b["detecte-mic-callback"](t),_.onMicVolumeReportCallback&&"function"==typeof _.onMicVolumeReportCallback&&_.onMicVolumeReportCallback(t/100,S.data.connectionId)}if("onGetSpeakerVolume"===e){var t=S.data.volume,o=S.data.seq;if("function"!=typeof b[o])return;t=Math.round(t/2.55),b[o](t),delete b[o]}if("onStartDetecteCam"===e){if(!S.data.deviceId)return void L.Logger.error(y,"Native callback Parameters onStartDetecteCam are not! ");o=S.data.seqId;L.Utils.isFunction(b[o])&&b[o](L.Utils.nativeMediaStream({id:S.data.deviceId,kind:"video"},{id:YS.deviceInfoMap.audioinput[0],kind:"audio"}))}if("onNativeNotification"===e&&S.data.arg){var r={},n={};switch(S.data.arg.name){case"onVideoDeviceStateChanged":T(function(){S.data.arg&&S.data.arg.args.deviceState?(r.videoinput=[],r.videoinput.push({deviceId:S.data.arg.args.deviceId,kind:"videoinput"})):(n.videoinput=[],n.videoinput.push({deviceId:S.data.arg.args.deviceId,kind:"videoinput"})),L.Utils.isFunction(_.onDeviceChanged)?_.onDeviceChanged(r,n,null,l):L.Utils.isFunction(l)&&l(r,n,null),L.Utils.isFunction(u)&&(L.Utils.getJsonLength(r)&&u(r,YS.DEVICE_STATE.DEVICE_ADD),L.Utils.getJsonLength(n)&&u(n,YS.DEVICE_STATE.DEVICE_REMOVE))});break;case"onAudioDeviceMicStateChanged":T(function(){S.data.arg&&S.data.arg.args.deviceState?(r.audioinput=[],r.audioinput.push({deviceId:S.data.arg.args.deviceId,kind:"audioinput"})):(n.audioinput=[],n.audioinput.push({deviceId:S.data.arg.args.deviceId,kind:"audioinput"})),L.Utils.isFunction(_.onDeviceChanged)?_.onDeviceChanged(r,n,null,l):L.Utils.isFunction(l)&&l(r,n,null),L.Utils.isFunction(u)&&(L.Utils.getJsonLength(r)&&u(r,YS.DEVICE_STATE.DEVICE_ADD),L.Utils.getJsonLength(n)&&u(n,YS.DEVICE_STATE.DEVICE_REMOVE))});break;case"onAudioDeviceSpeakerStateChanged":T(function(){S.data.arg&&S.data.arg.args.deviceState?(r.audiooutput=[],r.audiooutput.push({deviceId:S.data.arg.args.deviceId,kind:"audiooutput"})):(n.audiooutput=[],n.audiooutput.push({deviceId:S.data.arg.args.deviceId,kind:"audiooutput"})),L.Utils.isFunction(_.onDeviceChanged)?_.onDeviceChanged(r,n,null,l):L.Utils.isFunction(l)&&l(r,n,null),L.Utils.isFunction(u)&&(L.Utils.getJsonLength(r)&&u(r,YS.DEVICE_STATE.DEVICE_ADD),L.Utils.getJsonLength(n)&&u(n,YS.DEVICE_STATE.DEVICE_REMOVE))})}}}},!1),_.setMaxVideoProfile=function(e,t,i){o.width=e||o.width,o.height=t||o.height,o.maxfps=i||o.maxfps},_.setSmallVideoProfile=function(e,t,i){r.width=e||r.width,r.height=t||r.height,r.maxfps=i||r.maxfps},_.getSmallVideoProfile=function(){return r},_.getUseDevice=function(){return I},_.getVideoProfile=function(e){var t={};return YS.isMultiCamera&&n.hasOwnProperty(e)?t=L.Utils.copy(n[e]):YS.isMultiCamera||(t=L.Utils.copy(n)),L.Utils.getJsonLength(t)||(t=L.Utils.copy(o)),t},_.destroyVideoTrack=function(e){YS.notStopVideoTrack||(a[e]&&(a[e]=null),delete a[e])},_.destroyAllVideoTrack=function(){for(var e in a)_.destroyVideoTrack(e)},_.getUseVideoProfile=function(e){var t=_.getVideoProfile(e);if(t.width*t.height>o.width*o.height){var i=t.width*t.height/(o.width*o.height);t.width=Math.floor(t.width/i),t.height=Math.floor(t.height/i)}return t.maxfps>o.maxfps&&(t.maxfps=o.maxfps),t},_.getMaxVideoProfile=function(){return L.Utils.copy(o)},_.getVideoTrack=function(i,o,r){if(i)if(YS.isMultiCamera&&a[i]&&a[i].track)L.Utils.isFunction(o)&&o(a[i].track);else{YS.isMultiCamera||(c.videoinput=i);var e=_.getUseVideoProfile(i);a[i]={profile:e};var t={deviceId:{exact:i},width:e.width,height:e.height,frameRate:e.maxfps};_.getUserMedia({video:t,audio:!1},function(e){var t=e.getVideoTracks()[0];if(t){a[i].track=t;L.Utils.isFunction(o)&&o(a[i].track)}else L.Utils.isFunction(r)&&r({code:-1,message:"Requested device not video track",name:"UnknownError"});e=void 0},function(e){L.Utils.isFunction(r)&&r(e)})}else L.Utils.isFunction(r)&&r({code:8,message:"Requested device not found",name:"NotFoundError"})},_.getAudioTrack=function(i,o,r){i?s[i]?L.Utils.isFunction(o)&&o(s[i]):_.getUserMedia({audio:{deviceId:i},video:!1},function(e){var t=e.getAudioTracks()[0];t?(s[i]=t,L.Utils.isFunction(o)&&o(s[i])):L.Utils.isFunction(r)&&r({code:-1,message:"Requested device not audio track",name:"UnknownError"}),e=void 0},function(e){L.Utils.isFunction(r)&&r(e)}):L.Utils.isFunction(r)&&r({code:8,message:"Requested device not found",name:"NotFoundError"})},_.destroyAudioTrack=function(e){s[e]&&L.Utils.stopTrack(s[e]),s[e]=void 0,delete s[e]},_.destroyAllAudioTrack=function(){for(var e in s)_.destroyAudioTrack(e)},_.hasVideoTrack=function(e){return!!a[e]},_.hasAudioTrack=function(e){return!!s[e]},_.getUserMedia=function(e,t,i,o){var r,n,a;n=t,a=(a=i)||function(e){L.Logger.error(y,"getUserMedia error:",e)},(r=(r=e)||{audio:{},video:{}}).screen?(L.Logger.debug(y,"Screen access requested!"),n(null)):function(e){var t=h(e,"video"),i=h(e,"audio");if(t){if(!d[t]){var o=_.getUseVideoProfile(t);window.ysnative.postMessage({command:"setVideoProfile",VideoProfile:{width:o.width,height:o.height,frameRate:o.maxfps},deviceId:t}),d[t]=!0}window.ysnative.postMessage({command:"setCamera",deviceId:t})}i&&window.ysnative.postMessage({command:"setMicrophone",deviceId:i});f();if(L.Utils.isNull(e.video.deviceId)&&L.Utils.isNull(e.audio.deviceId)){var r={code:8,message:"Requested device not found",name:"NotFoundError"};L.Utils.isFunction(a)&&a(r),L.Logger.error(y," getUserMedia failed.",r)}else n(L.Utils.nativeMediaStream(t?{id:t,kind:"video"}:null,i?{id:i,kind:"audio"}:null))}(r)},_.setAVMgrProperty=function(e,t){for(var i in t&&(p[t]=p[t]||{room_video_width:_.room_video_width,room_video_height:_.room_video_height,room_video_fps:_.room_video_fps}),e)_.hasOwnProperty(i)&&(YS.isMultiCamera&&void 0!==t||(_[i]=e[i]),t&&p[t]&&(p[t][i]=e[i]));window.ysnative.postMessage({command:"setVideoProfile",VideoProfile:{width:e.room_video_width,height:e.room_video_height,maxfps:e.room_video_fps},deviceId:t})},_.setVideoProfile=function(e,t,i){if(YS.isMultiCamera?n[t]=e:(n=e,t=c.videoinput),!a[t]||!a[t].track)return i(),void L.Logger.info(y,"The specified track was not found locally.");if(YS.isMultiCamera){r=_.getUseVideoProfile(t);window.ysnative.postMessage({command:"setVideoProfile",VideoProfile:{width:r.width,height:r.height,frameRate:r.maxfps},deviceId:t})}else for(var o in a){var r=_.getUseVideoProfile(o);window.ysnative.postMessage({command:"setVideoProfile",VideoProfile:{width:r.width,height:r.height,frameRate:r.maxfps},deviceId:o})}},_.startDetecteMic=function(e,t){_.stopDetectMic(),window.ysnative.postMessage({command:"startDetecteMic",deviceId:e}),b["detecte-mic-callback"]=t},_.stopDetectMic=function(){window.ysnative.postMessage({command:"stopDetecteMic"}),delete b["detecte-mic-callback"]},_.startDetecteCam=function(e,t){_.stopDetecteCam(),window.ysnative.postMessage({command:"startDetecteCam",deviceId:e,args:t})},_.stopDetecteCam=function(){window.ysnative.postMessage({command:"stopDetecteCam"})},_.setSpeaker=function(e){window.ysnative.postMessage({command:"setSpeaker",deviceId:e})},_.checkIsSupportSetSpeaker=function(){return!0},_.addDeviceChangeListener=function(e){l=null,l=e},_.removeDeviceChangeListener=function(){l=null},_.registerDeviceChangeListener=function(e){u=e},_.getSpeakerVolume=function(e){if("function"==typeof e){var t=f();b[t]=e,window.ysnative.postMessage({command:"getSpeakerVolume",seq:t})}else L.Logger.error(y," wrong arguments in funciton getSpeakerVolume")},_.setSpeakerVolume=function(e){null==e||e<0||100<e?L.Logger.error(y," invalid arguments in funciton setSpeakerVolume"):(e=Math.round(2.55*e),window.ysnative.postMessage({command:"setSpeakerVolume",volume:e}))},_.enabledStreamVideoTrack=function(e,t){if(e&&e.getVideoTracks&&"function"==typeof e.getVideoTracks){var i=e.getVideoTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o].enabled!==t&&(i[o].enabled=t)}},_.enabledStreamAudioTrack=function(e,t){if(e&&e.getAudioTracks&&"function"==typeof e.getAudioTracks){var i=e.getAudioTracks();if(i&&0<i.length)for(var o=0;o<i.length;o++)i[o].enabled!==t&&(i[o].enabled=t)}},_.associateElementsToSpeaker=function(e,t,i){},_.getDevices=function(e,t){T(e,t)},_.setDevices=function(e,t){var i={},o={};for(var r in e=e||{})o[r]=L.Utils.localStorage.getItem(L.Constant.deviceStorage[r]),L.Constant.deviceStorage[r]&&e[r]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[r])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[r],e[r]),i[r]=!0);i.audiooutput&&E(),c.videoinput=e?e.videoinput:"",L.Utils.isFunction(_.onDevicesSetted)&&_.onDevicesSetted(e,o,t)},_.setCamera=function(e,t){if(e){c.videoinput=e||"";var i=S(L.Constant.deviceStorage.videoinput,e);L.Utils.isFunction(_.onCameraSetted)&&_.onCameraSetted(e,i,t)}else L.Logger.error(y,"Lack of key parameters!")},_.setMicrophone=function(e,t){if(e){var i=S(L.Constant.deviceStorage.audioinput,e);L.Utils.isFunction(_.onMicrophoneSetted)&&_.onMicrophoneSetted(e,i,t)}else L.Logger.error(y,"Lack of key parameters!")},_.setSpeaker=function(e,t){if(e){var i=S(L.Constant.deviceStorage.audiooutput,e);E(),L.Utils.isFunction(_.onSpeakerSetted)&&_.onSpeakerSetted(e,i,t)}else L.Logger.error(y,"Lack of key parameters!")},_.stopVideoTest=function(e,t,i){var o;(o=m.player)&&o&&o.destroy&&(o.destroy(),o=void 0),window.ysnative.postMessage({command:"stopDetecteCam"}),delete m.player,m.player=null},_.startVideoTest=function(e,t,i,o,r){if(!e)return L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startCameraTest got invalid deviceId");if(!t)return L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startCameraTest got invalid elementId");_.stopVideoTest();var n=void 0;if(!function(e,t,i){if(i=i||{},e){var o=YS.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:e,options:i});o.addVideoTrack(),"function"==typeof t&&t(o)}else L.Logger.error(y,"playDeviceStream elementID can not be empty!")}(t,function(e){m.player=e,n=e.id},i),!n)return L.Utils.isFunction(r)&&r("YS_ERR_INTERNAL_EXCEPTION"),void L.Logger.error(y,"startCameraTest occurred internal exception");var a={elementId:n};window.ysnative.postMessage({command:"startDetecteCam",deviceId:e,args:a})},_.stopMicrophoneTest=function(){_.stopDetectMic();var e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);e&&window.ysnative.postMessage({command:"setMicrophone",deviceId:e})},_.startMicrophoneTest=function(e,t,i,o){return e?t?(_.stopDetectMic(),void _.startDetecteMic(e,i)):(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startMicrophoneTest got invalid deviceId"))},_.stopSpeakerTest=function(){var e,t;g.audioUrl&&(e=g.audioUrl,(t={}).audioUrl=e,window.ysnative.postMessage({command:"clientAudioMediaPlayer",action:"stop",options:t}),g.audioUrl=null);var i=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);i&&_.setSpeaker(i)},_.startSpeakerTest=function(e,t,i){return e?t?(_.stopSpeakerTest(),_.setSpeaker(e),(o={}).audioUrl=t,window.ysnative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:o}),void(g.audioUrl=t)):(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(y,"startSpeakerTest got invalid deviceId"));var o},_.setSpeakerTestVolume=function(e){_.setSpeakerVolume(e)},_.checkVideoInputDevice=function(e,t){e?L.Utils.isFunction(t)&&t(!0):L.Utils.isFunction(t)&&t(!1)},_.checkAudioInputDevice=function(e,t){e?L.Utils.isFunction(t)&&t(!0):L.Utils.isFunction(t)&&t(!1)},_.stopNetworkTest=function(){v.testing=!1,clearInterval(v.timer),v.timer=void 0},_.startNetworkTest=function(e,t){_.stopNetworkTest();v.testing=!0,YS.networkTestInfo.isConnectRoom?(_.stopNetworkTest(),L.Logger.warning(y,"The room has been connected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT")):v.testing?(i(YS.networkTestInfo.protocol,YS.networkTestInfo.host,YS.networkTestInfo.port,e,t),v.timer=setInterval(function(){YS.networkTestInfo.isConnectRoom?(_.stopNetworkTest(),L.Logger.warning(y,"The room has beenconnected successfully, and the startNetworkTest method is not supported after successful connection."),L.Utils.isFunction(t)&&t("YS_ERR_ROOM_CONNECTED_NOT_SUPPORT")):v.testing?i(YS.networkTestInfo.protocol,YS.networkTestInfo.host,YS.networkTestInfo.port,e,t):_.stopNetworkTest()},3e3)):_.stopNetworkTest()},_.setAudioProcessing=function(e){},_},window.L&&window.L._onLoadFinshInitSDK&&window.L._onLoadFinshInitSDK(),window.YS=window.YS||{},window.L=window.L||{},window.ysnative=void 0,YS.nativeCallSeq=0,YS.waitNativeToCallbackList={},YS.NativeProxy=function(){var m="NativeProxy ",g=YS.EventDispatcher({}),o=0,f=1,r=2,n=void 0,v=o,a=void 0,i=void 0;function s(){return void 0!==YS.nativeCallSeq&&"number"==typeof YS.nativeCallSeq||(YS.nativeCallSeq=0),++YS.nativeCallSeq}function e(e){if(!L.Utils.isNull(e)&&(!L.Utils.isNull(e.data)&&!L.Utils.isNull(e.data.name)))switch(e.data.name){case"onValidWindowList":var t=e.data.validWindows;if(void 0===(p=e.data.seq))return;if("function"!=typeof YS.waitNativeToCallbackList[p])return;YS.waitNativeToCallbackList[p](t),delete YS.waitNativeToCallbackList[p];break;case"onLog":var i=e.data.level,o=e.data.log;0===i&&L.Logger.debug(m,o),1===i&&L.Logger.info(m,o),2===i&&L.Logger.warning(m,o),3===i&&L.Logger.error(m,o);break;case"onMonitorCount":var r=e.data.count;if(void 0===(p=e.data.seq))return;if("function"!=typeof YS.waitNativeToCallbackList[p])return;YS.waitNativeToCallbackList[p](r),delete YS.waitNativeToCallbackList[p];break;case"onTakSnapshot":var n=e.data.action,a=e.data.requestId,s=e.data.total,c=e.data.now,d=e.data.code,u=e.data.result;if("function"!=typeof YS.waitNativeToCallbackList[a])return;var l=L.Utils.toJsonParse(u);YS.waitNativeToCallbackList[a](n,a,s,c,d,l),"result"===n&&delete YS.waitNativeToCallbackList[a];break;case"onGetMediaPlayPos":(f=e.data.arg).duration=parseInt(1e3*f.duration),1<f.pos&&(f.pos=1),f.position=parseInt(f.pos*f.duration),f.position>f.duration&&(f.position=f.duration);var p=e.data.seq;if("function"!=typeof YS.waitNativeToCallbackList[p])return;YS.waitNativeToCallbackList[p](f);break;case"onNativeNotification":L.Utils.isFunction(g.onNativeNotification)&&g.onNativeNotification(e.data.arg);break;case"onMicVolumeReport":L.Utils.isFunction(g.onMicVolumeReport)&&g.onMicVolumeReport(e.data);break;case"onGetMediaFileInfo":var f=e.data.arg;p=e.data.seq;if(f.duration&&(f.duration=1e3*f.duration),"function"!=typeof YS.waitNativeToCallbackList[p])return;YS.waitNativeToCallbackList[p](f),delete YS.waitNativeToCallbackList[p];break;case"onLocalRecord":case"onGetOpenOrSaveFileName":case"onBrowseForFolder":case"onGetRecordingPath":case"onStartupFileTransmitter":case"getShareScreenProfile":f=e.data.arg,p=e.data.seq;if("function"!=typeof YS.waitNativeToCallbackList[p])return;YS.waitNativeToCallbackList[p](f),delete YS.waitNativeToCallbackList[p]}}function u(e,t,i){if(!YS.isYsNative)return L.Logger.warning(m,"getValidWindowList method must be in the client environment!"),void(L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"));if(null==e||"function"!=typeof t)return L.Logger.error(m," getValidWindowList function got wrong arguments"),void(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"));var o=s();YS.waitNativeToCallbackList[o]=t,window.ysnative.postMessage({command:"getValidWindowList",type:Number(e),seq:o})}return g.onNativeStartShareMediaFile=null,g.onNativeStopShareMediaFile=null,g.onNativeStartShareScreen=null,g.onNativeStopShareScreen=null,g.onNativeNotification=null,g.onMicVolumeReport=null,g.onSeekMediaFile=null,g.onNativeWindowClose=null,g.initialize=function(){window.ysnative.addEventListener("message",e,!1)},g.createShareScreenWindow=function(i,o,r,n,a,s,c,d){if(!YS.isYsNative)return L.Logger.error(m,"createShareScreenWindow method must be in the client environment!"),void(L.Utils.isFunction(c)&&c("YS_ERR_NOT_INITIALIZED"));u(0,function(e){var t=e[0];t&&"object"===qt(t)?function(e){if(!YS.isYsNative)return L.Logger.warning(m," updateWindowSource method must be in the client environment!");e.id=Number(e.id||0),e.x=Number(e.x||0),e.y=Number(e.y||0),e.width=Number(e.width||0),e.height=Number(e.height||0),e.mixMic=e.mixMic||!1,e.mixSpk=e.mixSpk||!1,e.type=Number(e.type||0),e.catchcursor=e.catchcursor||!1,window.ysnative.postMessage({command:"updateWindowSource",id:Number(e.id),left:Number(e.x),top:Number(e.y),width:Number(e.width),height:Number(e.height),mixMic:e.mixMic,mixSpk:e.mixSpk,type:Number(e.type),catchcursor:e.catchcursor})}({id:t.id,x:r,y:n,width:i,height:o,mixMic:a,mixSpk:s,type:0,catchcursor:d}):(L.Logger.error(m,"createShareScreenWindow:getValidWindowList is not data!"),L.Utils.isFunction(c)&&c("YS_ERR_NOT_DATA"))},c)},g.destroyShareScreenWindow=function(){g.createShareScreenWindow(0,0,0,0)},g.startShareScreen=function(i){if(!YS.isYsNative)return L.Logger.error(m,"startShareScreen method must be in the client environment!"),void(L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"));if(YS.isOnlyAudioRoom)return L.Logger.warning(m,"only audio room not execute method startShareScreen method !"),void(L.Utils.isFunction(i)&&i("YS_ERR_NOT_SUPPORT"));var o={},r={audio:!0,video:!0,attributes:o};if(YS.isYsNative&&2018061500<=YS.clientversion){u(0,function(e){var t=e[0];t&&"object"===qt(t)?function(e,t,i){if(!YS.isYsNative)return"function"==typeof i&&i("YS_ERR_NOT_INITIALIZED"),L.Logger.warning(m,"getShareScreenProfile method must be in the client environment!");if(null==e)return"function"==typeof i&&i("YS_ERR_INVALID_ARG"),L.Logger.error(m," getShareScreenProfile function got wrong arguments");var o=s();YS.waitNativeToCallbackList[o]=t,window.ysnative.postMessage({command:"getShareScreenProfile",args:e,seq:o})}(t,function(e){e&&"object"===qt(e)&&(o.videowidth=e.width,o.videoheight=e.height,o.videofps=e.fps),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(r,i)},function(e){L.Logger.warning(m,"startShareScreen:getShareScreenProfile is failure , failure info:"+e+"!"),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(r,i)}):(L.Logger.warning(m,"startShareScreen:getValidWindowList is not data!"),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(r,i))},function(e){L.Logger.error(m,"startShareScreen:getValidWindowList error info:"+e),L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(r,i)})}else L.Utils.isFunction(g.onNativeStartShareScreen)&&g.onNativeStartShareScreen(r,i)},g.stopShareScreen=function(e){if(!YS.isYsNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," stopShareScreen method must be called in the native environment!");L.Utils.isFunction(g.onNativeStopShareMediaFile)&&g.onNativeStopShareScreen(e),g.destroyShareScreenWindow()},g.startShareMediaFile=function(d,u,l,p){if(p=p||{},!YS.isYsNative)return L.Utils.isFunction(l)&&l("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," startShareMediaFile method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(l)&&l("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," startShareMediaFile method MAC machine is disabled!");if(L.Utils.isNull(d))return L.Utils.isFunction(l)&&l("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," startShareMediaFile method got invalid fileName!");if((!p||!p.IgnoreElementId)&&L.Utils.isNull(u))return L.Utils.isFunction(l)&&l("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," startShareMediaFile method got invalid elementId!");!function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),L.Logger.warning(m," getMediaFileInfo method must be called in the native environment!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),L.Logger.warning(m," getMediaFileInfo method got invalid fileName!");var o=s();YS.waitNativeToCallbackList[o]=t,window.ysnative.postMessage({command:"getMediaFileInfo",seq:o,file:e})}(d,function(e){var t=e.duration,i=e.width,o=e.height,r=e.video,n=e.audio;if(!e.video&&!e.audio)return L.Utils.isFunction(l)&&l("YS_ERR_INVALID_FIEL"),void L.Logger.error(m," startShareMediaFile method got invalid file!");if(YS.isOnlyAudioRoom&&e.video)return L.Logger.error(m,"only audio room not execute method startShareMediaFile to video media !"),void(L.Utils.isFunction(l)&&l("YS_ERR_NOT_SUPPORT"));var a={width:i,height:o,duration:t,filename:L.Utils.getFileName(d)};if(YS.isYsNative&&2018061500<=YS.clientversion&&(a.videowidth=i,a.videoheight=o,a.videofps=e.fps),void 0!==p.toID&&(a.toID=p.toID),p.attrs&&"object"===qt(p.attrs))for(var s in p.attrs)"toID"!==s&&"type"!==s&&(a[s]=p.attrs[s]);var c={video:r,audio:n,attributes:a,path:d,scale:p.scale};L.Utils.isFunction(g.onNativeStartShareMediaFile)&&g.onNativeStartShareMediaFile(c,u,l,p),v=f},l)},g.stopShareMediaFile=function(e){return YS.isYsNative?YS.isYsMacNative?(L.Utils.isFunction(e)&&e("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," stopShareMediaFile method MAC machine is disabled!")):(L.Utils.isFunction(g.onNativeStopShareMediaFile)&&g.onNativeStopShareMediaFile(e),void(v=o)):(L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," stopShareMediaFile method must be called in the native environment!"))},g.pauseShareMediaFile=function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," pauseShareMediaFile method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," pauseShareMediaFile method MAC machine is disabled!");if(!L.Utils.isBoolean(e))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(m," pauseShareMediaFile function got wrong arguments");if(v===o)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m," pauseShareMediaFile:The local media file is not open!");(e&&v!==r||!e&&v!==f)&&(window.ysnative.postMessage({command:"pauseMediaFile",pause:e}),v=e?r:f,L.Utils.isFunction(g.onPauseMediaFile)&&g.onPauseMediaFile(e)),L.Utils.isFunction(t)&&t(!0===e?"Paused":"Sharing")},g.getMediaFileProgress=function(e,t){return YS.isYsNative?L.Utils.isFunction(e)?v===o?(L.Utils.isFunction(t)&&t("YS_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m," getMediaFileProgress:The local media file is not open!")):(L.Utils.isNull(i)&&(i=s()),YS.waitNativeToCallbackList[i]=e,void window.ysnative.postMessage({command:"getMediaPlayPos",seq:i})):(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(m," getMediaFileProgress function got wrong arguments")):(L.Utils.isFunction(t)&&t("YS_ERR_NOT_INITIALIZED"),void L.Logger.error(m," getMediaFileProgress method must be called in the native environment!"))},g.registerMediaFileProgressListener=function(e,t,i){return YS.isYsNative?L.Utils.isNull(e)||e<=0||!L.Utils.isFunction(t)?(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(m," registerMediaFileProgressListener function got wrong arguments")):(g.unregisterMediaFileProgressListener(),e<1e3&&(e=1e3),L.Utils.isNull(a)&&(a=s()),YS.waitNativeToCallbackList[a]=t,v===f&&window.ysnative.postMessage({command:"getMediaPlayPos",seq:a}),void(n=setInterval(function(){v===f&&window.ysnative.postMessage({command:"getMediaPlayPos",seq:a})},e))):(L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.error(m," registerMediaFileProgressListener method must be called in the native environment!"))},g.unregisterMediaFileProgressListener=function(e){if(!YS.isYsNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.error(m," unregisterMediaFileProgressListener method must be called in the native environment!");L.Utils.isNull(n)||(clearInterval(n),n=void 0),L.Utils.isNull(a)||(delete YS.waitNativeToCallbackList[a],a=void 0)},g.seekMediaFile=function(e,t){return YS.isYsNative?L.Utils.isNumber(e)?v===o?(L.Utils.isFunction(t)&&t("YS_ERR_NOT_OPEN_MEDIA_FILE"),void L.Logger.warning(m," seekMediaFile:The local media file is not open!")):(e<0&&(e=0),1<e&&(e=1),window.ysnative.postMessage({command:"seekMediaFile",pos:e}),void(L.Utils.isFunction(g.onSeekMediaFile)&&g.onSeekMediaFile(e))):(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(m," seekShareMediaFile function got wrong arguments")):(L.Utils.isFunction(t)&&t("YS_ERR_NOT_INITIALIZED"),void L.Logger.error(m," seekMediaFile method must be called in the native environment!"))},g.getShareableApplicationsList=function(e,t){return YS.isYsNative?"function"!=typeof e?(L.Logger.error(m," getShareableApplicationsList function got wrong arguments"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"))):void u(1,e,t):(L.Logger.warning(m,"getShareableApplicationsList method must be in the client environment!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_INITIALIZED")))},g.startShareApplications=function(){},g.stopShareApplications=function(){},g.getMonitorCount=function(e,t){if(!YS.isYsNative)return L.Logger.warning(m,"getMonitorCount method must be in the client environment!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_INITIALIZED"));if("function"!=typeof e)return L.Logger.error(m," getMonitorCount function got wrong arguments"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var i=s();YS.waitNativeToCallbackList[i]=e,window.ysnative.postMessage({command:"getMonitorCount",seq:i})},g.enableViceMonitor=function(e){if(!YS.isYsNative)return L.Logger.warning(m,"enableViceMonitor method must be in the client environment!"),void(L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"));YS.subscribe_from_native=!0,window.ysnative.postMessage({command:"enableViceMonitor"})},g.switchMainViceMonitor=function(e){if(!YS.isYsNative)return L.Logger.warning(m,"changeMainViceMonitor method must be in the client environment!"),void(L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"));window.ysnative.postMessage({command:"exchangeClientPosition"})},g.nativeUploadFile=function(e,t,i,o){if(!YS.isYsNative)return L.Logger.warning(m,"nativeUploadFile method must be in the client environment!"),void("function"==typeof o&&o("YS_ERR_NOT_INITIALIZED"));if("object"!==qt(i)||"string"!=typeof e||"string"!=typeof t||""===e||""===t)return L.Logger.error(m," nativeUploadFile function got wrong arguments"),void("function"==typeof o&&o("YS_ERR_INVALID_ARG"));var r=s();window.ysnative.postMessage({command:"uploadFile",seq:r,uri:e,filename:t,params:i})},g.nativeDownloadFile=function(e,t,i){if(!YS.isYsNative)return L.Logger.warning(m,"nativeDownloadFile method must be in the client environment!"),void("function"==typeof i&&i("YS_ERR_NOT_INITIALIZED"));if("string"!=typeof e||"string"!=typeof t||""===e||""===t)return L.Logger.error(m," nativeDownloadFile function got wrong arguments"),void("function"==typeof i&&i("YS_ERR_INVALID_ARG"));var o=s();window.ysnative.postMessage({command:"downloadFile",seq:o,uri:e,filename:t})},g.screenCaptureUpload=function(e,t,i,o){if(!YS.isYsNative)return"function"==typeof o&&o("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m,"screenCaptureUpload method must be in the client environment!");if(!e||"function"!=typeof t)return L.Logger.error(m," screenCaptureUpload function got wrong arguments"),void("function"==typeof o&&o("YS_ERR_INVALID_ARG"));i=i||!1;var r=s();YS.waitNativeToCallbackList[r]=t,window.ysnative.postMessage({command:"takeSnapshot",needMin:i,fileName:e,requestId:r})},g.browseForLocalFolder=function(e,t,i){if(!YS.isYsNative)return L.Logger.warning(m,"browseForLocalFolder method must be in the client environment!"),void("function"==typeof i&&i("YS_ERR_NOT_INITIALIZED"));if("object"!==qt(e)||"function"!=typeof t)return L.Logger.error(m," browseForLocalFolder function got wrong arguments ,param must is json , onSuccess must is function! "),void(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"));var o=s();YS.waitNativeToCallbackList[o]=t,window.ysnative.postMessage({command:"browseForFolder",args:e,seq:o})},g.startRecordScreen=function(e,i,o){if(!YS.isYsNative)return L.Utils.isFunction(o)&&o("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," startRecordScreen method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(o)&&o("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," startRecordScreen method MAC machine is disabled!");if(L.Utils.isNull(e)||L.Utils.isNull(e.filename))return L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," startRecordScreen function got wrong arguments");var t={type:1,fileName:e.filename,forcepath:!0};for(var r in e)"type"!==r&&"filename"!==r&&(t[r]=e[r]);var n=s();YS.waitNativeToCallbackList[n]=function(e){if("Recording"===e.action){if(L.Utils.isFunction(i)){var t={action:e.action,filename:e.filepath};i(t)}}else L.Utils.isFunction(o)&&o("record screen failed")},window.ysnative.postMessage({command:"startLocalRecord",args:t,seq:n})},g.pauseRecordScreen=function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," pauseRecordScreen method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," pauseRecordScreen method MAC machine is disabled!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," pauseRecordScreen function got wrong arguments");var o={type:1,pause:e},r=s();YS.waitNativeToCallbackList[r]=function(e){L.Utils.isFunction(t)&&t({action:e.action})},window.ysnative.postMessage({command:"pauseLocalRecord",args:o,seq:r})},g.stopRecordScreen=function(e){if(!YS.isYsNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," stopRecordScreen method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," stopRecordScreen method MAC machine is disabled!");window.ysnative.postMessage({command:"stopLocalRecord",args:{type:1}})},g.startRecordAudio=function(e,i,o){if(!YS.isYsNative)return L.Utils.isFunction(o)&&o("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," startRecordAudio method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(o)&&o("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," startRecordAudio method MAC machine is disabled!");if(L.Utils.isNull(e)||L.Utils.isNull(e.filename))return L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," startRecordAudio function got wrong arguments");var t={type:0,fileName:e.filename,forcepath:!0};for(var r in e)"type"!==r&&"filename"!==r&&(t[r]=e[r]);var n=s();YS.waitNativeToCallbackList[n]=function(e){if("Recording"===e.action){if(L.Utils.isFunction(i)){var t={action:e.action,filename:e.filepath};i(t)}}else L.Utils.isFunction(o)&&o("record screen failed")},window.ysnative.postMessage({command:"startLocalRecord",args:t,seq:n})},g.pauseRecordAudio=function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," pauseRecordAudio method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," pauseRecordAudio method MAC machine is disabled!");if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," pauseRecordAudio function got wrong arguments");var o={type:0,pause:e},r=s();YS.waitNativeToCallbackList[r]=function(e){L.Utils.isFunction(t)&&t({action:e.action})},window.ysnative.postMessage({command:"pauseLocalRecord",args:o,seq:r})},g.stopRecordAudio=function(e){if(!YS.isYsNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," stopRecordAudio method must be called in the native environment!");if(YS.isYsMacNative)return L.Utils.isFunction(e)&&e("YS_ERR_NOT_SUPPORT"),void L.Logger.warning(m," stopRecordAudio method MAC machine is disabled!");window.ysnative.postMessage({command:"stopLocalRecord",args:{type:0}})},g.getOpenFileName=function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," getOpenFileName method must be called in the native environment!");if(L.Utils.isNull(e)||L.Utils.isNull(e.caption)||L.Utils.isNull(e.filter))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," getOpenFileName function got wrong arguments");var o=s();YS.waitNativeToCallbackList[o]=function(e){"Activated"===e.action?L.Utils.isFunction(i)&&(i("YS_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(m," getOpenFileName in progress")):L.Utils.isFunction(t)&&t(e)},window.ysnative.postMessage({command:"getOpenFileName",args:e,seq:o})},g.getSaveFileName=function(e,t,i){if(!YS.isYsNative)return L.Utils.isFunction(i)&&i("YS_ERR_NOT_INITIALIZED"),void L.Logger.warning(m," getSaveFileName method must be called in the native environment!");if(L.Utils.isNull(e)||L.Utils.isNull(e.caption)||L.Utils.isNull(e.filter))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.warning(m," getSaveFileName function got wrong arguments");var o=s();YS.waitNativeToCallbackList[o]=function(e){"Activated"===e.action?L.Utils.isFunction(i)&&(i("YS_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning(m," getSaveFileName in progress")):L.Utils.isFunction(t)&&t(e)},window.ysnative.postMessage({command:"getSaveFileName",args:e,seq:o})},g.listenCloseEvent=function(){if(YS.isYsNative)try{window.roadof_window&&window.roadof_window.listenCloseEvent?window.roadof_window.listenCloseEvent():L.Logger.error(m,"roadof_window.listenCloseEvent is not exist!")}catch(e){L.Logger.error(m," listenCloseEvent function can not be called")}else L.Logger.warning(m,"listenCloseEvent method must be in the client environment!")},g.shutdownNativeClient=function(){YS.isYsNative?window.ysnative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning(m,"shutdownNativeClient method must be in the client environment!")},g.closeWindow=function(){try{window.roadof_window&&window.roadof_window.closeWindow?window.roadof_window.closeWindow():L.Logger.error(m,"roadof_window.closeWindow is not exist!")}catch(e){L.Logger.error(m," closeWindow function can not be called")}},g.setPptAudioVolume=function(e){"number"==typeof e?window.ysnative.postMessage({command:"clientAudioMediaSetVolume",vol:e}):L.Logger.error(m,"ppt MP3 setVolume volume type must is number!")},g.clientAudioMediaPlayer=function(e,t,i){YS.isYsNative?YS.clientversion<2018031e3?L.Logger.warning(m,"Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(i=i||{},t?(L.Logger.info(m,"clientAudioMediaPlayer url is "+e+" , action is "+t+" , options is"+L.Utils.toJsonStringify(i)),i.audioUrl=e,window.ysnative.postMessage({command:"clientAudioMediaPlayer",action:t,options:i})):L.Logger.error(m,"clientAudioMediaPlayer action is not exist!")):L.Logger.warning(m,"clientAudioMediaPlayer method must be in the client environment!")},g.clientPreloadMediaFile=function(e){YS.isYsNative?YS.clientversion<2018031e3?L.Logger.warning(m,"Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(e)?e&&0<e.length&&window.ysnative.postMessage({command:"clientPreloadMediaFile",urlArray:e}):L.Logger.error(m,"clientPreloadMediaFile args must is array!"):L.Logger.warning(m,"clientPreloadMediaFile method must be in the client environment!")},g.clientOpenBrowserUrl=function(e){YS.isYsNative?YS.clientversion<2018031e3?L.Logger.warning(m,"Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):e?window.ysnative.postMessage({command:"clientOpenBrowserUrl",url:e}):L.Logger.error(m,"clientOpenBrowserUrl url is not exist!"):L.Logger.warning(m,"clientOpenBrowserUrl method must be in the client environment!")},g.getRecordingPath=function(e,t){if(!YS.isYsNative)return L.Logger.error(m," getRecordingPath method must be called in the native environment!"),void("function"==typeof t&&t("YS_ERR_NOT_INITIALIZED"));"function"!=typeof e&&L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG");var i=s();YS.waitNativeToCallbackList[i]=e,window.ysnative.postMessage({command:"getRecordingPath",seq:i})},g.setRecordingPath=function(e,t){return YS.isYsNative?"object"!==qt(e)?(L.Logger.error(m," setRecordingPath function got wrong arguments!"),void("function"==typeof t&&t("YS_ERR_INVALID_ARG"))):void window.ysnative.postMessage({command:"setRecordingPath",args:e}):(L.Logger.error(m," setRecordingPath method must be called in the native environment!"),void("function"==typeof t&&t("YS_ERR_NOT_INITIALIZED")))},g.startupFileTransmitter=function(e,t,i){if(!YS.isYsNative)return L.Logger.error(m," startupFileTransmitter method must be called in the native environment!"),void("function"==typeof i&&i("YS_ERR_NOT_INITIALIZED"));if("object"!==qt(e)||"function"!=typeof t)return L.Logger.error(m," startupFileTransmitter function got wrong arguments!"),void("function"==typeof i&&i("YS_ERR_INVALID_ARG"));var o=s();YS.waitNativeToCallbackList[o]=t,window.ysnative.postMessage({command:"startupFileTransmitter",args:e,seq:o})},g.initBroadcast=function(e,t,i,o,r){YS.isYsNative?e?(t=t||10,i=i||3,o&&r?window.ysnative.postMessage({command:"initBroadcast",url:e.toString(),fps:Number(t),key_sec:Number(i),width:Number(o),height:Number(r)}):L.Logger.error(m,"argument width or height of initBroadcast function not exist!")):L.Logger.error(m,"argument url of initBroadcast function not exist!"):L.Logger.warning(m,"initBroadcast method must be in the client environment!")},g.updateBroadcast=function(e,t,i,o){e=e||10,t=t||3,i&&o?window.ysnative.postMessage({command:"updateBroadcast",fps:Number(e),key_sec:Number(t),width:Number(i),height:Number(o)}):L.Logger.error(m,"argument width or height of updateBroadcast function not exist!")},g.uninitBroadcast=function(){YS.isYsNative?window.ysnative.postMessage({command:"uninitBroadcast"}):L.Logger.warning(m,"uninitBroadcast method must be in the client environment!")},g.startBroadcast=function(e){YS.isYsNative?e?window.ysnative.postMessage({command:"startBroadcast",streamId:e}):L.Logger.error(m,"argument extensionId of startBroadcast function not exist!"):L.Logger.warning(m,"startBroadcast method must be in the client environment!")},g.stopBroadcast=function(){YS.isYsNative?window.ysnative.postMessage({command:"stopBroadcast"}):L.Logger.warning(m,"stopBroadcast method must be in the client environment!")},window.onNativeWindowClose=function(){YS.isYsNative?L.Utils.isFunction(g.onNativeWindowClose)&&g.onNativeWindowClose():L.Logger.warning(m,"window.onNativeWindowClose method must be in the client environment!")},g}(),YS.NativeEntry=function(){var e=document.getElementById("ysnative");return e&&e.nodeName&&"embed"===e.nodeName.toLowerCase()||(e=document.createElement("embed"),document.body.appendChild(e),e.setAttribute("id","ysnative"),e.setAttribute("mainentry",!0),e.setAttribute("hidden",!0),e.setAttribute("type","application/x-ppapi-proxy")),e},YS.NativeInfo=function(){try{return roadof_window}catch(e){return null}},YS.CheckNativeInterfaceAvailable=function(){return!("function"!=typeof YS.NativeInfo||!YS.NativeInfo()||(window.ysnative=window.ysnative||YS.NativeEntry(),L.Utils.isNull(window.ysnative)||!L.Utils.isFunction(window.ysnative.postMessage)))},YS.Initialize=function(e,t){var i="NativeProxy ";try{if(e){YS.isYsNative=!0;a=void 0,s=void 0,c=void 0;(n=YS.NativeInfo())&&"object"===qt(n)&&(a=Number(n.clientversion),c=Number(n.endtype),s=n.friendlyversion),YS.clientversion=a,YS.clientfriendlyversion=s,YS.isYsMacNative=L.Utils.isBoolean(t)?t:2===c,window.ysnative=window.ysnative||YS.NativeEntry(),YS.NativeProxy.initialize(),YS.isYsMacNative||(YS.DeviceMgrImpl=null,YS.DeviceMgrImpl=YS.NativeAVMgr()),window.ysnative.postMessage({command:"maximizeNativeClient"}),YS.subscribe_from_native=YS.isYsNative&&!YS.isYsMacNative&&2018031e3<=a,L.Logger.info(i,(YS.isYsMacNative,"macClient"))}else{window.ysnative=void 0,YS.isYsNative=!1,YS.isYsMacNative=!1;var o=document.getElementById("ysnative");if(o&&o.nodeName&&"embed"===o.nodeName.toLowerCase()){var r=o.parentNode;r&&r.removeChild(o)}var n=YS.NativeInfo(),a=void 0,s=void 0,c=void 0;n&&"object"===qt(n)&&(a=Number(n.clientversion),c=Number(n.endtype),s=n.friendlyversion,n.maxmizeWindow&&"function"==typeof n.maxmizeWindow&&n.maxmizeWindow(),L.Logger.info(i,"clinet use browser,clinetInfo("+c===2?"macClient":"windowClient):clientVersion is "+a+",clientfriendlyversion is "+s+",endtype is "+c)),YS.subscribe_from_native=!1;var d=L.Utils.getBrowserInfo(!0);L.Logger.info(i,"Initialize finshed,browserInfo:"+d.info.browserName+" "+d.info.browserVersion)}"safari"!==L.Utils.getBrowserInfo(!0).info.browserName&&YS.DeviceMgrImpl.getDevices()}catch(e){L.Logger.error(i,"Initialize error:",e)}},window.YS=window.YS||{},window.L=window.L||{},YS.NativeStream=function(d){var i,u="NativeStream ",l=YS.EventDispatcher(d),o=!1,r="destroy",n=void 0,a=0;void 0!==d.video&&"number"==typeof d.video&&(d.video=0!==d.video),void 0!==d.audio&&"number"==typeof d.audio&&(d.audio=0!==d.audio),l.classInstanceName="Stream",l.stream=d.stream,l.mediaStreamClone=L.Utils.cloneMediaStream(l.stream),l.url=d.url,l.recording=d.recording,l.room=d.room,l.playing=!1,l.local=!1,l.video=d.video,l.audio=d.audio,l.screen=d.screen,l.scale=d.scale,l.media=d.media,l.videoSize=d.videoSize,l.videoFrameRate=d.videoFrameRate,l.extensionId=d.extensionId,l.desktopStreamId=d.desktopStreamId,l.path=d.path||"",l.videoMuted=!1,l.audioMuted=!1,l.attributes=d.attributes||{},l.isYsNative=!0,l.pushVideoMuted=!0,l.pushAudioMuted=!0,l.isInit=!1,l.audioinputDeviceId=d.audioinputDeviceId,l.videoinputDeviceId=d.videoinputDeviceId;var s={isWaiting:!1},c=0,e=1,t=2,p=void 0,f=void 0,m=void 0;if(!(void 0===l.videoSize||l.videoSize instanceof Array&&4===l.videoSize.length))throw Error("Invalid Video Size");void 0!==d.local&&!0!==d.local||(l.local=!0);function g(){return l.media?e:l.attributes.isWeb?c:l.screen?t:c}function v(){return l.extensionId}function h(){if(S(),"function"!=typeof s.onSuccess)return L.Logger.error(u,"startIntervalGetRealtimeVolume intervalCallback must is function!"),S(),void(void 0!==s.onFailure&&L.Utils.isFunction(s.onFailure)&&s.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",l.extensionId));s.onSuccess(a,l.extensionId),clearInterval(n),n=setInterval(function(){L.Utils.isFunction(s.onSuccess)?s.onSuccess(a,l.extensionId):(L.Logger.error(u,"startIntervalGetRealtimeVolume intervalCallback must is function!"),S(),L.Utils.isFunction(s.onFailure)&&s.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",l.extensionId))},s.interval)}function S(){clearInterval(n),n=void 0,a=0}return l.changeID=function(e){l.id=""===e?"local":e},l.getID=function(){return l.local&&!d.streamID?l.id||"local":d.streamID},l.id=l.getID(),l.publisherId=function(){var e=l.extensionId.split(":");return e.length?e[0]:l.extensionId},l.getAttributes=function(){return d.attributes},l.setAttributes=function(e){l.updateLocalAttributes(e)},l.updateLocalAttributes=function(e){if(e&&"object"===qt(e))for(var t in e)d.attributes[t]=e[t]},l.hasAudio=function(){return d.audio},l.changeAudio=function(e){d.audio=e},l.hasVideo=function(){return d.video},l.changeVideo=function(e){d.video=e},l.hasData=function(){return d.data},l.changeData=function(e){d.data=e},l.hasScreen=function(){return d.screen},l.hasMedia=function(){return d.media},l.hasVideoPlayer=function(){return!!p},l.getVideoPlayer=function(){return p},l.hasAudioPlayer=function(){return!!f},l.getAudioPlayer=function(){return f},l.getVideoPlayerElementId=function(){return m},l.changeScreen=function(e){d.screen=e},l.sendData=function(){L.Logger.error(u,"Failed to send data. This Stream object has not that channel enabled.")},l.init=function(e,t,i){if(t=t||{},YS.isPlayback)i&&"function"==typeof i&&i({type:"access-denied",stream:l});else{if("video"!==l.getAttributes().type||!l.local)return L.Logger.warning(u,"stream init must is localStream and stream type must is video!"),void(i&&"function"==typeof i&&i({type:"access-denied",stream:l}));if(l.isIniting||l.isInit)i&&"function"==typeof i&&i({type:"access-denied",stream:l});else{var o;t.initDeviceId&&("object"===qt(t.initDeviceId)?(t.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t.initDeviceId.videoinput),t.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,t.initDeviceId.audioinput),t.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,t.initDeviceId.audiooutput)):L.Logger.warning(u,"stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(d.audio||d.video){l.isIniting=!0,L.Logger.debug(u,"Requested access to local media");var r=d.video;!0===r||!0===d.screen?(r=!0===r?{}:r,void 0!==l.videoSize&&(r.mandatory=r.mandatory||{},r.mandatory.minWidth=l.videoSize[0],r.mandatory.minHeight=l.videoSize[1],r.mandatory.maxWidth=l.videoSize[2],r.mandatory.maxHeight=l.videoSize[3]),void 0!==l.videoFrameRate&&(r.optional=r.optional||[],r.optional.push({minFrameRate:l.videoFrameRate[0]}),r.optional.push({maxFrameRate:l.videoFrameRate[1]}))):!0===d.screen&&void 0===r&&(r=!0);var n=YS.DeviceMgrImpl.getUseVideoProfile(l.videoinputDeviceId),a={video:{deviceId:{exact:l.videoinputDeviceId},width:n.width,height:n.height,frameRate:n.maxfps},audio:d.audio,fake:d.fake,screen:d.screen,extensionId:l.extensionId,desktopStreamId:l.desktopStreamId},s=function(e){L.Logger.debug(u,"User has granted access to local media."),l.stream=e,l.mediaStreamClone=L.Utils.cloneMediaStream(l.stream),o=YS.StreamEvent({type:"access-accepted",stream:l}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-accepted",stream:l})},c=function(e){var t=YS.StreamEvent({type:"access-denied",stream:l,message:e});l.isInit=!0,l.isIniting=!1,l.dispatchEvent(t),i&&"function"==typeof i&&i({type:"access-denied",message:e,stream:l})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?YS.DeviceMgrImpl.getUserMedia(a,s,c,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):YS.DeviceMgrImpl.getDevices(function(e){YS.DeviceMgrImpl.getUserMedia(a,s,c,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else L.Logger.warning(u,"The stream has no audio and video needs to be initialized."),o=YS.StreamEvent({type:"access-denied",stream:l,message:"The stream has no audio and video needs to be initialized."}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-denied",stream:l,message:"The stream has no audio and video needs to be initialized."})}catch(e){o=YS.StreamEvent({type:"access-denied",stream:l,message:e}),l.isInit=!0,l.isIniting=!1,l.dispatchEvent(o),i&&"function"==typeof i&&i({type:"access-denied",message:e,stream:l})}}}},l.create=function(){l.local?window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())})},l.destroy=function(){l.local||window.ysnative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:l.local,type:Number(g())})},l.playVideo=function(e,t){function i(){if(t=t||{},void 0!==(l.elementID=e)){if(m=e,"living"!==r)return void L.Logger.warning(u,"stream.play:player life state not is living , not play stream!");p?(l.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:o),p=new YS.NativeVideoPlayer({id:v(),stream:l,elementID:e,options:t,bundleId:l.extensionId}),l.playing=!0,l.local?g()===c?window.ysnative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!0,type:Number(g()),options:t,args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):g()===c?window.ysnative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!1,type:Number(g()),options:t}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),g()===c||l.muteAudio(!0)):(l.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:o),p=new YS.NativeVideoPlayer({id:v(),stream:l,elementID:e,options:t,bundleId:l.extensionId}),l.local?g()===c?window.ysnative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!0,type:Number(g()),options:t,args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):g()===c?window.ysnative.postMessage({command:"playVideo",connectionId:v().toString(),isLocal:!1,type:Number(g()),options:t}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),p?L.Logger.info(u,"stream.Video is already in play!"):l.muteVideo(!1)),YS.isOnlyAudioRoom&&p.hideVideo(),s.isWaiting&&!n&&h()}}r="living",!l.local||"video"!==l.getAttributes().type||l.isInit||YS.isPlayback?i():(L.Logger.info(u,"stream.play:my stream is not init , call stream init start!"),l.init(!0,void 0,function(e){L.Logger.info(u,"stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(e)),i()}))},l.playAudio=function(e){function t(){e=e||{},"living"===r?(f?L.Logger.warning(u,"stream.Audio is already in play!"):(f=new YS.NativeAudioPlayer({id:v(),stream:l,options:e,bundleId:l.extensionId}),l.local?g()===c?window.ysnative.postMessage({command:"playAudio",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!0,type:Number(g()),args:{path:"string"==typeof l.path?l.path.toString():"",scale:"boolean"==typeof l.scale?l.scale:l.getAttributes().type===YS.STREAM_FILE}}):g()===c?window.ysnative.postMessage({command:"playAudio",connectionId:v().toString(),isLocal:!1,type:Number(g())}):window.ysnative.postMessage({command:"playStream",connectionId:v().toString(),isLocal:!1,type:Number(g())}),g()===c||l.muteVideo(!0)),l.playing=!0,YS.isOnlyAudioRoom&&p&&p.hideVideo(),s.isWaiting&&!n&&h()):L.Logger.warning(u,"stream.play:player life state not is living , not play stream!")}r="living",!l.local||"video"!==l.getAttributes().type||l.isInit||YS.isPlayback?t():(L.Logger.info(u,"stream.play:my stream is not init , call stream init start!"),l.init(!0,void 0,function(e){L.Logger.info(u,"stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(e)),t()}))},l.stop=function(e){e?"video"===e?(p&&p.destroy&&p.destroy(),p=void 0,g()===c?window.ysnative.postMessage({command:"unPlayVideo",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())}):window.ysnative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})):"audio"===e&&(f&&f.destroy&&f.destroy(),f=void 0,g()===c?window.ysnative.postMessage({command:"unPlayAudio",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())}):window.ysnative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})):(r="destroy",l.playing&&(p&&p.destroy(),f&&f.destroy&&f.destroy(),f=p=void 0,l.playing=!1,window.ysnative.postMessage({command:"stopStream",connectionId:v().toString(),isLocal:!!l.local,type:Number(g())})))},l.unplayVideo=function(){p&&(l.stop("video"),p=void 0),f||p||(l.stop(),p=f=void 0)},l.unplayAudio=function(){f&&(l.stop("audio"),f=void 0),f||p||(l.stop(),p=f=void 0)},l.getVideoPlayerOptions=function(){},l.updateVideoPlayerOptions=function(e){p&&p.updateVideoPlayerOptions&&p.updateVideoPlayerOptions(e)},l.updateAudioPlayerOptions=function(e){f&&f.updateAudioPlayerOptions&&f.updateAudioPlayerOptions(e)},l.showVideo=function(){void 0!==p&&p.showVideo()},l.hideVideo=function(){void 0!==p&&p.hideVideo()},l.getAudioTrack=function(){f&&f.getAudioTrack()},l.hasAudioTrack=function(){f&&f.hasAudioTrack()},l.removeAudioTrack=function(){f&&f.removeAudioTrack()},l.addAudioTrack=function(e){l.hasAudioTrack()&&l.removeAudioTrack(),f&&f.addAudioTrack(e),S(),s.isWaiting&&h()},l.getVideoTrack=function(){p&&p.getVideoTrack()},l.hasVideoTrack=function(){p&&p.hasVideoTrack()},l.removeVideoTrack=function(){p&&p.removeVideoTrack()},l.addVideoTrack=function(e){l.hasVideoTrack()&&l.removeVideoTrack(),p&&p.addVideoTrack(e)},l.setMute=function(e){void 0!==f&&f.setMute&&f.setMute(e)},l.setVolume=function(e){if(void 0!==f&&f.setVolume){if("number"!=typeof e)return void L.Logger.error(u,"Stream setVolume volume type must is number!");f.setVolume(e)}},l.getVolume=function(e){if(void 0!==f&&f.getVolume)return f.getVolume(e)},l.startIntervalGetRealtimeVolume=function(e,t,i){"function"==typeof e?(l.stopIntervalGetRealtimeVolume(),s.isWaiting=!0,s.onSuccess=e,s.onFailure=i,s.interval="number"==typeof t?t:100,h()):L.Logger.warning(u,"startIntervalGetRealtimeVolume intervalCallback must is function!")},l.stopIntervalGetRealtimeVolume=function(){S(),s={isWaiting:!1}},l.hideLoading=function(){void 0!==p&&p.hideLoading&&p.hideLoading()},l.showLoading=function(){void 0!==p&&p.showLoading&&p.showLoading()},i=function(){if(void 0===p||void 0===l.stream)return null;var e,t=p.video,i=document.defaultView.getComputedStyle(t),o=parseInt(i.getPropertyValue("width"),10),r=parseInt(i.getPropertyValue("height"),10),n=parseInt(i.getPropertyValue("left"),10),a=parseInt(i.getPropertyValue("top"),10);e="object"===qt(l.elementID)&&"function"==typeof l.elementID.appendChild?l.elementID:document.getElementById(l.elementID);var s=document.defaultView.getComputedStyle(e),c=parseInt(s.getPropertyValue("width"),10),d=parseInt(s.getPropertyValue("height"),10),u=document.createElement("canvas");return u.id="testing",u.width=c,u.height=d,u.setAttribute("style","display: none"),u.getContext("2d").drawImage(t,n,a,o,r),u},l.getVideoFrameURL=function(e){var t=i();return null!==t?e?t.toDataURL(e):t.toDataURL():null},l.getVideoFrame=function(){var e=i();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},l.checkOptions=function(e,t){!0===t?(e.video||e.audio||e.screen)&&(L.Logger.warning(u,"Cannot update type of subscription"),e.video=void 0,e.audio=void 0,e.screen=void 0):!1===l.local&&(!0===e.video&&!1===l.hasVideo()&&(L.Logger.warning(u,"Trying to subscribe to video when there is no video, won't subscribe to video"),e.video=!1),!0===e.audio&&!1===l.hasAudio()&&(L.Logger.warning(u,"Trying to subscribe to audio when there is no audio, won't subscribe to audio"),e.audio=!1)),!1===l.local&&(l.hasVideo()||!0!==e.slideShowMode||(L.Logger.warning(u,"Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),e.slideShowMode=!1))},l.updateMuteToServer=function(e){if(void 0!==l.pc&&l.pc.updateSpec){var t={muteStream:{video:l.videoMuted,audio:l.audioMuted}};l.checkOptions(t,!0),l.pc.updateSpec(t,e)}},l._setQualityLayer=function(e,t,i){var o={qualityLayer:{spatialLayer:e,temporalLayer:t}};l.checkOptions(o,!0),l.pc.updateSpec(o,i)},l.pushVideo=function(e){l.pushVideoMuted!=e&&(l.pushVideoMuted=e,window.ysnative.postMessage({command:"pushVideo",enable:e}))},l.pushAudio=function(e){l.pushAudioMuted!=e&&(l.pushAudioMuted=e,window.ysnative.postMessage({command:"pushAudio",enable:e}))},l.updateConfiguration=function(e,t){void 0!==e&&(l.pc?(l.checkOptions(e,!0),l.local,l.pc.updateSpec(e,t)):t("This stream has no peerConnection attached, ignoring"))},l.muteVideo=function(e,t){L.Logger.debug(u,"call muteVideo , video muted state:"+e+" , stream id:"+l.getID()+" , extensionId is "+l.extensionId+", attrs is "+L.Utils.toJsonStringify(l.getAttributes())),l.videoMuted=e,l.local,l.peerConnectionStream,l.updateMuteToServer(t)},l.muteAudio=function(e,t){L.Logger.debug(u,"call muteAudio , audio muted state:"+e+" , stream id:"+l.getID()+" , extensionId is "+l.extensionId+", attrs is "+L.Utils.toJsonStringify(l.getAttributes())),l.audioMuted=e,l.local&&window.ysnative.postMessage({command:"enableAudio",enable:!e,connectionId:v().toString()}),void 0!==l.stream||L.Logger.warning(u,"not deviceStream to muteAudio"),l.updateMuteToServer(t)},l.onRemoteAudioVolume=function(e){a=e,p&&L.Utils.isFunction(p.onRemoteAudioVolume)&&p.onRemoteAudioVolume(e)},l.onMicVolumeReport=function(e){l&&l.local&&(a=e,p&&L.Utils.isFunction(p.onMicVolumeReport)&&p.onMicVolumeReport(e))},l.setLocalVideoMirror=function(e){l.local&&(o=e,l.updateVideoPlayerOptions({mirror:e}))},l.getRealtimeVolume=function(e,t){if(!L.Utils.isFunction(e))return L.Logger.error(u," getRealtimeVolume: onVolume is not function"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));e(a)},l},window.YS=window.YS||{},window.L=window.L||{},YS.PlayBackProvider=function(){var s={onSeekPlayback:null,onPausePlayback:null,onPlaybackClearAll:null,onHandlerDuration:null,onHandlerPlaybackEnd:null,onHandlerPlaybackUpdateTime:null,onJoinPlaybackRoom:null,seekPlayback:function(e,t){L.Utils.isFunction(s.onSeekPlayback)&&s.onSeekPlayback(e,t)},pausePlayback:function(e,t){L.Utils.isFunction(s.onPausePlayback)&&s.onPausePlayback(e,t)},joinPlaybackRoom:function(e,t,i,o,r,n,a){L.Utils.isFunction(s.onJoinPlaybackRoom)&&s.onJoinPlaybackRoom(e,t,i,o,r,n,a)},playbackClearAll:function(){L.Utils.isFunction(s.onPlaybackClearAll)&&s.onPlaybackClearAll()},handlerDuration:function(e){L.Utils.isFunction(s.onHandlerDuration)&&s.onHandlerDuration(e)},handlerPlaybackEnd:function(){L.Utils.isFunction(s.onHandlerPlaybackEnd)&&s.onHandlerPlaybackEnd()},handlerPlaybackUpdateTime:function(e){L.Utils.isFunction(s.onHandlerPlaybackUpdateTime)&&s.onHandlerPlaybackUpdateTime(e)}};return s}(),window.YS=window.YS||{},window.L=window.L||{},YS.MSG_TO_ALLUSER="__all",YS.MSG_TO_ALLEXCEPTSENDER="__allExceptSender",YS.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor",YS.MSG_TO_NONEUSER="__none",YS.STREAM_VIDEO="video",YS.STREAM_MEDIA="media",YS.STREAM_SCREEN="screen",YS.STREAM_FILE="file",YS.PUBLISH_STATE_NONE=0,YS.PUBLISH_STATE_AUDIOONLY=1,YS.PUBLISH_STATE_VIDEOONLY=2,YS.PUBLISH_STATE_BOTH=3,YS.PUBLISH_STATE_MUTEALL=4,YS.SCREENSTATE_ON=1,YS.SCREENSTATE_OFF=0,YS.MEDIAFILESTATE_ON=1,YS.MEDIAFILESTATE_OFF=0,YS.ENABLEDUALSTREAM_ON=!0,YS.ENABLEDUALSTREAM_OFF=!1;var Gt=0,zt=1;function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if(YS.CGetUserMediaRetry=!0,YS.REC_TYPE_RECFILE=0,YS.REC_TYPE_VIDEOLIST=1,YS.REC_TYPE_MP3=2,YS.REC_TYPE_MIXVIDEO=3,YS.roomInstance=void 0,YS.SDKTYPE="pc",YS.isHiFi=!1,YS.maxaveragebitrateToHifi=256e3,YS.isOnlyAudioRoom=!1,YS.needOnlyAudioRoom=0,YS.connectTimer=0,YS.isRetainPublishstateOnOnlyAudioRoom=!1,YS.APPVERSION="customer",YS.isMultiCamera=!1,YS.isPlayback=!1,YS.mySerial="",YS.myPeerid="",YS.logTs="",YS.roomConstraint={width:"",height:"",frameRate:""},YS.userCacheStreamVideo=!0,YS.SDKVERSIONS="2.0.5",YS.SDKVERSIONSTIME="20191217",YS.PROXYVERSION=20190415,YS.loadSdkTs=(new Date).getTime(),console.info("[ys-sdk-version]sdk-version:"+YS.SDKVERSIONS+" , sdk-time: "+YS.SDKVERSIONSTIME),YS.checkBrowserSupport=function(t,e){try{(e=e||{}).vcodec=e.vcodec||"all";var i=L.Utils.getBrowserInfo();if(L.Logger.info("call checkBrowserSupport!",i.versions.mobile,i.info.browserName,i.info.browserVersion,!!t),!RTCPeerConnection)return L.Logger.warning(i.info.browserName+" "+i.info.browserVersion+(i.versions.mobile?" mobile":"")+" browser not support RTCPeerConnection!"),"function"==typeof t&&t(!1,i.info.browserName+" "+i.info.browserVersion+" browser not support RTCPeerConnection!"),!1;if(!(navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))return L.Logger.warning(i.info.browserName+" "+i.info.browserVersion+(i.versions.mobile?" mobile":"")+" browser not support getUserMedia!"),"function"==typeof t&&t(!1,i.info.browserName+" "+i.info.browserVersion+" browser not support getUserMedia!"),!1;if(!MediaStream)return L.Logger.warning(i.info.browserName+" "+i.info.browserVersion+(i.versions.mobile?" mobile":"")+" browser not support MediaStream!"),"function"==typeof t&&t(!1,i.info.browserName+" "+i.info.browserVersion+" browser not support MediaStream!"),!1;if("safari"===i.info.browserName){var o=i.info.browserVersion.split("."),r=Number(o[0]||0),n=Number(o[1]||0);if(13<=r||12<=r&&1<=n||"h264"===e.vcodec&&11<=r)return L.Logger.info((i.versions.mobile?"mobile ":"")+"browser support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!0,i.info.browserName,i.info.browserVersion),!0}else if("chrome"===i.info.browserName){o=i.info.browserVersion.split("."),r=Number(o[0]||0);if(i.versions.mobile){if("vp8"===e.vcodec&&50<=r)return L.Logger.info((i.versions.mobile?"mobile ":"")+"browser support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!0,i.info.browserName,i.info.browserVersion),!0}else if(52<=r||"vp8"===e.vcodec&&50<=r)return L.Logger.info((i.versions.mobile?"mobile ":"")+"browser support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!0,i.info.browserName,i.info.browserVersion),!0}else{if("edge"===i.info.browserName)return L.Logger.info((i.versions.mobile?"mobile ":"")+"browser support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!0,i.info.browserName,i.info.browserVersion),!0;if("firefox"===i.info.browserName)return L.Logger.info((i.versions.mobile?"mobile ":"")+"browser support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!0,i.info.browserName,i.info.browserVersion),!0}return L.Logger.warning((i.versions.mobile?"mobile ":"")+"browser not support.",i.info.browserName,i.info.browserVersion),"function"==typeof t&&t(!1,i.info.browserName+" "+i.info.browserVersion+(i.versions.mobile?" mobile":"")+" browser not support."),!1}catch(e){return L.Logger.warning((i.versions.mobile?"mobile ":"")+"browser not support, unknown error:",e),"function"==typeof t&&t(!1,i.info.browserName+" "+i.info.browserVersion+(i.versions.mobile?" mobile":"")+" browser not support, unknown error"),!1}},YS.getSdkVersion=function(){return YS.SDKVERSIONS},YS.Room=function(e){return YS.roomInstance||(YS.roomInstance=YS.RoomInit(e)),YS.roomInstance},YS.RoomInit=function(d){var ae="Room ";L.Logger.info("[ys-sdk-version]sdk-version:"+YS.SDKVERSIONS+" , sdk-time: "+YS.SDKVERSIONSTIME),L.Logger.info(ae,"browserInfo:"+L.Utils.toJsonStringify(L.Utils.getBrowserInfo())+",browser:"+L.Utils.getBrowserInfo().info.browserName+":"+L.Utils.getBrowserInfo().info.browserVersion+",detectOS:"+L.Utils.detectOS()+",use real browser:"+L.Utils.getBrowserName()),"object"!==qt(d=d||{})&&(L.Logger.error(ae,"YS.Room roomOptios must is json!"),d={}),d.autoSubscribeAV=void 0!==d.autoSubscribeAV&&d.autoSubscribeAV;function i(){N._web_protocol="https",N._doc_protocol="https",N._socket_protocol="https",N._backup_doc_protocol="https",N._web_host=void 0,N._web_port=void 0,N._doc_host=void 0,N._doc_port=void 0,N._socket_host=void 0,N._socket_port=void 0,N._backup_doc_host=void 0,N._backup_doc_host_list=[],N._backup_doc_port=void 0,N._room_uri=void 0,N._room_id=void 0,N._room_type=0,N._room_name=void 0,N._room_properties={},N._room_max_videocount=6,N._configuration=void 0,N._testIP=void 0,N._testPort=void 0,N._myself={id:""},N._serverList={},N._ipFalsificationName=void 0,N._serverName=void 0,N._isIpFalsification=!1,N._ipFalsification=void 0,N._isGetFileList=!1,N._recordfilepath=void 0,N._webInterfaceHtmlPort=8080,N._connectedNumber=0,N._isConnected=!1,N._handlerCallbackJson=!1,N._docServerAddr=void 0,N._useDocServerAddr=void 0,N._hasDocServerAddrBackup=!1,N._roomCheckRoomInfoString="",N._createStreams={},N._playVideoStreams={},N._playAudioStreams={},N._roomJsonOptions={},N._userJsonOptions={},N._registerAudioVolumeListeners={},N._autoProcessDevChangeEvent=!1,N._durationTime={},N._myIp="0.0.0.0",N._video_codec=0,N._roomMode=window.YS.ROOM_MODE.NORMAL_ROOM,N._isSendAllPublishUserNetworkequipment=!0,N._room_filelist=[],N._users={},N._local_def_ext_id="_local_default_extension_id_",N._sentAloneNetQualityBadList={},N._mediaFileScale=!0,N._nativeStatsDelivered={},N._isLocalVideoMirror=!1,N._isLocalVideoMirrorList={},N._backupCourseAddrList=[],N._isLeaveRoom=!0,N._webReconnectNumList={},N._ipinfo={},N._devicePublishInfo={},N._multiCameraAudioDevicePublishInfo={},N._mainCameraDeviceId="",N._videoProfileList={},N.isYsInvalidAppkey=!1,N._videoStreamAttrs={},N._videoStreamListAttrs={},N._useServerScreenRecording=!1,N._sdkUserProperty={id:!0,nickname:!0,role:!0,hasvideo:!0,hasaudio:!0,publishstate:!0,ys_maincamera:!0,ys_ip:!0,ys_area:!0,ys_carrier:!0,servername:!0,disablevideo:!0,disableaudio:!0,group:!0},N._ys_room_test_sdk=!1,N._safariOnlySubscibe=!1,N._isMix=!1}var t,e,D={},N={},U=YS.EventDispatcher(D),u="/ClientAPI/enterroom",r="/ClientAPI/getroomfile",a="/LogData/jsanalysisLog",n="/LogData/event",s=3,c=void 0,Y=void 0,l=YS.NativeProxy,P=YS.Signalling,p=YS.PlayBackProvider,M=window.YS_MODULE.MediaControl,f={},m=!1,g=!1,O=Gt,v=null,x=0,V=0,F=-1,h="",S="",B=0,j=0,J="4",H=[],W={},q={},G={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0},y=3,z=!1,Q={checkRoomCount:0,joinRoomCount:0,getConfigCount:0,checkRoomPlaybackCount:0},_=!1,b=null;function w(e){if(N._web_protocol=e.web_protocol||N._web_protocol,N._web_host=e.web_host||N._web_host,N._web_port=e.web_port||N._web_port,N._doc_protocol=e.doc_protocol||N._doc_protocol,N._doc_host=e.doc_host||N._doc_host,N._doc_port=e.doc_port||N._doc_port,N._socket_protocol=e.socket_protocol||N._socket_protocol,N._socket_host=e.socket_host||N._socket_host,N._socket_port=e.socket_port||N._socket_port,N._backup_doc_protocol=e.backup_doc_protocol||N._backup_doc_protocol,N._backup_doc_host=e.backup_doc_host||N._backup_doc_host,N._backup_doc_port=e.backup_doc_port||N._backup_doc_port,N._backup_doc_host_list=e.backup_doc_host_list||N._backup_doc_host_list,void 0===N._doc_host&&(N._doc_host=N._web_host),void 0===N._doc_port&&(N._doc_port=N._web_port),void 0===N._backup_doc_host&&(N._backup_doc_host=N._web_host),void 0===N._backup_doc_port&&(N._backup_doc_port=N._web_port),N._docServerAddr||(N._doc_host=N._web_host,N._doc_port=N._web_port),N._hasDocServerAddrBackup?N._backup_doc_host_list.length||(N._backup_doc_host_list=[N._backup_doc_host]):(N._backup_doc_host=N._web_host,N._backup_doc_port=N._web_port,N._backup_doc_host_list=[N._backup_doc_host]),Y&&Y.changeCommonWhiteBoardConfigration){for(var t=[],i=0,o=N._backup_doc_host_list.length;i<o;i++)t.push({protocol:N._backup_doc_protocol,hostname:N._backup_doc_host_list[i],port:N._backup_doc_port});Y.changeCommonWhiteBoardConfigration({webAddress:{protocol:N._web_protocol,hostname:N._web_host,port:N._web_port},docAddress:{protocol:N._doc_protocol,hostname:N._doc_host,port:N._doc_port},backupDocAddressList:t})}YS.networkTestInfo.protocol=N._web_protocol,YS.networkTestInfo.host=N._socket_host||N._web_host||"api.roadofcloud.com",YS.networkTestInfo.port=N._web_port||/https/g.test(N._web_protocol)?443:80;var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomServerAddressUpdate,message:{protocol:N._web_protocol,web_protocol:N._web_protocol,web_host:N._web_host,web_port:N._web_port,doc_protocol:N._doc_protocol,doc_host:N._doc_host,doc_port:N._doc_port,backup_doc_protocol:N._backup_doc_protocol,backup_doc_host:N._backup_doc_host,backup_doc_port:N._backup_doc_port,backup_doc_host_list:N._backup_doc_host_list}});U.dispatchEvent(r)}function I(e,o,r){var n=N._room_uri;(e=e||{}).source=e.source||"unknown source";var s=e.source;function a(a){re(N._web_host,N._web_port,function(e,t){if(L.Logger.debug(ae,"reconnected room:step2GetFileList result = "+e+" , message:"+L.Utils.toJsonStringify(t)),0===e){if(N._room_filelist=[],t&&Array.isArray(t)&&t.length)for(var i=0,o=t.length;i<o;i++){var r=t[i];r&&(r.fileid=Number(r.fileid),r.pagenum=Number(r.pagenum),r.dynamicppt=Number(r.dynamicppt),r.filecategory=Number(r.filecategory),r.fileprop=Number(r.fileprop),r.type=Number(r.type),r.filetype=r.filetype&&"string"==typeof r.filetype?r.filetype.toLocaleLowerCase():r.filetype,r.isContentDocument=void 0!==r.isContentDocument&&null!==r.isContentDocument&&"number"==typeof Number(r.isContentDocument)?Number(r.isContentDocument):0,N._room_filelist.push(r))}var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomFiles,message:N._room_filelist});U.dispatchEvent(n)}else L.Logger.info(ae,s+":step2GetFileList code is "+e);"function"==typeof a&&a()})}0<N._connectedNumber&&(j=Date.now()),oe(N._web_host,N._web_port,function(e,t){if(0!=e)L.Logger.error(ae,s+":step2GetConfig failure --\x3e result and responseText:",e,t);else{if(n!==N._room_uri||"forceReconnect room"===s){U.needReconnectSocket=!0,YS.isYsNative&&(N._handlerCallbackJson=!1,window.ysnative.postMessage({command:"nativeClear"}));try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(ae,s+":Socket already disconnected , disconnect errorInfo:",e)}if(P&&P.emptySocket&&P.emptySocket(),"select service reconnect"===s||"forceReconnect room"===s){ee(),clearInterval(U._networkequipmentTimer),clearInterval(U._catonNumber),clearInterval(U.sendcatonNumber);var i=YS.RoomEvent({type:YS.EVENT_TYPE.roomDisconnected,message:"select service reconnect , need socket disconnect"});U.dispatchEvent(i)}}"forceReconnect room"===s?a(function(){L.Logger.info(ae,s+":room socket force reconnect room  ,room socket url:"+(window.__YsSdkBuild__?L.Utils.encrypt(N._room_uri):N._room_uri)+"! "),ne()}):n!==N._room_uri?a(function(){L.Logger.info(ae,s+":room socket url  changed  , old room socket url:"+(window.__YsSdkBuild__?L.Utils.encrypt(n):n)+"  , now room socket url:"+(window.__YsSdkBuild__?L.Utils.encrypt(N._room_uri):N._room_uri)+"! "),ne()}):(L.Logger.info(ae,s+":room socket url not change  , room socket url:"+(window.__YsSdkBuild__?L.Utils.encrypt(N._room_uri):N._room_uri)+"! "),"reconnected room"===s?a(function(){se(o,r)}):"select service reconnect"===s&&(L.Logger.warning(ae,"room uri is not change , no need to perform a reload server"),N._isConnected&&N._users[De()]&&N._serverName!==N._myself.servername&&U.changeUserProperty(De(),"__all",{servername:N._serverName})))}},{notSpeedNetwordk:!0,restrict:N._serverName,configonly:1})}function T(e,t){if(e=e||N._serverList,t=t||N._serverName,"object"===qt(e)&&L.Utils.getJsonLength(e)&&void 0!==t)for(var i in e)e[i].isUseServer=t===i}function K(e,t,i,o){if(e=e||gt(o),t=t||{hasvideo:N._myself.hasvideo,disablevideo:N._myself.disablevideo},i=i||{hasaudio:N._myself.hasaudio,disableaudio:N._myself.disableaudio},e>YS.PUBLISH_STATE_NONE&&Ue(o)){var r=!(t.hasvideo&&!t.disablevideo&&(e===YS.PUBLISH_STATE_VIDEOONLY||e===YS.PUBLISH_STATE_BOTH)),n=!(i.hasaudio&&!i.disableaudio&&(e===YS.PUBLISH_STATE_AUDIOONLY||e===YS.PUBLISH_STATE_BOTH));E(Ne(o),r),A(Ne(o),n),g&&(E(Ne(o,!1,g),r),A(Ne(o,!1,g),n))}}function E(e,t){if(M.hasConnection(e.getID())){var i=M.videoEnabled(e.getID()),o=!t;M.enableVideo(e.getID(),o),o!==i&&k(e)}}function A(e,t,i){if(M.hasConnection(e.getID())){var o=M.audioEnabled(e.getID()),r=!t;M.enableAudio(e.getID(),r),r===o||i||k(e)}}function k(e){if(M.hasConnection(e.getID())){var t={muteStream:{video:!M.videoEnabled(e.getID()),audio:!M.audioEnabled(e.getID())}};L.Logger.info(ae,"update stream mute state send message to server,stream id is "+e.getID()+",send message info:",L.Utils.toJsonStringify(t));var i={streamId:e.getID(),msg:{type:"updatestream",config:t}};e.getAttributes().type!==YS.STREAM_MEDIA&&e.publisherId()===De()||(i.browser=L.Utils.getBrowser()),Ie("signaling_message",i)}}function R(e,t,i){N._isConnected&&"disconnected"===t&&("publish"===i?(Ot(e,window.YS.ERROR_NOTICE.ERR_PUBLISH_FAILED,"publish ice disconnected"),C(e,"publish ice disconnected"),e.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_PUB",streamid:e.getID(),data:"ICE_DISCONNECTED"})):"subscribe"===i&&(xt(e,window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ice disconnected"),X(e,"subscribe ice disconnected"),e.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_SUB",streamid:e.getID(),data:"ICE_DISCONNECTED"})))}function C(t,i){if(void 0===t.reconnectionNumber&&(t.reconnectionNumber=0),t.isUnpublishing=!1,t.isPublishing=!1,t.isCompleted=!1,void 0===c||t.reconnectionNumber<c)L.Logger.info(ae,"publishReconnection->"+i+":unpublish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),ot(t,function(e){e||L.Logger.warning(ae,"publishReconnection->"+i+": unpublish in not success , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+" !"),setTimeout(function(){switch(t.getAttributes().type){case YS.STREAM_VIDEO:gt(t.videoinputDeviceId)>YS.PUBLISH_STATE_NONE?(L.Logger.info(ae,"publishReconnection->"+i+":republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.reconnectionNumber++,it(t,{reconnection:!0})):$(t);break;default:t.needPublishToServer&&Pe(t.extensionId)?(L.Logger.info(ae,"publishReconnection->"+i+":republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.reconnectionNumber++,it(t,{reconnection:!0})):$(t)}},1e3)},{reconnection:!0,socketop:{reason:-1}});else{switch(L.Logger.info(ae,"publishReconnection->"+i+":The number of republish exceeded "+c+" , not republish , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.getAttributes().type){case YS.STREAM_VIDEO:var e=gt(t.videoinputDeviceId);if(e>YS.PUBLISH_STATE_NONE){var o=void 0;if(e===YS.PUBLISH_STATE_VIDEOONLY||e===YS.PUBLISH_STATE_BOTH){var r={};YS.isMultiCamera&&(r.deviceId=t.videoinputDeviceId),o=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_MAX_RECONNECT_COUNT,info:r}})}var n=void 0;e!==YS.PUBLISH_STATE_AUDIOONLY&&e!==YS.PUBLISH_STATE_BOTH||(n=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_MAX_RECONNECT_COUNT,info:{}}})),U.changeUserPublish(t.publisherId(),YS.PUBLISH_STATE_NONE,t.videoinputDeviceId),o&&U.dispatchEvent(o),n&&U.dispatchEvent(n)}else ot(t);break;case YS.STREAM_SCREEN:YS.isYsNative?l.stopShareScreen():U.stopShareScreen();break;case YS.STREAM_FILE:YS.isYsNative&&l.stopShareMediaFile();break;default:ot(t),t.needPublishToServer=!1,Me(t.extensionId)&&Oe(t.extensionId)}$(t),Ot(t,window.YS.ERROR_NOTICE.ERR_PUBLISH_MAX_RECONNECT_COUNT,i)}}function X(t,i){void 0===t.reconnectionNumber&&(t.reconnectionNumber=0),t.isCompleted=!1,L.Logger.info(ae,"subscribeReconnection->"+i+":unsubscribe , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),nt(t,function(e){e||L.Logger.warning(ae,"subscribeReconnection->"+i+": unsubscribe in not success , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+" !"),void 0===t.incremental&&(t.incremental=0),t.incremental=0===t.incremental?1:2*t.incremental,4<=t.incremental&&(t.incremental=4),clearTimeout(t.incrementalTimer),t.incrementalTimer=setTimeout(function(){U.remoteStreams[t.getID()]?(t.reconnectionNumber++,L.Logger.info(ae,"subscribeReconnection->"+i+": stream-removed(initiative) , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),N._nativeStatsDelivered[t.extensionId]=void 0,delete N._nativeStatsDelivered[t.extensionId],t.getAttributes().type===YS.STREAM_VIDEO?qe(t):Ge(t,!1),L.Logger.info(ae,"subscribeReconnection->"+i+":resubscribe , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),rt(t,{reconnection:!0})):Z(t)},1e3*t.incremental)},{reconnection:!0,socketop:{reason:-1}})}function Z(e){e.isCompleted=!1,e.reconnectionNumber=0,e.incremental=0,clearTimeout(e.incrementalTimer),e.incrementalTimer=void 0}function $(e){e.isPublishing=!1,e.isUnpublishing=!1,e.isCompleted=!1,e.reconnectionNumber=0}function ee(){for(var e in YS.isOnlyAudioRoom=!1,YS.needOnlyAudioRoom=0,YS.connectTimer=0,YS.networkTestInfo.host="api.roadofcloud.com",N._myself&&(N._myself.publishstate=YS.PUBLISH_STATE_NONE),U.remoteStreams){if(U.remoteStreams.hasOwnProperty(e))(t=U.remoteStreams[e])&&(L.Logger.info(ae,"_resetRoomState--\x3estream-removed(), stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),M.closeConnection(t.getID()),Z(t),t.getAttributes().type===YS.STREAM_VIDEO?qe(t):Ge(t,!1),Ft(t),delete t.report,delete U.remoteStreams[e],Me(t.extensionId)&&Oe(t.extensionId))}for(var e in U.localStreams)if(U.localStreams.hasOwnProperty(e)){var t=U.localStreams[e];M.closeConnection(t.getID()),$(t),delete t.report,delete U.localStreams[e],Me(t.extensionId)&&Oe(t.extensionId)}for(var i in N._createStreams){delete(t=N._createStreams[i]).report,M.closeConnection(t.getID()),$(t),Me(t.extensionId)&&Oe(t.extensionId)}H=[],q={},U.remoteStreams={},N._nativeStatsDelivered={},N._devicePublishInfo={},N._multiCameraAudioDevicePublishInfo={},G={duration:0,outBytes:0,inBytes:0,outPackets:0,inPackets:0,outAudioKBitRate:0,inAudioKBitRate:0,outVideoKBitRate:0,inVideoKBitRate:0,audioDelay:0,videoDelay:0},M.closeAllConnections(),N._isConnected=!1,YS.networkTestInfo.isConnectRoom=!1,Y&&Y.changeCommonWhiteBoardConfigration&&Y.changeCommonWhiteBoardConfigration({isConnectedRoom:N._isConnected}),o()}function o(){if(YS.isPlayback)for(var e in N._users)N._users[e].playbackLeaved=!0;else for(var e in N._users)delete N._users[e]}function te(e,t,i,o,r,n){L.Logger.debug(ae,"Going to entryroom");var a=N._web_protocol+"://"+e+":"+t+u+"?ts="+(new Date).getTime();n=n||{};var s={serial:N._room_id,restrict:0,configonly:0};if(n.restrict&&(s.restrict=n.restrict),n.configonly&&(s.configonly=1),N._useServerScreenRecording&&(s.logintype=88),i&&"object"===qt(i))for(var c in i)s[c]=i[c];n.noGetEntryroom&&N.entryroomRes?"getConfig"===n.sourceName?0===N.entryroomRes.result?L.Utils.isFunction(o)&&o(N.entryroomRes):(L.Logger.error("entryroom result not is 0, result is "+N.entryroomRes.result),L.Utils.isFunction(r)&&r("result not is 0, result is "+N.entryroomRes.result)):L.Utils.isFunction(o)&&o(N.entryroomRes):L.Utils.sdkAjax({url:a,dataType:"json",type:"POST",anync:!0,data:s,success:function(e){N.entryroomRes=e,L.Logger.debug(ae,"entryroom resp = ",L.Utils.toJsonStringify(e)),"getConfig"===n.sourceName?0===e.result?L.Utils.isFunction(o)&&o(e):(L.Logger.error("entryroom result not is 0, result is "+e.result),L.Utils.isFunction(r)&&r("result not is 0, result is "+e.result)):L.Utils.isFunction(o)&&o(e)},error:function(e,t,i){N.entryroomRes=void 0,L.Logger.error(ae,"entryroom fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(r)&&r(e,t,i)}})}function ie(e,t,i,o,r,n,a,s){N._serverName=e,(N._ys_room_test_sdk||N._useServerScreenRecording)&&(n=""),N._ipFalsification=L.Utils.trim(n),N._isIpFalsification=!!n;var c=t,d=Number(i),u={};if(a&&"object"===qt(a))for(var l in a)u[l]=a[l];/https/g.test(N._socket_protocol)||(d+=1),N._testIP&&N._testPort&&(c=N._testIP,d=N._testPort),u.socket_host=c,u.socket_port=d,o&&(u.web_host=o),r&&Array.isArray(r)&&r.length?(N._hasDocServerAddrBackup=!0,u.backup_doc_host=r[0],u.backup_doc_host_list=r):N._hasDocServerAddrBackup=!1,w(u),N._room_uri=N._socket_protocol+"://"+N._socket_host+":"+N._socket_port,L.Logger.debug(ae,"privateVariableJson._room_uri = "+N._room_uri),L.Utils.isFunction(s)&&s()}function oe(o,r,g,v){N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method _step2GetConfig cannot be executed!"):((v=v||{}).sourceName="getConfig",N._backupCourseAddrList=[],L.Logger.debug(ae,"Going to getConfig"),te(o,r,{},function(n){L.Logger.debug(ae,"getConfig resp = ",L.Utils.toJsonStringify(n)),N._configuration=n;var a={};n.ipinfo&&"object"===qt(n.ipinfo)&&(N._ipinfo=n.ipinfo),n.ClassDocServerAddr&&(N._docServerAddr=n.ClassDocServerAddr,a.doc_host=n.ClassDocServerAddr,N._useDocServerAddr=n.ClassDocServerAddr);var e=0;if(n.newcourseaddr&&Array.isArray(n.newcourseaddr)&&n.newcourseaddr.length&&(N._backupCourseAddrList=N._backupCourseAddrList.concat(n.newcourseaddr),e+=n.newcourseaddr.length),n.backcourseaddr&&Array.isArray(n.backcourseaddr)&&n.backcourseaddr.length)for(var t=0,i=n.backcourseaddr.length;t<i;t++){for(var o=n.backcourseaddr[t],r=!1,s=0,c=N._backupCourseAddrList.length;s<c;s++){var d=N._backupCourseAddrList[s];L.Utils.toJsonStringify(o)===L.Utils.toJsonStringify(d)&&(r=!0)}r||N._backupCourseAddrList.push(o)}if(N._backupCourseAddrList.length)if(v&&v.notSpeedNetwordk||1==e){var u=N._backupCourseAddrList.shift();N._backupCourseAddrList.push(u),ie(u.name,u.signaladdr,u.signalport,u.webaddr,u.docaddr,u.change,a,function(){g(n?0:window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(n))})}else for(var l=!1,p=N._backupCourseAddrList.length,f=0,m=N._backupCourseAddrList.length;f<m;f++)!function(o,e){var t,i,r;t=e,i=N._web_port,r=function(e){p--;var t=!1;if(0===e&&(l||(t=l=!0)),t||0!==p||l||(L.Logger.warning(ae,"all server node speed fail,use first server node!"),l=!0,t=!(o=0)),t&&l){if(N._backupCourseAddrList.length<=o&&(L.Logger.error(ae,"_speedNetwordk:addrs length <= index,change index=0!",o,N._backupCourseAddrList.length),o=0),!N._backupCourseAddrList.length)return void L.Logger.error(ae,"_speedNetwordk:addrs length = 0!");var i=N._backupCourseAddrList[o];N._backupCourseAddrList.splice(o,1),N._backupCourseAddrList.push(i),ie(i.name,i.signaladdr,i.signalport,i.webaddr,i.docaddr,i.change,a,function(){g(n?0:window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,L.Utils.toJsonStringify(n))})}},L.Utils.speedNetwordk(N._web_protocol,t,i,r)}(f,N._backupCourseAddrList[f].webaddr);else L.Logger.error(ae,"getConfig not addrs info!")},function(e,t,i){L.Logger.error(ae,"getConfig fail[ XHR , textStatus , errorThrown ]:",e,t,i),N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method getConfig cannot be executed!"):(N._webReconnectNumList.hasOwnProperty("getConfigReconnectNum")||(N._webReconnectNumList.getConfigReconnectNum=0),N._webReconnectNumList.getConfigReconnectNum=++N._webReconnectNumList.getConfigReconnectNum%5,clearTimeout(N._webReconnectNumList.getConfigReconnectTimer),N._webReconnectNumList.getConfigReconnectTimer=setTimeout(function(){N._webReconnectNumList.getConfigReconnectTimer=void 0,N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method getConfig cannot be executed!"):(L.Logger.info(ae,"Rerequest getConfig web interface!"),oe(o,r,g,v))},1e3*N._webReconnectNumList.getConfigReconnectNum))},v))}function re(e,t,o){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _step2GetFileList cannot be executed!");else if(N._isGetFileList){L.Logger.debug(ae,"Going to getFileList");var i=N._web_protocol+"://"+e+":"+t+r+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",anync:!0,data:{serial:N._room_id},success:function(e){L.Logger.debug(ae,"getFileList resp = ",L.Utils.toJsonStringify(e));var t,i=e.result;0==i&&void 0!==e.roomfile?t=e.roomfile:L.Logger.info(ae,"getFileList resp.roomfile is not exist , nRet:"+i),L.Utils.isFunction(o)&&o(i,t)},error:function(e,t,i){L.Logger.error(ae,"getFileList fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(o)&&o(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}else L.Utils.isFunction(o)&&o(-1,void 0)}function ne(){L.Logger.debug(ae,"step3Connect"),N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method _step3Connect cannot be executed!"):(L.Logger.info(ae,"socket connect address:"+(window.__YsSdkBuild__?L.Utils.encrypt(N._room_uri):N._room_uri)),N._isConnected=!1,YS.networkTestInfo.isConnectRoom=!1,Y&&Y.changeCommonWhiteBoardConfigration&&Y.changeCommonWhiteBoardConfigration({isConnectedRoom:N._isConnected}),x=0,B=(new Date).getTime(),function a(i,o){if(N._isLeaveRoom)return void L.Logger.info(ae,"The room is over. Method _connectSocket cannot be executed!");P.connectSocket(N._room_uri);var s=0;var c=!1;P.onConnectError=function(e){var t=z&&0<F,i=0,o=0;0<N._connectedNumber&&0===B?(j=Date.now(),B=(new Date).getTime()):0<B&&(i=Date.now()-B,o=B-j);var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"joinRoom",error:window.YS_ERR.ROOM_JOIN_FAILED,errorCode:window.YS_ERR.ROOM_JOIN_FAILED}},{httpTime:o,socketTime:i,reconnectCount:F,isReconnect:t});if(U.dispatchEvent(r),L.Logger.error(ae,"connect_error info:",e),s++,!c&&3<=s&&(c=!0,U.eventLog({type:"FAIL_SOCKET",data:N._room_uri})),1<N._backupCourseAddrList.length&&3<=s){var n=N._backupCourseAddrList.shift();N._backupCourseAddrList.push(n),L.Logger.warning(ae,"Not Connected,change address reconnection, address info:"+L.Utils.toJsonStringify(n)+" ,error info: "+e),ie(n.name,n.signaladdr,n.signalport,n.webaddr,n.docaddr,n.change,void 0,function(){try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(ae,"Socket already disconnected , disconnect errorInfo:",e)}P&&P.emptySocket&&P.emptySocket(),U.needReconnectSocket=!0,V+=1,a(f._handler_connectSocketSuccess,f._handler_connectSocketFail)})}Jt(J)};P.onConnect=function(){if(x=(new Date).getTime()-B,N._isLeaveRoom)return L.Logger.info(ae,"The room is over. socket connect!"),void(P&&P.isHasSocket&&P.isHasSocket()&&U.leaveroom());if(L.Logger.debug(ae,"ys connectd"),(s=0)===N._connectedNumber||U.needReconnectSocket)P.onAddStream=function(e){var t=!1,i=!1,o="",r="",n="";if(e.attributes.type===YS.STREAM_MEDIA)t=!0,YS.isPlayback&&e.attributes.toID&&e.attributes.toID!==YS.MSG_TO_ALLUSER&&e.attributes.toID!==YS.MSG_TO_ALLEXCEPTAUDITOR&&e.attributes.toID!==e.extensionId.replace(/\:media/g,"")&&(t=!1);else if(e.attributes.type){var a=wt(e.extensionId);a===De()?t=!1:(t=!0,o=U.getUser(wt(e.extensionId)),r=wt(e.extensionId,1),n="yssmall"===wt(e.extensionId,2),o&&o.ys_enabledualstream&&(o["Dual:"+r]&&o["Dual:"+r]!=n?t=!1:n!=O&&(t=!1)))}YS.subscribe_from_native&&t&&(i=!0);var s=void 0;if(e.attributes.type!==YS.STREAM_MEDIA&&wt(e.extensionId)===De()){if(!(s=Pe(e.extensionId)))return void L.Logger.error(ae,"onAddStream:not find local stream,add stream arg:",L.Utils.toJsonStringify(e))}else s=YS.Stream({streamID:e.id,local:!1,audio:e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes,extensionId:e.extensionId,getVideoTrack:Nt,getAudioTrack:Ut,getRegisterAudioVolumeListener:Yt},i);for(var c in U.remoteStreams)if(U.remoteStreams[c]&&U.remoteStreams[c].extensionId===s.extensionId){var d=U.remoteStreams[c];Ft(d),delete U.remoteStreams[c],Me(d.extensionId)&&Oe(d.extensionId)}if(delete s.report,(U.remoteStreams[e.id]=s).getAttributes().type===YS.STREAM_VIDEO&&s.publisherId()===De()&&K(void 0,void 0,void 0,s.videoinputDeviceId),t&&rt(s),L.Logger.info(ae,"stream-added , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),s.publisherId()===De())if(s.getAttributes().type===YS.STREAM_VIDEO){var u=!1,l=gt(s.videoinputDeviceId);l===YS.PUBLISH_STATE_MUTEALL&&(u=!0),We(s,u),l===YS.PUBLISH_STATE_NONE&&!s.isUnpublishing&&U.localStreams[s.getID()]&&ot(s)}else s.getAttributes().type!==YS.STREAM_MEDIA&&Ge(s,!0)},P.onSignalingMessageMediaserver=function(e){var t;if(L.Logger.debug(ae,"signaling_message_mediaserver",e),e.mess=Le(e.mess),e.peerId?(t=U.remoteStreams[e.peerId],!d.autoSubscribeAV&&e&&e.mess&&"answer"===e.mess.type&&t&&(t.video&&E(t,!0),t.audio&&A(t,!0))):t=U.localStreams[e.streamId],t){if(L.Logger.info(ae," onSignalingMessageMediaserver info: stream id is",t.getID(),", stream extensionId is",t.extensionId,", arg.mess.type is",e.mess.type),e&&e.mess&&"ready"===e.mess.type){var i=null;if(e.peerId){if(L.Logger.info(ae,"stream-subscribed , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.subscribed=!0,t.getAttributes().type===YS.STREAM_VIDEO){var o=!1;N._users[t.publisherId()]&&N._users[t.publisherId()].publishstate===YS.PUBLISH_STATE_MUTEALL&&(o=!0),We(t,o)}else Ge(t,!0);Z(t);var r={userId:t.publisherId(),type:t.getAttributes().type,source:"media server ready"};if(t.getAttributes().type===YS.STREAM_VIDEO){var n=new RegExp(t.publisherId()+":","g");if(n.test(t.extensionId)){var a=ft(t);r.deviceId=a}t.extensionId.split(":")[0]===U.getMySelf().id&&t&&t.needSetVideoBW&&M.setBandWidth(t.getID(),t.needSetVideoBW,function(){L.Logger.info(ae," setBandWidth success!")},function(e){L.Logger.info(ae," setBandWidth It might be a little bit of a problem!")})}i=YS.RoomEvent({type:YS.EVENT_TYPE.roomInfoNotice,message:{code:window.YS.INFO_NOTICE.INFO_SUBSCRIBE_COMPLETED,info:r}})}else{$(t);var r={userId:t.publisherId(),type:t.getAttributes().type,source:"media server ready"};if(YS.isMultiCamera&&t.getAttributes().type===YS.STREAM_VIDEO){var a=ft(t);r.deviceId=a}i=YS.RoomEvent({type:YS.EVENT_TYPE.roomInfoNotice,message:{code:window.YS.INFO_NOTICE.INFO_PUBLISH_COMPLETED,info:r}})}t.isCompleted=!0,YS.isYsNative&&YS.subscribe_from_native&&t&&t.hideLoading&&t.hideLoading(),i&&U.dispatchEvent&&U.dispatchEvent(i)}M.hasConnection(t.getID())?pt(e.mess,t):L.Logger.warning(ae,"stream pc is not exist , Can't call processSignalingMessage method!")}else L.Logger.error(ae,"onSignalingMessageMediaserver stream is not exist,signaling_message_mediaserver info:",e)},P.onUpdateAttributeStream=function(e){var t=U.remoteStreams[e.id];void 0!==t?(t.updateLocalAttributes(e.attrs),ze(t,e.attrs)):L.Logger.warning(ae,"onUpdateAttributeStream stream invalid",e)},P.onPublishFailed=function(e){L.Logger.warning(ae,"stream-publish_mediaserver_failed server info: "+L.Utils.toJsonStringify(e));var t=U.localStreams[e.streamId];t&&(Ot(t,window.YS.ERROR_NOTICE.ERR_PUBLISH_TIMEOUT,"mediaserver publish failed"),C(t,"mediaserver publish failed"),t.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_PUB",streamid:t.getID(),data:"MEDIASERVER_FAILED"}))},P.onSubscribeFailed=function(e){L.Logger.warning(ae,"stream-subscribe_mediaserver_failed server info: "+L.Utils.toJsonStringify(e));var t=U.remoteStreams[e.streamId];t&&(xt(t,window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_TIMEOUT,"mediaserver subscribe failed"),N._useServerScreenRecording&&jt()?(L.Logger.info(ae,"recorder class over by signallingObj onSubscribeFailed,roomid is "+N._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(N._myself)),jt().over(100)):X(t,"mediaserver subscribe failed"),t.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_SUB",streamid:t.getID(),data:"MEDIASERVER_FAILED"}))},P.onRemoveStream=function(e){var t=U.remoteStreams[e.id];if(t){var i=Pe(De()+":"+YS.STREAM_SCREEN);i&&i.mediaStream&&t.mediaStream&&i.mediaStream.id===t.mediaStream.id&&U.stopShareScreen(function(){L.Logger.error(ae,"stream-removed , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", stopShareScreen Failed. ")}),M.closeConnection(t.getID()),L.Logger.info(ae,"stream-removed , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),t.getAttributes().type===YS.STREAM_VIDEO?qe(t):Ge(t,!1),et(t),Ft(t),delete t.report,delete U.localStreams[e.id],delete U.remoteStreams[e.id],Me(t.extensionId)&&Oe(t.extensionId)}else L.Logger.info(ae,"Received a removeStream for ",e.id," and it has not been registered here, ignoring.")},P.onDisconnect=function(e){if(!U.needReconnectSocket&&(L.Logger.info(ae,"Socket disconnected, lost connection to YSController",e),N._isConnected)){ee(),YS.isYsNative&&(N._handlerCallbackJson=!1,window.ysnative.postMessage({command:"nativeClear"})),clearInterval(U._networkequipmentTimer),clearInterval(U._catonNumber),clearInterval(U.sendcatonNumber);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomDisconnected,message:"unexpected-disconnection"});U.dispatchEvent(t)}"io server disconnect"===e?(L.Logger.info("server close socket,force leave room!"),U.leaveroom(!0)):Jt(J)},P.onReconnecting=function(e){L.Logger.debug(ae,"reconnecting info:",e);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomReconnecting,message:{number:e,info:"room-reconnecting number:"+e}});U.dispatchEvent(t)},P.onParticipantLeft=f._handler_participantLeft,P.onParticipantJoined=f._handler_participantJoined,P.onParticipantPublished=f._handler_participantPublished,P.onParticipantEvicted=function(e){e=e||{},L.Logger.info(ae,"user evicted room  , user info: "+L.Utils.toJsonStringify(N._myself)+" , participantEvicted  messages:"+L.Utils.toJsonStringify(e)),U.leaveroom(!0);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomParticipantEvicted,message:e,user:N._myself});U.dispatchEvent(t)},P.onSendMessage=f._handler_sendMessage,P.onMsgList=function(e){L.Logger.debug(ae,"msgList info:",L.Utils.toJsonStringify(e));var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomMsgList,message:e});U.dispatchEvent(t)},P.onPubMsg=f._handler_pubMsg,P.onDelMsg=f._handler_delMsg,P.onSetProperty=f._handler_setProperty,P.onPlaybackClearAll=p.playbackClearAll,P.onDuration=p.handlerDuration,P.onPlaybackEnd=p.handlerPlaybackEnd,P.onPlaybackUpdatetime=p.handlerPlaybackUpdateTime,P.onForceReconnect=function(){L.Logger.info(ae,"service notice forceReconnect , call reconnected room! ");var e={source:"forceReconnect room"};I(e,i,o)},N._connectedNumber++,L.Logger.info(ae,"connected room  , current connected number is "+N._connectedNumber+"! "),U.needReconnectSocket||L.Logger.info(ae,"Reconnect Socket ,  join room start! "),U.needReconnectSocket=!1,se(i,o);else{L.Logger.info(ae,"reconnected room! ");var e=YS.RoomEvent({type:YS.EVENT_TYPE.roomReconnected});U.dispatchEvent(e);var t={source:"reconnected room"};I(t,i,o)}}}(f._handler_connectSocketSuccess,f._handler_connectSocketFail))}function se(r,n){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _step4Join cannot be executed!");else if(null!=N._room_id){if(N._myself&&(N._serverName&&(N._myself.servername=N._serverName),N._myself.ys_ip=N._myIp,N._myself.ys_area=N._ipinfo.country+"."+N._ipinfo.city+"."+N._ipinfo.area,N._myself.ys_carrier=N._ipinfo.perators,YS.isMultiCamera)){if(!N._mainCameraDeviceId){var e=N._mainCameraDeviceId;N._mainCameraDeviceId=ye(),L.Logger.info(ae,"change myself main camera device id,my id is "+De()+",change device id is "+N._mainCameraDeviceId+",old device id is "+e);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:De()!==N._local_def_ext_id?De():"",deviceId:N._mainCameraDeviceId}});U.dispatchEvent(t)}N._myself.ys_maincamera=N._mainCameraDeviceId}if(L.Utils.isFunction(N._roomJsonOptions.awitJoinRoomCallback)){var i=!1;N._roomJsonOptions.awitJoinRoomCallback(function(){i?L.Logger.error(ae,"awitJoinRoomCallback fire again!"):(i=!0,o())}),delete N._roomJsonOptions.awitJoinRoomCallback}else o()}else L.Logger.error(ae,"Invalid status",N._room_id);function o(){var e={};for(var t in N._myself)"id"!=t&&"watchStatus"!=t&&(e[t]=N._myself[t]);var i=M.getMaxVideoProfile(),o={userId:De(),roomId:N._room_id,maxVideo:N._room_max_videocount,videofps:i.maxfps,videowidth:i.width,videoheight:i.height,properties:e,roomtype:N._room_properties.roomtype,version:s,vcodec:"number"==typeof N._video_codec?N._video_codec:0,develop:(88==e.role||-1==e.role)&&!N._useServerScreenRecording};if(N._useServerScreenRecording&&(o.useServerScreenRecord=!0),YS.isPlayback){if(!N._recordfilepath)return void L.Logger.error(ae,"The playback file address does not exist!");o.recordfilepath=N._recordfilepath}if(2===N._myself.role&&(o.lang=N._roomJsonOptions.recordLang),"object"===qt(N._roomJsonOptions.joinRoomTestParams))for(var t in N._roomJsonOptions.joinRoomTestParams)o.hasOwnProperty(t)||(o[t]=N._roomJsonOptions.joinRoomTestParams[t]);L.Logger.info(ae,"joinRoom params info:"+(window.__YsSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(o)):L.Utils.toJsonStringify(o))),P.sendMessageSocket("joinRoom",o,function(e,t){0===e?L.Utils.isFunction(r)&&(z=!0,r(e,t)):L.Utils.isFunction(n)&&n(e,t)})}}function ce(e,o,r,n){var a=void 0,s=!1,c=!1,t=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/ClientAPI/uploaddocument?ts="+(new Date).getTime();return e&&"object"===qt(e)&&"function"==typeof e.get?a=e.get("filetype"):e&&"object"===qt(e)&&void 0!==e.filetype&&(a=e.filetype),e&&"object"===qt(e)&&"function"==typeof e.get?s=1===Number(e.get("writedb")):e&&"object"===qt(e)&&void 0!==e.writedb&&(s=1===Number(e.writedb)),e&&"object"===qt(e)&&"function"==typeof e.get?c=1===Number(e.get("dynamicppt")):e&&"object"===qt(e)&&void 0!==e.writedb&&(c=1===Number(e.dynamicppt)),Log.error(111111111,a),L.Utils.sdkAjax({url:t,dataType:"json",type:"POST",data:e,async:!0,isupLoadFile:!0,progress:function(e){if(L.Utils.isFunction(r)&&e){var t=e.loaded,i=e.total,o=Math.floor(100*t/i);100<=o&&c&&(_=!0),r(e,o)}},success:function(e){L.Logger.debug(ae,"uploadFile resp = ",L.Utils.toJsonStringify(e));var t=e.result;if(0===t&&s){var i=L.Utils.toJsonParse(L.Utils.toJsonStringify(e));delete i.result,i.filetype=i.filetype||a,_&&c?b=i:de(i,!1)}0===t?L.Utils.isFunction(o)&&o(t,e):L.Utils.isFunction(n)&&n(t,e)},error:function(e,t,i){_=!1,b=null,L.Logger.error(ae,"uploadFile fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}function de(e,t){if(e&&"object"===qt(e)){var i=Number(e.fileprop),o=e.filetype&&"string"==typeof e.filetype?e.filetype.toLocaleLowerCase():e.filetype,r=1===i||2===i,n=3===i,a=!r&&!n,s=/(mp3|mp4|webm)/g.test(o),c=e;c.fileid=Number(e.fileid),c.pagenum=Number(e.pagenum),c.filecategory=void 0!==e.filecategory?Number(e.filecategory):0,c.fileprop=i,c.filetype=o,c.isContentDocument=void 0!==e.isContentDocument&&null!==e.isContentDocument&&"number"==typeof Number(e.isContentDocument)?Number(e.isContentDocument):0,c.swfpath=r||n?e.downloadpath:e.swfpath,c.dynamicppt=r?1:0,c.currpage=1,c.pptslide=1,c.pptstep=0,c.steptotal=0;var d={name:"DocumentChange",id:"DocumentChange",toID:t?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:t,isGeneralFile:a,isMedia:s,isDynamicPPT:r,isH5Document:n,action:"",mediaType:s?o:"",filedata:c}),save:!1};U.pubMsg(d)}}function ue(o,r,n){var e=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/ClientAPI/delroomfile?ts="+(new Date).getTime(),t={serial:N._room_properties.serial,fileid:o};L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:t,success:function(e){L.Logger.debug(ae,"deleteFile resp = ",L.Utils.toJsonStringify(e));var t=e.result,i=function(e){for(var t=0;t<N._room_filelist.length;t++)if(N._room_filelist[t].fileid==e)return{file:N._room_filelist[t],index:t}}(o);0===t&&i&&i.file&&"object"===qt(i.file)&&de(L.Utils.toJsonParse(L.Utils.toJsonStringify(i.file)),!0);0===t?L.Utils.isFunction(r)&&r(t,e):L.Utils.isFunction(n)&&n(t,e)},error:function(e,t,i){L.Logger.error(ae,"deleteFile fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}function le(e,t){N._devicePublishInfo[e]=N._devicePublishInfo[e]||{_audiopublished_:!1,_videopublished_:!1},L.Utils.isBoolean(t)&&(N._devicePublishInfo[e]._videopublished_=t)}function pe(e,t){N._devicePublishInfo[e]=N._devicePublishInfo[e]||{_audiopublished_:!1,_videopublished_:!1},L.Utils.isBoolean(t)&&(N._devicePublishInfo[e]._audiopublished_=t)}function fe(e,t){L.Utils.isBoolean(t)&&(N._multiCameraAudioDevicePublishInfo[e]=t)}function me(e){if(N._devicePublishInfo[e])return N._devicePublishInfo[e]._videopublished_}function ge(e){if(N._devicePublishInfo[e])return N._devicePublishInfo[e]._audiopublished_}function ve(e){return N._multiCameraAudioDevicePublishInfo[e]}function he(e){N._devicePublishInfo[e]&&(N._devicePublishInfo[e]._audiopublished_||N._devicePublishInfo[e]._videopublished_||(N._devicePublishInfo[e]=void 0,delete N._devicePublishInfo[e]))}function Se(e){N._multiCameraAudioDevicePublishInfo[e]||(N._multiCameraAudioDevicePublishInfo[e]=void 0,delete N._multiCameraAudioDevicePublishInfo[e])}function ye(){var e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput);if(L.Utils.isVideoinputDeviceIdFromDeviceList(e))return e;if(YS.deviceInfoMap&&YS.deviceInfoMap.videoinput&&YS.deviceInfoMap.videoinput.length){var t=YS.deviceInfoMap.videoinput[0]&&YS.deviceInfoMap.videoinput[0].deviceId;return e&&L.Logger.warning(ae,"The host camera device id("+e+") of local storage is not in the device list, looking for other device replacements, which have an id of "+t),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t),t}return e&&L.Logger.warning(ae,"The host camera device id("+e+') of local storage is not in the device list, looking for other device replacements, which have an id of ""'),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,""),""}function _e(e){var t="254.254.254.254";if("offer"===e.type||"candidate"===e.type){var i=L.Utils.toJsonStringify(e),o=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;o.test(i)&&(e=L.Utils.toJsonParse(i.replace(o,t)));var r=/ [0-9a-zA-Z]{8}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{12,}\.local /;r.test(i)&&(e=L.Utils.toJsonParse(i.replace(r," "+t+" ")))}return e}function Le(e){if(!N._isIpFalsification||!N._ipFalsification)return e;if("answer"===e.type){var t=L.Utils.toJsonStringify(e),i=N._ipFalsification,o=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;o.test(t)&&(e=L.Utils.toJsonParse(t.replace(o,i)))}return e}function be(e,t){var i=!1,o=!1;e.getAttributes().type!==YS.STREAM_MEDIA&&e.publisherId()===De()||(o=!0);function r(e){"ssrc"===e.type&&"video"===e.mediaType?!o&&/send/g.test(e.id)?(w=Number(e.bytesSent),I=Number(e.packetsSent),h=Number(e.googRtt),T=Number(e.packetsLost),S=Number(e.googFrameWidthSent),y=Number(e.googFrameHeightSent),b=Number(e.googFrameRateSent),_=e.timestamp,g=e.googFirsReceived?Number(e.googFirsReceived):0,v=e.googPlisReceived?Number(e.googPlisReceived):0):o&&/recv/g.test(e.id)&&(E=Number(e.bytesReceived),D=Number(e.packetsReceived),A=Number(e.googCurrentDelayMs),N=Number(e.packetsLost),k=Number(e.googFrameWidthReceived),R=Number(e.googFrameHeightReceived),C=Number(e.googFrameRateReceived),_=e.timestamp):"ssrc"===e.type&&"audio"===e.mediaType&&(!o&&/send/g.test(e.id)?(B=Number(e.bytesSent),j=Number(e.packetsSent),F=Number(e.googRtt),J=Number(e.packetsLost),W=Number(e.googJitterReceived),H=e.timestamp):o&&/recv/g.test(e.id)&&(G=Number(e.bytesReceived),z=Number(e.packetsReceived),Q=Number(e.googCurrentDelayMs),K=Number(e.packetsLost),W=Number(e.googJitterReceived),H=e.timestamp))}function n(e){"video"===e.mediaType?o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(E=Number(e.bytesReceived)?Number(e.bytesReceived):0,D=Number(e.packetsReceived)?Number(e.packetsReceived):0,A=Number(e.CurrentDelayMs)?Number(e.CurrentDelayMs):0,N=Number(e.packetsLost)?Number(e.packetsLost):0,k=Number(e.FrameWidthReceived)?Number(e.FrameWidthReceived):0,R=Number(e.FrameHeightReceived)?Number(e.FrameHeightReceived):0,C=Number(e.framerateMean)?Number(e.framerateMean):0,_=e.timestamp):(h=Number(e.Rtt)?Number(e.Rtt):0,w=Number(e.bytesSent)?Number(e.bytesSent):0,I=Number(e.packetsSent)?Number(e.packetsSent):0,T=Number(e.nackCount)?Number(e.nackCount):0,S=Number(e.FrameWidthSent)?Number(e.FrameWidthSent):0,y=Number(e.FrameHeightSent)?Number(e.FrameWidthSent):0,b=Number(e.framerateMean)?Number(e.framerateMean):0,g=Number(e.firCount)?Number(e.firCount):0,v=Number(e.firCount)?Number(e.pliCount):0,_=e.timestamp):"audio"===e.mediaType&&(o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(G=Number(e.bytesReceived)?Number(e.bytesReceived):0,z=Number(e.packetsReceived)?Number(e.packetsReceived):0,Q=Number(e.CurrentDelayMs)?Number(e.CurrentDelayMs):0,K=Number(e.packetsLost)?Number(e.packetsLost):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp):(B=Number(e.bytesSent)?Number(e.bytesSent):0,j=Number(e.packetsSent)?Number(e.packetsSent):0,F=Number(e.Rtt)?Number(e.Rtt):0,J=Number(e.nackCount)?Number(e.nackCount):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp))}function a(e){if("video"===e.mediaType)o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(E=Number(e.bytesReceived)?Number(e.bytesReceived):0,D=Number(e.packetsReceived)?Number(e.packetsReceived):0,N=Number(e.packetsLost)?Number(e.packetsLost):0,_=e.timestamp):(w=Number(e.bytesSent)?Number(e.bytesSent):0,I=Number(e.packetsSent)?Number(e.packetsSent):0,T=Number(e.nackCount)?Number(e.nackCount):0,g=Number(e.firCount)?Number(e.firCount):0,v=Number(e.firCount)?Number(e.pliCount):0,_=e.timestamp);else if("audio"===e.mediaType)o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(G=Number(e.bytesReceived)?Number(e.bytesReceived):0,z=Number(e.packetsReceived)?Number(e.packetsReceived):0,K=Number(e.packetsLost)?Number(e.packetsLost):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp):(B=Number(e.bytesSent)?Number(e.bytesSent):0,j=Number(e.packetsSent)?Number(e.packetsSent):0,J=Number(e.nackCount)?Number(e.nackCount):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp);else if("track"===e.type&&e.hasOwnProperty("frameWidth")&&e.frameWidth)o?o&&(k=Number(e.frameWidth)?Number(e.frameWidth):0,R=Number(e.frameHeight)?Number(e.frameHeight):0,Z=Number(e.framesReceived)?Number(e.framesReceived):0):(S=Number(e.frameWidth)?Number(e.frameWidth):0,y=Number(e.frameHeight)?Number(e.frameHeight):0,X=Number(e.framesSent)?Number(e.framesSent):0);else if("candidate-pair"===e.type&&e.hasOwnProperty("currentRoundTripTime")){var t=parseInt(1e3*e.currentRoundTripTime);o?Q=A=t:F=h=t}}function s(e){"video"===e.mediaType?o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(E=Number(e.bytesReceived)?Number(e.bytesReceived):0,D=Number(e.packetsReceived)?Number(e.packetsReceived):0,N=Number(e.packetsLost)?Number(e.packetsLost):0,_=e.timestamp):(w=Number(e.bytesSent)?Number(e.bytesSent):0,I=Number(e.packetsSent)?Number(e.packetsSent):0,T=Number(e.nackCount)?Number(e.nackCount):0,g=Number(e.firCount)?Number(e.firCount):0,v=Number(e.firCount)?Number(e.pliCount):0,_=e.timestamp):"audio"===e.mediaType?o||"outbound-rtp"!==e.type?o&&"inbound-rtp"===e.type&&(G=Number(e.bytesReceived)?Number(e.bytesReceived):0,z=Number(e.packetsReceived)?Number(e.packetsReceived):0,K=Number(e.packetsLost)?Number(e.packetsLost):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp):(B=Number(e.bytesSent)?Number(e.bytesSent):0,j=Number(e.packetsSent)?Number(e.packetsSent):0,J=Number(e.nackCount)?Number(e.nackCount):0,W=1e3*Number(e.jitter)?1e3*Number(e.jitter):0,H=e.timestamp):"track"===e.type&&e.hasOwnProperty("frameWidth")&&e.frameWidth&&(o?o&&(k=Number(e.frameWidth)?Number(e.frameWidth):0,R=Number(e.frameHeight)?Number(e.frameHeight):0,C=Number(e.framesPerSecond)?Number(e.framesPerSecond):0):(S=Number(e.frameWidth)?Number(e.frameWidth):0,y=Number(e.frameHeight)?Number(e.frameHeight):0,b=Number(e.framesPerSecond)?Number(e.framesPerSecond):0))}var c=0,d={frameWidth:0,frameHeight:0},u=0,l=0,p=0,f=0,m=0,g=0,v=0,h=0,S=0,y=0,_=0,b=0,w=0,I=0,T=0,E=0,A=0,k=0,R=0,C=0,D=0,N=0,U=0,Y=0,P=0,M=0,O=0,x=0,V=0,F=0,B=0,j=0,J=0,H=0,W=0,q=0,G=0,z=0,Q=0,K=0,X=0,Z=0;if(t&&"object"===qt(t)&&t.forEach)t.forEach(function(e,t){"chrome"===L.Utils.getBrowserInfo(!0).info.browserName?r(e):"firefox"===L.Utils.getBrowserInfo(!0).info.browserName?n(e):"edge"===L.Utils.getBrowserInfo(!0).info.browserName?s(e):"safari"===L.Utils.getBrowserInfo(!0).info.browserName&&a(e)});else for(var $ in t){var ee=t[$];"chrome"===L.Utils.getBrowserInfo(!0).info.browserName?r(ee):"firefox"===L.Utils.getBrowserInfo(!0).info.browserName?n(ee):"edge"===L.Utils.getBrowserInfo(!0).info.browserName?s(ee):"safari"===L.Utils.getBrowserInfo(!0).info.browserName&&a(ee)}if(e.report||(e.report={},i=!0),e.report.timestamp=e.report.timestamp||_,e.report.audioTimestamp=e.report.audioTimestamp||H,o?(e.report.bytesReceived=e.report.bytesReceived||E,e.report.packetsReceived=e.report.packetsReceived||D,e.report.packetsLostReceived=e.report.packetsLostReceived||N,e.report.audioBytesReceived=e.report.audioBytesReceived||G,e.report.audioPacketsReceived=e.report.audioPacketsReceived||z,e.report.audioPacketsLostReceived=e.report.audioPacketsLostReceived||K,e.report.googFrameRateReceivedNum=e.report.googFrameRateReceivedNum||Z):(e.report.bytesSent=e.report.bytesSent||w,e.report.packetsSent=e.report.packetsSent||I,e.report.packetsLostSend=e.report.packetsLostSend||T,e.report.audioBytesSent=e.report.audioBytesSent||B,e.report.audioPacketsSent=e.report.audioPacketsSent||j,e.report.audioPacketsLostSend=e.report.audioPacketsLostSend||J,e.report.googFrameRateSentNum=e.report.googFrameRateSentNum||X),!i){if(e.networkStatus&&_-e.report.timestamp<=0&&H-e.report.audioTimestamp<=0)return e.networkStatus;if(o){if(U=8*(E-e.report.bytesReceived),d.frameWidth=isNaN(S)?0:k,d.frameHeight=isNaN(y)?0:R,"safari"===L.Utils.getBrowserInfo(!0).info.browserName){var te=parseInt((Z-e.report.googFrameRateReceivedNum)/((_-e.report.timestamp)/1e3));e.report.googFrameRateReceivedNum=Z,C=Number(te)?Number(te):C}u=C,c=A,m=isNaN(c)?0:c,!e.report.useAccumulativeMode&&N<e.report.packetsLostReceived&&(L.Logger.info(ae,"remote stream stats:curr packetsLostReceived < save packetsLostReceived, set use accumulative mode!",e.getID(),N,e.report.packetsLostReceived),e.report.useAccumulativeMode=!0),e.report.useAccumulativeMode&&(N+=e.report.packetsLostReceived),l=(N-e.report.packetsLostReceived)/(D-e.report.packetsReceived)*100,f=D,p=N,q=8*(G-e.report.audioBytesReceived),M=Q,V=isNaN(M)?0:M,x=W,!e.report.useAudioAccumulativeMode&&K<e.report.audioPacketsLostReceived&&(L.Logger.info(ae,"remote stream stats:curr audioPacketsLostReceived < save audioPacketsLostReceived, set use audio accumulative mode!",e.getID(),K,e.report.audioPacketsLostReceived),e.report.useAudioAccumulativeMode=!0),e.report.useAudioAccumulativeMode&&(K+=e.report.audioPacketsLostReceived),O=(K-e.report.audioPacketsLostReceived)/(z-e.report.audioPacketsReceived)*100,P=z,Y=K}else{if(U=8*(w-e.report.bytesSent),d.frameWidth=isNaN(S)?0:S,d.frameHeight=isNaN(y)?0:y,"safari"===L.Utils.getBrowserInfo(!0).info.browserName){var ie=parseInt((X-e.report.googFrameRateSentNum)/((_-e.report.timestamp)/1e3));e.report.googFrameRateSentNum=X,b=Number(ie)?Number(ie):b}u=b,c=h,m=isNaN(c)?0:Math.round(c/2),!e.report.useAccumulativeMode&&T<e.report.packetsLostSend&&(L.Logger.info(ae,"remote stream stats:curr packetsLostSend < save packetsLostSend, set use accumulative mode!",e.getID(),T,e.report.packetsLostSend),e.report.useAccumulativeMode=!0),e.report.useAccumulativeMode&&(T+=e.report.packetsLostSend),l=(T-e.report.packetsLostSend)/(I-e.report.packetsSent)*100,f=I,p=T,q=8*(B-e.report.audioBytesSent),M=F,V=isNaN(M)?0:Math.round(M/2),x=W,!e.report.useAudioAccumulativeMode&&J<e.report.audioPacketsLostSend&&(L.Logger.info(ae,"remote stream stats:curr audioPacketsLostSend < save audioPacketsLostSend, set use audio accumulative mode!",e.getID(),J,e.report.audioPacketsLostSend),e.report.useAudioAccumulativeMode=!0),e.report.useAudioAccumulativeMode&&(J+=e.report.audioPacketsLostSend),O=(J-e.report.audioPacketsLostSend)/(j-e.report.audioPacketsSent)*100,P=j,Y=J}var oe=U/((_-e.report.timestamp)/1e3),re=q/((H-e.report.audioTimestamp)/1e3);o?(e.report.bytesReceived=E,e.report.packetsReceived=D,e.report.packetsLostReceived=N,e.report.audioBytesReceived=G,e.report.audioPacketsReceived=z,e.report.audioPacketsLostReceived=K):(e.report.bytesSent=w,e.report.packetsSent=I,e.report.packetsLostSend=T,e.report.audioBytesSent=B,e.report.audioPacketsSent=j,e.report.audioPacketsLostSend=J),e.report.timestamp=_,e.report.audioTimestamp=H,l=isNaN(l)?0:Math.round(l)<=100?Math.round(l):100,O=isNaN(O)?0:Math.round(O)<=100?Math.round(O):100,m=isNaN(m)?0:m,V=isNaN(V)?0:V;var ne={video:{bytesSent:Number(w),bitsPerSecond:isNaN(oe)?0:Math.round(oe),packetsLost:isNaN(p)?0:p,totalPackets:isNaN(f)?0:f,packetsLostRate:l,currentDelay:m,frameRate:isNaN(u)?0:Math.round(u),frameWidth:d.frameWidth,frameHeight:d.frameHeight,timestamp:_,netquality:L.Utils.getNetLevel(l,m),googFirsCount:g,googPlisCount:v},audio:{audioBytesSent:Number(B),bitsPerSecond:isNaN(re)?0:Math.round(re),packetsLost:isNaN(Y)?0:Y,totalPackets:isNaN(P)?0:P,packetsLostRate:O,currentDelay:V,jitter:isNaN(x)?0:x,timestamp:H,netquality:L.Utils.getNetLevel(O,V)}};return 100<=ne.video.packetsLostRate&&(ne.video.packetsLostRate=100),e.networkStatus=ne}}function we(e,t,i){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _handlerCheckroom cannot be executed!");else{var o={},r=e.result;if(0===r){YS.isPlayback&&(e.nickname="playback",e.roomrole=-1,e.thirdid=L.Utils.generategGuid()+":playback");var n=e.room,a=e.pullinfo;e.ipinfo&&"object"===qt(e.ipinfo)&&(N._myIp=L.Utils.trim(e.ipinfo.selfip)),e.roomrole=Number(e.roomrole),n.roomtype=Number(n.roomtype),n.maxvideo=parseInt(n.maxvideo);var s={},c={};if(a&&a.data&&a.data.pullConfigureList){var d=a.data.pullConfigureList;for(var u in d){var l=d[u];s[l.pullProtocol]=l.pullUrlList}}if(a&&a.data&&a.data.pushConfigureInfo){var p=a.data.pushConfigureInfo;for(var u in p){var f=p[u];c[f.pushProtocol]=f.pushUrl}}n.pullConfigure=s,n.pushConfigure=c,N._room_properties=n,N._room_name=n.roomname,N._room_type=n.roomtype,N._room_max_videocount=n.maxvideo,N._video_codec=void 0!==n.vcodec&&null!==n.vcodec&&"number"==typeof Number(n.vcodec)?Number(n.vcodec):N._video_codec,L.Logger.info(ae,"room video codec:"+N._video_codec),o.properties={},o.properties.role=e.roomrole,o.properties.nickname=e.nickname;var m=""+e.thirdid;0===e.thirdid&&(m=""),o.id=i||(null!=m&&""!=m?m:L.Utils.generategGuid()),"string"!=typeof o.id&&(o.id=""+o.id),N._myself=YS.RoomUser(o),Vt(),YS.isPlayback?(N._myself.hasvideo=!1,N._myself.hasaudio=!1):N._safariOnlySubscibe?(L.Logger.info(ae,"_handlerCheckroom:safari is only subscibe"),N._myself.hasvideo=!!YS.deviceInfoMap.videoinput.length,N._myself.hasaudio=!!YS.deviceInfoMap.audioinput.length):(L.Logger.debug(ae,"call getDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),M.getDeviceMgr().getDevices(function(e){L.Logger.debug(ae,"call getDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");var t=e.hasdevice;N._myself.hasvideo=t.videoinput,N._myself.hasaudio=t.audioinput})),YS.isPlayback?(N._room_id=n.serial+"_"+De(),N._room_id&&-1===N._room_id.indexOf(":playback")&&(N._room_id+=":playback")):N._room_id=n.serial,L.Logger.info(ae,"room videowidth、videoheight、videoframerate:",n.videowidth,n.videoheight,n.videoframerate),M.setMaxVideoProfile(Number(n.videowidth),Number(n.videoheight),Number(n.videoframerate)),N._roomCheckRoomInfoString=e?"string"==typeof e?e:L.Utils.toJsonStringify(e):"",YS.isYsNative&&!N._handlerCallbackJson&&(N._handlerCallbackJson=!0,window.ysnative.postMessage({command:"initNative",localId:De().toString(),width:Number(n.videowidth),height:Number(n.videoheight),fps:Number(n.videoframerate),roomInfo:N._roomCheckRoomInfoString,webAddr:N._web_host.toString(),webPort:N._web_port.toString(),ys_multistream:YS.isMultiCamera}));var g=N._room_properties.chairmancontrol;N._mediaFileScale=!(!YS.isPlayback&&g&&"string"==typeof g)||1!==Number(g.substr(95,1)),N._mediaFileScale||L.Logger.info(ae,"media file not use scale,keep the original quality"),YS.isHiFi=!(!g||"string"!=typeof g)&&1===Number(g.substr(91,1)),YS.isHiFi&&L.Logger.info(ae,"enable hd audio"),n.hasOwnProperty("audiobitrate")&&(YS.maxaveragebitrateToHifi=1e3*Number(n.audiobitrate),YS.isHiFi&&L.Logger.info(ae,"enable hd audio, set audiobitrate:",YS.maxaveragebitrateToHifi)),L.Logger.info(ae,(YS.isPlayback?"initPlaybackInfo to checkroom finshed--\x3e":"")+"privateVariableJson._room_max_videocount:"+N._room_max_videocount,"my id:"+De(),"room id:"+N._room_id,"room properties chairmancontrol is:"+(N._room_properties.chairmancontrol?window.__YsSdkBuild__?L.Utils.encrypt(N._room_properties.chairmancontrol):N._room_properties.chairmancontrol:void 0))}else L.Logger.warning(ae,"checkroom failure code is "+r);L.Logger.info(ae,"checkroom finshed!"),t(r,o,e)}}function Ie(e,t,i,o){N._isConnected?P.socketSend(e,t,i,function(e,t){L.Utils.isFunction(o)&&o(e,t)}):L.Logger.warning(ae,"Trying to send a message over a disconnected Socket")}function Te(e,t,i){var o,r,n=gt(t);L.Logger.debug(ae,"onChangeMyPublishState "+n+" to "+e),o=e,r=t,YS.isMultiCamera?N._myself["publishstate:"+r]=o:N._myself.publishstate=o;var a=[];a.push(Ne(t,!0)),g&&a.push(Ne(t,!0,g)),e>YS.PUBLISH_STATE_NONE?(K(e,void 0,void 0,t),a.forEach(function(e){e&&void 0===U.localStreams[e.getID()]&&!e.isPublishing&&(e.setAttributes({toID:i||"__all"}),it(e,void 0,function(){gt(t)===YS.PUBLISH_STATE_NONE&&e&&!e.isUnpublishing&&U.localStreams[e.getID()]&&ot(e)}))})):a.forEach(function(e){e&&!e.isUnpublishing&&U.localStreams[e.getID()]&&ot(e,function(){gt(t)>YS.PUBLISH_STATE_NONE&&(e=Ne(t,!0))&&void 0===U.localStreams[e.getID()]&&!e.isPublishing&&it(e)})})}function Ee(e){if(L.Logger.debug(ae,"onChangeMyDisableVideoState "+N._myself.disablevideo+" to "+e),N._myself.disablevideo!=e)if(N._myself.disablevideo=e,YS.isMultiCamera){for(var t in N._myself)if(/publishstate:/g.test(t)){var i=Dt(t);N._myself[t]>YS.PUBLISH_STATE_NONE&&K(N._myself[t],void 0,void 0,i)}}else N._myself.publishstate>YS.PUBLISH_STATE_NONE&&K(N._myself.publishstate,void 0,void 0,void 0)}function Ae(e){if(L.Logger.debug(ae,"onChangeMyDisableAudioState "+N._myself.disableaudio+" to "+e),N._myself.disableaudio!=e)if(N._myself.disableaudio=e,YS.isMultiCamera){for(var t in N._myself)if(/publishstate:/g.test(t)){var i=Dt(t);N._myself[t]>YS.PUBLISH_STATE_NONE&&K(N._myself[t],void 0,void 0,i)}}else N._myself.publishstate>YS.PUBLISH_STATE_NONE&&K(N._myself.publishstate,void 0,void 0,void 0)}function ke(e){var t=!1;return e&&(t=e.getAttributes().type!==YS.STREAM_MEDIA&&e.publisherId()===De()),t}function Re(e,t,i){var o=void 0;if(t===YS.STREAM_MEDIA||t===YS.STREAM_SCREEN)for(var r in U.remoteStreams){if((a=U.remoteStreams[r]).extensionId===e+":"+t){o=a;break}}else if(e===De())if(t===YS.STREAM_VIDEO){var n=e;YS.isMultiCamera&&(n+=":"+i),o=N._createStreams[n]}else o=N._createStreams[e+":"+t];else for(var r in U.remoteStreams){var a=U.remoteStreams[r];if(t===YS.STREAM_VIDEO){n=e;if(i&&(n+=":"+i),a.extensionId===n&&e==a.publisherId()){o=a;break}}else if(a.extensionId===e+":"+t){o=a;break}}return o}function Ce(e){var t=[];for(var i in N._createStreams)Pe(i)&&Pe(i).getAttributes().type===e&&t.push(Pe(i));return t}function De(){return L.Utils.isNull(N._myself.id)?N._local_def_ext_id:N._myself.id}function Ne(e,t,i){return t&&(Ue(e)||Ye(e),i&&!Ue(e,i)&&Ye(e,i)),YS.isMultiCamera?i?N._createStreams[De()+":"+e+":yssmall"]:N._createStreams[De()+":"+e]:i?N._createStreams[De()+":yssmall"]:N._createStreams[De()]}function Ue(e,t){return!!Ne(e,!1,t)}function Ye(e,t){var i=!YS.isPlayback&&(N._roomJsonOptions.audio||!1),o=!YS.isPlayback&&(N._roomJsonOptions.video||!1),r={},n=void 0;if((n=YS.isMultiCamera&&N._videoStreamListAttrs[Rt(De(),YS.STREAM_VIDEO,e)]||N._videoStreamAttrs)&&"object"===qt(n))for(var a in n)r[a]=n[a];return YS.isMultiCamera?(t&&je("video",{video:o,audio:i,attributes:r,videoinputDeviceId:e,enableDualStream:t}),je("video",{video:o,audio:i,attributes:r,videoinputDeviceId:e,enableDualStream:t})):(t&&je("video",{video:o,audio:i,attributes:r,enableDualStream:t}),je("video",{video:o,audio:i,attributes:r,enableDualStream:t}))}function Pe(e){return N._createStreams[e]}function Me(e){var t=!1,i=N._createStreams[e];if(i&&i.publisherId()===De()&&i.getAttributes().type!==YS.STREAM_MEDIA)if(M.hasConnection(i.getID())||U.localStreams[i.getID()]||U.remoteStreams[i.getID()]||N._playVideoStreams[e]||N._playAudioStreams[Ct(i.publisherId(),i.getAttributes().type)])t=!1;else switch(i.getAttributes().type){case YS.STREAM_VIDEO:gt(i.videoinputDeviceId)===YS.PUBLISH_STATE_NONE&&(t=!0);break;default:i.needPublishToServer||(t=!0)}return t}function Oe(e){var t=N._createStreams[e];if(t){var i=N._playVideoStreams[e],o=N._playAudioStreams[Ct(t.publisherId(),t.getAttributes().type)];switch(t.getAttributes().type){case YS.STREAM_VIDEO:i&&U.unplayVideo(t.publisherId(),void 0,t.videoinputDeviceId),o&&U.unplayAudio(t.publisherId());break;case YS.STREAM_FILE:(i||o)&&U.unplayRemoteMediaFile(t.publisherId());break;case YS.STREAM_SCREEN:(i||o)&&U.unplayRemoteScreen(t.publisherId());break;default:i&&Fe(i),o&&Be(o)}if(delete t.report,t.destroy(),t.getAttributes().type===YS.STREAM_VIDEO){var r=!0,n=!0,a=Ce(YS.STREAM_VIDEO);if(a&&a.length)for(var s=0,c=a.length;s<c;s++)a[s]&&a[s].extensionId!==t.extensionId&&(a[s].videoinputDeviceId===t.videoinputDeviceId&&(r=!1),a[s].audioinputDeviceId===t.audioinputDeviceId&&(n=!1));r&&M.destroyVideoTrack(t.videoinputDeviceId),n&&M.destroyAudioTrack(t.audioinputDeviceId)}}N._createStreams[e]=void 0,delete N._createStreams[e]}function xe(e,t,i){i=i||{},t.playInfo=t.playInfo||{video:!1,audio:!1},t.playInfo.video=!YS.isOnlyAudioRoom,t.hasVideoPlayer()?e!==t.getVideoPlayerElementId()?(t.unplayVideo(),t.playVideo(e,i),N._playVideoStreams[t.extensionId]=t):t.updateVideoPlayerOptions(i):(t.playVideo(e,i),N._playVideoStreams[t.extensionId]=t),t.video&&(t.playInfo.video?(t.updateVideoPlayerOptions(i),t.showVideo()):t.hideVideo()),ke(t)||t.video&&E(t,!t.playInfo.video)}function Ve(e,t,i){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.audio=!0,e.hasAudioPlayer()?e.updateAudioPlayerOptions(t):(e.playAudio(t),N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)]=e),e.getAttributes().type!==YS.STREAM_VIDEO&&e.audio&&(e.playInfo.audio?e.setMute(!1):e.setMute(!0)),ke(e)||e.audio&&A(e,!e.playInfo.audio,i)}function Fe(e,t){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.video=!1,e.video&&(e.playInfo.video?e.showVideo():e.hideVideo()),ke(e)||e.video&&E(e,!e.playInfo.video),e.unplayVideo(t),delete N._playVideoStreams[e.extensionId],e.publisherId()===De()&&e.getAttributes().type!==YS.STREAM_MEDIA&&Me(e.extensionId)&&Oe(e.extensionId)}function Be(e,t,i){t=t||{},e.playInfo=e.playInfo||{video:!1,audio:!1},e.playInfo.audio=!1,e.getAttributes().type!==YS.STREAM_VIDEO&&e.audio&&(e.playInfo.audio?e.setMute(!1):e.setMute(!0)),ke(e)||e.audio&&A(e,!e.playInfo.audio,i),e.unplayAudio(t),t.notDelete?N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)]=null:delete N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)],e.publisherId()===De()&&e.getAttributes().type!==YS.STREAM_MEDIA&&Me(e.extensionId)&&Oe(e.extensionId)}function je(e,t){var i={getVideoTrack:Nt,getAudioTrack:Ut,getRegisterAudioVolumeListener:Yt},o={type:e,isWeb:(t=t||{}).isWeb};if(t.attributes&&"object"===qt(t.attributes))for(var r in t.attributes)"type"!==r&&(o[r]=t.attributes[r]);switch(i.audio=t.audio||!1,i.video=t.video||!1,i.data=!1,i.attributes=o,e){case YS.STREAM_VIDEO:i.screen=!1,i.media=!1,i.extensionId=De(),void 0!==t.videoinputDeviceId&&(i.extensionId+=":"+t.videoinputDeviceId),t.enableDualStream&&(i.extensionId=i.extensionId+":yssmall");break;case YS.STREAM_SCREEN:i.screen=!0,i.media=!1,i.extensionId=De()+":"+e;break;case YS.STREAM_FILE:i.screen=!1,i.media=!0,i.path=t.path,i.scale=L.Utils.isBoolean(t.scale)?t.scale:N._mediaFileScale,i.extensionId=De()+":"+e}var n=!1;YS.isYsNative&&(n=YS.isYsMacNative?e===YS.STREAM_SCREEN&&YS.isYsNative:YS.isYsNative);var a=YS.Stream(i,n);return e===YS.STREAM_VIDEO&&(void 0!==t.videoinputDeviceId?a.videoinputDeviceId=t.videoinputDeviceId:(a.videoinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),N._safariOnlySubscibe&&!YS.DeviceMgrImpl._isGetDevicesed&&(a.needChangevideoDeviceId=!0)),a.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),N._safariOnlySubscibe&&!YS.DeviceMgrImpl._isGetDevicesed&&(a.needChangeaudioDeviceId=!0)),N._createStreams[a.extensionId]=a}function Je(e,t){if(YS.isOnlyAudioRoom!==e){if(YS.isOnlyAudioRoom=e,YS.isOnlyAudioRoom)for(var i in U.remoteStreams){(d=U.remoteStreams[i])&&d.video&&(d.getAttributes().type===YS.STREAM_FILE&&d.publisherId()===De()?YS.isYsNative&&l.stopShareMediaFile():d.getAttributes().type===YS.STREAM_SCREEN&&d.publisherId()===De()?YS.isYsNative?l.stopShareScreen():U.stopShareScreen():d.getAttributes().type===YS.STREAM_MEDIA&&d.publisherId()===De()&&U.stopShareMedia())}for(var i in N._myself)if(!YS.isMultiCamera&&"publishstate"===i||YS.isMultiCamera&&/publishstate:/g.test(i)){var o=N._myself[i];if(o>YS.PUBLISH_STATE_NONE){var r=void 0;if(YS.isMultiCamera&&/publishstate:/g.test(i)&&(r=Dt(i)),YS.isOnlyAudioRoom)if(o!==YS.PUBLISH_STATE_AUDIOONLY){var n=void 0;if(o===YS.PUBLISH_STATE_VIDEOONLY||o===YS.PUBLISH_STATE_BOTH){var a={};YS.isMultiCamera&&(a.deviceId=r),n=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_SWITCHAUDIOROOM,info:a}})}YS.isMultiCamera?N._mainCameraDeviceId===r?U.changeUserPublish(De(),YS.PUBLISH_STATE_AUDIOONLY,r):U.changeUserPublish(De(),YS.PUBLISH_STATE_NONE,r):U.changeUserPublish(De(),YS.PUBLISH_STATE_AUDIOONLY,r),n&&U.dispatchEvent(n)}else YS.isMultiCamera&&N._mainCameraDeviceId!==r&&U.changeUserPublish(De(),YS.PUBLISH_STATE_NONE,r);else if(o!==YS.PUBLISH_STATE_BOTH){var s=void 0;if(o===YS.PUBLISH_STATE_AUDIOONLY||o===YS.PUBLISH_STATE_MUTEALL){a={};var c=!1;YS.isMultiCamera?N._mainCameraDeviceId===r&&(a.deviceId=r,c=!0):c=!0,c&&(s=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_PUBLISHVIDEO_BY_SWITCHAUDIOVIDEOROOM,info:a}}))}YS.isMultiCamera?N._mainCameraDeviceId===r?U.changeUserPublish(De(),YS.PUBLISH_STATE_BOTH,r):U.changeUserPublish(De(),YS.PUBLISH_STATE_NONE,r):U.changeUserPublish(De(),YS.PUBLISH_STATE_BOTH,r),s&&U.dispatchEvent(s)}else YS.isMultiCamera&&N._mainCameraDeviceId!==r&&U.changeUserPublish(De(),YS.PUBLISH_STATE_NONE,r)}}for(var i in N._playVideoStreams){var d=N._playVideoStreams[i];YS.isOnlyAudioRoom?d.hideVideo():d.showVideo()}var u=YS.RoomEvent({type:YS.EVENT_TYPE.roomAudioVideoStateSwitched,message:{fromId:t,onlyAudio:YS.isOnlyAudioRoom}});U.dispatchEvent(u)}}function He(e){"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e&&e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data));var s=e.fromID,c=e.data,d=function(e){for(var t=0;t<N._room_filelist.length;t++)if(N._room_filelist[t].fileid==e)return{file:N._room_filelist[t],index:t}}(c.filedata.fileid);if(c.isDel){if(d&&d.file){N._room_filelist.splice(d.index,1);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomDeleteFile,message:{fileid:d.file.fileid,fileinfo:d.file,fromID:s}});U.dispatchEvent(t)}}else{var i=function(e){var t=c.filedata;t.fileid=Number(t.fileid),t.pagenum=Number(t.pagenum),t.filecategory=void 0!==t.filecategory?Number(t.filecategory):0,t.isContentDocument=void 0!==t.isContentDocument&&null!==t.isContentDocument&&"number"==typeof Number(t.isContentDocument)?Number(t.isContentDocument):0,t.dynamicppt=c.isDynamicPPT?1:0,t.uploaduserid=s,t.uploadusername=e?e.nickname:"",t.companyid=N._room_properties.companyid,t.downloadpath=t.swfpath,t.filetype=t.filetype&&"string"==typeof t.filetype?t.filetype.toLocaleLowerCase():t.filetype,t.fileprop=c.isDynamicPPT?2:c.isH5Document?3:0,t.type=0;var i=t;if(d){var o={},r=!1;for(var n in i)d.file[n]!==i[n]&&(d.file[n]=i[n],o[n]=i[n],r=!0);if(r){a=YS.RoomEvent({type:YS.EVENT_TYPE.roomUpdateFile,message:{fileid:i.fileid,updateFileinfo:o,fromID:s}});U.dispatchEvent(a)}}else{N._room_filelist.push(i);var a=YS.RoomEvent({type:YS.EVENT_TYPE.roomAddFile,message:{fileid:i.fileid,fromID:s}});U.dispatchEvent(a)}};U.getRoomUser(s,function(e){i(e)},function(){i()})}}function We(e,t){if(e.getAttributes().type===YS.STREAM_VIDEO){e.publisherId()===De()&&Pe(e.extensionId)&&(e=Pe(e.extensionId));var i=N._users[e.publisherId()];if(i){void 0===ve(e.publisherId())&&fe(e.publisherId(),!1),void 0===ge(e.extensionId)&&pe(e.extensionId,!1),void 0===me(e.extensionId)&&le(e.extensionId,!1);var o=ft(e).replace(/\:yssmall/g,""),r=mt(i,o),n=r===YS.PUBLISH_STATE_AUDIOONLY||r===YS.PUBLISH_STATE_BOTH,a=r===YS.PUBLISH_STATE_VIDEOONLY||r===YS.PUBLISH_STATE_BOTH;if(e.audio&&(ge(e.extensionId.replace(/\:yssmall/g,""))!==n||t)){var s={userId:e.publisherId(),published:n,type:e.getAttributes().type,publishstate:r,attributes:e.getAttributes()},c=ve(e.publisherId());pe(e.extensionId,s.published);var d=new RegExp(e.publisherId()+":","g");if(void 0!==i.ys_maincamera&&d.test(e.extensionId))if(o!==i.ys_maincamera)N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)]&&Be(e,{notDelete:!0});else if(fe(e.publisherId(),s.published),n===c)s.published&&null===N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)]&&Ve(e);else{L.Logger.info(ae,"roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:s}));var u=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:s});U.dispatchEvent(u)}else{fe(e.publisherId(),s.published),L.Logger.info(ae,"roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:s}));u=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:s});U.dispatchEvent(u)}}if(e.video&&(me(e.extensionId.replace(/\:yssmall/g,""))!==a||t)){s={userId:e.publisherId(),published:a,type:e.getAttributes().type,publishstate:r,attributes:e.getAttributes()};(d=new RegExp(e.publisherId()+":","g")).test(e.extensionId)&&(s.deviceId=o),le(e.extensionId,s.published),L.Logger.info(ae,"roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserVideoStateChanged,message:s}));var l=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserVideoStateChanged,message:s});U.dispatchEvent(l)}he(e.extensionId),Se(e.publisherId())}}}function qe(e){if(e.getAttributes().type===YS.STREAM_VIDEO){e.publisherId()===De()&&Pe(e.extensionId)&&(e=Pe(e.extensionId));var t=N._users[e.publisherId()];if(t){void 0===ve(e.publisherId())&&fe(e.publisherId(),!1),void 0===ge(e.extensionId)&&pe(e.extensionId,!1),void 0===me(e.extensionId)&&le(e.extensionId,!1);var i=ft(e),o=mt(t,i);if(e.audio&&ge(e.extensionId)){var r={userId:e.publisherId(),published:!1,type:e.getAttributes().type,publishstate:o,attributes:e.getAttributes()},n=ve(e.publisherId());pe(e.extensionId,r.published);var a=new RegExp(e.publisherId()+":","g");if(void 0!==t.ys_maincamera&&a.test(e.extensionId)){if(i!==t.ys_maincamera)N._playAudioStreams[Ct(e.publisherId(),e.getAttributes().type)]&&Be(e,{notDelete:!0});else if(fe(e.publisherId(),!1),!1!==n){L.Logger.info(ae,"roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:r}));var s=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:r});U.dispatchEvent(s)}}else{fe(e.publisherId(),!1),L.Logger.info(ae,"roomUserAudioStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:r}));s=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserAudioStateChanged,message:r});U.dispatchEvent(s)}}if(e.video&&me(e.extensionId)){r={userId:e.publisherId(),published:!1,type:e.getAttributes().type,publishstate:o,attributes:e.getAttributes()};(a=new RegExp(e.publisherId()+":","g")).test(e.extensionId)&&(r.deviceId=i),le(e.extensionId,r.published),L.Logger.info(ae,"roomUserVideoStateChanged info:"+L.Utils.toJsonStringify({type:YS.EVENT_TYPE.roomUserVideoStateChanged,message:r}));var c=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserVideoStateChanged,message:r});U.dispatchEvent(c)}he(e.extensionId),Se(e.publisherId())}}}function Ge(e,t){var i="room-user"+e.getAttributes().type+"state-changed",o=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.getAttributes()));o.video=e.hasVideo(),o.audio=e.hasAudio();var r={userId:e.publisherId(),published:t,type:e.getAttributes().type,attributes:o};t?N._createStreams[e.extensionId]=e:delete N._createStreams[e.extensionId],L.Logger.info(ae,i+" info:"+L.Utils.toJsonStringify({type:i,message:r}));var n=YS.RoomEvent({type:i,message:r});U.dispatchEvent(n)}function ze(e,t){var i="room-user"+e.getAttributes().type+"attributes-update",o=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.getAttributes()));o.video=e.hasVideo(),o.audio=e.hasAudio();var r={userId:e.publisherId(),type:e.getAttributes().type,attributes:o,updateAttributes:t};if(e.getAttributes().type===YS.STREAM_VIDEO&&new RegExp(e.publisherId()+":","g").test(e.extensionId)){var n=ft(e);r.deviceId=n}var a=YS.RoomEvent({type:i,message:r});U.dispatchEvent(a)}function Qe(){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _sendDeviceInfoToPhp cannot be executed!");else{var e=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/LogData/equipment?ts="+(new Date).getTime(),t=L.Utils.getBrowserInfo(),i={serial:N._room_properties.serial,companyid:N._room_properties.companyid,peerid:De(),peername:N._myself.nickname,peerrole:N._myself.role,ip:N._myIp,country:N._ipinfo.country,region:N._ipinfo.city,city:N._ipinfo.area,osversion:L.Utils.detectOS(),devicemodel:YS.isYsNative&&(YS.clientfriendlyversion||YS.clientversion)?YS.clientfriendlyversion||YS.clientversion:t.info.browserName+" "+t.info.browserVersion,cpuarchitecture:t.cpuarchitecture||"x86",sdkversion:YS.SDKVERSIONS,sdkdate:YS.SDKVERSIONSTIME,connecttime:x,reconnectcount:F,isp:N._ipinfo.perators,redirectcount:V,routename:N._myself.servername,browsername:L.Utils.getBrowserName(),docServer:N._useDocServerAddr||""},o=YS.DeviceMgrImpl.getUseDevice();o&&(i.audioinput=o.audioinput?o.audioinput.label:"",i.videoinput=o.videoinput?o.videoinput.label:"",i.audiooutput=o.audiooutput?o.audiooutput.label:""),L.Utils.sdkAjax({url:e,dataType:"json",type:"POST",anync:!0,data:i,success:function(e){L.Logger.debug(ae,"equipment resp = ",L.Utils.toJsonStringify(e))},error:function(e,t,i){L.Logger.error(ae,"equipment fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}}function Ke(e){if(N._isConnected)L.Logger.warning(ae,"Room already connected!");else if(void 0!==N._web_host&&void 0!==N._web_port)if(N._room_properties){if(U.needReconnectSocket=!0,YS.isMultiCamera)for(var t in N._myself)/publishstate:/g.test(t)&&N._myself[t]!==YS.PUBLISH_STATE_NONE&&(N._myself[t]=YS.PUBLISH_STATE_NONE);else N._myself.publishstate!==YS.PUBLISH_STATE_NONE&&(N._myself.publishstate=YS.PUBLISH_STATE_NONE);if(N._userJsonOptions&&N._userJsonOptions.userProperties&&"object"===qt(N._userJsonOptions.userProperties))for(var t in N._userJsonOptions.userProperties)void 0===N._myself[t]&&(N._myself[t]=N._userJsonOptions.userProperties[t]);N._roomJsonOptions&&N._roomJsonOptions.group&&(Array.isArray(N._roomJsonOptions.group)?N._myself.group=N._roomJsonOptions.group:L.Logger.warning(ae,"joinroomOptions.group must is a array!")),L.Logger.info(ae,"joinroom:my device info  [hasvideo , hasaudio] is ["+N._myself.hasvideo+" ,"+N._myself.hasaudio+"]"),L.Logger.debug(ae,"joinroom:my room user",N._myself),N._users={},oe(e=e||N._web_host,N._web_port,function(e,t){if(0!=e){L.Logger.error(ae,"step2GetConfig failure --\x3e result and responseText:",e,t);var i=YS.RoomEvent({type:YS.EVENT_TYPE.roomError,message:{source:"getconfig",error:e,errorCode:e}});if(U.dispatchEvent(i),U.eventLog({type:"FAIL_ENTER",data:e}),Q.getConfigCount++,5<=Q.getConfigCount){var o=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"getconfig",error:e,errorCode:e}},{httpTime:Date.now()-j,socketTime:0,reconnectCount:F,isReconnect:z&&0<F});U.dispatchEvent(o)}Jt(J)}else re(N._web_host,N._web_port,function(e,t){if(L.Logger.debug(ae,"step2GetFileList result = "+e+" , message:"+L.Utils.toJsonStringify(t)),0===e){if(N._room_filelist=[],t&&Array.isArray(t)&&t.length)for(var i=0,o=t.length;i<o;i++){var r=t[i];r&&(r.fileid=Number(r.fileid),r.pagenum=Number(r.pagenum),r.dynamicppt=Number(r.dynamicppt),r.filecategory=Number(r.filecategory),r.fileprop=Number(r.fileprop),r.type=Number(r.type),r.filetype=r.filetype&&"string"==typeof r.filetype?r.filetype.toLocaleLowerCase():r.filetype,r.isContentDocument=void 0!==r.isContentDocument&&null!==r.isContentDocument&&"number"==typeof Number(r.isContentDocument)?Number(r.isContentDocument):0,N._room_filelist.push(r))}var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomFiles,message:N._room_filelist});U.dispatchEvent(n)}else L.Logger.info(ae,"step2GetFileList code is "+e);if(L.Utils.isFunction(N._roomJsonOptions.awitConnectRoomCallback)){N._roomJsonOptions.awitConnectRoomCallback(function(){ne()}),delete N._roomJsonOptions.awitConnectRoomCallback}else ne()})},{notSpeedNetwordk:!!N._roomJsonOptions.serverName,noGetEntryroom:!0})}else L.Logger.warning(ae,"No checkroom cannot joinroom , room_properties is "+N._room_properties);else L.Logger.warning(ae,"web_host or web_port or myself is undefined , web_host is "+N._web_host+" , web_port is "+N._web_port+",myself is "+N._myself)}function Xe(i){YS.isPlayback?Ke(i):N._roomJsonOptions&&"object"===qt(N._roomJsonOptions)&&void 0!==N._roomJsonOptions.video&&void 0!==N._roomJsonOptions.audio?void 0===N._myself.hasvideo||void 0===N._myself.hasaudio?N._safariOnlySubscibe?(L.Logger.info(ae,"_joinroom_step1:safari is only subscibe."),Ke(i)):(L.Logger.debug(ae,"call getDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),M.getDeviceMgr().getDevices(function(e){L.Logger.debug(ae,"call getDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");var t=e.hasdevice;N._myself.hasvideo=t.videoinput,N._myself.hasaudio=t.audioinput,Ke(i)})):Ke(i):void 0===N._myself.hasvideo||void 0===N._myself.hasaudio?N._safariOnlySubscibe?(L.Logger.info(ae,"_joinroom_step1:safari is only subscibe!"),Ke(i)):(L.Logger.debug(ae,"call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),M.getDeviceMgr().getDevices(function(e){L.Logger.debug(ae,"call getDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");var t=e.hasdevice;N._myself.hasvideo=t.videoinput,N._myself.hasaudio=t.audioinput,Ke(i)})):Ke(i)}function Ze(e,t,i,o,r,n,a){if(!e)return L.Logger.error(ae," "+n+" method got invalid userId!"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));if(!t)return L.Logger.error(ae,"  "+n+" method got invalid elementId!"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));if(i&&"object"!==qt(i))return L.Logger.error(ae,"  "+n+" method options is not json!"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));(N._playVideoStreams[Rt(e,r,a)]||N._playAudioStreams[Ct(e,r)])&&$e(e,void 0,r,"un"+n,a);var s=Re(e,r,a);if(!s)return L.Logger.debug(ae,"  "+n+": user has not stream, user id is "+e),void(L.Utils.isFunction(o)&&o("YS_NO_THIS_STREAM"));s.video&&xe(t,s,i),s.audio&&Ve(s,i)}function $e(e,t,i,o,r){if(!e)return L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," "+o+" method got invalid userId!");var n=N._playVideoStreams[Rt(e,i,r)];n||L.Logger.debug(ae," "+o+": user has not video stream, user id is "+e);var a=N._playAudioStreams[Ct(e,i)];a||L.Logger.debug(ae," "+o+": user has not audio stream, user id is "+e),n||a?(n&&Fe(n),a&&Be(a)):L.Utils.isFunction(t)&&t("YS_NO_THIS_STREAM")}function et(e){if(N._roomMode===window.YS.ROOM_MODE.BIG_ROOM&&e.getAttributes().type===YS.STREAM_VIDEO&&e.publisherId()!==De()&&N._users[e.publisherId()]){var t=N._users[e.publisherId()];if(t.role!==window.YS.ROOM_ROLE.TEACHER&&t.role!==window.YS.ROOM_ROLE.ASSISTANT)for(var i in t)if(("publishstate"===i||/publishstate:/g.test(i))&&t[i]===YS.PUBLISH_STATE_NONE){delete N._users[e.publisherId()];break}}}function tt(){if(N._roomMode===window.YS.ROOM_MODE.BIG_ROOM)for(var e in N._users){var t=N._users[e];if(e!==De()&&t.role!==window.YS.ROOM_ROLE.TEACHER&&t.role!==window.YS.ROOM_ROLE.ASSISTANT)for(var i in t)if(("publishstate"===i||/publishstate:/g.test(i))&&t[i]===YS.PUBLISH_STATE_NONE){delete N._users[e];break}}}function it(s,a,c){if(N._isConnected)if(s.isPublishing)L.Utils.isFunction(c)&&c(void 0,"publishing");else if(a=a||{},L.Logger.info(ae,"calling publish , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),s&&void 0===U.localStreams[s.getID()]){if(a.maxVideoBW=a.maxVideoBW||D.defaultVideoBW,a.maxVideoBW>D.maxVideoBW&&(a.maxVideoBW=D.maxVideoBW),s.getAttributes().type===YS.STREAM_SCREEN)a.maxVideoBW=D.maxScreenBW,a.videowidth&&a.videoheight&&s.updateLocalAttributes({videowidth:a.videowidth,videoheight:a.videoheight});else if(s.getAttributes().type===YS.STREAM_FILE){var e=s.getAttributes().width,t=s.getAttributes().height;if(e&&t){var i=640,o=e,r=t;s.scale||(i=1920<Math.max(e,t)?1920:e),t<=e?i<e&&(r=(o=i)*(t/e)):i<t&&(o=(r=i)*(e/t)),o=Math.floor(o),r=Math.floor(r),s.updateLocalAttributes({width:o,height:r,videowidth:o,videoheight:r}),a.maxVideoBW=L.Utils.getMaxBPS(o,30),s.scale&&a.maxVideoBW>D.maxLocalFileMediaBW&&(a.maxVideoBW=D.maxLocalFileMediaBW)}else a.maxVideoBW=D.maxLocalFileMediaBW}else if(s.getAttributes().type===YS.STREAM_VIDEO){var n="";s&&s.extensionId&&s.extensionId.split&&(n=s.extensionId.split(":")[1]);var d=M.getUseVideoProfile(n),u=M.getMaxVideoProfile(n),l=L.Utils.getMaxBPS(d.width,d.fps),p=L.Utils.getMaxBPS(u.width,u.fps);l<p&&(s.needSetVideoBW=l),a.maxVideoBW=p}void 0===a.minVideoBW&&(a.minVideoBW=0),a.minVideoBW>D.maxVideoBW&&(a.minVideoBW=D.maxVideoBW),s.publishFailCount=0,s.isPublishing=!0;var f=function(n){if(s.getAttributes().type===YS.STREAM_VIDEO&&gt(s.videoinputDeviceId)===YS.PUBLISH_STATE_NONE)return M.closeConnection(s.getID()),U.localStreams[s.getID()]&&ot(s),$(s),void(L.Utils.isFunction(c)&&c(void 0,"not need publish!"));Ie("publish",{state:"ms",data:s.hasData(),audio:s.hasAudio(),video:s.hasVideo(),screen:s.hasScreen(),minVideoBW:a.minVideoBW,attributes:s.getAttributes(),extensionId:s.extensionId,createOffer:a.createOffer,metadata:a.metadata,scheme:a.scheme,fec:YS.isYsNative&&20190415<YS.PROXYVERSION},void 0,function(e,t){if(0!==e)return s.isPublishing=!1,s.isUnpublishing=!1,s.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_PUB",streamid:s.getID(),data:e}),L.Logger.warning(ae,"Error when publishing the stream: ",e,t),L.Logger.info(ae,"stream-publish-fail , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),2===e?($(s),U.changeUserPublish(s.publisherId(),YS.PUBLISH_STATE_NONE,s.videoinputDeviceId),Ot(s,window.YS.ERROR_NOTICE.ERR_PUBLISH_ROOMMAXVIDEOLIMITED,"publish ack failed")):(C(s,"publish ack failed"),Ot(s,window.YS.ERROR_NOTICE.ERR_PUBLISH_FAILED,"publish ack failed")),void(L.Utils.isFunction(c)&&c(void 0,e));L.Logger.debug(ae,"Stream assigned an Id, starting the publish process , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),s.changeID(t),s.setAttributes=function(e){var t,i;i=e,(t=s)&&"object"===qt(i)&&(U.remoteStreams[t.getID()]?(t.local&&t.updateLocalAttributes(i),P.sendMessageSocket("updateStreamAttributes",{id:t.getID(),attrs:i})):L.Logger.warning(ae,"You can not update attributes to server, because the stream does not exist on the server."))};function i(e,t){Ie("signaling_message",{streamId:e,msg:t=_e(t)})}var o={video:(U.localStreams[t]=s).hasVideo(),maxVideoBW:a.maxVideoBW},r={audio:s.hasAudio(),maxAudioBW:a.maxAudioBW};M.createUpConnection(s.getID(),{mediaStream:n,useNative:s.isYsNative,extraData:{video:s.hasVideo(),audio:s.hasAudio(),screen:s.hasScreen(),media:s.hasMedia(),setStreamMethod:v,extensionId:s.extensionId,attributes:s.getAttributes(),isMix:N._isMix}}),M.bindIceCandidate(s.getID(),function(e,t){L.Logger.debug(ae,"Sending ice info(connection_id is "+e+"):",t),i(e,t)}),M.bindOfferGenerated(s.getID(),function(e,t){t.sdp=L.Utils.setMaxBWToSdp(t.sdp,o,r),L.Logger.debug(ae,"Sending sdp info(connection_id is "+e+"):",t),i(e,t)}),M.bindIceConnectionStateChange(s.getID(),function(e,t){if(L.Logger.info(ae,"publish ice state:"+t+" , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),"disconnected"===t&&N._isConnected&&s){L.Logger.warning(ae,"Publishing Stream ",s.getID()," has disconnected after successful ICE checks , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes()));var i=s.getID();q[s.extensionId]?q[s.extensionId].failCount++:q[s.extensionId]={peerID:s.extensionId,streamID:i,failCount:1};R(s,t,"publish")}}),M.createOffer(s.getID()),L.Utils.isFunction(c)&&c(!0,t)})};switch(s.getAttributes().type){case YS.STREAM_VIDEO:Wt(De(),function(e){s.publisherId()===De()&&s.needChangevideoDeviceId&&(s.videoinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),delete s.needChangevideoDeviceId),s.publisherId()===De()&&s.needChangeaudioDeviceId&&(s.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),delete s.needChangevideoDeviceId);var t={},i={};i.hasvideo=N._myself.hasvideo,i.hasaudio=N._myself.hasaudio;var o=!1;N._myself.hasvideo!==!!YS.deviceInfoMap.videoinput.length&&(t.hasvideo=!!YS.deviceInfoMap.videoinput.length,N._myself.hasvideo=t.hasvideo,o=!0),N._myself.hasaudio!==!!YS.deviceInfoMap.audioinput.length&&(t.hasaudio=!!YS.deviceInfoMap.audioinput.length,N._myself.hasaudio=t.hasaudio,o=!0),o&&(L.Logger.info(ae,"publish my av,change my has device info:my old device info  [hasvideo , hasaudio] is ["+i.hasvideo+" ,"+i.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(t)),N._isConnected&&U.changeUserProperty(De(),"__all",t));var r="yssmall"===wt(s.extensionId,2);M.getDeviceMediaStream(s.videoinputDeviceId,s.audioinputDeviceId,function(e,t,i){var o=gt(s.videoinputDeviceId);if(o>YS.PUBLISH_STATE_NONE){if(t||i||L.Logger.info(ae,"publish video track and audio track all ready ."),t&&L.Logger.info(ae,"publish video track is fail, fail info:",L.Utils.toJsonStringify(t)),i&&L.Logger.info(ae,"publish audio track is fail, fail info:",L.Utils.toJsonStringify(i)),t&&(o===YS.PUBLISH_STATE_VIDEOONLY||o===YS.PUBLISH_STATE_BOTH)){var r={};YS.isMultiCamera&&(r.deviceId=s.videoinputDeviceId);var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:r}});U.dispatchEvent(n)}if(i&&(o===YS.PUBLISH_STATE_AUDIOONLY||o===YS.PUBLISH_STATE_BOTH)){var a=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:{}}});U.dispatchEvent(a)}f(e)}Me(s.extensionId)&&Oe(s.extensionId)},function(e,t){e&&L.Logger.info(ae,"publish device stream is not success, video track is fail, fail info:",L.Utils.toJsonStringify(e)),t&&L.Logger.info(ae,"publish device stream is not success, audio track is fail, fail info:",L.Utils.toJsonStringify(t));var i=gt(s.videoinputDeviceId);if(i>YS.PUBLISH_STATE_NONE){var o=void 0;if(i===YS.PUBLISH_STATE_VIDEOONLY||i===YS.PUBLISH_STATE_BOTH){var r={};YS.isMultiCamera&&(r.deviceId=s.videoinputDeviceId),o=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHVIDEO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:r}})}var n=void 0;i!==YS.PUBLISH_STATE_AUDIOONLY&&i!==YS.PUBLISH_STATE_BOTH||(n=YS.RoomEvent({type:YS.EVENT_TYPE.roomWarnNotice,message:{code:window.YS.WARNING_NOTICE.WAR_UNPUBLISHAUDIO_BY_GET_DEVICE_MEDIASTREAM_FAILURE,info:{}}})),o&&U.dispatchEvent(o),n&&U.dispatchEvent(n)}else ot(s);Me(s.extensionId)&&Oe(s.extensionId),L.Utils.isFunction(c)&&c(void 0,"publish device stream not success")},r)});break;case YS.STREAM_SCREEN:f(s.mediaStream);break;default:f(void 0)}}else L.Logger.info(ae,"Trying to publish invalid stream , stream id:"+s.getID()+" , extensionId is "+s.extensionId+", attrs is "+L.Utils.toJsonStringify(s.getAttributes())),s.isPublishing=!1,L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid stream")}function ot(i,o,e){if(e=e||{},i.isUnpublishing)L.Utils.isFunction(o)&&o(void 0,"unpublishing");else if(e=e||{},L.Logger.info(ae,"calling unpublish , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),i&&U.localStreams[i.getID()]){i.isUnpublishing=!0;var t=void 0;e&&e.socketop&&(t=e.socketop),P.sendMessageSocket("unpublish",i.getID(),function(e,t){if(i.isUnpublishing=!1,i.isPublishing=!1,0!==e)return L.Logger.warning(ae,"Error unpublishing stream, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error info:",t),L.Logger.info(ae,"stream-unpublish-fail , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),void(L.Utils.isFunction(o)&&o(void 0,t));L.Logger.debug(ae,"Stream unpublished  , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),M.closeConnection(i.getID()),delete i.report,delete U.localStreams[i.getID()],i.changeID("local"),i.setAttributes=function(e){i.updateLocalAttributes(e)},Me(i.extensionId)&&Oe(i.extensionId),L.Utils.isFunction(o)&&o(!0)},t)}else{var r="Cannot unpublish, stream does not exist or is not local";L.Logger.warning(ae,"unpublish warning:",r),L.Utils.isFunction(o)&&o(void 0,r)}}function rt(n,a,s){if(a=a||{},U.remoteStreams[n.getID()]){if(n.hasVideo()||n.hasScreen()||(a.video=!1),n.hasAudio()||(a.audio=!1),a.maxVideoBW=a.maxVideoBW||D.defaultVideoBW,a.maxVideoBW>D.maxVideoBW&&(a.maxVideoBW=D.maxVideoBW),n.getAttributes().type===YS.STREAM_SCREEN)a.maxVideoBW=D.maxScreenBW;else if(n.getAttributes().type===YS.STREAM_FILE){var e=n.getAttributes().width;a.maxVideoBW=e?L.Utils.getMaxBPS(e,30):D.maxLocalFileMediaBW}L.Logger.info(ae,"Subscribing to : "+n.getID()+" , extensionId : "+n.extensionId),Ie("subscribe",{streamId:n.getID(),audio:a.audio,video:a.video,data:a.data,browser:L.Utils.getBrowser(),createOffer:a.createOffer,metadata:a.metadata,slideShowMode:a.slideShowMode},void 0,function(e,t){if(0!==e)return L.Logger.info(ae,"stream-subscribe-fail , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", error is "+L.Utils.toJsonStringify(t)),xt(n,window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"subscribe ack failed"),n.getAttributes().type===YS.STREAM_VIDEO&&U.eventLog({type:"FAIL_SUB",streamid:n.getID(),data:e}),X(n,"subscribe ack failed"),void(L.Utils.isFunction(s)&&s(void 0,t));n.incremental=0,n.subscribeFailCount=0,L.Logger.debug(ae,"Subscriber added");var i={video:n.hasVideo(),maxVideoBW:a.maxVideoBW},o={audio:n.hasAudio(),maxAudioBW:a.maxAudioBW};M.createDownConnection(n.getID(),{useNative:YS.subscribe_from_native,extraData:{video:n.hasVideo(),audio:n.hasAudio(),screen:n.hasScreen(),media:n.hasMedia(),extensionId:n.extensionId}});function r(e,t){Ie("signaling_message",{streamId:e,msg:t=_e(t),browser:L.Utils.getBrowser()})}M.bindIceCandidate(n.getID(),function(e,t){L.Logger.debug(ae,"Sending ice info(connection_id is "+e+"):",t),r(e,t)}),M.bindOfferGenerated(n.getID(),function(e,t){t.sdp=L.Utils.setMaxBWToSdp(t.sdp,i,o),L.Logger.debug(ae,"Sending sdp info(connection_id is "+e+"):",t),r(e,t)}),M.bindAddStream(n.getID(),function(e,t){U.remoteStreams[e]?L.Logger.debug(ae,"Stream subscribed:add stream",e):L.Logger.info(ae,"stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", attrs is "+L.Utils.toJsonStringify(n.getAttributes()))}),M.bindIceConnectionStateChange(n.getID(),function(e,t){if(L.Logger.info(ae,"subscribe ice state:"+t+" , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", attrs is "+L.Utils.toJsonStringify(n.getAttributes())),"disconnected"===t&&N._isConnected&&n){L.Logger.warning(ae,"Subscribing stream ",n.getID()," has disconnected after successful ICE checks , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", attrs is "+L.Utils.toJsonStringify(n.getAttributes()));var i=n.getID();q[n.extensionId]?q[n.extensionId].failCount++:q[n.extensionId]={peerID:n.extensionId,streamID:i,failCount:1};R(n,t,"subscribe")}if(("completed"===t||"connected"===t)&&N._isConnected&&n){i=n.getID();n.getAttributes().type===YS.STREAM_VIDEO&&n.hasVideoPlayer()&&!n.hasVideoTrack()&&M.getConnectionVideoTrack(e)&&(L.Logger.info(ae," retry addVideoTrack stream ",n.getID()),n.addVideoTrack(M.getConnectionVideoTrack(e)))}}),M.createOffer(n.getID(),void 0,void 0,a),L.Utils.isFunction(s)&&s(!0)})}else{L.Logger.info(ae,"Cannot subscribe to invalid stream , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", attrs is "+L.Utils.toJsonStringify(n.getAttributes())),L.Utils.isFunction(s)&&s(void 0,"subscribe invalid stream")}}function nt(i,o,e){if(e=e||{},U.remoteStreams[i.getID()]){var t=void 0;e&&e.socketop&&(t=e.socketop),P.sendMessageSocket("unsubscribe",i.getID(),function(e,t){if(0!==e)return L.Logger.error(ae,"Error unsubscribe stream, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Logger.info(ae,"stream-unsubscribe-fail , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),void(L.Utils.isFunction(o)&&o(void 0,t));i.subscribed=!1,M.closeConnection(i.getID()),L.Utils.isFunction(o)&&o(!0)},t)}else{L.Logger.info(ae,"Cannot unsubscribe to invalid stream , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(o)&&o(void 0,"unsubscribe invalid stream")}}function at(o,r,n,a,s,c){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _checkroom cannot be executed!");else{var e={};if("string"==typeof n)for(var t=n.split("&"),i=0;i<t.length;i++){var d=t[i].split("=");e[d[0]]=d[1]}else e=n;YS.isPlayback&&(e.playback=!0),null!=s&&""+s&&(e.userid=""+s),YS.isYsNative?e.clientType=4:e.clientType=1;var u={};N._roomJsonOptions.serverName&&(u.restrict=N._roomJsonOptions.serverName),L.Logger.debug(ae,"Going to checkroom",L.Utils.toJsonStringify(e)),L.Logger.info(ae,"call checkroom start!"),U.eventLog({type:"EVENT_JOIN"}),te(N._web_host,N._web_port,e,function(e){L.Logger.debug(ae,"checkroom resp = ",L.Utils.toJsonStringify(e)),we(e,a,s)},function(e,t,i){L.Logger.error(ae,"checkroom fail[ XHR , textStatus , errorThrown ]:",e,t,i),N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method checkroom cannot be executed!"):(N._webReconnectNumList.hasOwnProperty("checkroomReconnectNum")||(N._webReconnectNumList.checkroomReconnectNum=0),N._webReconnectNumList.checkroomReconnectNum=++N._webReconnectNumList.checkroomReconnectNum%5,clearTimeout(N._webReconnectNumList.checkroomReconnectTimer),N._webReconnectNumList.checkroomReconnectTimer=setTimeout(function(){N._webReconnectNumList.checkroomReconnectTimer=void 0,N._isLeaveRoom?L.Logger.info(ae,"The room is over. Method checkroom cannot be executed!"):(L.Logger.info(ae,"Rerequest checkroom web interface!"),at(o,r,n,a,s,c))},1e3*N._webReconnectNumList.checkroomReconnectNum))},u)}}function st(e,t,i){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _sendNetworkequipment cannot be executed!");else{N._web_protocol,N._web_host,N._web_port,(new Date).getTime();var o=e[0],r={};try{o&&(r={cpuOccupancy:o.cpuOccupancy,video:{currentDelay:(o.video?o.video.currentDelay:0)||0,videoWidth:(o.video?o.video.frameWidth:0)||0,videoHeight:(o.video?o.video.frameHeight:0)||0,frameRate:(o.video?o.video.frameRate:0)||0,videoFps:i},audio:{currentDelay:(o.audio?o.audio.currentDelay:0)||0}})}catch(e){L.Logger.error(ae,"setStreamStats error info:"+e+"!")}var n={streamId:t.getID(),peerId:t.extensionId.split(":")[0],stats:r};t.extensionId.split(":")[0]===N._myself.id&&P.socketSend("setStreamStats",n)}}function ct(i,o,r,n){if("edge"!==L.Utils.getBrowserInfo(!0).info.browserName){if(ke(i)&&(i=Pe(i.extensionId)),!i)return L.Logger.warning(ae,"stream is not exist!"),void(L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"));if(M.hasConnection(i.getID())){if(i.isCompleted)if(M.hasNativeConnection(i.getID())){var e=N._nativeStatsDelivered[i.extensionId];e?(L.Utils.isFunction(o)&&o(e),lt(i,e)):L.Utils.isFunction(r)&&r("YS_ERR_NOT_DATA")}else try{M.getStats(i.getID(),function(e){if(!e)return L.Logger.warning(ae,"pc.getStats -> getStats not exist!"),void(L.Utils.isFunction(r)&&r("YS_ERR_UNKNOWN"));var t=be(i,e);if(t)L.Utils.isFunction(o)&&o(t),lt(i,t);else{if(n)return L.Logger.warning(ae,"pc.getStats ->not get data!"),void(L.Utils.isFunction(r)&&r("YS_ERR_UNKNOWN"));setTimeout(function(){i&&M.hasConnection(i.getID())&&ct(i,o,r,!0)},300)}},function(e){L.Logger.warning(ae,"pc.getStats fail,fail info:",e),L.Utils.isFunction(r)&&r(e)})}catch(e){L.Logger.error(ae,"pc.getStats error:",e),L.Utils.isFunction(r)&&r("YS_ERR_UNKNOWN")}}else L.Utils.isFunction(r)&&r("YS_ERR_NOT_PEERCONNECTION")}}function dt(e){var t=void 0;for(var i in N._createStreams)e===i&&(t=Pe(i));if(!t)for(var i in U.remoteStreams)e===i&&(t=U.remoteStreams[i]);return t}function ut(e,t,i){if(e&&dt(e)&&"object"===qt(t))if(N._nativeStatsDelivered[e]=N._nativeStatsDelivered[e]||{},N._nativeStatsDelivered[e].video=N._nativeStatsDelivered[e].video||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,frameRate:0,frameWidth:0,frameHeight:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},N._nativeStatsDelivered[e].audio=N._nativeStatsDelivered[e].audio||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,jitter:0,timestamp:0,netquality:L.Utils.getNetLevel(0,0)},i){var o=(t.packetsLost-N._nativeStatsDelivered[e].video.packetsLost)/(t.totalPackets-N._nativeStatsDelivered[e].video.totalPackets)*100;for(var r in N._nativeStatsDelivered[e].video.packetsLostRate=isNaN(o)?0:Math.round(o)<=100?Math.round(o):100,t)"timeStamp"===r?N._nativeStatsDelivered[e].video.timestamp=t[r]:"netQuality"===r?N._nativeStatsDelivered[e].video.netquality=t[r]:N._nativeStatsDelivered[e].video[r]=t[r]}else{var n=(t.packetsLost-N._nativeStatsDelivered[e].audio.packetsLost)/(t.totalPackets-N._nativeStatsDelivered[e].audio.totalPackets)*100;for(var r in N._nativeStatsDelivered[e].audio.packetsLostRate=isNaN(n)?0:Math.round(n)<=100?Math.round(n):100,t)"timeStamp"===r?N._nativeStatsDelivered[e].audio.timestamp=t[r]:"netQuality"===r?N._nativeStatsDelivered[e].audio.netquality=t[r]:N._nativeStatsDelivered[e].audio[r]=t[r]}else!dt(e)&&N._nativeStatsDelivered[e]&&(N._nativeStatsDelivered[e]=void 0,delete N._nativeStatsDelivered[e])}function lt(e,t){t&&t.video&&W.hasOwnProperty(e.publisherId())&&(t.video.kartunCount=W[e.publisherId()]),e.networkStatus=t;var i={userId:e.publisherId(),type:e.getAttributes().type,networkStatus:t,iskartun:!!(t.video&&t.video.frameRate<=3)};switch(e.getAttributes().type){case YS.STREAM_VIDEO:if(new RegExp(e.publisherId()+":","g").test(e.extensionId)){var o=ft(e);i.deviceId=o}var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserNetworkStateChanged,message:i},!1);U.dispatchEvent(r,!1);break;case YS.STREAM_MEDIA:case YS.STREAM_FILE:case YS.STREAM_SCREEN:r=YS.RoomEvent({type:"room-"+e.getAttributes().type+"networkstate-changed",message:i},!1);U.dispatchEvent(r,!1)}}function pt(e,t){if(e&&t&&(L.Logger.debug(ae,"Process Signaling Message:",L.Utils.toJsonStringify(e)),e.sdp&&"answer"===e.type)){var i=e.sdp,o=i.indexOf("udp");if(-1!==o){var r="";t&&(r+="stream sdp info:stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())+". \n"),r+="udp info:"+(window.__YsSdkBuild__?L.Utils.encrypt(i.substr(o,58)):i.substr(o,58)),L.Logger.info(ae,r)}YS.isHiFi&&(e.sdp=L.Utils.setHiFiToSdp(e.sdp)),e.sdp=L.Utils.setMaxBWToSdp(e.sdp),L.Logger.debug(ae,"Set remote and local description"),L.Logger.debug(ae,"Remote Description",e.sdp),M.setRemoteDescription(t.getID(),e)}}function ft(e){if(e.publisherId()===De()&&e.videoinputDeviceId)return e.videoinputDeviceId;var t=new RegExp(e.publisherId()+":","g");return t.test(e.extensionId)?e.extensionId.replace(t,""):""}function mt(e,t){if(e.id===De())return YS.isMultiCamera?e["publishstate:"+t]||YS.PUBLISH_STATE_NONE:e.publishstate||YS.PUBLISH_STATE_NONE;var i="publishstate";return t&&(i+=":"+t),e[i]||YS.PUBLISH_STATE_NONE}function gt(e){return YS.isMultiCamera?N._myself["publishstate:"+e]||YS.PUBLISH_STATE_NONE:N._myself.publishstate||YS.PUBLISH_STATE_NONE}function vt(){return N._myself.ys_screenstate||YS.SCREENSTATE_OFF}function ht(){return N._myself.ys_mediafilestate||YS.MEDIAFILESTATE_OFF}function St(e,t){t=t||e;var i=gt(e.videoinputDeviceId);i===YS.PUBLISH_STATE_NONE&&U.remoteStreams[e.getID()]?ot(e):i>YS.PUBLISH_STATE_NONE&&ot(e,function(){i>YS.PUBLISH_STATE_NONE&&(le(t,!1),pe(t,!1),it(t))})}function yt(e,t,i){i=i||{};for(var o=Ce(YS.STREAM_VIDEO),r=0,n=o.length;r<n;r++){var a=o[r];e===L.Constant.deviceStorage.videoinput?YS.isMultiCamera||(i.forceUpdate||void 0!==t&&t!==a.videoinputDeviceId)&&_t(a,t,i.forceUpdate):e===L.Constant.deviceStorage.audioinput&&(i.forceUpdate||void 0!==t&&t!==a.audioinputDeviceId)&&Lt(a,t,i.forceUpdate)}}function _t(o,r,e){if(r!==o.videoinputDeviceId||e){var n=gt(o.videoinputDeviceId);if(YS.isMultiCamera&&r!==o.videoinputDeviceId){if(n===YS.PUBLISH_STATE_NONE&&U.remoteStreams[o.getID()])ot(o);else if(n>YS.PUBLISH_STATE_NONE){var t=Ne(r,!0);St(o,t)}}else{M.hasConnection(o.getID())&&M.getConnectionVideoTrack(o.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!YS.customStreamFn||o.removeVideoTrack();var a=o.videoinputDeviceId;o.videoinputDeviceId=r,N._playVideoStreams[o.extensionId]||n>YS.PUBLISH_STATE_NONE?YS.DeviceMgrImpl.getVideoTrack(r,function(e){if(YS.userCacheStreamVideo&&r&&YS.cacheStreams.hasOwnProperty(r)){var t=YS.cacheStreams[r]||{},i=(t=t.stream||{}).getVideoTracks();i&&i.length&&(e=i[0])}o.removeVideoTrack(),o.addVideoTrack(e),n===YS.PUBLISH_STATE_NONE&&U.remoteStreams[o.getID()]?ot(o):M.hasConnection(o.getID())&&M.getConnectionVideoTrack(o.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!YS.customStreamFn?M.replaceVideoTrack(o.getID(),e):St(o),Me(o.extensionId)&&Oe(o.extensionId),a!==r&&M.destroyVideoTrack(a)},function(e){L.Logger.info(ae,"updateStreamVideoinputDeviceId:getDeviceVideoTrack fail,fain info is "+L.Utils.toJsonStringify(e)+",stream id:"+o.getID()+" , extensionId is "+o.extensionId+", attrs is "+L.Utils.toJsonStringify(o.getAttributes())),Mt(e,"videoinput",r)}):n===YS.PUBLISH_STATE_NONE&&U.remoteStreams[o.getID()]&&ot(o)}}}function Lt(t,i,e){if(i!==t.audioinputDeviceId||e){var o=gt(t.videoinputDeviceId);M.hasConnection(t.getID())&&M.getConnectionAudioTrack(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!YS.customStreamFn||t.removeAudioTrack();var r=t.audioinputDeviceId;t.audioinputDeviceId=i,N._playAudioStreams[Ct(t.publisherId(),t.getAttributes().type)]||N._registerAudioVolumeListeners[Ct(t.publisherId(),t.getAttributes().type)]||o>YS.PUBLISH_STATE_NONE?YS.DeviceMgrImpl.getAudioTrack(i,function(e){t.removeAudioTrack(),t.addAudioTrack(e),o===YS.PUBLISH_STATE_NONE&&U.remoteStreams[t.getID()]?ot(t):M.hasConnection(t.getID())&&M.getConnectionAudioTrack(t.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!YS.customStreamFn?M.replaceAudioTrack(t.getID(),e):St(t),Me(t.extensionId)&&Oe(t.extensionId),r!==t.audioinputDeviceId&&M.destroyAudioTrack(t.audioinputDeviceId)},function(e){L.Logger.info(ae,"updateStreamAudioinputDeviceId:getDeviceAudioTrack fail,fain info is "+L.Utils.toJsonStringify(e)+",stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),Mt(e,"audioinput",i)}):o===YS.PUBLISH_STATE_NONE&&U.remoteStreams[t.getID()]&&ot(t)}}function bt(e,t){if(!YS.isMultiCamera)return L.Logger.warning(ae,"set main camera is fail,not in a multi-camera environment!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_IN_MULTI_CAMERA_ENVIRONMENT"));if(L.Utils.isVideoinputDeviceIdFromDeviceList(e))if(N._mainCameraDeviceId!==e){var i=N._mainCameraDeviceId;N._isConnected&&N._myself.ys_maincamera!==e&&U.changeUserProperty(De(),"__all",{ys_maincamera:e});var o=(n=i,(a=YS.isMultiCamera?gt(n):N._myself.publishstate)===YS.PUBLISH_STATE_AUDIOONLY||a===YS.PUBLISH_STATE_BOTH);o&&U.unpublishAudio();i=N._mainCameraDeviceId;N._mainCameraDeviceId=e,L.Logger.info(ae,"change myself main camera device id,my id is "+De()+",change device id is "+N._mainCameraDeviceId+",old device id is "+i),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,N._mainCameraDeviceId),o&&U.publishAudio(),N._registerAudioVolumeListeners[Ct(De(),YS.STREAM_VIDEO)]&&(Ne(i)&&Ne(i).stopIntervalGetRealtimeVolume(),Ne(N._mainCameraDeviceId)&&Ne(N._mainCameraDeviceId).startIntervalGetRealtimeVolume());var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:De()!==N._local_def_ext_id?De():"",deviceId:N._mainCameraDeviceId}});U.dispatchEvent(r)}else N._isConnected&&N._myself.ys_maincamera!==N._mainCameraDeviceId&&U.changeUserProperty(De(),"__all",{ys_maincamera:N._mainCameraDeviceId});else L.Logger.warning(ae,"set main camera is fail,the device id("+e+") is not in the video device list!"),L.Utils.isFunction(t)&&t("YS_ERR_DEVICE_ID_NOT_LIST");var n,a}function wt(e,t){var i=e.split(":");if(!i.length)return e;if(2==(t=t||0))return"yssmall"===i[1]?i[1]:"yssmall"===i[2]?i[2]:e;if(i[t]){if("yssmall"===i[t])return;return i[t]}}function It(e){var t=e.split(":");if(t.length){var i=e;return t.forEach(function(e){/yssmall/.test(e)||(i=e)}),i}}function Tt(e,t,i,o,r,n,a){if(At(o,!0)&&N._isLeaveRoom){if(L.Utils.isNull(e)||L.Utils.isNull(t)||L.Utils.isNull(i)||"object"!==qt(i))return L.Logger.error(ae," startPlayback function got wrong arguments"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));N._isLeaveRoom=!1,N._roomJsonOptions={},N._userJsonOptions=N._userJsonOptions||{},N._userJsonOptions.userProperties={},N._roomJsonOptions.video=!0,N._roomJsonOptions.audio=!0,N._testIP=r,N._testPort=n,L.Logger.info(ae,"call startPlayback start!");var s=N._web_host;!function(e,t,i,o,r,n){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _initPlaybackInfo cannot be executed!");else{var a=function(){if(void 0===i.roomtype||void 0===i.serial||void 0===i.recordfilepath)return L.Logger.error(ae,"The params must be included [roomtype , serial , recordfilepath] ! "),void(L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG"));w({web_host:e,web_port:t}),i.recordfilepath=/\//g.test(i.recordfilepath.charAt(i.recordfilepath.length-1))?i.recordfilepath:i.recordfilepath+"/",YS.isPlayback=!0,N._recordfilepath=i.recordfilepath,N._isGetFileList=!1,we({result:0,room:{roomtype:i.roomtype,maxvideo:void 0!==i.maxvideo?i.maxvideo:1e6,roomrole:-1,serial:i.serial,roomname:i.roomname||"Play Back",recordfilepath:i.recordfilepath,domain:i.domain,host:i.host||e,companyid:i.companyid||-1}},function(e,t,i){0===e&&o&&"function"==typeof o&&o(e,t,i)})};if(r)a();else{if(!i.recordfilepath)return L.Logger.error(ae,"params.recordfilepath is required !"),L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG");w({web_host:e,web_port:t}),i.recordfilepath=/\//g.test(i.recordfilepath.charAt(i.recordfilepath.length-1))?i.recordfilepath:i.recordfilepath+"/",YS.isPlayback=!0,N._recordfilepath=i.recordfilepath,N._isGetFileList=!1,L.Logger.info(ae,"initPlaybackInfo to checkroom start , params is "+(window.__YsSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(i)):L.Utils.toJsonStringify(i))+"!");var s=i.recordfilepath,c=new RegExp(/:[0-9]{1,6}\//);c.test(s)&&(s=s.replace(c,"/")),0!==s.indexOf("http")||0===s.indexOf("https")||N._useServerScreenRecording||(s=s.replace(/http/,"https"));var d=s+"room.json";L.Utils.sdkAjax({url:d,dataType:"json",type:"GET",async:!0,success:function(e){L.Logger.debug(ae,"getPlaybackRoomJson resp = ",L.Utils.toJsonStringify(e)),e&&"object"===qt(e)?we(e,function(e,t,i){0===e?o&&"function"==typeof o&&o(e,t,i):a()}):(L.Logger.error(ae,"getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),a())},error:function(e,t,i){L.Logger.error(ae,"getPlaybackRoomJson fail[ XHR , textStatus , errorThrown ]:",e,t,i),a()}})}}}(e,t,i,function(e,t,i){var o=YS.RoomEvent({type:YS.EVENT_TYPE.roomCheckroomPlayback,message:{ret:e,userinfo:t,roominfo:i}});if(U.dispatchEvent(o),0===e)Xe(s);else{var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomError,message:{source:"checkroom playback",error:e,errorCode:e}});if(U.dispatchEvent(r),U.eventLog({type:"FAIL_ENTER",data:e}),Q.checkRoomPlaybackCount++,5<=Q.checkRoomPlaybackCount){var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"checkroom playback",error:e,errorCode:e}},{httpTime:Date.now()-j,socketTime:0,reconnectCount:F,isReconnect:z&&0<F});U.dispatchEvent(n)}Jt(J)}},a,o)}}function Et(e,t){if(At(t,!0))return YS.isPlayback?L.Utils.isBoolean(e)?void(e?P.socketSend("pausePlayback"):P.socketSend("Playback")):(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," pausePlayback function got wrong arguments")):(L.Logger.warning(ae,"No playback environment!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_PLAYBACK_ENVIRONMENT")))}function At(e,t){return!!m||(t&&L.Logger.error(ae,"The room is not initialized and cannot execute methods on the room class. Please call the init method for initialization!"),L.Utils.isFunction(e)&&e("YS_ERR_ROOM_NOT_INIT"),!1)}function kt(e,t){return!!N._isConnected||(t&&L.Logger.error(ae,"The room has not been successfully connected yet. Please try again after the connection is successful!"),L.Utils.isFunction(e)&&e("YS_ERR_ROOM_NOT_CONNECTED",window.YS_ERR.ROOM_NOT_CONNECT),!1)}function Rt(e,t,i){return t===YS.STREAM_VIDEO?e===De()?YS.isMultiCamera?e+":"+i:e:i?e+":"+i:e:e+":"+t}function Ct(e,t){return e+":"+t}function Dt(e){return"publishstate"===e?"":/publishstate:/g.test(e)?e.replace(/publishstate:/g,""):""}function Nt(e,t,i,o,r,n){if(o=o||{},i===YS.STREAM_MEDIA||i===YS.STREAM_SCREEN||t!==De()){if(M.hasConnection(e)){var a=M.getConnectionVideoTrack(e);a?L.Utils.isFunction(r)&&r(a):L.Utils.isFunction(n)&&n("YS_ERR_NOT_VIDEOTRACK")}else L.Utils.isFunction(n)&&n("YS_ERR_NOT_PEERCONNECTION")}else i===YS.STREAM_VIDEO&&o.videoinputDeviceId?YS.DeviceMgrImpl.getVideoTrack(o.videoinputDeviceId,function(e){if(YS.userCacheStreamVideo&&o.videoinputDeviceId&&YS.cacheStreams.hasOwnProperty(o.videoinputDeviceId)){var t=YS.cacheStreams[o.videoinputDeviceId]||{},i=(t=t.stream||{}).getVideoTracks();i&&i.length&&(e=i[0])}L.Utils.isFunction(r)&&r(e),o.extensionId&&Me(o.extensionId)&&Oe(o.extensionId)},function(e){Mt(e,"videoinput",o.videoinputDeviceId),L.Utils.isFunction(n)&&n(e)}):L.Utils.isFunction(n)&&n("YS_ERR_NOT_VIDEOTRACK")}function Ut(e,t,i,o,r,n){if(i===YS.STREAM_MEDIA||t!==De())if(M.hasConnection(e)){var a=M.getConnectionAudioTrack(e);a?L.Utils.isFunction(r)&&r(a):L.Utils.isFunction(n)&&n("YS_ERR_NOT_AUDIOTRACK")}else L.Utils.isFunction(n)&&n("YS_ERR_NOT_PEERCONNECTION");else i===YS.STREAM_VIDEO&&o.audioinputDeviceId?YS.DeviceMgrImpl.getAudioTrack(o.audioinputDeviceId,function(e){L.Utils.isFunction(r)&&r(e),o.extensionId&&Me(o.extensionId)&&Oe(o.extensionId)},function(e){Mt(e,"audioinput",o.audioinputDeviceId),L.Utils.isFunction(n)&&n(e)}):L.Utils.isFunction(n)&&n("YS_ERR_NOT_AUDIOTRACK")}function Yt(e,t){return N._registerAudioVolumeListeners[Ct(e,t)]}function Pt(e){var t="";if(e===De())YS.isMultiCamera&&(t=N._mainCameraDeviceId);else{var i=N._users[e];i&&void 0!==i.ys_maincamera&&(t=i.ys_maincamera)}return t}function Mt(e,t,i){if(i){var o=void 0,r="",n={};if("object"===qt(e))for(var a in r=e.name,e)"code"!==a&&"name"!==a&&"message"!==a||(n[a]=e[a]);var s=L.Utils.getUserMediaFailCode(r);"TypeError"===r&&(o={causeCode:window.YS_ERR.DEVICE_ERROR_TypeError,causeInfo:n}),L.Logger.info(ae,"device-not-available , error code is "+s+"  , kind is "+t+" , deviceId is "+i+",errorInfo:"+L.Utils.toJsonStringify(n));var c={kind:t,deviceId:i};o&&(c.detailsInfo=o);var d=YS.RoomEvent({type:YS.EVENT_TYPE.deviceNotAvailable,message:c},{code:s});U.dispatchEvent(d),"videoinput"===t?(N._sendVDEventLog!==s+"_"+i&&U.eventLog({type:"FAIL_VIDEODEVICE",data:s}),N._sendVDEventLog=s+"_"+i):"audioinput"===t&&(N._sendADEventLog!==s+"_"+i&&U.eventLog({type:"FAIL_AUDIODEVICE ",data:s}),N._sendADEventLog=s+"_"+i)}}function Ot(e,t,i){if(t!==window.YS.ERROR_NOTICE.ERR_PUBLISH_FAILED||(e.publishFailCount++,e.publishFailCount%y==0)){var o={userId:e.publisherId(),type:e.getAttributes().type,source:i};if(YS.isMultiCamera&&e.getAttributes().type===YS.STREAM_VIDEO){var r=ft(e);o.deviceId=r}var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomErrorNotice,message:{code:t,info:o}},{errorCode:t,errorInfo:o});n&&U.dispatchEvent&&U.dispatchEvent(n)}}function xt(e,t,i){if(t!==window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED||(e.subscribeFailCount++,e.subscribeFailCount%y==0)){var o={userId:e.publisherId(),type:e.getAttributes().type,source:i};if(e.getAttributes().type===YS.STREAM_VIDEO)if(new RegExp(e.publisherId()+":","g").test(e.extensionId)){var r=ft(e);o.deviceId=r}var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomErrorNotice,message:{code:t,info:o}},{errorCode:t,errorInfo:o});n&&U.dispatchEvent&&U.dispatchEvent(n)}}function Vt(){for(var e in N._playVideoStreams){if((n=(r=N._playVideoStreams[e]).publisherId())!==De()){var t=e.replace(new RegExp(n,"g"),De());N._createStreams[e]||N._playAudioStreams[Ct(r.publisherId(),r.getAttributes().type)]||L.Utils.isFunction(r.updateExtensionId)&&r.updateExtensionId(t),N._playVideoStreams[t]=r,N._playVideoStreams[e]=void 0,delete N._playVideoStreams[e]}}for(var i in N._playAudioStreams){e=(r=N._playAudioStreams[i]).extensionId;if((n=r.publisherId())!==De()){var o=i.replace(new RegExp(n,"g"),De());N._createStreams[e]||L.Utils.isFunction(r.updateExtensionId)&&r.updateExtensionId(t),N._playAudioStreams[o]=r,N._playAudioStreams[i]=void 0,delete N._playAudioStreams[i]}}for(var e in N._createStreams){var r,n;if((n=(r=N._createStreams[e]).publisherId())!==De()){t=e.replace(new RegExp(n,"g"),De());L.Utils.isFunction(r.updateExtensionId)&&r.updateExtensionId(t),N._createStreams[t]=r,N._createStreams[e]=void 0,delete N._createStreams[e]}}}function Ft(e){if(e){if(e.publisherId()!==De()||e.publisherId()===De()&&e.getAttributes().type===YS.STREAM_MEDIA){e.stopIntervalGetRealtimeVolume();var t=N._registerAudioVolumeListeners[Ct(e.publisherId(),e.getAttributes().type)];t&&(t.onSuccess=void 0,t.onFailure=void 0,t.interval=100,t.isWaiting=!1,N._registerAudioVolumeListeners[Ct(e.publisherId(),e.getAttributes().type)]=void 0,delete N._registerAudioVolumeListeners[Ct(e.publisherId(),e.getAttributes().type)])}N._nativeStatsDelivered[e.extensionId]=void 0,delete N._nativeStatsDelivered[e.extensionId]}}function Bt(e){var t=!1;for(var i in e)if(N._sdkUserProperty.hasOwnProperty(i)||/publishstate:/g.test(i)){t=!0;break}return t}function jt(){try{return roadofrecorder}catch(e){return L.Logger.warning(ae," _getRoadofrecorder fucntion current is Not define!"),null}}function Jt(e,t){if(!t&&N._sendlogts&&(new Date).getTime()-N._sendlogts<5e3)N._sendlogtimer=setTimeout(function(){Jt(e,!0),clearTimeout(N._sendlogtimer),N._sendlogtimer=void 0},5e3);else{clearTimeout(N._sendlogtimer),N._sendlogtimer=void 0;try{L.Logger._web_protocol=N._web_protocol||L.Logger._web_protocol,L.Logger._web_host=N._web_host||L.Logger._web_host,L.Logger._web_port=N._web_port||L.Logger._web_port;var o=L.Logger._web_protocol,r=L.Logger._web_host,n=L.Logger._web_port;if(!r)return;L.Logger.getAllLog(e,function(e){if(L.Utils.isArray(e)){if(e&&e.length){var t=[];if((t=YS.logTs===e[e.length-1].ts?(YS.logTs=YS.logTs+1,e):(YS.logTs=e[e.length-1].ts,e.filter(function(e,t){if(e&&"undefined serial"===e.serial&&(e.ts>=YS.loadSdkTs?e.serial=YS.mySerial||"":e.serial=""),e&&"undefined peerid"===e.peerid&&(e.ts>=YS.loadSdkTs?e.peerid=YS.myPeerid||"":e.peerid=""),e&&e.peerid)return e.ts<YS.logTs})))&&t.length){N._sendlogts=(new Date).getTime();var i=o+"://"+r+":"+n+a+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",anync:!0,data:function(e){if(L.Utils.isArray(e)){var o="";e.forEach(function(e){var t={};for(var i in e)"ts"===i?t.logts=""+e[i]:t[i]=e[i];o+=JSON.stringify(t)+"\n"})}var t=pako.gzip(o,{to:"string"});return window.btoa=window.btoa||function(e,t){var i,o,r,n,a,s,c,d,u=[],l="",p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(0<(s=(c=(t=void 0!==t&&t)?e.encodeUTF8():e).length%3))for(;s++<3;)l+="=",c+="\0";for(s=0;s<c.length;s+=3)o=(i=c.charCodeAt(s)<<16|c.charCodeAt(s+1)<<8|c.charCodeAt(s+2))>>18&63,r=i>>12&63,n=i>>6&63,a=63&i,u[s/3]=p.charAt(o)+p.charAt(r)+p.charAt(n)+p.charAt(a);return d=(d=u.join("")).slice(0,d.length-l.length)+l},window.btoa(t)}(t),success:function(e){YS.logTs&&L.Logger.keep(YS.logTs),L.Logger.debug(ae,"send logs = ",L.Utils.toJsonStringify(e))},error:function(e,t,i){L.Logger.error(ae,"send logs fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}}}else L.Logger.debug(ae,"getAllLog error , Because the return value is not an array!")})}catch(e){L.Logger.error(ae,"gzip is null or error info:",e)}}}function Ht(e){var t=L.Utils.getBrowserInfo(),o={type:e.type,fileid:e.fileid,streamid:e.streamid,data:e.data,logts:(new Date).getTime(),platform:YS.isYsNative?"nativeclient":"js",osversion:L.Utils.detectOS(),device:YS.isYsNative&&(YS.clientfriendlyversion||YS.clientversion)?YS.clientfriendlyversion||YS.clientversion:t.info.browserName+" "+t.info.browserVersion,cpu:"x86",room:N._room_properties.serial||YS.mySerial,companyid:N._room_properties.companyid,userid:N._myself.id||YS.myPeerid,line:e.line||N._serverName,cdn:e.cdn,role:N._myself.role,sdkversion:YS.SDKVERSIONS,sdkdate:YS.SDKVERSIONSTIME};for(var i in o)"object"===qt(o[i])?o[i]=L.Utils.toJsonStringify(o[i]):void 0===o[i]||null===o[i]?o[i]="":o[i]=""+o[i];L.Logger.info(ae,"call eventLog, params:"+L.Utils.toJsonStringify(o));var r=N._web_protocol+"://"+N._web_host+":"+N._web_port+n+"?ts="+(new Date).getTime();L.Utils.sdkAjax({url:r,dataType:"json",type:"POST",async:!0,data:{eventjson:L.Utils.toJsonStringify(o)},success:function(e){e&&0!==e.code&&L.Logger.info("eventLog is not success,code:"+e.code," , response:",e," ,eventjson:"+L.Utils.toJsonStringify(o))},error:function(e,t,i){L.Logger.error(ae,"WEBFUNC_EVENT fail[ XHR , textStatus , errorThrown ]:",e,t,i+" ,eventjson:"+L.Utils.toJsonStringify(o))}})}function Wt(e,t,i){e===De()?!N._safariOnlySubscibe||i||YS.isYsNative||YS.DeviceMgrImpl._isGetDevicesed?t&&t(!1):M.getDeviceMgr().getDevices(function(){t&&t(!0)},{isSetlocalStorage:!0}):t&&t(!1)}i(),YS.networkTestInfo.isConnectRoom=N._isConnected,U.remoteStreams={},U.localStreams={},U.init=function(e,i,t,o,r){if(L.Logger.info(ae," room-sdk initializing. options : ",L.Utils.toJsonStringify(r)),m)return L.Logger.error(ae,"Already initialized,can the uninit method first if you need to initialize again!"),void(L.Utils.isFunction(t)&&t("YS_ERR_ALREADY_INIT"));r=r||{};var n=!!L.Utils.isBoolean(r.isEncryption)&&r.isEncryption,a=!!L.Utils.isBoolean(r.ys_invalidappkey)&&r.ys_invalidappkey;if(!a){if(L.Utils.isNull(e))return L.Logger.error(ae," the appKey can not be empty when initializing room-sdk"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));if(n){if(!L.Utils.isFunction(r.onDecode))return L.Logger.error(ae,"Cipher decode algorithm function can't be empty, please introduced to encryption function configuration items (option.onDecode)!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_DECODE_ALGORITHM_FUNCTION"));e=r.onDecode(e)}window.YS.MD5&&L.Utils.isFunction(window.YS.MD5)?h=window.YS.MD5(e):(L.Logger.error(ae,"Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.YS.MD5 = md5"),L.Utils.isFunction(t)&&t("YS_ERR_NOT_MD5_ENCRYPT")),S=e}o=!L.Utils.isBoolean(o)||o,d.autoSubscribeAV=void 0!==r.autoSubscribeAV?r.autoSubscribeAV:d.autoSubscribeAV,N._isGetFileList=!!L.Utils.isBoolean(r.isGetFileList)&&r.isGetFileList,YS.isMultiCamera=!!L.Utils.isBoolean(r.ys_multistream)&&r.ys_multistream,N._useServerScreenRecording=!!L.Utils.isBoolean(r.useServerScreenRecording)&&r.useServerScreenRecording,r.ys_use_secure_socket=!L.Utils.isBoolean(r.ys_use_secure_socket)||r.ys_use_secure_socket,c=L.Utils.isNumber(r.ys_max_reconnect_count)?r.ys_max_reconnect_count:void 0,N.isYsInvalidAppkey=a,N._ys_room_test_sdk=!!L.Utils.isBoolean(r.ys_room_test_sdk)&&r.ys_room_test_sdk,N._safariOnlySubscibe="safari"===L.Utils.getBrowserInfo(!0).info.browserName&&!!r.safariOnlySubscibe,N._isMix=r.isMix||!1,r.useHttpProtocol&&(r.ys_use_secure_socket=!1),r.ys_use_secure_socket?(N._web_protocol="https",N._doc_protocol="https",N._socket_protocol="https",N._backup_doc_protocol="https",N._webInterfaceHtmlPort=8080):(N._web_protocol="http",N._doc_protocol="http",N._socket_protocol="http",N._backup_doc_protocol="http",N._webInterfaceHtmlPort=81),r.ys_host&&(N.ys_host=r.ys_host||"api.roadofcloud.com"),r.ys_port&&(N.ys_port=r.ys_port||(r.ys_use_secure_socket?443:80)),N._safariOnlySubscibe?(L.Logger.info(ae,"init method:safari is only subscibe"),m=!0,L.Utils.isFunction(i)&&(i(),window.onunload=function(){U.uninit()})):M.getDeviceMgr().getDevices(function(e){if(M.getDeviceMgr().checkIsSupportSetSpeaker()){var t=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);t&&M.getDeviceMgr().checkIsSupportSetSpeaker()&&(YS.isYsNative?M.getDeviceMgr().setDevices({audiooutput:t}):M.getDeviceMgr().associateElementsToSpeaker(void 0,t))}o||r&&r.hasOwnProperty("isCheckDevice")&&r.isCheckDevice?M.checkDeviceAvailability(e,function(){if(YS.isMultiCamera&&!N._mainCameraDeviceId){var e=N._mainCameraDeviceId;N._mainCameraDeviceId=ye(),L.Logger.info(ae,"change myself main camera device id,my id is "+De()+",change device id is "+N._mainCameraDeviceId+",old device id is "+e);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:De()!==N._local_def_ext_id?De():"",deviceId:N._mainCameraDeviceId}});U.dispatchEvent(t)}m=!0,L.Utils.isFunction(i)&&(i(),window.onunload=function(){U.uninit()})},{findAvailabilityDevice:!!L.Utils.isBoolean(r.findAvailabilityDevice)&&(!YS.isYsNative&&r.findAvailabilityDevice),onVideoSuccess:function(){var e=YS.RoomEvent({type:YS.EVENT_TYPE.deviceSuccess,message:{kind:"videoinput"}});U.dispatchEvent(e)},onAudioSuccess:function(){var e=YS.RoomEvent({type:YS.EVENT_TYPE.deviceSuccess,message:{kind:"audioinput"}});U.dispatchEvent(e)},onVideoFailure:function(e){if(e&&"object"===qt(e)){var t="object"===qt(e)&&e.name,i=L.Utils.getUserMediaFailCode(t),o=YS.RoomEvent({type:YS.EVENT_TYPE.deviceFailure,message:{kind:"videoinput"}},{code:i});U.dispatchEvent(o),L.Logger.info(ae,"init method video device fail!",i,e),N._sendVDEventLog!==i+"_"&&U.eventLog({type:"FAIL_VIDEODEVICE",data:i}),N._sendVDEventLog=i+"_"}},onAudioFailure:function(e){if(e&&"object"===qt(e)){var t="object"===qt(e)&&e.name,i=L.Utils.getUserMediaFailCode(t),o=YS.RoomEvent({type:YS.EVENT_TYPE.deviceFailure,message:{kind:"audioinput"}},{code:i});U.dispatchEvent(o),L.Logger.info(ae,"init method audio device fail!",i,e),N._sendADEventLog!==i+"_"&&U.eventLog({type:"FAIL_AUDIODEVICE ",data:i}),N._sendADEventLog=i+"_"}}}):(m=!0,L.Utils.isFunction(i)&&(i(),window.onunload=function(){U.uninit()}))},{isSetlocalStorage:!0})},U.uninit=function(e,t){m&&U.leaveroom(),function(){for(var e in YS.DeviceMgrImpl.destroyAllCacheStreams(),N._createStreams)Oe(e);M.destroyAllVideoTrack(),M.destroyAllAudioTrack(),YS._mobile_video_mediaStream&&(YS._mobile_video_mediaStream.getTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_video_mediaStream=void 0);YS._mobile_audio_mediaStream&&(YS._mobile_audio_mediaStream.getTracks().forEach(function(e){L.Utils.stopTrack(e,!0)}),YS._mobile_audio_mediaStream=void 0)}(),YS.isPlayback=!1,YS.isMultiCamera=!1,m=!1,S=h="",c=void 0,F=-1,v=null,j=B=x=V=0,i(),M.getDeviceMgr().stopAllAudioMix(),YS.networkTestInfo.isConnectRoom=N._isConnected,Vt(),L.Utils.isFunction(e)&&e()},U.checkInit=function(e,t){return At(e,t)},U.setLogIsDebug=function(e,t,i){i=i||!1;var o={debug:e=e||!1},r={development:e,logLevel:void 0!==t&&"number"==typeof t?t:e?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},n={webrtcLogDebug:e};YS.ysLogPrintConfig(o,r,n),L.Logger.setIsFormatLog(i)},U.registerLogListener=function(e){L.Logger.registerLogListener(e)},U.getFileList=function(){return N._room_filelist},U.getFileinfo=function(e){for(var t=void 0,i=0,o=N._room_filelist.length;i<o;i++)if(N._room_filelist[i]&&N._room_filelist[i].fileid==e){t=N._room_filelist[i];break}return t},U.getDeviceMgr=function(){return M.getDeviceMgr()},U.getRoomProperties=function(){return N._room_properties},U.getMySelf=function(){return N._myself},U.getUser=function(e){return void 0===e?void 0:N._users[e]},U.getUsers=function(){return N._users},U.takePhoto=function(e,t,i){if(t){var o=Re(t,YS.STREAM_VIDEO,i);if(o)return o.getVideoFrameURL(e)}return null},U.changeUserPropertyByRole=function(e,t,i){if(At(void 0,!0)&&kt(void 0,!0))if(Array.isArray(e))if("object"===qt(i)){var o={roles:e};U.changeUserProperty(o,t,i)}else L.Logger.error(ae,"changeUserPropertyByRole properties params must is json !");else L.Logger.error(ae,"changeUserPropertyByRole roles params must is array!")},U.batchChangeUserProperty=function(e,t,i){if(At(void 0,!0)&&kt(void 0,!0))if(Array.isArray(e))if("object"===qt(i)){if(N._roomMode!==window.YS.ROOM_MODE.BIG_ROOM)for(var o=e.length-1;0<=o;o--)e[o]&&!N._users[e[o]]&&(L.Logger.warning(ae,"batchChangeUserProperty:user is not exist, user id: "+e[o]+" !"),e.splice(o,1));var r={ids:e};U.changeUserProperty(r,t,i)}else L.Logger.error(ae,"batchChangeUserProperty properties params must is json !");else L.Logger.error(ae,"batchChangeUserProperty ids params must is array!")},U.changeUserProperty=function(e,t,i){if(At(void 0,!0)&&kt(void 0,!0))if(void 0!==i&&void 0!==e)if("object"===qt(i))if(YS.isMultiCamera&&i.hasOwnProperty("publishstate:"))L.Logger.error(ae,"changeUserProperty MultiCamera publishstate properties must not empty!");else{if(YS.isOnlyAudioRoom)for(var o in i)"publishstate"!==o&&!/publishstate:/g.test(o)||i[o]!==YS.PUBLISH_STATE_VIDEOONLY&&i[o]!==YS.PUBLISH_STATE_BOTH||delete i[o];var r={};if(r.id=e,r.toID=t||"__all",i.hasOwnProperty("id")&&(L.Logger.warning(ae,"Method changeUserProperty cannot modify the id properties"),delete i.id),r.properties=i,"object"===qt(e)){if(e.hasOwnProperty("ids")&&Array.isArray(e.ids))for(var n in e.ids)if(e.ids[n]===De()){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?N._myself[o]=i[o]:"ys_maincamera"===o?N._myself[o]=i[o]:"ys_screenstate"===o?N._myself[o]=i[o]:"ys_mediafilestate"===o&&(N._myself[o]=i[o]);Bt(i)&&L.Logger.info(ae,"change myself property,my id is "+De()+",change property:"+L.Utils.toJsonStringify(i))}if(e.hasOwnProperty("roles")&&Array.isArray(e.roles))for(var n in e.roles)if(e.roles[n]===N._myself.role){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?N._myself[o]=i[o]:"ys_maincamera"===o?N._myself[o]=i[o]:"ys_screenstate"===o?N._myself[o]=i[o]:"ys_mediafilestate"===o&&(N._myself[o]=i[o]);Bt(i)&&L.Logger.info(ae,"change myself property,my id is "+De()+",change property:"+L.Utils.toJsonStringify(i))}}else{if(N._roomMode!==window.YS.ROOM_MODE.BIG_ROOM&&!N._users[e])return void L.Logger.error(ae,"changeUserProperty:user is not exist , user id: "+e+"!");if(e===De()){for(var o in i)"publishstate"===o||/publishstate:/g.test(o)?N._myself[o]=i[o]:"ys_maincamera"===o?N._myself[o]=i[o]:"ys_screenstate"===o?N._myself[o]=i[o]:"ys_mediafilestate"===o&&(N._myself[o]=i[o]);Bt(i)&&L.Logger.info(ae,"change myself property,my id is "+De()+",change property:"+L.Utils.toJsonStringify(i))}}L.Utils.getJsonLength(r.properties)&&P.sendMessageSocket("setProperty",r)}else L.Logger.error(ae,"changeUserProperty properties must is json !");else L.Logger.error(ae,"changeUserProperty properties or id is not exist!")},U.sendMessage=function(e,t,i,o){if(At(void 0,!0)&&kt(void 0,!0)){var r={};t=t||"__all",r.toID=t;var n={};if("string"==typeof e){var a=L.Utils.toJsonParse(e);"object"!==qt(a)&&(a=e),e=a}if("object"===qt(e))for(var s in e)n[s]=e[s];else n.msg=e;if("string"==typeof i&&(i=L.Utils.toJsonParse(i)),i&&"object"===qt(i))for(var s in i)n[s]=i[s];r.message=L.Utils.toJsonStringify(n),o&&o.isToSender&&(r.isToSender=!0),P.sendMessageSocket("sendMessage",r)}},U.pubMsg=function(e){if(At(void 0,!0)&&kt(void 0,!0))if("object"===qt(e)){var t={};t.name=e.name||e.msgName,t.id=e.id||e.msgId||t.name,t.toID=e.toID||e.toId||"__all",t.data=e.data,e.save||(t.do_not_save=""),void 0!==e.associatedMsgID&&(t.associatedMsgID=e.associatedMsgID),void 0!==e.associatedUserID&&(t.associatedUserID=e.associatedUserID);var i={};for(var o in e)void 0===t[o]&&void 0!==e[o]&&"save"!==o&&"name"!==o&&"msgName"!==o&&"id"!==o&&"msgId"!==o&&"toID"!==o&&"toId"!==o&&"data"!==o&&"associatedMsgID"!==o&&"associatedUserID"!==o&&(i[o]=e[o]);for(var o in i)void 0===t[o]&&"save"!==o&&(t[o]=i[o]);if(void 0!==t.name&&null!==t.name){if("DocumentChange"===t.name&&"__allExceptSender"===t.toID){var r=L.Utils.toJsonParse(L.Utils.toJsonStringify(t));r.fromID=De(),r&&r.data&&"string"==typeof r.data&&(r.data=L.Utils.toJsonParse(r.data)),He(r)}"ClassBegin"===t.name&&(U.eventLog({type:"EVENT_BEGIN"}),Jt(J)),P.sendMessageSocket("pubMsg",t)}else L.Logger.error(ae,"pubMsg name is must exist!")}else L.Logger.error(ae,"pubMsg params must is json!")},U.delMsg=function(e){if(At(void 0,!0)&&kt(void 0,!0))if("object"===qt(e)){var t,i,o,r;r=1===arguments.length&&e&&"object"===qt(e)?(t=e.name||e.msgName,i=e.id||e.msgId,o=e.toID||e.toId,e.data):(t=e,i=arguments[1],o=arguments[2],arguments[3]);var n={};n.name=t,n.id=i||n.name,n.toID=o||"__all",n.data=r||{},void 0!==n.name&&null!==n.name?void 0!==n.id&&null!==n.id?("ClassBegin"===n.name&&(U.eventLog({type:"EVENT_END"}),Jt(J)),P.sendMessageSocket("delMsg",n)):L.Logger.error(ae,"delMsg id is must exist!"):L.Logger.error(ae,"delMsg name is must exist!")}else L.Logger.error(ae,"delMsg params must is json!")},U.evictUser=function(e,t){if(At(void 0,!0)&&kt(void 0,!0)){L.Logger.info(ae,"evictUser",e);var i={};if(i.id=e,t&&"object"===qt(t))for(var o in t)i[o]=t[o];P.sendMessageSocket("evictParticipant",i)}},U.joinroom=function(e,t,i,o,r,n,a,s){if(At(void 0,!0))if(N._isLeaveRoom)if(N._isConnected)L.Logger.warning(ae,"Room already connected!");else{F=-1,B=V=x=0,j=Date.now(),e=e||"api.roadofcloud.com",t=t||(/https/g.test(N._web_protocol)?443:80),L.Logger.info(ae,"call joinroom start!"),N._myself={id:""},Vt(),N._isLeaveRoom=!1,N._webReconnectNumList={},w({web_host:e,web_port:t}),N._roomJsonOptions="object"===qt(r)?r:{},N._userJsonOptions=N._userJsonOptions||{},N._userJsonOptions.userProperties=n||{},N._roomJsonOptions.video=!0,N._roomJsonOptions.audio=!0,N._testIP=a,N._testPort=s;var c={serial:N._roomJsonOptions.serial,password:N._roomJsonOptions.password||""};N._roomJsonOptions.serial&&(YS.mySerial=N._roomJsonOptions.serial),o&&(YS.myPeerid=o),N.isYsInvalidAppkey||(c.version=1,c.authkey=h,c.key=S),i&&(c.nickname=i),N._roomJsonOptions.hasOwnProperty("token")&&(c.token=N._roomJsonOptions.token),N._roomJsonOptions.hasOwnProperty("userrole")&&(c.userrole=N._roomJsonOptions.userrole);var d=N._web_host;N._roomJsonOptions.checkroomParamsUrl&&!N.isYsInvalidAppkey&&(N._roomJsonOptions.checkroomParamsUrl+="&version=1&authkey="+h+"&key="+S),at(e,t,N._roomJsonOptions.checkroomParamsUrl?N._roomJsonOptions.checkroomParamsUrl:c,function(e,t,i){var o=YS.RoomEvent({type:YS.EVENT_TYPE.roomCheckroom,message:{ret:e,userinfo:t,roominfo:i}});if(U.dispatchEvent(o),0===e)Xe(d);else{var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomError,message:{source:"checkroom",error:e,errorCode:e}});if(U.dispatchEvent(r),U.eventLog({type:"FAIL_ENTER",data:e}),Q.checkRoomCount++,5<=Q.checkRoomCount){var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:e,errorCode:e}},{httpTime:Date.now()-j,socketTime:0,reconnectCount:F,isReconnect:z&&0<F});U.dispatchEvent(n)}Jt(J)}i&&i.room&&i.room.serial&&(YS.mySerial=i.room.serial),YS.myPeerid=N._myself.id;var a={};a.peerid=YS.myPeerid?YS.myPeerid:"",a.serial=YS.mySerial?YS.mySerial:"",L.Logger.setLogStaicPrefix(a.peerid,a.serial),L.Logger.setReportwarning(function(){Jt(J)}),clearInterval(YS._logUploadTimer),YS._logUploadTimer=window.setInterval(function(){if(!At(void 0,!1))return clearInterval(YS._logUploadTimer),void(YS._logUploadTimer=void 0);Jt(J)},18e4)},o)}else L.Logger.warning(ae,"Room is not leaved!")},U.joinRoomEx=function(e,t,i,o){if(At(void 0,!0))if(N._isLeaveRoom)if(N._isConnected)L.Logger.warning(ae,"Room already connected!");else{e||L.Logger.error(ae,"joinRoomEx roomId is null!"),F=-1,B=V=x=0,j=Date.now();var r=N.ys_host||"api.roadofcloud.com",n=N.ys_port||(/https/g.test(N._web_protocol)?443:80);L.Logger.info(ae,"call joinroom start!"),N._myself={id:""},Vt(),N._isLeaveRoom=!1,N._webReconnectNumList={},w({web_host:r,web_port:n}),N._roomJsonOptions={thirdroomid:e},N._userJsonOptions=N._userJsonOptions||{},N._userJsonOptions.userProperties=o||{},N._roomJsonOptions.video=!0,N._roomJsonOptions.audio=!0;var a={thirdroomid:N._roomJsonOptions.thirdroomid};N._roomJsonOptions.thirdroomid&&(YS.mySerial=N._roomJsonOptions.thirdroomid),i&&(YS.myPeerid=i),N.isYsInvalidAppkey||(a.version=1,a.authkey=h,a.key=S),t&&(a.nickname=t),N._roomJsonOptions.hasOwnProperty("token")&&(a.token=N._roomJsonOptions.token),N._roomJsonOptions.hasOwnProperty("userrole")&&(a.userrole=N._roomJsonOptions.userrole);var s=N._web_host;N._roomJsonOptions.checkroomParamsUrl&&!N.isYsInvalidAppkey&&(N._roomJsonOptions.checkroomParamsUrl+="&version=1&authkey="+h+"&key="+S),at(r,n,N._roomJsonOptions.checkroomParamsUrl?N._roomJsonOptions.checkroomParamsUrl:a,function(e,t,i){var o=YS.RoomEvent({type:YS.EVENT_TYPE.roomCheckroom,message:{ret:e,userinfo:t,roominfo:i}});if(U.dispatchEvent(o),0===e)Xe(s);else{var r=YS.RoomEvent({type:YS.EVENT_TYPE.roomError,message:{source:"checkroom",error:e,errorCode:e}});if(U.dispatchEvent(r),U.eventLog({type:"FAIL_ENTER",data:e}),Q.checkRoomCount++,5<=Q.checkRoomCount){var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"checkroom",error:e,errorCode:e}},{httpTime:Date.now()-j,socketTime:0,reconnectCount:F,isReconnect:z&&0<F});U.dispatchEvent(n)}Jt(J)}i&&i.room&&i.room.serial&&(YS.mySerial=i.room.serial),YS.myPeerid=N._myself.id;var a={};a.peerid=YS.myPeerid?YS.myPeerid:"",a.serial=YS.mySerial?YS.mySerial:"",L.Logger.setLogStaicPrefix(a.peerid,a.serial),L.Logger.setReportwarning(function(){Jt(J)}),clearInterval(YS._logUploadTimer),YS._logUploadTimer=window.setInterval(function(){if(!At(void 0,!1))return clearInterval(YS._logUploadTimer),void(YS._logUploadTimer=void 0);Jt(J)},18e4)},i)}else L.Logger.warning(ae,"Room is not leaved!")},U.leaveroom=function(e){if(At(void 0,!0)){e=e||!1,N._isLeaveRoom=!0,clearInterval(U._networkequipmentTimer),clearInterval(U._catonNumber),clearInterval(U.sendcatonNumber),clearTimeout(N._webReconnectNumList.checkroomReconnectTimer),N._webReconnectNumList.checkroomReconnectTimer=void 0,clearTimeout(N._webReconnectNumList.getFalsificationIpReconnectTimer),N._webReconnectNumList.getFalsificationIpReconnectTimer=void 0,clearTimeout(N._webReconnectNumList.getConfigReconnectTimer),N._webReconnectNumList.getConfigReconnectTimer=void 0,L.Logger.info(ae,"leaveroom "+(e?"force : "+e:"")),ee();try{P&&P.socketDisconnect&&P.socketDisconnect()}catch(e){L.Logger.warning(ae,"Socket already disconnected , disconnect errorInfo:",e)}P&&P.emptySocket&&P.emptySocket(),N._isConnected=!1,YS.networkTestInfo.isConnectRoom=!1,F=-1,j=B=V=x=0,Y&&Y.changeCommonWhiteBoardConfigration&&Y.changeCommonWhiteBoardConfigration({isConnectedRoom:N._isConnected});var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomLeaveRoom,message:e});U.dispatchEvent(t),Jt(J)}},U.startServerRecord=function(e){if(At(void 0,!0)&&kt(void 0,!0)){e=e||{};var t=L.Utils.isNull(e.recordType)?YS.REC_TYPE_RECFILE:e.recordType,i=void 0===e.recordChat||"boolean"!=typeof e.recordChat||e.recordChat,o=L.Utils.isNull(e.convert)?0:e.convert,r=L.Utils.isNull(e.layout)?0:e.layout;L.Logger.info(ae,"startServerRecord recordtype = "+t+",convert = "+o+",layout = "+r);var n={name:"ServerRecord",id:"ServerRecord",toID:"__all",data:{recordtype:t,convert:o,layout:r},save:!0};i&&(n.data.recordchat=!0),n.data=L.Utils.toJsonStringify(n.data),U.pubMsg(n)}},U.stopServerRecord=function(){if(At(void 0,!0)&&kt(void 0,!0)){L.Logger.info(ae,"stopServerRecord .");var e={name:"ServerRecord",id:"ServerRecord",toID:"__all",data:{}};e.data=L.Utils.toJsonStringify(e.data),U.delMsg(e)}},U.uploadRoomFile=function(e,t,i,o,r,n,a){if(At(n,!0)&&kt(function(e,t){L.Utils.isFunction(n)&&n(t,e)},!0)){if((a=a||{}).isWritedb=!!L.Utils.isBoolean(a.isWritedb)&&a.isWritedb,!e||!t||!i)return L.Logger.error(ae," uploadRoomFile method got invalid arguments"),void(L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_BAD_PARAMETERS,"YS_ERR_INVALID_ARG"));var s=U.getUploadFileParams(e,t,a.isWritedb,a.qRCodeId),c=new FormData;for(var d in s)c.append(d,s[d]);return c.append("filedata",i),ce(c,o,r,n)}},U.deleteRoomFile=function(e,t,i){if(At(void 0,!0)&&kt(function(e,t){L.Utils.isFunction(i)&&i(t,e)},!0))return null==e?(L.Logger.error(ae," deleteRoomFile method got invalid arguments"),void(L.Utils.isFunction(i)&&i(window.YS.ERROR_NOTICE.ERR_BAD_PARAMETERS,"YS_ERR_INVALID_ARG"))):void ue(e,t,i)},U.setAutoProcessDeviceChangeEvent=function(e){L.Utils.isBoolean(e)&&(N._autoProcessDevChangeEvent=e)},U.requestServerList=function(e,t,r,n,i){if(i=i||{},At(n,!0))if(L.Utils.getJsonLength(N._serverList))L.Utils.isFunction(r)&&(T(N._serverList,N._serverName),r(N._serverList));else{if(!e||!t)return L.Logger.error(ae,"requestServerList host or port is not exist!"),void(L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_BAD_PARAMETERS,"YS_ERR_INVALID_ARG"));L.Logger.debug(ae,"Going to requestServerList");var o=(i.protocol||N._web_protocol)+"://"+e+":"+t+"/ClientAPI/getserverarea?ts="+(new Date).getTime(),a={selfip:i.hasOwnProperty("selfip")?i.selfip:N._myIp,companyid:N._room_properties.companyid};L.Utils.sdkAjax({url:o,type:"post",async:!0,data:a,success:function(e){L.Logger.info(ae,"webInterfaceGetserver resp = ",window.__YsSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(e)):L.Utils.toJsonStringify(e));var t=(e=L.Utils.toJsonParse(e)).result;if(N._serverList={},0==t&&void 0!==e.serverarealist){for(var i in e.serverarealist){var o=e.serverarealist[i];N._serverList[o.serverareaname]=o}L.Utils.isFunction(r)&&(T(N._serverList,N._serverName),r(N._serverList))}else L.Logger.info(ae,"webInterfaceGetserver resp.serverarealist is not exist , nRet:"+t),L.Utils.isFunction(n)&&n(t,e)},error:function(e){L.Logger.error(ae,"webInterfaceGetserver fail[readyState-status]:",e),L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}},U.switchServer=function(e){U.switchServerByName(e)},U.publishVideo=function(e){if(At(void 0,!0)&&kt(void 0,!0))if(YS.isOnlyAudioRoom)L.Logger.warning(ae,"only audio room not execute method publishVideo method !");else if(!YS.isMultiCamera||L.Utils.isVideoinputDeviceIdFromDeviceList(e)){var t=gt(e);if(t!==YS.PUBLISH_STATE_VIDEOONLY&&t!==YS.PUBLISH_STATE_BOTH){var i=t===YS.PUBLISH_STATE_MUTEALL||t===YS.PUBLISH_STATE_NONE?YS.PUBLISH_STATE_VIDEOONLY:YS.PUBLISH_STATE_BOTH;U.changeUserPublish(De(),i,e)}}else L.Logger.warning(ae,"publishVideo is fail,the device id("+e+") is not in the video device list!")},U.unpublishVideo=function(e){if(At(void 0,!0)&&kt(void 0,!0))if(YS.isOnlyAudioRoom)L.Logger.warning(ae,"only audio room not execute method unpublishVideo method !");else{var t=gt(e);if(t!==YS.PUBLISH_STATE_NONE&&t!==YS.PUBLISH_STATE_AUDIOONLY){var i=t===YS.PUBLISH_STATE_BOTH?YS.PUBLISH_STATE_AUDIOONLY:YS.PUBLISH_STATE_NONE;U.changeUserPublish(De(),i,e)}}},U.publishAudio=function(){if(At(void 0,!0)&&kt(void 0,!0)){var e=gt(N._mainCameraDeviceId);if(e!==YS.PUBLISH_STATE_AUDIOONLY&&e!==YS.PUBLISH_STATE_BOTH){var t=e===YS.PUBLISH_STATE_MUTEALL||e===YS.PUBLISH_STATE_NONE?YS.PUBLISH_STATE_AUDIOONLY:YS.PUBLISH_STATE_BOTH;U.changeUserPublish(De(),t,N._mainCameraDeviceId)}}},U.unpublishAudio=function(){if(At(void 0,!0)&&kt(void 0,!0)){var e=gt(N._mainCameraDeviceId);if(e!==YS.PUBLISH_STATE_NONE&&e!==YS.PUBLISH_STATE_VIDEOONLY){var t=e===YS.PUBLISH_STATE_BOTH?YS.PUBLISH_STATE_VIDEOONLY:YS.PUBLISH_STATE_NONE;U.changeUserPublish(De(),t,N._mainCameraDeviceId)}}},U.playRemoteMedia=function(e,t,i,o){At(o,!0)&&Ze(e,t,i=i||{},o,YS.STREAM_MEDIA,"playRemoteMedia")},U.unplayRemoteMedia=function(e,t){At(t,!0)&&$e(e,t,YS.STREAM_MEDIA,"unplayRemoteMedia")},U.playRemoteMediaFile=function(e,t,i,o){At(o,!0)&&Ze(e,t,i=i||{},o,YS.STREAM_FILE,"playRemoteMediaFile")},U.unplayRemoteMediaFile=function(e,t){At(t,!0)&&$e(e,t,YS.STREAM_FILE,"unplayRemoteMediaFile")},U.playRemoteScreen=function(e,t,i,o){At(o,!0)&&(e!==De()?Ze(e,t,i=i||{},o,YS.STREAM_SCREEN,"playRemoteScreen"):L.Utils.isFunction(o)&&o("YS_ERR_NOT_PLAY_SELF_SCREEN"))},U.playVideoOnDemand=function(e,t,i){if(i=i||{},!e||!t||"string"!=typeof e||"string"!=typeof t)return L.Logger.error(ae,"Illegal parameter in function playVideoOnDemand, params is:",e,t,i);var o=document.getElementById(t);if(!o)return L.Logger.error(ae,"Can not found the element by id ",t);var r=document.createElement("video"),n=document.createElement("source");if(r.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;z-index:999;top:0;"),r.setAttribute("autoplay","true"),r.setAttribute("class","ys_video_on_demand"),r.setAttribute("controls","true"),n.setAttribute("src",e),i)for(var a in i)try{r.setAttribute(a,i[a])}catch(e){L.Logger.error(ae,"Catch set attribute exception,info is:"+e)}r.appendChild(n),o.appendChild(r)},U.stopVideoOnDemand=function(e){if(!e||"string"!=typeof e)return L.Logger.error(ae,"Illegal parameter in function playVideoOnDemand, params is:",e);var t=document.getElementById(e);if(!t)return L.Logger.error(ae,"Can not found the element by id ",t);var i=t.getElementsByClassName("ys_video_on_demand");Array.prototype.forEach.call(i,function(e){try{t.removeChild(e)}catch(e){L.Logger.error(ae,"Catch stop video on demand exception,info is:"+e)}})},U.unplayRemoteScreen=function(e,t){At(t,!0)&&(e!==De()?$e(e,t,YS.STREAM_SCREEN,"unplayRemoteScreen"):L.Utils.isFunction(t)&&t("YS_ERR_NOT_UNPLAY_SELF_SCREEN"))},U.setRemoteAudioVolume=function(e,t,i,o){if(At(void 0,!0)){if(""===t&&(t=De()),L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(ae,"setRemoteAudioVolume method got invalid userId!");if("number"!=typeof e)return L.Logger.error(ae," setRemoteAudioVolume method volume muset is number!"),void(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"));if(t!==De()&&!N._users[t])return L.Logger.debug(ae,"setRemoteAudioVolume:user is not exist,user id is "+t+"!"),void(L.Utils.isFunction(i)&&i("YS_ERR_NOT_USER"));var r=o||YS.STREAM_VIDEO,n=void 0;r===YS.STREAM_VIDEO&&(n=Pt(t));var a=Re(t,r,n);if(!a)return L.Logger.debug(ae," setRemoteAudioVolume: user is not stream  , user id is "+t),void(L.Utils.isFunction(i)&&i("YS_NO_THIS_STREAM"));a.setVolume(e)}},U.getAudioVolume=function(e,t,i,o){if(At(void 0,!0)){if(""===e&&(e=De()),L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),void L.Logger.error(ae,"getAudioVolume method got invalid userId!");if(!L.Utils.isFunction(t))return L.Logger.error(ae," getAudioVolume: onVolume is not function"),void(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"));if(e!==De()&&!N._users[e])return L.Logger.debug(ae,"setRemoteAudioVolume:user is not exist,user id is "+e+"!"),void(L.Utils.isFunction(i)&&i("YS_ERR_NOT_USER"));var r=o||YS.STREAM_VIDEO,n=void 0;r===YS.STREAM_VIDEO&&(n=Pt(e));var a=Re(e,r,n);if(!a)return L.Logger.debug(ae," getAudioVolume: user has not stream, user id is "+e),void(L.Utils.isFunction(i)&&i("YS_NO_THIS_STREAM"));a.getRealtimeVolume(t,i)}},U.registerAudioVolumeListener=function(i,o,r,n,e){if(At(n,!0)){if(""===i&&(i=De()),L.Utils.isNull(i))return L.Logger.error(ae," registerAudioVolumeListener: userId is invalid"),void(L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG"));if("number"!=typeof o)return L.Logger.error(ae," registerAudioVolumeListener: msInterval is invalid"),void(L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG"));if(!L.Utils.isFunction(r))return L.Logger.error(ae," registerAudioVolumeListener: onVolume is not function"),void(L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG"));if(i!==De()&&!N._users[i])return L.Logger.debug(ae,"registerAudioVolumeListener:user is not exist,user id is "+i+"!"),void(L.Utils.isFunction(n)&&n("YS_ERR_NOT_USER"));o<50&&(o=50);var a=e||YS.STREAM_VIDEO,s=void 0;a===YS.STREAM_VIDEO&&(s=Pt(i));var t=Re(i,a,s);if(!t)return function t(){setTimeout(function(){var e=Re(i,a,s);e?(N._registerAudioVolumeListeners[Ct(i,a)]={onSuccess:r,interval:L.Utils.isNumber(o)?o:100,onFailure:n,isWaiting:!0},e.stopIntervalGetRealtimeVolume(),YS.isYsNative?e.startIntervalGetRealtimeVolume(r,o,n):e.startIntervalGetRealtimeVolume()):t()},500)}(),L.Logger.debug(ae," registerAudioVolumeListener: user has not stream, user id is "+i),void(L.Utils.isFunction(n)&&n("YS_NO_THIS_STREAM"));N._registerAudioVolumeListeners[Ct(i,a)]={onSuccess:r,interval:L.Utils.isNumber(o)?o:100,onFailure:n,isWaiting:!0},t.stopIntervalGetRealtimeVolume(),YS.isYsNative?t.startIntervalGetRealtimeVolume(r,o,n):t.startIntervalGetRealtimeVolume()}},U.unregisterAudioVolumeListener=function(e,t,i){if(At(void 0,!0)){if(""===e&&(e=De()),L.Utils.isNull(e))return L.Logger.error(ae," unregisterAudioVolumeListener: userId is invalid"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));if(e!==De()&&!N._users[e])return L.Logger.debug(ae,"setRemoteAudioVolume:user is not exist,user id is "+e+"!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_USER"));var o=i||YS.STREAM_VIDEO,r=void 0;o===YS.STREAM_VIDEO&&(r=Pt(e));var n=N._registerAudioVolumeListeners[Ct(e,o)];n&&(n.onSuccess=void 0,n.onFailure=void 0,n.interval=100,n.isWaiting=!1,N._registerAudioVolumeListeners[Ct(e,o)]=void 0,delete N._registerAudioVolumeListeners[Ct(e,o)]);var a=Re(e,o,r);if(!a)return L.Logger.debug(ae," unregisterAudioVolumeListener: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("YS_NO_THIS_STREAM"));a.stopIntervalGetRealtimeVolume()}},U.switchOnlyAudioRoom=function(e){if(At(void 0,!0)){var t,i="OnlyAudioRoom",o=i,r={};e?(YS.needOnlyAudioRoom=1,t={name:i,id:o,toID:"__all",data:r,save:!0},U.pubMsg(t)):(YS.needOnlyAudioRoom=2,t={name:i,id:o,toID:"__all",data:r},U.delMsg(t))}},U.startShareMedia=function(i,e,o,t){if(At(o,!0)&&kt(o,!0)){if(t=t||{},e=void 0!==e&&e,!i)return L.Logger.error(ae,"[ys-fake-sdk]startShareMedia url can not be empty!"),void(o&&"function"==typeof o&&o("YS_ERR_INVALID_ARG"));if(YS.isOnlyAudioRoom&&e)return L.Logger.warning(ae,"only audio room not execute method startShareMedia to video media !"),void(o&&"function"==typeof o&&o("YS_ERR_NOT_SUPPORT"));var r={type:"media"};if(void 0!==t.toID&&(r.toID=t.toID),t.attrs&&"object"===qt(t.attrs))for(var n in t.attrs)"toID"!==n&&"type"!==n&&(r[n]=t.attrs[n]);var a={audio:!0,video:e,url:i,extensionId:De()+":media",attributes:r},s=!1;for(var n in U.remoteStreams){var c=U.remoteStreams[n];c&&"media"===c.getAttributes().type&&(s=!0,U.stopShareMedia(function(e){d()},function(){d()}))}s||d()}function d(){L.Logger.info(ae,"calling startShareMedia  , url is "+i+" , isVideo is "+e+" , options is "+L.Utils.toJsonStringify(t)),Ie("publish",{state:"url",data:a.data,audio:a.audio,video:a.video,attributes:a.attributes,extensionId:a.extensionId,metadata:void 0,createOffer:void 0},a.url,function(e,t){0===e?L.Logger.debug(ae,"mediaStream published , stream id:"+t+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.attributes)):(L.Logger.warning(ae,"Error when publishing mediaStream",e,t),L.Logger.info(ae,"stream-publish-fail , stream url:"+i+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.attributes)),L.Utils.isFunction(o)&&o(e))})}},U.stopShareMedia=function(o,r,e){if(At(o,!0)&&kt(o,!0)){e=e||{};var t=!1;for(var i in U.remoteStreams){var n=U.remoteStreams[i];if(n&&"media"===n.getAttributes().type){if(e&&"object"===qt(e)&&e.onlyStopMyself&&n.publisherId()!==De())continue;t=!0,a(n)}}t||(L.Logger.info(ae,"No media are Shared!"),o&&"function"==typeof o&&o("YS_ERR_NOT_MEDIA_SHARED"))}function a(i){L.Logger.info(ae,"calling stopShareMedia , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),P.sendMessageSocket("unpublish",i.getID(),function(e,t){0!==e?(L.Logger.warning(ae,"unpublish media stream fail, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Utils.isFunction(o)&&o(t)):(L.Logger.debug(ae,"meidaStream unpublished , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(r)&&r())})}},U.pauseShareMedia=function(e,t){if(At(t,!0)&&kt(t,!0)){if(!L.Utils.isBoolean(e))return L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," pauseShareMedia function got wrong arguments");var i=!1;for(var o in U.remoteStreams){var r=U.remoteStreams[o];"media"===r.getAttributes().type&&(i=!0,P.controlMedia(r.getID(),{type:"pause",pause:e}))}i||(L.Logger.warning(ae,"No media are Shared and the execution pauseShareMedia method is invalid!"),t&&"function"==typeof t&&t("YS_ERR_NOT_MEDIA_SHARED"))}},U.seekMedia=function(e,t){if(At(t,!0)&&kt(t,!0)){if(!L.Utils.isNumber(e))return L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," seekShareMedia function got wrong arguments");var i=!1;for(var o in e<0&&(e=0),1<e&&(e=1),U.remoteStreams){var r=U.remoteStreams[o];if("media"===r.getAttributes().type){i=!0;var n=parseInt(e*r.getAttributes().duration);n>r.getAttributes().duration&&(n=r.getAttributes().duration),P.controlMedia(r.getID(),{type:"seek",pos:n})}}i||(L.Logger.warning(ae,"No media are Shared and the execution seekShareMedia method is invalid!"),t&&"function"==typeof t&&t("YS_ERR_NOT_MEDIA_SHARED"))}},U.setMute=function(e,t,i){var o=void 0;o=t==YS.MEDIA_TYPE.MEDIA?e+":"+YS.STREAM_MEDIA:e+":"+YS.STREAM_FILE;var r=N._createStreams[o];null!=r&&r.setMute(i)},U.setVolume=function(e,t,i){var o=void 0;o=t==YS.MEDIA_TYPE.MEDIA?e+":"+YS.STREAM_MEDIA:e+":"+YS.STREAM_FILE;var r=N._createStreams[o];null!=r&&r.setVolume(i)},U.isPlayAudio=function(e,t,i){var o=L.Utils.copy(i);o.audioUrl=e,o.audio=!0,o.isPlay=t,l&&l.clientAudioMediaPlayer(e,t?"play":"stop",o)},U.playVideo=function(t,i,o,r,n){if(At(r,!0))return L.Logger.info(ae," playVideo. userId:",t,";elementId:",i,";options:",o,"; videoinputDeviceId:",n),o=o||{},""===t&&(t=De()),t?i?o&&"object"!==qt(o)?(L.Logger.error(ae,"playVideo method options must is json!"),void(L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"))):void Wt(t,function(){if(N._playVideoStreams[Rt(t,o&&o.mediaType||YS.STREAM_VIDEO,n)]&&U.unplayVideo(t,void 0,n),t===De()){if(YS.isMultiCamera&&(!o||o.mediaType!==YS.STREAM_SCREEN)&&!L.Utils.isVideoinputDeviceIdFromDeviceList(n))return L.Logger.error(ae,"playVideo is fail,the device id("+n+") is not in the video device list!"),void(L.Utils.isFunction(r)&&r("YS_ERR_DEVICE_ID_NOT_LIST"));o.mirror=L.Utils.isBoolean(o.mirror)?o.mirror:N._isLocalVideoMirrorList[Rt(t,o&&o.mediaType||YS.STREAM_VIDEO,n)]||N._isLocalVideoMirror,Ue(n)||o&&"screen"===o.mediaType||Ye(n)}else if(!N._users[t])return L.Logger.info(ae,"playVideo:user is not exist, user id is "+t),void(L.Utils.isFunction(r)&&r("YS_ERR_NOT_USER"));var e=Re(t,o&&o.mediaType||YS.STREAM_VIDEO,n);if(!e)return L.Logger.warning(ae,"playVideo: user has not stream, user id is "+t),void(L.Utils.isFunction(r)&&r("YS_NO_THIS_STREAM"));e.publisherId()===De()&&e.needChangevideoDeviceId&&(e.videoinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),delete e.needChangevideoDeviceId),e.publisherId()===De()&&e.needChangeaudioDeviceId&&(e.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),delete e.needChangevideoDeviceId),xe(i,e,o)},!(o&&o.mediaType||YS.STREAM_VIDEO)):(L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"),void L.Logger.error(ae,"playVideo method got invalid elementId!")):(L.Utils.isFunction(r)&&r("YS_ERR_INVALID_ARG"),void L.Logger.error(ae,"playVideo method got invalid userId!"))},U.unplayVideo=function(e,t,i,o){if(At(t,!0)){if(L.Logger.info(ae," unplayVideo. userId:",e),""===e&&(e=De()),!e)return L.Logger.error(ae,"unplayVideo method got invalid userId!"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var r=N._playVideoStreams[Rt(e,o&&o.mediaType||YS.STREAM_VIDEO,i)];if(!r)return L.Logger.debug(ae,"unplayVideo: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("YS_NO_THIS_STREAM"));Fe(r)}},U.playAudio=function(i,o){if(At(o,!0))return L.Logger.info(ae," playAudio, userId:",i),3===arguments.length&&"string"==typeof arguments[1]&&"function"==typeof arguments[2]&&(o=arguments[2]),i?i===De()?(L.Logger.info(ae,"playAudio:play local audio are not allowed, user id is "+i),void(L.Utils.isFunction(o)&&o("YS_ERR_NOT_PLAY_SELF_AUDIO"))):void Wt(i,function(){N._playAudioStreams[Ct(i,YS.STREAM_VIDEO)]&&U.unplayAudio(i);var e=N._users[i];if(!e)return L.Logger.info(ae,"playAudio:user is not exist, user id is "+i),void(L.Utils.isFunction(o)&&o("YS_ERR_NOT_USER"));var t=Re(i,YS.STREAM_VIDEO,e.ys_maincamera);if(!t)return L.Logger.debug(ae,"playAudio: user has not stream, user id is "+i),void(L.Utils.isFunction(o)&&o("YS_NO_THIS_STREAM"));t.publisherId()===De()&&t.needChangevideoDeviceId&&(t.videoinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),delete t.needChangevideoDeviceId),t.publisherId()===De()&&t.needChangeaudioDeviceId&&(t.audioinputDeviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),delete t.needChangevideoDeviceId),Ve(t)}):(L.Logger.error(ae,"playAudio method got invalid userId!"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG")))},U.unplayAudio=function(e,t){if(At(t,!0)){if(L.Logger.info(ae," unplayAudio. userId:",e),!e)return L.Logger.error(ae,"unplayAudio method got invalid userId!"),void(L.Utils.isFunction(t)&&t("YS_ERR_INVALID_ARG"));var i=N._playAudioStreams[Ct(e,YS.STREAM_VIDEO)];if(!i)return L.Logger.debug(ae,"unplayAudio: user has not stream, user id is "+e),void(L.Utils.isFunction(t)&&t("YS_NO_THIS_STREAM"));Be(i)}},U.setLocalVideoMirror=function(e,t){L.Utils.isBoolean(e)?(L.Logger.info(ae," setLocalVideoMirror. isMirror:",e),YS.isMultiCamera&&void 0!==t||(N._isLocalVideoMirror=e),YS.isMultiCamera&&(N._isLocalVideoMirrorList[Rt(De(),YS.STREAM_VIDEO,t)]=e),Ue(t)&&Ne(t).setLocalVideoMirror(e)):L.Logger.error(ae,"The setLocalVideoMirror method parameter isMirror must be of Boolean type!")},U.getVideoProfile=function(e){return M.getVideoProfile(e)},U.setVideoProfile=function(e,i,o){if(At(i,!0)){var t=function(){L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"),L.Logger.error(ae," setVideoProfile method got invalid arguments",e)};if("object"===qt(e))if("number"==typeof e.width&&"number"==typeof e.height&&"number"==typeof e.maxfps){YS.isMultiCamera||(o=void 0);var r=function(e){if(!L.Utils.isNull(N._myself.id)){var t=N._myself.id;return e&&(t+=":"+e),Pe(t)}L.Logger.warning(ae,"The room has not been successfully connected yet. Please try again after the connection is successful!")}(o);M.setVideoProfile(e,o,function(){if(r){var e=M.getUseVideoProfile(o);if(r.maxfps=e.maxfps,M.hasConnection(r.getID())){var t=L.Utils.getMaxBPS(e.width,e.maxfps);isNaN(t)&&(t=1280),M.setBandWidth(r.getID(),t,function(){L.Logger.info(ae," setBandWidth success setBandWidth info:",t)},i)}}},function(){if(r){var e=M.getUseVideoProfile(o);_t(r,r.videoinputDeviceId,!0,e.maxfps)}}),M.getDeviceMgr()&&M.getDeviceMgr().isNativeSetVideoProfile||L.Logger.info(ae,"setVideoProfile profile:"+L.Utils.toJsonStringify(e)+(o?" , videoinputDeviceId is "+o:""))}else t();else t()}},U.getRoomUserNum=function(t,e,o,i){if(At(o,!0)&&kt(o,!0)){if(!L.Utils.isFunction(t))return L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," The parameter onSuccess of method getRoomUserNum must be a function");var r={companyid:N._room_properties.companyid,serial:N._room_properties.serial};void 0!==e&&Array.isArray(e)&&(r.role=e),i&&L.Utils.isString(i)&&(r.search=i);var n=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/ClientAPI/getroomusernum?ts="+(new Date).getTime();L.Utils.sdkAjax({url:n,dataType:"json",type:"GET",async:!0,data:r,success:function(e){L.Logger.debug(ae,"getroomusernum resp = ",L.Utils.toJsonStringify(e)),0===e.result?t(L.Utils.isNumber(Number(e.num))?Number(e.num):0):(L.Logger.warning(ae,"getroomusernum interface request fail , code is "+e.result),L.Utils.isFunction(o)&&o(e.result,e))},error:function(e,t,i){L.Logger.error(ae,"getroomusernum fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(o)&&o(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}},U.getRoomUsers=function(r,e,t,i,n,o,a){if(At(n,!0)&&kt(n,!0)){if(!L.Utils.isFunction(r))return L.Utils.isFunction(n)&&n("YS_ERR_INVALID_ARG"),void L.Logger.error(ae," The parameter onSuccess of method getRoomUsers must be a function");var s={companyid:N._room_properties.companyid,serial:N._room_properties.serial};if(void 0!==e&&L.Utils.isNumber(e)&&(s.start=e),void 0!==t&&L.Utils.isNumber(t)&&(s.max=t),void 0!==i&&Array.isArray(i)&&(s.role=i),o&&L.Utils.isString(o)&&(s.search=o),a&&Array.isArray(a)){for(var c=[],d=0,u=a.length;d<u&&("object"===qt(a[d])&&c.push(a[d]),!(3<=c.length));d++);c.length&&(s.order=c)}var l=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/ClientAPI/getroomusers?ts="+(new Date).getTime();L.Utils.sdkAjax({url:l,dataType:"json",type:"POST",async:!0,data:s,success:function(e){if(L.Logger.debug(ae,"getroomusers resp = ",L.Utils.toJsonStringify(e)),0===e.result){var t=[];if(e.userlist&&Array.isArray(e.userlist))for(var i=0,o=e.userlist.length;i<o;i++)t.push(YS.RoomUser(e.userlist[i]));r(t,e.total)}else L.Logger.warning(ae,"getroomusers interface request fail , code is "+e.result),L.Utils.isFunction(n)&&n(e.result,e)},error:function(e,t,i){L.Logger.error(ae,"getroomusers fail[ XHR , textStatus , errorThrown ]:",e,t,i),L.Utils.isFunction(n)&&n(window.YS.ERROR_NOTICE.ERR_HTTP_REQUEST_FAILED,"YS_ERR_HTTP_REQUEST_FAILED")}})}},U.getNativeInterface=function(e){return YS.isYsNative?l:(L.Utils.isFunction(e)&&e("YS_ERR_NOT_INITIALIZED"),void L.Logger.error(ae," getNativeInterface method must be called in the native environment!"))},U.getPlaybackInterface=function(){return p},U.getRoomUser=function(e,i,o){if(At(o,!0)&&kt(o,!0)){if(!e||!L.Utils.isFunction(i))return L.Logger.error(ae,"getRoomUser method got invalid argument!"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));if(N._roomMode===window.YS.ROOM_MODE.NORMAL_ROOM)N._users[e]?i(N._users[e]):L.Utils.isFunction(o)&&o("YS_ERR_NOT_DATA");else{var t=[];t.push(e),P.sendMessageSocket("getUser",t,function(e,t){0===e&&Array.isArray(t)&&t.length&&t[0]?i(YS.RoomUser(t[0])):L.Utils.isFunction(o)&&o("YS_ERR_NOT_DATA")})}}},U.setStreamProcessor=function(e){e&&L.Utils.isFunction(e)&&(v=e)},U.getIp=function(t,i){if(L.Utils.isFunction(t))try{var o=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),r=function(){},n={},a=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,s=function(e){n[e]||(L.Utils.isFunction(t)?t(e):L.Logger.error(ae," getIP method parameter is not a specified type"),n[e]=!0)};o.createDataChannel(""),o.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(a).forEach(s)}),o.setLocalDescription(e,r,r)}).catch(function(e){L.Logger.error(ae," getip An error occurred, so handle the failure to connect")}),o.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(a)&&e.candidate.candidate.match(a).forEach(s)}}catch(e){L.Utils.isFunction(i)?i(e):L.Logger.error(ae," getIP method parameter is not a specified type"),L.Logger.error(ae,"Use a browser that supports webRTC,form")}else L.Logger.error(ae," getIP method parameter is not a specified type")},U.getDocServerList=function(){for(var t=[],e=0,i=N._backupCourseAddrList.length;e<i;e++){var o=N._backupCourseAddrList[e];o.docaddr&&Array.isArray(o.docaddr)&&o.docaddr.forEach(function(e){t.push(e)})}return N._docServerAddr&&t.push(N._docServerAddr),t||[]},U.reportDocServer=function(e){N._useDocServerAddr=e,Qe()},U.setNoticeInterval=function(e){y=e},U.enableDualStream=function(e){At(void 0,!0)&&(g=!!e,U.changeUserProperty(De(),"__all",{ys_enabledualstream:g}))},U.setSmallStreamParameter=function(e){At(void 0,!0)&&(e&&"object"===qt(e)?M.setSmallVideoProfile(Number(e.width),Number(e.height),Number(e.maxfps)):L.Logger.error(ae,"setSmallStreamParameter method parameter type is incorrect"))},U.setRemoteDefaultVideoStreamType=function(e){At(void 0,!0)&&(O=!!e)},U.setRemoteVideoStreamType=function(n,e,t){if(At(void 0,!0))if(e){var a=U.getUser(e);if(a){if(a.ys_enabledualstream){var s="Dual:"+(t||"");if(a[s]===n)return;if(n===Gt||n===zt){var i=function(t){if("object"!==qt(t)||!t.userId)return L.Logger.error(ae,"Parameter not valid in private function _getStreams");var i=[];if(t.userId){var o=new RegExp(t.userId);Object.values(U.remoteStreams).forEach(function(e){o.test(e.extensionId)&&i.push(e)})}if(t.deviceId&&i.length){var r=new RegExp(t.deviceId);i=i.filter(function(e){return r.test(e.extensionId)})}t.streamType&&i.length?i=i.filter(function(e){return e.attributes.type===t.streamType}):i.length&&(i=i.filter(function(e){return e.attributes.type===YS.STREAM_VIDEO}));return i}({userId:e,deviceId:t}),c=[],d=[];i.length&&(n===Gt?(c=i.filter(function(e){return!!e.subscribed&&/yssmall/.test(e.extensionId)}),d=i.filter(function(e){return!e.subscribed&&!/yssmall/.test(e.extensionId)})):n===zt&&(c=i.filter(function(e){return!!e.subscribed&&!/yssmall/.test(e.extensionId)}),d=i.filter(function(e){return!e.subscribed&&/yssmall/.test(e.extensionId)})),d.length&&d.forEach(function(o,r){rt(o,{},function(e){e&&c.length&&(le(o.extensionId,!0),c.forEach(function(i){It(o.extensionId)===It(i.extensionId)&&i.getVideoPlayer()&&i.getVideoPlayer().elementID&&i.replaceStream(o,function(e,t){0===e&&(nt(i,function(e){e&&(Ve(o,{},!0),Be(i,{},!0),le(i,!1))}),r===d.length&&(a[s]=n))})}))})}))}}}else L.Logger.error(ae,"setRemoteVideoStreamType method user was not found by specifying parameters,userId:"+e)}else L.Logger.error(ae,"setRemoteVideoStreamType method missing parameter.")},U.destroyServerRoom=function(){L.Logger.info("call destroyServerRoom");U.pubMsg({name:"Server_RoomEnd",id:"Server_RoomEnd",toID:"__none",data:{},save:!1})},U.eventLog=function(e){if("object"===qt(e)){if(!N._web_host)return N._eventLogAwitlist=N._eventLogAwitlist||[],void N._eventLogAwitlist.push(e);if(N._eventLogAwitlist&&N._eventLogAwitlist.length){for(var t in N._eventLogAwitlist)Ht(N._eventLogAwitlist[t]);N._eventLogAwitlist=[],delete N._eventLogAwitlist}Ht(e)}},U.setLocalStreamAttributes=function(e,t){if(e&&"object"===qt(e)){if(!YS.isMultiCamera||void 0===t)for(var i in e)N._videoStreamAttrs[i]=e[i];if(YS.isMultiCamera)for(var i in N._videoStreamListAttrs[Rt(De(),YS.STREAM_VIDEO,t)]=N._isLocalVideoMirrorList[Rt(De(),YS.STREAM_VIDEO,t)]||{},e)N._videoStreamListAttrs[Rt(De(),YS.STREAM_VIDEO,t)][i]=e[i];Ue(t)&&(Ne(t).updateLocalAttributes(e),Ne(t).setAttributes(e))}},U.liveSimulateServerCommunicationInterface=function(e){if(f["_handler_"+e]&&"function"==typeof f["_handler_"+e]){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);f["_handler_"+e].apply(null,t)}},U.changeUserPublish=function(e,t,i){if(At(void 0,!0)&&kt(void 0,!0))if(void 0!==e)if(YS.isMultiCamera){var o={};o["publishstate:"+i]=t,U.changeUserProperty(e,"__all",o)}else U.changeUserProperty(e,"__all",{publishstate:t});else L.Logger.error(ae,"changeUserPublish method id is not exist!")},U.changeUserShare=function(e,t,i){if(i){if(At(void 0,!0)&&kt(void 0,!0))if(void 0!==e){var o={};o[i]=t,U.changeUserProperty(e,"__all",o)}else L.Logger.error(ae,"changeUserShare method id is not exist! type:",i)}else L.Logger.error(ae,"changeUserShare method type is not exist!")},U.changeMyDisableVideoState=function(e){At(void 0,!0)&&kt(void 0,!0)&&("boolean"==typeof e?U.changeUserProperty(De(),"__all",{disablevideo:e}):L.Logger.warning(ae,"changeMyDisableVideoState:disablevideo must boolean !"))},U.changeMyDisableAudioState=function(e){At(void 0,!0)&&kt(void 0,!0)&&("boolean"==typeof e?U.changeUserProperty(De(),"__all",{disableaudio:e}):L.Logger.warning(ae,"changeMyDisableAudioState:disableaudio must boolean !"))},U.updateVideoPlayerOptions=function(e,t,i,o,r){if(At(void 0,!0)){if("object"!==qt(e))return L.Logger.error(ae," updateVideoPlayerOptions method options muset is json!"),void(L.Utils.isFunction(i)&&i("YS_ERR_INVALID_ARG"));var n=Re(t,o||YS.STREAM_VIDEO,r);if(!n)return L.Logger.debug(ae," updateVideoPlayerOptions: user is not stream  , user id is "+t),void(L.Utils.isFunction(i)&&i("YS_NO_THIS_STREAM"));n.updateVideoPlayerOptions(e)}},U.registerRoomWhiteBoardDelegate=function(e){if(e&&"YSWhiteBoardManager"===e.className&&"function"==typeof e.registerRoomDelegate){if((Y=e)&&(Y.registerRoomDelegate&&Y.registerRoomDelegate(U),Y.changeCommonWhiteBoardConfigration)){var t={};if(N._web_protocol&&N._web_host&&void 0!==N._web_port&&(t.webAddress={protocol:N._web_protocol,hostname:N._web_host,port:N._web_port}),N._doc_protocol&&N._doc_host&&void 0!==N._doc_port&&(t.docAddress={protocol:N._doc_protocol,hostname:N._doc_host,port:N._doc_port}),N._backup_doc_host_list.length){for(var i=[],o=0,r=N._backup_doc_host_list.length;o<r;o++)i.push({protocol:N._backup_doc_protocol,hostname:N._backup_doc_host_list[o],port:N._backup_doc_port});t.backupDocAddressList=i}t.myUserId=De(),void 0!==N._myself.nickname&&(t.myName=N._myself.nickname),void 0!==N._myself.role&&(t.myRole=N._myself.role),t.isPlayback=YS.isPlayback,Y.changeCommonWhiteBoardConfigration(t)}}else L.Logger.warning(ae,"register whiteboardManagerInstance not is a YSWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")},U.stopShareLocalMedia=function(o,r,e){if(At(o,!0)&&kt(o,!0)){e=e||{};var t=!1;for(var i in U.remoteStreams){var n=U.remoteStreams[i];if(n&&"file"===n.getAttributes().type){if(e&&"object"===qt(e)&&e.onlyStopMyself&&n.publisherId()!==De())continue;t=!0,YS.isYsNative&&n.publisherId()===De()?l.stopShareMediaFile():a(n)}}t||(L.Logger.info(ae,"No media file are Shared!"),o&&"function"==typeof o&&o("YS_ERR_NOT_LOCAL_MEDIA_FILE_SHARED"))}function a(i){L.Logger.info(ae,"calling stopShareLocalMedia , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),P.sendMessageSocket("unpublish",i.getID(),function(e,t){0!==e?(L.Logger.warning(ae,"Error unpublish local media stream fail, stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes()),"error code is "+e+" ,error info:",t),L.Utils.isFunction(o)&&o(t)):(L.Logger.debug(ae,"meidaStream unpublished , stream id:"+i.getID()+" , extensionId is "+i.extensionId+", attrs is "+L.Utils.toJsonStringify(i.getAttributes())),L.Utils.isFunction(r)&&r())})}},U.joinPlaybackRoom=Tt,U.seekPlayback=function(e,t){e&&L.Utils.isNumber(e)&&N._durationTime?P.socketSend("seekPlayback",e):L.Logger.error(ae,"Incorrect parameter!")},U.pausePlayback=Et,U.getUploadFileParams=function(e,t,i,o){if(At(void 0,!0)){i=void 0===i||i;var r={serial:N._room_properties.serial,userid:De(),sender:N._myself.nickname,conversion:1,isconversiondone:0,writedb:i?1:0,fileoldname:e,filetype:t,alluser:1};return o&&(r.codeid=o),r}},U.uploadFile=function(e,i,t){if(At(void 0,!0)&&kt(void 0,!0))if(e){if(e instanceof FormData)return ce(e,i,t,function(e,t){L.Utils.isFunction(i)&&i(e,t)});if(e.filename&&e.filetype&&e.filedata){var o=U.getUploadFileParams(e.filename,e.filetype,e.isWritedb,e.qRCodeId),r=new FormData;for(var n in o)r.append(n,o[n]);return r.append("filedata",e.filedata),ce(r,i,t,function(e,t){L.Utils.isFunction(i)&&i(e,t)})}L.Logger.error(ae," uploadFile method Parameters of the lack of!")}else L.Logger.error(ae,"uploadFile method Parameters of the lack of!")},U.deleteFile=function(e,i){At(void 0,!0)&&kt(void 0,!0)&&(null!=e?ue(e,i,function(e,t){L.Utils.isFunction(i)&&i(e,t)}):L.Logger.error(ae,"deleteFile fileid is required!"))},U.switchServerByName=function(e){if(At(void 0,!0)){if(void 0!==N._web_host&&void 0!==N._web_port)if(0<N._connectedNumber)if(N._serverName!==e)if(N._useServerScreenRecording||N._ys_room_test_sdk||!N._web_host||/(192.168.|127.0.0.1|127.17.|localhost)/g.test(N._web_host)||!N._serverName)L.Logger.error(ae," The switching condition is not satisfied, cannot call changeWebRequestAddress ! ");else{N._serverName=e,T(N._serverList,N._serverName);I({source:"select service reconnect"})}else L.Logger.info(ae,"server name not change , not need reconnect service!");else L.Logger.error(ae,"selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! ");else L.Logger.error(ae,"selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");return!0}},U.setLogLevel=function(e){if(e){J=e;var t=L.Logger.DEBUG;"4"===e?t=L.Logger.INFO:"5"===e?t=L.Logger.WARNING:"6"===e&&(t=L.Logger.ERROR),L.Logger.setLogLevel(t)}},U.getStreamStats=function(n,t){try{if(n&&t){var e=[];for(var a in U.remoteStreams){var i=U.remoteStreams[a];e.push(function(r){return new Promise(function(i,o){P.socketSend("getStreamStats",{streamId:a,peerId:n},function(e,t){switch(e){case 0:!function(e,t){if(!t[n])return L.Logger.warning(ae,"getStreamStats method error info : stats  not exist!"),o();t[n].type=wt(e.extensionId)===n?"up":"down",t[n].userId=wt(e.extensionId),t[n].peerId=n,t[n]&&t[n].video&&(t[n].video.frameRate=e.frameRate);YS.isMultiCamera&&(t[n].deviceId=wt(e.extensionId,1));i(t[n])}(r,t);break;case 1:L.Logger.warning(ae,"getStreamStats method error info :  room does not exist!"),o(e);break;case 2:L.Logger.warning(ae,"getStreamStats method error info :"+r.id+"  stream does not exist!"),o(e);break;case 3:L.Logger.warning(ae,"getStreamStats method error info :"+n+" user not exist!"),o(e);break;default:o(e)}})})}(i))}Promise.all(e).then(function(e){var a=U.getUsers();e.forEach(function(e){for(var t in U.remoteStreams){var i=U.remoteStreams[t],o=wt(i.extensionId),r=wt(i.extensionId,1);if(!(o!==e.userId||YS.isMultiCamera&&r!==e.deviceId)){var n=a[o];if(n){if(e&&e.video&&(1==e.video.videoMute?delete e.video:(e.video.videoFps&&e.video.frameRate&&(e.video.frameRate=e.video.frameRate>e.video.videoFps?e.video.videoFps:e.video.frameRate),e.video.videoWidth=i&&i.width?i.width:0,e.video.videoHeight=i&&i.height?i.height:0,delete e.video.videoFps)),e&&e.audio&&1==e.audio.audioMute&&delete e.audio,YS.isMultiCamera){for(var t in n)if(("publishstate"===t||/publishstate:/g.test(t))&&Dt(t)===e.deviceId){1==n[t]?delete e.video:2==n[t]&&delete e.audio;break}}else 1==n.publishstate?delete e.video:2==n.publishstate&&delete e.audio;break}}}}),t(e)}).catch(function(e){L.Logger.warning(ae,"getStreamStats method promise error info :",e)})}else L.Logger.warning(ae,"getStreamStats method specifies that the parameter type is incorrect!"),L.Utils.isFunction(t)&&t()}catch(e){L.Logger.warning(ae,"getStreamStats method error info: ",e)}},U.startShareScreen=function(o,r){if(L.Logger.info(ae,"call startShareScreen",o),At(void 0,!0)&&kt(void 0,!0))if(YS.isOnlyAudioRoom)L.Logger.warning(ae,"only audio room not execute method publishVideo method !");else{if(L.Utils.getBrowserInfo(!0).versions.mobile)return L.Logger.warning(ae,"mobile not suport share screen!"),void(r&&r(window.YS_ERR.NOT_SUPPORT));(o=o||{}).electronblackwinlist&&(o.electron=o.electron||{},o.electron.blackwinlist=o.electronblackwinlist),L.Logger.info("checkUserDesktopMediaMode start"),YS.DeviceMgrImpl.checkUserDesktopMediaMode(function(e){L.Logger.info("checkUserDesktopMediaMode finsh",e),e?(L.Logger.info("openWebScreen start",o),M.openWebScreen(o,function(e){L.Logger.info("openWebScreen finsh",o);var t=YS.SCREENSTATE_ON;if(t!==vt()){U.changeUserShare(De(),t,"ys_screenstate");var i={};o&&o.video&&o.video.mandatory?(o.video.mandatory.maxWidth?i.videowidth=o.video.mandatory.maxWidth:L.Logger.error(ae,"ShareScreen must set videowidth"),o.video.mandatory.maxHeight?i.videoheight=o.video.mandatory.maxHeight:L.Logger.error(ae,"ShareScreen must set videoheight")):(i.videowidth=window.screen.width,i.videoheight=window.screen.height),function(e,t,i){t=t||{};var o=Pe(De()+":screen");if(!L.Utils.isNull(o))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_IN_PROGRESS"),L.Logger.error(ae,"Share screen in progress.");var r={video:!0,isWeb:!0};e&&e.getAudioTracks&&e.getAudioTracks().length&&(r.audio=!0);(o=je("screen",r)).mediaStream=e,o.needPublishToServer=!0,L.Logger.info(ae,"calling screenPublish stream , stream id:"+o.getID()+" , extensionId is "+o.extensionId+", attrs is "+L.Utils.toJsonStringify(o.getAttributes())),e&&e.electronSourceId&&o.setAttributes({electronSourceId:e.electronSourceId});void 0===U.remoteStreams[o.getID()]?it(o,t,function(e,t){e||L.Utils.isFunction(i)&&i(t,"please install the web sharing plug-in")}):(L.Logger.error(ae,"Trying to publish invalid screenStream",o),L.Utils.isFunction(i)&&i(void 0,"Trying to publish invalid screenStream"))}(e,i,r)}},function(e){L.Logger.info(ae,"No media stream from the plug-in was retrieved",e),L.Utils.isFunction(r)&&(e&&e.code&&e.message?r(e.code,e.message):r(void 0,"No media stream from the plug-in was retrieved"))},function(e){L.Logger.info(ae,"Sharing has closed data."),U.stopShareScreen()})):L.Utils.isFunction(r)&&r(window.YS_ERR.CHECK_USERDesktopMediaError,"please install the web sharing plug-in")})}},U.stopShareScreen=function(e){if(At(void 0,!0)&&kt(void 0,!0)){var t=YS.SCREENSTATE_OFF;t!==vt()&&(U.changeUserShare(De(),t,"ys_screenstate"),function(i){M.closeWebScreen();var e=Pe(De()+":"+YS.STREAM_SCREEN);if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_TERMINATED"),L.Logger.warning(ae,"Could not find the specify stream while stop sharing screen.");e.needPublishToServer=!1,L.Logger.info(ae,"calling unpublishScreen , stream id:"+e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes())),ot(e,function(e,t){e||L.Utils.isFunction(i)&&i(t),Me(De()+":"+YS.STREAM_SCREEN)&&Oe(De()+":"+YS.STREAM_SCREEN)})}(e))}},U.shareSceenIsNeedPlugin=function(){return YS.DeviceMgr.checkDesktopIsNeedPlugin()},U.startAudioMix=function(e,t){if(N._isMix)return M.getDeviceMgr().startAudioMix(e,t);L.Logger.warning(ae,"startAudioMixing:Remix configuration is not allowed. If you need to remix, configure isMix to be true when calling the init method")},U.stopAudioMix=function(e,t){return M.getDeviceMgr().stopAudioMix(e,t)},U.stopAllAudioMix=function(){return M.getDeviceMgr().stopAllAudioMix()},f._handler_participantLeft=function(e,t){var i=N._users[e];if(void 0!==i){L.Logger.debug(ae,"user left room  , user info: "+L.Utils.toJsonStringify(i)),L.Logger.info(ae,"user left room  , user id: "+e);var o=[];for(var r in U.remoteStreams){var n=U.remoteStreams[r];e==n.publisherId()&&o.push(n)}for(var a in o)P.onRemoveStream({id:o[a].getID()});YS.isPlayback&&void 0!==t&&(i.leaveTs=t),YS.isPlayback?N._users[e]&&(N._users[e].playbackLeaved=!0):delete N._users[e];var s=YS.RoomEvent({type:YS.EVENT_TYPE.roomParticipantLeave,user:i});U.dispatchEvent(s)}else L.Logger.error(ae,"participantLeft user is not exist , userid is "+e+"!")},f._handler_participantJoined=function(e){L.Logger.debug(ae,"participantJoined userinfo:"+L.Utils.toJsonStringify(e));var t=YS.RoomUser(e);L.Logger.info(ae,"user joined room  , user id : "+t.id),N._users[t.id]=t,YS.isPlayback&&N._users[t.id]&&delete N._users[t.id].playbackLeaved,YS.isPlayback&&"object"===qt(e)&&(t.joinTs=e.ts);var i=YS.RoomEvent({type:YS.EVENT_TYPE.roomParticipantJoin,user:t});U.dispatchEvent(i)},f._handler_participantPublished=function(e){if(L.Logger.debug(ae,"participantPublished userinfo:"+L.Utils.toJsonStringify(e)),N._roomMode===window.YS.ROOM_MODE.BIG_ROOM){var t=YS.RoomUser(e),i=N._users[t.id];if(i)for(var o in t)i[o]=t[o];else i=t;N._users[i.id]=i,YS.isPlayback&&N._users[i.id]&&delete N._users[i.id].playbackLeaved,YS.isPlayback&&"object"===qt(e)&&(i.joinTs=e.ts)}},f._handler_sendMessage=function(e){if(L.Logger.debug(ae,"room-text-message info:"+(e&&"object"===qt(e)?L.Utils.toJsonStringify(e):e)),e&&e.hasOwnProperty("message")){var t=N._users[e.fromID];t=t||{id:e.fromID,nickname:t?t.nickname:e.nickname,role:t?t.role:e.role},e&&e.message&&"string"==typeof e.message&&(e.message=L.Utils.toJsonParse(e.message)),YS.isPlayback&&void 0!==e.ts&&"object"===qt(e.message)&&(e.message.ts=e.ts);var i=YS.RoomEvent({type:YS.EVENT_TYPE.roomTextMessage,user:t,message:e.message},{userid:e.fromID,nickname:t?t.nickname:e.nickname,role:t?t.role:e.role});U.dispatchEvent(i)}else L.Logger.error(ae,"room-text-message messages or messages.message is not exist!")},f._handler_pubMsg=function(e){if(L.Logger.debug(ae,"pubMsg info:",L.Utils.toJsonStringify(e)),e&&"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data)),"OnlyAudioRoom"===e.name)return L.Logger.info(ae,"pubMsg name : OnlyAudioRoom , from : ",e.fromID),void Je(!0,e.fromID);if("ClassBegin"===e.name&&L.Logger.info(ae,"pubMsg name : ClassBegin , from : ",e.fromID),"ServerRecord"===e.name&&L.Logger.info(ae,"pubMsg name : ServerRecord , from : ",e.fromID),"DocumentChange"===e.name&&He(e),"RemoteControl"===e.name&&function(e){if(e&&e.data){var t=e.data.type,i={associatedMsgID:"ClassBegin",id:"RemoteControl",name:"RemoteControl",toID:e.fromID,do_not_save:""};switch(t){case"getDeviceInfo":YS.DeviceMgrImpl.getDevices(function(e){YS.isMultiCamera&&e.devices&&e.devices.videoinput&&delete e.devices.videoinput,i.data={action:"deviceManagement",type:"sendDeviceInfo",deviceData:{deviceInfo:e}},P.socketSend("pubMsg",i)},{isSetlocalStorage:!1});break;case"changeDeviceInfo":if(M.getDeviceMgr().checkIsSupportSetSpeaker()){var o=e.data.changeData.selectDeviceInfo;YS.DeviceMgrImpl.setDevices(o,function(){L.Logger.error(ae,"set devices failed")})}}}}(e),"BigRoom"===e.name){N._roomMode=window.YS.ROOM_MODE.BIG_ROOM,tt(),L.Logger.info(ae,"pubMsg name : BigRoom , roomMode : ",N._roomMode);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomModeChanged,message:{roomMode:N._roomMode}});U.dispatchEvent(t)}"DocTransformComplete"===e.name&&null!==b&&(de(b,!1),_=!1,b=null);t=YS.RoomEvent({type:YS.EVENT_TYPE.roomPubmsg,message:e});U.dispatchEvent(t)},f._handler_delMsg=function(e){if(L.Logger.debug(ae,"delMsg info:",L.Utils.toJsonStringify(e)),e&&"string"==typeof e&&(e=L.Utils.toJsonParse(e)),e.data&&"string"==typeof e.data&&(e.data=L.Utils.toJsonParse(e.data)),"OnlyAudioRoom"===e.name)return L.Logger.info(ae,"delMsg name : OnlyAudioRoom , from : ",e.fromID),void Je(!1,e.fromID);if("BigRoom"===e.name){N._roomMode=window.YS.ROOM_MODE.NORMAL_ROOM,tt(),L.Logger.info(ae,"delMsg name : BigRoom , roomMode : ",N._roomMode);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomModeChanged,message:{roomMode:N._roomMode}})}if("ClassBegin"===e.name){L.Logger.info(ae,"delMsg name : ClassBegin , from : ",e.fromID);try{N._useServerScreenRecording&&jt()&&(L.Logger.info(ae,"recorder class over,roomid is "+N._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(N._myself)),jt().over())}catch(e){L.Logger.error(ae,"roadofrecorder err:",e)}}"ServerRecord"===e.name&&L.Logger.info(ae,"delMsg name : ServerRecord , from : ",e.fromID);t=YS.RoomEvent({type:YS.EVENT_TYPE.roomDelmsg,message:e});U.dispatchEvent(t)},f._handler_setProperty=function(e){L.Logger.debug(ae,"setProperty info:",L.Utils.toJsonStringify(e));var t=e,i=t.id;if((i!==De()||i===De()&&De()!==t.fromID)&&t.hasOwnProperty("properties")&&Bt(t.properties)&&L.Logger.info(ae,"change user property,user id is "+i+",change property:"+L.Utils.toJsonStringify(t.properties)),t.hasOwnProperty("properties")){var o=t.properties,r=N._users[i];if(De()===i)for(var n in r=N._myself,o)if("publishstate"===n||/publishstate:/g.test(n)){var a=Dt(n),s=o[n];if(Te(s,a,e.toID),s>YS.PUBLISH_STATE_NONE)(l=Ne(a,!0))&&U.remoteStreams[l.getID()]&&We(l);else if(s===YS.PUBLISH_STATE_NONE){(l=Ne(a))&&$(l)}M.needRePublish(l.getID())&&St(l)}else"disablevideo"===n?Ee(o[n]):"disableaudio"===n&&Ae(o[n]);if(!r)return void(N._roomMode!==window.YS.ROOM_MODE.NORMAL_ROOM&&L.Logger.info(ae,"setProperty user is not exist , userid is "+i+", change user property inof:"+L.Utils.toJsonStringify(e)+"!"));var c=r.servername,d=r.ys_maincamera;for(var n in o)"id"!=n&&"watchStatus"!=n&&(r[n]=o[n]);if(De()!==r.id)for(var u in o)if("publishstate"===u||/publishstate:/g.test(u))for(var n in U.remoteStreams){var l;if((l=U.remoteStreams[n]).publisherId()!==De()&&l.getAttributes().type===YS.STREAM_VIDEO&&o[u]>YS.PUBLISH_STATE_NONE&&U.remoteStreams[l.getID()]&&U.remoteStreams[l.getID()].subscribed)if("publishstate"===u)l.extensionId===r.id&&We(l);else{a=Dt(u);l.extensionId===r.id+":"+a&&We(l)}}De()===i&&o.hasOwnProperty("ys_maincamera")&&De()!==t.fromID&&o.ys_maincamera!==d&&bt(o.ys_maincamera,function(e){L.Logger.warning(ae,"other user control set main camera fail,fail info:",e),U.changeUserProperty(De(),"__all",{ys_maincamera:d})}),De()===i&&o.hasOwnProperty("servername")&&(De()!==t.fromID?o.servername&&o.servername!==c&&U.switchServerByName(o.servername):o.servername&&o.servername!==c&&(N._serverName=o.servername,T(N._serverList,N._serverName)));var p=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserPropertyChanged,user:r,message:o},{fromID:t.fromID,userId:r.id});if(U.dispatchEvent(p),De()!==r.id&&o.hasOwnProperty("ys_maincamera")){L.Logger.info(ae,"change user main camera device id,user id is "+i+",change device id is "+o.ys_maincamera+",old device id is "+d);var f=YS.RoomEvent({type:YS.EVENT_TYPE.roomUserMainCameraChanged,message:{userId:r.id,deviceId:o.ys_maincamera}});U.dispatchEvent(f)}}},p.onJoinPlaybackRoom=Tt,p.onSeekPlayback=function(e,t){if(At(t,!0)){if(!YS.isPlayback)return L.Logger.warning(ae,"No playback environment!"),void(L.Utils.isFunction(t)&&t("YS_ERR_NOT_PLAYBACK_ENVIRONMENT"));try{var i=Math.floor(Number(e*N._durationTime));i>N._durationTime&&(i=N._durationTime),P.socketSend("seekPlayback",i)}catch(e){L.Utils.isFunction(t)&&t("YS_ERR_UNKNOWN"),L.Logger.error(ae,"The seek posttion must be a number, in milliseconds !")}}},p.onPausePlayback=Et,p.onPlaybackClearAll=function(){if(YS.isPlayback){N._roomMode=window.YS.ROOM_MODE.NORMAL_ROOM,L.Logger.info(ae,"room mode changed,current mode is "+N._roomMode);var e=YS.RoomEvent({type:YS.EVENT_TYPE.roomModeChanged,message:{roomMode:N._roomMode}});U.dispatchEvent(e);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomPlaybackClear_all});U.dispatchEvent(t),YS.isPlayback?(o(),N._users[De()]=N._myself):L.Logger.error(ae,"No playback environment, no execution playbackClearAll!")}else L.Logger.warning(ae,"No playback environment!")},p.onHandlerDuration=function(e){if(YS.isPlayback){var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomPlaybackDuration,message:e});N._durationTime=e,U.dispatchEvent(t)}else L.Logger.warning(ae,"No playback environment!")},p.onHandlerPlaybackEnd=function(){if(YS.isPlayback){try{N._useServerScreenRecording&&jt()&&(L.Logger.info(ae,"recorder class over,roomid is "+N._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(N._myself)),jt().over())}catch(e){L.Logger.error(ae,"roadofrecorder err:",e)}var e=YS.RoomEvent({type:YS.EVENT_TYPE.roomPlaybackPlaybackEnd});U.dispatchEvent(e)}else L.Logger.warning(ae,"No playback environment!")},p.onHandlerPlaybackUpdateTime=function(e){if(YS.isPlayback){var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomPlaybackPlayback_updatetime,message:e});U.dispatchEvent(t)}else L.Logger.warning(ae,"No playback environment!")},f._handler_connectSocketSuccess=function(e,t){if(N._isLeaveRoom)return L.Logger.info(ae,"The room is over. Method _handler_connectSocketSuccess cannot be executed!"),void(P&&P.isHasSocket&&P.isHasSocket()&&U.leaveroom());YS.isYsNative&&!N._handlerCallbackJson&&(N._handlerCallbackJson=!0,window.ysnative.postMessage({command:"initNative",localId:De().toString(),width:320,height:240,fps:10,roomInfo:N._roomCheckRoomInfoString,webAddr:N._web_host.toString(),webPort:N._web_port.toString(),ys_multistream:YS.isMultiCamera}));var i=t.roominfo,o=t.msglist,r=t.userlist,n=t.currServerTs,a=[],s=i.streams||[],c=i.id;for(var d in YS.networkTestInfo.protocol=N._web_protocol,YS.networkTestInfo.host=N._socket_host||N._web_host||"api.roadofcloud.com",YS.networkTestInfo.port=N._web_port||/https/g.test(N._web_protocol)?443:80,N._isConnected=!0,YS.networkTestInfo.isConnectRoom=!0,U.iceServers=i.iceServers,D.defaultVideoBW=N._room_video_maxbps,D.maxVideoBW=N._room_video_maxbps,D.defaultScreenBW=L.Utils.getMaxBPS(1280,20),D.maxScreenBW=L.Utils.getMaxBPS(1280,20),D.defaultLocalFileMediaBW=L.Utils.getMaxBPS(640,30),D.maxLocalFileMediaBW=L.Utils.getMaxBPS(640,30),N._users={},N._users[De()]=N._myself,N._myself){if(YS.isMultiCamera){if(/publishstate:/g.test(d)&&N._myself[d]>YS.PUBLISH_STATE_NONE){var u=Dt(d);K(N._myself[d],void 0,void 0,u),it(h=Ne(u,!0))}}else if("publishstate"===d)if(N._myself[d]>YS.PUBLISH_STATE_NONE)K(N._myself[d],void 0,void 0,void 0),it(h=Ne(void 0,!0))}for(var l in s)if(s.hasOwnProperty(l)){var p=s[l],f=!1;YS.subscribe_from_native&&(f=!0);var m=wt(p.extensionId),g=(wt(p.extensionId,1),!0),v="yssmall"===wt(p.extensionId,2)?1:0;r.forEach(function(e){e.id===m&&e.properties&&e.properties.ys_enabledualstream&&v!=O&&(g=!1)});var h=YS.Stream({streamID:p.id,local:!1,audio:p.audio,video:p.video,data:p.data,screen:p.screen,attributes:p.attributes,extensionId:p.extensionId,getVideoTrack:Nt,getAudioTrack:Ut,getRegisterAudioVolumeListener:Yt},f);a.push(h),U.remoteStreams[p.id]=h,L.Logger.info(ae,"room-connected --\x3e stream info , stream id:"+h.getID()+" , extensionId is "+h.extensionId+", attrs is "+L.Utils.toJsonStringify(h.getAttributes())),g&&rt(h)}for(var l in r)if(r.hasOwnProperty(l)){var S=r[l],y=YS.RoomUser(S);void 0!==y&&(N._users[y.id]=y,YS.isPlayback&&N._users[y.id]&&delete N._users[y.id].playbackLeaved,L.Logger.info(ae,"room-connected --\x3e user info: "+L.Utils.toJsonStringify(y)))}L.Logger.info(ae,"room-connected --\x3e myself info: "+L.Utils.toJsonStringify(N._myself));var _=new Array;if(o&&"string"==typeof o&&(o=L.Utils.toJsonParse(o)),o.hasOwnProperty("OnlyAudioRoom")){var b=o.OnlyAudioRoom;L.Logger.info(ae,"msglist msg name : OnlyAudioRoom , from : ",b.fromID),Je(!0,b.fromID),2===YS.needOnlyAudioRoom&&U.switchOnlyAudioRoom(!1)}else 1===YS.needOnlyAudioRoom&&U.switchOnlyAudioRoom(!0);o.hasOwnProperty("BigRoom")?(N._roomMode=window.YS.ROOM_MODE.BIG_ROOM,tt()):N._roomMode=window.YS.ROOM_MODE.NORMAL_ROOM,L.Logger.info(ae,"room mode changed,current mode is "+N._roomMode);var w=YS.RoomEvent({type:YS.EVENT_TYPE.roomModeChanged,message:{roomMode:N._roomMode}});for(var d in U.dispatchEvent(w),o)o.hasOwnProperty(d)&&_.push(o[d]);if(_.sort(function(e,t){return void 0!==e&&e.hasOwnProperty("seq")&&void 0!==t&&t.hasOwnProperty("seq")?e.seq-t.seq:0}),L.Logger.debug(ae,"Connected to room "+c),L.Logger.debug(ae,"connected response:",L.Utils.toJsonStringify(t)),L.Logger.info(ae,"room-connected ,streams length is "+a.length+" , signalling list length "+_.length),Y&&Y.changeCommonWhiteBoardConfigration){for(var I=[],T=0,E=N._backup_doc_host_list.length;T<E;T++)I.push({protocol:N._backup_doc_protocol,hostname:N._backup_doc_host_list[T],port:N._backup_doc_port});Y.changeCommonWhiteBoardConfigration({webAddress:{protocol:N._web_protocol,hostname:N._web_host,port:N._web_port},docAddress:{protocol:N._doc_protocol,hostname:N._doc_host,port:N._doc_port},backupDocAddressList:I,myUserId:De(),myName:N._myself.nickname,myRole:N._myself.role,isConnectedRoom:N._isConnected,isPlayback:YS.isPlayback})}if(F+=1,!YS.isPlayback){var A=0;Qe(),clearInterval(U._networkequipmentTimer),clearInterval(U._catonNumber),clearInterval(U.sendcatonNumber),U._networkequipmentTimer=setInterval(function(){var c=[],d=!1;10<=++A&&(A=0,N._sentAloneNetQualityBadList={},d=!0);var u=0;for(var e in U.remoteStreams){var t=U.remoteStreams[e];t.getAttributes().type===YS.STREAM_VIDEO&&N._users[t.publisherId()]&&function(s){u++,ct(s,function(e){if(u--,e&&N._users[s.publisherId()]){var t=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.video)),i=L.Utils.toJsonParse(L.Utils.toJsonStringify(e.audio));delete t.packetsLostRate,delete i.packetsLostRate;var o={video:t,audio:i,cpuOccupancy:0,peerId:N._users[s.publisherId()].id,peerName:N._users[s.publisherId()].nickname,streamId:s.getID()};U.remoteStreams[s.getID()].width=t.frameWidth,U.remoteStreams[s.getID()].height=t.frameHeight,U.remoteStreams[s.getID()].frameRate=t.frameRate;var r=[];r.push(o);var n={};if(s&&s.extensionId&&s.extensionId.split&&(n=M.getVideoProfile(s.extensionId.split(":")[1])),st(r,s,n.maxfps),(!d&&e.audio.netquality>=window.YS.NET_QUALITY.YS_NET_QUALITY_BAD||e.video.netquality>=window.YS.NET_QUALITY.YS_NET_QUALITY_BAD)&&!N._sentAloneNetQualityBadList[s.getID()]){N._sentAloneNetQualityBadList[s.getID()]=!0;var a=[];a.push(o),st(a,s)}d&&(N._isSendAllPublishUserNetworkequipment?c.push(o):s.publisherId()===De()&&c.push(o),u<=0&&(d=!1,st(c,s)))}s=void 0},function(){u--})}(t)}},6e3),U._catonNumber=setInterval(function(){var e=[];for(var t in U.remoteStreams){var i=U.remoteStreams[t];i.getAttributes().type===YS.STREAM_VIDEO&&N._users[i.publisherId()]&&function(d){try{e.push(new Promise(function(c,e){ct(d,function(e){if(e.video&&e.video.frameRate<=3&&d.getLoadFirstVideoFrameTs()&&2e3<(new Date).getTime()-d.getLoadFirstVideoFrameTs()&&d.publisherId()!==N._myself.id&&M.hasConnection(d.getID())&&M.videoEnabled(d.getID())){var t=ft(d).replace(/\:yssmall/g,""),i=N._users[d.publisherId()];if(i){var o=mt(i,t);if(o===YS.PUBLISH_STATE_VIDEOONLY||o===YS.PUBLISH_STATE_BOTH){W.hasOwnProperty(d.publisherId())?W[d.publisherId()]+=1:W[d.publisherId()]=1;var r=function(){return(new Date).getTime()},n=!0;for(var a in H){var s=H[a];if(s&&s.peerid===d.extensionId){s.time_ms.push(r()),n=!1;break}}n&&H.push({streamid:d.getID(),peerid:d.extensionId,time_ms:[r()]}),d._isSendFailVideostuckObj=d._isSendFailVideostuckObj||{},d._isSendFailVideostuckObj[d.getID()+"_"+d.extensionId]?d._isSendFailVideostuckObj[d.getID()+"_"+d.extensionId]++:(d._isSendFailVideostuckObj[d.getID()+"_"+d.extensionId]=1,U.eventLog({type:"FAIL_VIDEOSTUCK",data:d.extensionId,streamid:d.getID()}))}}}else e.video&&3<e.video.frameRate&&d._isSendFailVideostuckObj&&d._isSendFailVideostuckObj.hasOwnProperty(d.getID()+"_"+d.extensionId)&&d._isSendFailVideostuckObj.hasOwnProperty(d.getID()+"_"+d.extensionId);d.publisherId()!==N._myself.id&&(e.isMe=!0),c(e),d=void 0})}))}catch(e){L.Logger.warning(ae,"catonNumber method was a slight problem with the handling.")}}(i)}e.length&&Promise.all(e).then(function(e){var t=[],i=[],o=0,r=0;e.forEach(function(e){e.isMe?t.push(e):i.push(e)}),G.audioDelay=0,G.videoDelay=0,t.forEach(function(e){e&&e.audio&&(G.outAudioKBitRate+=e.audio.bitsPerSecond?e.audio.bitsPerSecond:0,G.outBytes+=e.audio.audioBytesSent?e.audio.audioBytesSent:0,G.outPackets+=e.audio.totalPackets?e.audio.totalPackets:0,G.audioDelay+=e.audio.currentDelay?e.audio.currentDelay:0,o+=1),e&&e.video&&(G.outVideoKBitRate+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,G.outBytes+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,G.outPackets+=e.video.totalPackets?e.video.totalPackets:0,G.videoDelay+=e.video.currentDelay?e.video.currentDelay:0,r+=1)}),G.audioDelay=isNaN(parseInt(G.audioDelay/o))?0:parseInt(G.audioDelay/o),G.videoDelay=isNaN(parseInt(G.videoDelay/r))?0:parseInt(G.videoDelay/r),i.forEach(function(e){e&&e.audio&&(G.inAudioKBitRate+=e.audio.bitsPerSecond?e.audio.bitsPerSecond:0,G.inBytes+=e.audio.audioBytesSent?e.audio.audioBytesSent:0,G.inPackets+=e.audio.totalPackets?e.audio.totalPackets:0),e&&e.video&&(G.inVideoKBitRate+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,G.inBytes+=e.video.bitsPerSecond?e.video.bitsPerSecond:0,G.inPackets+=e.video.totalPackets?e.video.totalPackets:0)});var n=(new Date).getTime()-YS.connectTimer;G.duration=0<=n?n:0;var a=YS.RoomEvent({type:YS.EVENT_TYPE.roomRtcStatsReportEvent,message:{stats:G}});U.dispatchEvent(a,!1)}).catch(function(e){L.Logger.warning(ae,"catonNumber promise error info :",e)})},1e3),U.sendcatonNumber=setInterval(function(){try{var e=Object.values(q);if(!H.length&&!e.length)return;var t={serial:N._room_properties.serial,companyid:N._room_properties.companyid,peerid:N._myself.id,statistics:H,streamstat:e};H=[];var i=N._web_protocol+"://"+N._web_host+":"+N._web_port+"/LogData/networkequipmentcount?ts="+(new Date).getTime();L.Utils.sdkAjax({url:i,dataType:"json",type:"POST",async:!0,data:t,success:function(){},error:function(e,t,i){L.Logger.error(ae,"sendcatonNumber fail[ XHR , textStatus , errorThrown ]:",e,t,i)}})}catch(e){L.Logger.warning(ae,"sendcatonNumber method was a slight problem with the handling.")}},6e4)}var k=x;x=V=0;try{N&&N._useServerScreenRecording&&jt()&&(L.Logger.info(ae,"recorder class set state,state is "+window.YS.ROADOFRECODER.STATE_ROOM_CONNECTED+",roomid is "+N._room_properties.serial+",myself info:"+L.Utils.toJsonStringify(N._myself)),jt().setstate(window.YS.ROADOFRECODER.STATE_ROOM_CONNECTED))}catch(e){L.Logger.error(ae,"roadofrecorder err:",e)}Q={checkRoomCount:0,joinRoomCount:0,getConfigCount:0,checkRoomPlaybackCount:0};var R=z&&0<F,C=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnected,streams:a,message:_},{httpTime:B-j,socketTime:k,reconnectCount:F,isReconnect:R,currServerTs:n});L.Logger.info(ae,"Test connect success info:",JSON.stringify({httpTime:B-j,socketTime:k,reconnectCount:F,isReconnect:R})),U.dispatchEvent(C),YS.connectTimer=(new Date).getTime(),B=0,Jt(J),U.eventLog({type:"EVENT_JOINOK"})},f._handler_connectSocketFail=function(e){if(N._isLeaveRoom)L.Logger.info(ae,"The room is over. Method _handler_connectSocketFail cannot be executed!");else{L.Logger.error(ae,"Not Connected! Error: "+e);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomError,message:{source:"joinRoom",error:window.YS_ERR.ROOM_JOIN_FAILED,errorCode:window.YS_ERR.ROOM_JOIN_FAILED}});if(U.dispatchEvent(t),U.eventLog({type:"FAIL_SOCKET",data:N._room_uri}),Q.joinRoomCount++,5<=Q.joinRoomCount){var i=z&&0<F,o=0<x?x:Date.now()-B,r=YS.RoomEvent({type:YS.EVENT_TYPE.roomConnectFail,message:{source:"joinRoom",error:window.YS_ERR.ROOM_JOIN_FAILED,errorCode:window.YS_ERR.ROOM_JOIN_FAILED}},{httpTime:B-j,socketTime:o,reconnectCount:F,isReconnect:i});L.Logger.info(ae,"Test connect fail info:",JSON.stringify({httpTime:B-j,socketTime:o,reconnectCount:F,isReconnect:i})),U.dispatchEvent(r),x=B=0}Jt(J)}},l.onNativeStartShareMediaFile=function(e,t,i,o){var r=YS.MEDIAFILESTATE_ON;if(r!==ht()){U.changeUserShare(De(),r,"ys_mediafilestate");var n=Pe(De()+":file");if(!L.Utils.isNull(n))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_IN_PROGRESS"),void L.Logger.error(ae,"Share media file in progress.");n=je("file",e),o&&o.IgnoreElementId?(n.create(),l.pauseShareMediaFile(!0)):n.play(t),n.needPublishToServer=!0,L.Logger.info(ae,"calling localFilePublish stream , stream id:"+n.getID()+" , extensionId is "+n.extensionId+", attrs is "+L.Utils.toJsonStringify(n.getAttributes())),n&&void 0===U.remoteStreams[n.getID()]?it(n,function(e,t){e||L.Utils.isFunction(i)&&i(t)}):(L.Logger.error(ae,"Trying to publish invalid LocalFileStream",n),L.Utils.isFunction(i)&&i(void 0,"Trying to publish invalid LocalFileStream"))}},l.onNativeStopShareMediaFile=function(i){var e=YS.MEDIAFILESTATE_OFF;if(e!==ht()){U.changeUserShare(De(),e,"ys_mediafilestate");var t=Pe(De()+":file");if(L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_TERMINATED"),void L.Logger.warning(ae,"Could not find the specify stream while stop sharing media file.");t.stop(),t.needPublishToServer=!1,L.Logger.info(ae,"calling unpublishLocalFile , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),ot(t,function(e,t){e||L.Utils.isFunction(i)&&i(t)}),Me(De()+":"+YS.STREAM_FILE)&&Oe(De()+":"+YS.STREAM_FILE)}},l.onNativeStartShareScreen=function(e,i){var t=Pe(De()+":screen");if(!L.Utils.isNull(t))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_IN_PROGRESS"),void L.Logger.error(ae,"Share screen in progress.");(t=je("screen",e)).needPublishToServer=!0,L.Logger.info(ae,"calling screenPublish stream , stream id:"+t.getID()+" , extensionId is "+t.extensionId+", attrs is "+L.Utils.toJsonStringify(t.getAttributes())),void 0===U.remoteStreams[t.getID()]?(U.changeUserShare(De(),YS.SCREENSTATE_ON,"ys_screenstate"),it(t,void 0,function(e,t){e||L.Utils.isFunction(i)&&i(t)})):(L.Logger.error(ae,"Trying to publish invalid screenStream",t),L.Utils.isFunction(i)&&i(void 0,"Trying to publish invalid screenStream"))},l.onNativeStopShareScreen=function(i){var e=Pe(De()+":"+YS.STREAM_SCREEN);if(L.Utils.isNull(e))return L.Utils.isFunction(i)&&i("YS_ERR_OPERATION_TERMINATED"),void L.Logger.warning(ae,"Could not find the specify stream while stop sharing screen.");e.needPublishToServer=!1,L.Logger.info(ae,"calling unpublishScreen , stream id:"+e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes())),U.changeUserShare(De(),YS.SCREENSTATE_OFF,"ys_screenstate"),ot(e,function(e,t){e||L.Utils.isFunction(i)&&i(t)}),Me(De()+":"+YS.STREAM_SCREEN)&&Oe(De()+":"+YS.STREAM_SCREEN)},l.onNativeNotification=function(e){if("object"===qt(e))switch(e.name){case"onMediaFileEnded":(o=Re(De(),"file"))&&l.pauseShareMediaFile(!0);var t=YS.RoomEvent({type:YS.EVENT_TYPE.roomClientNotificationOnMediaFileEnded});U.dispatchEvent(t);break;case"onRemoteAudioVolume":var i=e.args;if(!L.Utils.isNull(i)){var o,r=i.type||YS.STREAM_VIDEO;(o=Re(i.id,r))&&L.Utils.isFunction(o.onRemoteAudioVolume)&&o.onRemoteAudioVolume(i.volume)}break;case"onAudioStatsDelivered":e&&"object"===qt(e.args)&&ut(e.args.connectionId,e.args.stats,!1);break;case"onVideoStatsDelivered":e&&"object"===qt(e.args)&&ut(e.args.connectionId,e.args.stats,!0);break;case"version":e&&"object"===qt(e.args)&&(YS.PROXYVERSION=Number(e.args.version));default:var n=YS.RoomEvent({type:YS.EVENT_TYPE.roomNativeNotification,message:e});U.dispatchEvent(n)}},l.onMicVolumeReport=function(e){if("object"===qt(e)){var t=Re(De(),YS.STREAM_VIDEO,N._mainCameraDeviceId);t&&L.Utils.isFunction(t.onMicVolumeReport)&&t.onMicVolumeReport(e.volume)}},l.onPauseMediaFile=function(e){var t=Re(De(),YS.STREAM_FILE);t&&U.remoteStreams[t.getID()]&&"file"===t.getAttributes().type&&P.controlMedia(t.getID(),{type:"pause",pause:e})},l.onSeekMediaFile=function(e){var t=Re(De(),YS.STREAM_FILE);if(t&&U.remoteStreams[t.getID()]&&"file"===t.getAttributes().type){var i=parseInt(e*t.getAttributes().duration);i>t.getAttributes().duration&&(i=t.getAttributes().duration),P.controlMedia(t.getID(),{type:"seek",pos:i})}},l.onNativeWindowClose=function(){var e=YS.RoomEvent({type:YS.EVENT_TYPE.roomClientClose});U.dispatchEvent(e)},YS.DeviceMgrImpl.onCameraSetted=function(e,t,i,o){o=o||{},YS.isMultiCamera&&void 0!==e&&e!==N._mainCameraDeviceId&&(L.Utils.isVideoinputDeviceIdFromDeviceList(e)?bt(e):(L.Logger.warning(ae,"The device id("+e+") is not in the video device list,not allow set main camera!"),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,N._mainCameraDeviceId))),yt(L.Constant.deviceStorage.videoinput,e,o)},YS.DeviceMgrImpl.onMicrophoneSetted=function(e,t,i,o){o=o||{},yt(L.Constant.deviceStorage.audioinput,e,o)},YS.DeviceMgrImpl.onSpeakerSetted=function(e,t,i,o){({})},YS.DeviceMgrImpl.onDeviceChanged=function(h,S,y,_){for(var e in S)if("videoinput"===e||"audioinput"===e){var t=S[e];if(t&&t.length)for(var i=0,o=t.length;i<o;i++)if(t[i]){var r=t[i].deviceId;if("videoinput"===e)(d=Ne(r))&&d.removeVideoTrack(),M.hasDeviceVideoTrack(r)&&M.destroyVideoTrack(r);else if("audioinput"===e){var n=0;for(o=(c=Ce(YS.STREAM_VIDEO)).length;n<o;n++){(d=c[n]).audioinputDeviceId===r&&d.removeAudioTrack()}M.hasDeviceAudioTrack(r)&&M.destroyAudioTrack(r)}}}for(var e in h)if("videoinput"===e||"audioinput"===e){var a=h[e];if(a&&a.length)for(i=0,o=a.length;i<o;i++)if(a[i]){var s=a[i].deviceId;if("videoinput"===e)(d=Ne(s))&&d.videoinputDeviceId===s&&_t(d,d.videoinputDeviceId,!0);else if("audioinput"===e){var c;for(n=0,o=(c=Ce(YS.STREAM_VIDEO)).length;n<o;n++){var d;(d=c[n]).audioinputDeviceId===s&&Lt(d,d.audioinputDeviceId,!0)}}}}if(!N._autoProcessDevChangeEvent||N._safariOnlySubscibe&&!YS.DeviceMgrImpl._isGetDevicesed){if(YS.isMultiCamera){var u=S.videoinput;if(u&&u.length){for(i=0,o=u.length;i<o;i++){if(u[i])u[i].deviceId===N._mainCameraDeviceId&&bt(ye())}N._mainCameraDeviceId||bt(ye())}var l=h.videoinput;l&&l.length&&(N._mainCameraDeviceId||bt(ye()))}L.Utils.isFunction(_)&&_(h,S,y)}else{var b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);M.getDeviceMgr().getDevices(function(e){var t,i,o=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),r=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),n=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);if(b!==n&&M.getDeviceMgr().checkIsSupportSetSpeaker()&&(YS.isYsNative?M.getDeviceMgr().setDevices({audiooutput:n}):M.getDeviceMgr().associateElementsToSpeaker(void 0,n)),N._myself){var a=e.hasdevice,s={},c={},d=!1;c.hasvideo=N._myself.hasvideo,c.hasaudio=N._myself.hasaudio,N._myself.hasvideo!==a.videoinput&&(s.hasvideo=a.videoinput,N._myself.hasvideo=s.hasvideo,d=!0),N._myself.hasaudio!==a.audioinput&&(s.hasaudio=a.audioinput,N._myself.hasaudio=s.hasaudio,d=!0),d&&(L.Logger.info(ae,"change device:my old device info  [hasvideo , hasaudio] is ["+c.hasvideo+" ,"+c.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(s)),N._isConnected&&U.changeUserProperty(De(),"__all",s));for(var u=Ce(YS.STREAM_VIDEO),l=0,p=u.length;l<p;l++){var f=u[l];r!==f.audioinputDeviceId&&Lt(f,r),YS.isMultiCamera||o!==f.videoinputDeviceId&&_t(f,o)}if(YS.isMultiCamera){var m=S.videoinput;if(m)for(l=0,p=m.length;l<p;l++)if(m[l]){var g=m[l].deviceId;t=g,(i=YS.isMultiCamera?gt(t):N._myself.publishstate)!==YS.PUBLISH_STATE_VIDEOONLY&&i!==YS.PUBLISH_STATE_BOTH||U.unpublishVideo(g),g===N._mainCameraDeviceId&&bt(ye())}var v=h.videoinput;v&&v.length&&(N._mainCameraDeviceId||bt(ye()))}}L.Utils.isFunction(_)&&_(h,S,y)},{isSetlocalStorage:!0})}},YS.DeviceMgrImpl.onCameraMuted=function(e){function t(o,e){var r=Ne(o,!1,e);r&&r.local&&r.videoinputDeviceId===o&&YS.DeviceMgrImpl.getVideoTrack(o,function(e){if(YS.userCacheStreamVideo&&o&&YS.cacheStreams.hasOwnProperty(o)){var t=YS.cacheStreams[o]||{},i=(t=t.stream||{}).getVideoTracks();i&&i.length&&(e=i[0])}r.removeVideoTrack(),r.addVideoTrack(e),gt(r.videoinputDeviceId)===YS.PUBLISH_STATE_NONE&&U.remoteStreams[r.getID()]?ot(r):M.hasConnection(r.getID())&&L.Utils.isSupportRTCRtpSenderMethod("replaceTrack")&&!YS.customStreamFn?M.replaceVideoTrack(r.getID(),e):St(r),Me(r.extensionId)&&Oe(r.extensionId)},function(e){L.Logger.info(ae,"updateStreamVideoinputDeviceId:getDeviceVideoTrack fail,fain info is "+L.Utils.toJsonStringify(e)+",stream id:"+r.getID()+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.getAttributes())),Mt(e,"videoinput",videoinputDeviceId)})}e&&(t(e,!1),t(e,!0))},"safari"!==L.Utils.getBrowserInfo(!0).info.browserName&&M.getDeviceMgr().getDevices(),U._onSendFailNoseeEventLog=function(e){var t=U.remoteStreams[e];if(t&&t.publisherId()!==N._myself.id){var i=N._users[t.publisherId()];if(!i)return!0;var o=mt(i,ft(t).replace(/\:yssmall/g,""));return o===YS.PUBLISH_STATE_NONE||(o===YS.PUBLISH_STATE_VIDEOONLY||o===YS.PUBLISH_STATE_BOTH?!(t._fail_nosee_ts&&(new Date).getTime()-t._fail_nosee_ts<1e4)&&(U.eventLog({type:"FAIL_NOSEE",streamid:e}),t._fail_nosee_ts=void 0,delete t._fail_nosee_ts,!0):(t._fail_nosee_ts=(new Date).getTime(),!1))}return!0},U._onSendFailNohearEventLog=function(e){var t=U.remoteStreams[e];if(t&&t.getAttributes().type===YS.STREAM_VIDEO&&t.publisherId()!==N._myself.id){var i=N._users[t.publisherId()];if(!i)return!0;var o=ft(t).replace(/\:yssmall/g,""),r=Pt(i.id);if(YS.isMultiCamera&&o!==r)return!0;var n=mt(i,r);return n===YS.PUBLISH_STATE_NONE||(n===YS.PUBLISH_STATE_AUDIOONLY||n===YS.PUBLISH_STATE_BOTH?!(t._fail_nohear_ts&&(new Date).getTime()-t._fail_nohear_ts<1e4)&&(U.eventLog({type:"FAIL_NOHEAR",streamid:e}),t._fail_nohear_ts=void 0,delete t._fail_nohear_ts,!0):(t._fail_nohear_ts=(new Date).getTime(),!1))}return!0},L.Utils.getBrowserInfo(!0).versions.mobile&&(void 0!==document.hidden?(e="visibilitychange",t="visibilityState"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozVisibilityState"):void 0!==document.msHidden?(e="msvisibilitychange",t="msVisibilityState"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitVisibilityState"),L.Utils.addEvent(document,e,function(){if(void 0!==document[t]&&"visible"===document[t]||void 0!==document.hidden&&!1===document.hidden)for(var e in L.Logger.info(ae,"visibilitychange:visible"),U.remoteStreams)!function(r){r.publisherId()!==N._myself.id&&M.hasConnection(r.getID())&&M.videoEnabled(r.getID())&&r.getLoadFirstVideoFrameTs()&&2e3<(new Date).getTime()-r.getLoadFirstVideoFrameTs()&&ct(r,function(e){if(U.remoteStreams[r.getID()]&&M.hasConnection(r.getID()))if(r.getAttributes().type===YS.STREAM_VIDEO){var t=ft(r).replace(/\:yssmall/g,""),i=N._users[r.publisherId()];if(i){var o=mt(i,t);o!==YS.PUBLISH_STATE_VIDEOONLY&&o!==YS.PUBLISH_STATE_BOTH||(e.video&&e.video.frameRate<=3?(xt(r,window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"visibilitychange:visible, subscribe video stuck"),X(r,"visibilitychange:visible, subscribe video stuck")):r.checkoutVideoPlayerStuck())}}else e.video&&e.video.frameRate<=3?(xt(r,window.YS.ERROR_NOTICE.ERR_SUBSCRIBE_FAILED,"visibilitychange:visible, subscribe video stuck"),X(r,"visibilitychange:visible, subscribe video stuck")):r.checkoutVideoPlayerStuck()})}(U.remoteStreams[e]);else L.Logger.info(ae,"visibilitychange:hidden")}));return U},window.YS=window.YS||{},window.L=window.L||{},YS.RoomUser=function(e){if(null!=e&&void 0!==e.properties){var t=e.id,i=e.properties;L.Logger.debug("RoomUser ","RoomUser",t,i);var o={};for(var r in o.id=t,o.watchStatus=0,i)"id"!=r&&"watchStatus"!=r&&(o[r]=i[r]);return o.publishstate=o.publishstate||YS.PUBLISH_STATE_NONE,o.hasOwnProperty("ys_screenstate")||(o.ys_screenstate=YS.SCREENSTATE_OFF),o.hasOwnProperty("ys_mediafilestate")||(o.ys_mediafilestate=YS.MEDIAFILESTATE_OFF),o.hasOwnProperty("ys_enabledualstream")||(o.ys_enabledualstream=YS.ENABLEDUALSTREAM_OFF),o.getId=function(){return t},o.nickName=function(){return i.nickname},o.userRole=function(){},o.hasVideo=function(){},o.hasAudio=function(){},o.publishState=function(e){var t="publishstate";return L.Utils.isNull(e)&&(t+=":"+e),i[t]},o.videoStatus=function(e){var t="publishstate";L.Utils.isNull(e)&&(t+=":"+e);i[t];return i[t]},o.audioStatus=function(){},o.enableDualStream=function(){return!!o.hasOwnProperty("ys_enabledualstream")&&i.ys_enabledualstream},o.getValue=function(e){return o.hasOwnProperty(e)?i[e]:null},o}L.Logger.warning("RoomUser ","Invalidate user info",t,i)},window.YS=window.YS||{},window.L=window.L||{},YS.Signalling=function(){var r={},i=null,n="Signalling ";function o(){if(arguments.length){var e=arguments[0];if("function"==typeof r[e]){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);r[e].apply(r[e],t)}}}return r.sendMessageSocket=function(e,t,i,o){L.Logger.debug(n,"sendMessageSocket",e,t),r.socketSend(e,t,i)},r.connectSocket=function(e,t){(t=t||{}).secure=!L.Utils.isBoolean(t.secure)||t.secure,t.reconnection=!L.Utils.isBoolean(t.reconnection)||t.reconnection,t.transports=Array.isArray(t.transports)?t.transports:["websocket"],window.YS.socketIO?(L.Logger.info(n,"socket.io connect , uri : "+e+" , options : "+L.Utils.toJsonStringify(t)),(i=window.YS.socketIO.connect(e,{secure:t.secure,reconnection:t.reconnection,transports:t.transports})).on("connect_error",o.bind(o,"onConnectError")),i.on("connect",o.bind(o,"onConnect")),i.on("onAddStream",o.bind(o,"onAddStream")),i.on("signaling_message_mediaserver",o.bind(o,"onSignalingMessageMediaserver")),i.on("onUpdateAttributeStream",o.bind(o,"onUpdateAttributeStream")),i.on("publish_failed",o.bind(o,"onPublishFailed")),i.on("subscribe_failed",o.bind(o,"onSubscribeFailed")),i.on("onRemoveStream",o.bind(o,"onRemoveStream")),i.on("disconnect",o.bind(o,"onDisconnect")),i.on("reconnecting",o.bind(o,"onReconnecting")),i.on("participantLeft",o.bind(o,"onParticipantLeft")),i.on("participantJoined",o.bind(o,"onParticipantJoined")),i.on("participantPublished",o.bind(o,"onParticipantPublished")),i.on("participantEvicted",o.bind(o,"onParticipantEvicted")),i.on("sendMessage",o.bind(o,"onSendMessage")),i.on("msgList",o.bind(o,"onMsgList")),i.on("pubMsg",o.bind(o,"onPubMsg")),i.on("delMsg",o.bind(o,"onDelMsg")),i.on("setProperty",o.bind(o,"onSetProperty")),i.on("playback_clearAll",o.bind(o,"onPlaybackClearAll")),i.on("duration",o.bind(o,"onDuration")),i.on("playbackEnd",o.bind(o,"onPlaybackEnd")),i.on("playback_updatetime",o.bind(o,"onPlaybackUpdatetime")),i.on("forceReconnect",o.bind(o,"onForceReconnect"))):L.Logger.error(n,"socket.io is not exist,please link socket.io,for example: window.YS.SocketIO = io (io is the socket.io that you want to associate with)!")},r.socketSend=function(){if(arguments.length&&i)if("string"==typeof arguments[0]){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);i.emit.apply(i,e)}else L.Logger.warning(n," PARAMETER ERROR ")},r.controlMedia=function(e,t){i&&i.emit("controlmedia",e,t)},r.isHasSocket=function(){return!!i},r.emptySocket=function(){i=void 0},r.socketDisconnect=function(){i&&i.disconnect()},r}(),window.YS=window.YS||{},window.L=window.L||{},YS.Stream=function(e,t){return t?YS.NativeStream(e):YS.StreamInner(e)},YS.StreamInner=function(e){var n=YS.EventDispatcher(e),o=void 0,i=void 0,r=void 0,a=!1,s="Stream ";void 0!==e.video&&"number"==typeof e.video&&(e.video=0!==e.video),void 0!==e.audio&&"number"==typeof e.audio&&(e.audio=0!==e.audio),n.classInstanceName="Stream",n.url=e.url,n.local=!L.Utils.isBoolean(e.local)||e.local,n.video=e.video,n.audio=e.audio,n.screen=e.screen,n.scale=e.scale,n.media=e.media,n.data=e.data,n.extensionId=e.extensionId,n.path=e.path||"",n.attributes=e.attributes||{},n.isYsNative=!1,n.streamID=e.streamID,n.audioinputDeviceId=e.audioinputDeviceId,n.videoinputDeviceId=e.videoinputDeviceId,n.subscribed=e.subscribed||!1,n.subscribeFailCount=0,n.publishFailCount=0;var c=e.getVideoTrack,d=e.getAudioTrack,t=e.getRegisterAudioVolumeListener,u={onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1},l=void 0,p=void 0,f=void 0;function m(){if(L.Utils.getBrowserInfo(!0).versions.mobile&&"safari"===L.Utils.getBrowserInfo(!0).info.browserName)L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0);else{if(v(),g(),"function"!=typeof u.onSuccess)return L.Logger.error(s," intervalCallback must is function!"),void(L.Utils.isFunction(u.onFailure)&&u.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function"));try{o&&o.stop&&(o.stop(),o=void 0),o=null,n&&n.attributes&&YS.audioContext&&YS.DeviceMgrImpl&&YS.DeviceMgrImpl.getsSoundMeterInstance?L.Utils.isFunction(d)&&d(n.getID(),n.publisherId(),n.attributes.type,{audioinputDeviceId:n.audioinputDeviceId},function(e){o=void 0,v(),L.Utils.isFunction(u.onSuccess)||g();var t=L.Utils.createMediaStream();t&&e?(t.addTrack(e),(o=YS.DeviceMgrImpl.getsSoundMeterInstance(YS.audioContext,{mediaStream:t}))&&o.connectToSource?o.connectToSource(t,function(e){if(v(),L.Utils.isFunction(u.onSuccess)||g(),e)return L.Logger.error(s,"startIntervalGetRealtimeVolume connectToSource error:",e),g(),void(L.Utils.isFunction(u.onFailure)&&u.onFailure(e));if(o){if(o&&o.instant&&o.instant.toFixed){var t=Math.floor(100*o.instant.toFixed(2));L.Utils.isFunction(u.onSuccess)&&u.onSuccess(t)}else L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0);clearInterval(i),i=setInterval(function(){if(L.Utils.isFunction(u.onSuccess))if(o&&o.instant&&o.instant.toFixed){var e=Math.floor(100*o.instant.toFixed(2));u.onSuccess(e)}else u.onSuccess(0);else g()},u.interval)}else L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)},function(e){o=void 0,L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}):L.Utils.isFunction(u.onSuccess)&&u.onSuccess(0)}catch(e){L.Logger.error(s,"startIntervalGetRealtimeVolume error :",e),L.Utils.isFunction(u.onFailure)&&u.onFailure(e)}}}function g(){o&&o.stop&&o.stop(),clearInterval(i),i=o=void 0,v()}function v(){L.Utils.isFunction(t)&&(u=t(n.publisherId(),n.attributes.type)),u=u||{onSuccess:void 0,onFailure:void 0,interval:100,isWaiting:!1}}return n.changeID=function(e){n.id=""===e?"local":e,l&&l.changeStreamId(n.getID()),p&&p.changeStreamId(n.getID())},n.getID=function(){return n.local&&!n.streamID?n.id||"local":n.streamID},n.id=n.getID(),n.destroy=function(){n.stopIntervalGetRealtimeVolume(),n.removeAudioTrack(),n.removeVideoTrack(),l&&n.unplayVideo(),p&&n.unplayAudio()},n.publisherId=function(){var e=n.extensionId.split(":");return e.length?e[0]:n.extensionId},n.getAttributes=function(){return n.attributes},n.setAttributes=function(e){n.updateLocalAttributes(e)},n.updateLocalAttributes=function(e){if(e&&"object"===qt(e))for(var t in e)n.attributes[t]=e[t]},n.hasAudio=function(){return n.audio},n.hasVideo=function(){return n.video},n.hasScreen=function(){return n.screen},n.hasMedia=function(){return n.media},n.hasData=function(){return n.data},n.hasVideoPlayer=function(){return!!l},n.getVideoPlayer=function(){return l},n.hasAudioPlayer=function(){return!!p},n.getAudioPlayer=function(){return p},n.getVideoPlayerElementId=function(){return f},n.playVideo=function(e,t,i){if(t=t||{},void 0!==e&&(l&&n.unplayVideo(),f=e,n.local&&(t.mirror=L.Utils.isBoolean(t.mirror)?t.mirror:a),l=i||new YS.VideoPlayer({id:n.extensionId,elementID:e,local:n.local,type:n.attributes.type,userid:n.publisherId(),bundleId:n.extensionId,extensionId:n.extensionId,options:t,streamId:n.getID()}),YS.isOnlyAudioRoom&&l.hideVideo(),L.Utils.isFunction(c))){var o="videoplayer_"+(new Date).getTime();l.videoTrackTempId=o,c(n.getID(),n.publisherId(),n.attributes.type,{videoinputDeviceId:n.videoinputDeviceId},function(e){l&&o===l.videoTrackTempId&&(l.hasVideoTrack()&&l.removeVideoTrack(),l.addVideoTrack(e))},function(e){L.Logger.info(s,"playVideo:getVideoTrack fail,fail info:",e)})}},n.replaceStream=function(e,t){if(e.playVideo){var i=n.getVideoPlayerElementId(),o=n.getVideoPlayerOptions(),r=new YS.VideoPlayer({id:e.extensionId,elementID:i,local:e.local,type:e.attributes.type,userid:e.publisherId(),bundleId:e.extensionId,extensionId:e.extensionId,options:o,isClone:!0,streamId:e.getID()});e.playVideo(n.getVideoPlayerElementId(),n.getVideoPlayerOptions(),r),L.Utils.mediaPlay(r.video,function(e){0===e&&(r.container.style.zIndex="1",r.oldContainer&&r.container.parentNode.removeChild(r.oldContainer),r.oldContainer=void 0,L.Utils.isFunction(t)&&t(0,r))})}},n.playAudio=function(e){if(e=e||{},!document.getElementById("YSSDK_audioPlayer_list_container")){var t=document.createElement("div");t.setAttribute("id","YSSDK_audioPlayer_list_container"),t.style.display="none",document.body.appendChild(t)}if(p&&n.unplayAudio(),p=new YS.AudioPlayer({id:n.extensionId,elementID:"YSSDK_audioPlayer_list_container",local:n.local,type:n.attributes.type,userid:n.publisherId(),bundleId:n.extensionId,extensionId:n.extensionId,options:e,streamId:n.getID()}),L.Utils.isFunction(d)){var i="audioplayer_"+(new Date).getTime();p.audioTrackTempId=i,d(n.getID(),n.publisherId(),n.attributes.type,{audioinputDeviceId:n.audioinputDeviceId},function(e){p&&i===p.audioTrackTempId&&(p.hasAudioTrack()&&p.removeAudioTrack(),p.addAudioTrack(e))},function(e){L.Logger.debug(s,"playAudio:getAudioTrack fail,fail info:",e)})}n.local&&n.attributes.type===YS.STREAM_VIDEO||(v(),u.isWaiting&&void 0===o&&m())},n.unplayVideo=function(){l&&l.destroy(),l=void 0,n.local&&n.attributes.type===YS.STREAM_VIDEO||p||g()},n.unplayAudio=function(){p&&p.destroy(),p=void 0,n.local&&n.attributes.type===YS.STREAM_VIDEO||g()},n.getVideoPlayerOptions=function(){if(l&&l.getVideoPlayerOptions)return l.getVideoPlayerOptions()},n.updateVideoPlayerOptions=function(e){l&&l.updateVideoPlayerOptions&&l.updateVideoPlayerOptions(e)},n.updateAudioPlayerOptions=function(e){p&&p.updateAudioPlayerOptions&&p.updateAudioPlayerOptions(e)},n.showVideo=function(){l&&l.showVideo()},n.hideVideo=function(){l&&l.hideVideo()},n.getAudioTrack=function(){p&&p.getAudioTrack()},n.hasAudioTrack=function(){p&&p.hasAudioTrack()},n.removeAudioTrack=function(){p&&p.removeAudioTrack()},n.addAudioTrack=function(e){n.hasAudioTrack()&&n.removeAudioTrack(),p&&p.addAudioTrack(e),v(),g(),u.isWaiting&&void 0===o&&m()},n.getVideoTrack=function(){var e;return l&&(e=l.getVideoTrack()),e},n.hasVideoTrack=function(){var e=!1;return l&&(e=l.hasVideoTrack()),e},n.removeVideoTrack=function(){l&&l.removeVideoTrack()},n.addVideoTrack=function(e){n.hasVideoTrack()&&n.removeVideoTrack(),l&&l.addVideoTrack(e)},n.setMute=function(e){p&&p.setMute&&p.setMute(e)},n.setVolume=function(e){if(p&&p.setVolume){if("number"!=typeof e)return void L.Logger.error(s,"Stream setVolume volume type must is number!");p.setVolume(e)}},n.getVolume=function(e){return p&&p.getVolume?p.getVolume(e):(L.Utils.isFunction(e)&&e(0),0)},n.startIntervalGetRealtimeVolume=function(){n.stopIntervalGetRealtimeVolume(),v(),m()},n.stopIntervalGetRealtimeVolume=function(){g(),v()},n.hideLoading=function(){l&&l.hideLoading&&l.hideLoading()},n.showLoading=function(){l&&l.showLoading&&l.showLoading()},n.getVideoElement=function(){return l&&l.video},n.setLocalVideoMirror=function(e){n.local&&(a=e,n.updateVideoPlayerOptions({mirror:e}))},n.getRealtimeVolume=function(i,o){if(!L.Utils.isFunction(i))return L.Logger.error(s," getRealtimeVolume: onVolume is not function"),void(L.Utils.isFunction(o)&&o("YS_ERR_INVALID_ARG"));if(L.Utils.getBrowserInfo(!0).versions.mobile&&"safari"===L.Utils.getBrowserInfo(!0).info.browserName)i(0);else try{r&&r.stop&&(r.stop(),r=void 0),n&&n.attributes&&YS.audioContext&&YS.DeviceMgrImpl&&YS.DeviceMgrImpl.getsSoundMeterInstance?L.Utils.isFunction(d)&&d(n.getID(),n.publisherId(),n.attributes.type,{audioinputDeviceId:n.audioinputDeviceId},function(e){var t=L.Utils.createMediaStream();t&&e?(t.addTrack(e),(r=YS.DeviceMgrImpl.getsSoundMeterInstance(YS.audioContext,{mediaStream:t}))&&r.connectToSource?r.connectToSource(t,function(e){if(e)return L.Logger.error(s,"getRealtimeVolume connectToSource error:",e),void(L.Utils.isFunction(o)&&o(e));if(r&&r.instant&&r.instant.toFixed){var t=Math.floor(100*r.instant.toFixed(2));i(t)}else i(0);r&&r.stop&&(r.stop(),r=void 0)}):i(0)):i(0)},function(e){i(0)}):i(0)}catch(e){L.Logger.error(s,"getRealtimeVolume:Web Audio API(audioContext) not supported",e),L.Utils.isFunction(o)&&o(e)}},n.updateExtensionId=function(e){n.extensionId=e,l&&l.updateVideoPlayerSpec&&l.updateVideoPlayerSpec({id:n.extensionId,userid:n.publisherId(),bundleId:n.extensionId,extensionId:n.extensionId}),p&&p.updateAudioPlayerSpec&&p.updateAudioPlayerSpec({id:n.extensionId,userid:n.publisherId(),bundleId:n.extensionId,extensionId:n.extensionId})},n.getVideoFrameURL=function(e){var t=function(){{if(void 0===l)return null;var e=l.video,t=document.defaultView.getComputedStyle(e),i=parseInt(t.getPropertyValue("width"),10),o=parseInt(t.getPropertyValue("height"),10),r=(parseInt(t.getPropertyValue("left"),10),parseInt(t.getPropertyValue("top"),10),document.createElement("canvas"));return Math.max(i,o)<640&&(o<i?(o=o/i*640,i=640):(i=i/o*640,o=640)),r.id="testing",r.width=i,r.height=o,r.setAttribute("style","display: none"),r.getContext("2d").drawImage(e,0,0,i,o),r}}();return null!==t?e?t.toDataURL(e):t.toDataURL():null},n.getLoadFirstVideoFrameTs=function(){return l?l.firstVideoFrameTs:0},n.getLoadFirstAudioFrameTs=function(){return p?p.firstAudioFrameTs:0},n.checkoutVideoPlayerStuck=function(){l&&l.checkIsGetVideoData(function(e){e||(L.Logger.info(s,"videoplayer stuck,reload video stream,stream id:"+n.getID()+",extensionId:"+n.extensionId+",elementID:"+l.elementID+", attributes:"+L.Utils.toJsonStringify(n.getAttributes())),l.reloadVideo())})},v(),n},window.YS=window.YS||{},window.L=window.L||{},function(e){function l(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function s(e,t,i,o,r,n){return l((a=l(l(t,e),l(o,n)))<<(s=r)|a>>>32-s,i);var a,s}function p(e,t,i,o,r,n,a){return s(t&i|~t&o,e,t,r,n,a)}function f(e,t,i,o,r,n,a){return s(t&o|i&~o,e,t,r,n,a)}function m(e,t,i,o,r,n,a){return s(t^i^o,e,t,r,n,a)}function g(e,t,i,o,r,n,a){return s(i^(t|~o),e,t,r,n,a)}function c(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var i,o,r,n,a,s=1732584193,c=-271733879,d=-1732584194,u=271733878;for(i=0;i<e.length;i+=16)c=g(c=g(c=g(c=g(c=m(c=m(c=m(c=m(c=f(c=f(c=f(c=f(c=p(c=p(c=p(c=p(r=c,d=p(n=d,u=p(a=u,s=p(o=s,c,d,u,e[i],7,-680876936),c,d,e[i+1],12,-389564586),s,c,e[i+2],17,606105819),u,s,e[i+3],22,-1044525330),d=p(d,u=p(u,s=p(s,c,d,u,e[i+4],7,-176418897),c,d,e[i+5],12,1200080426),s,c,e[i+6],17,-1473231341),u,s,e[i+7],22,-45705983),d=p(d,u=p(u,s=p(s,c,d,u,e[i+8],7,1770035416),c,d,e[i+9],12,-1958414417),s,c,e[i+10],17,-42063),u,s,e[i+11],22,-1990404162),d=p(d,u=p(u,s=p(s,c,d,u,e[i+12],7,1804603682),c,d,e[i+13],12,-40341101),s,c,e[i+14],17,-1502002290),u,s,e[i+15],22,1236535329),d=f(d,u=f(u,s=f(s,c,d,u,e[i+1],5,-165796510),c,d,e[i+6],9,-1069501632),s,c,e[i+11],14,643717713),u,s,e[i],20,-373897302),d=f(d,u=f(u,s=f(s,c,d,u,e[i+5],5,-701558691),c,d,e[i+10],9,38016083),s,c,e[i+15],14,-660478335),u,s,e[i+4],20,-405537848),d=f(d,u=f(u,s=f(s,c,d,u,e[i+9],5,568446438),c,d,e[i+14],9,-1019803690),s,c,e[i+3],14,-187363961),u,s,e[i+8],20,1163531501),d=f(d,u=f(u,s=f(s,c,d,u,e[i+13],5,-1444681467),c,d,e[i+2],9,-51403784),s,c,e[i+7],14,1735328473),u,s,e[i+12],20,-1926607734),d=m(d,u=m(u,s=m(s,c,d,u,e[i+5],4,-378558),c,d,e[i+8],11,-2022574463),s,c,e[i+11],16,1839030562),u,s,e[i+14],23,-35309556),d=m(d,u=m(u,s=m(s,c,d,u,e[i+1],4,-1530992060),c,d,e[i+4],11,1272893353),s,c,e[i+7],16,-155497632),u,s,e[i+10],23,-1094730640),d=m(d,u=m(u,s=m(s,c,d,u,e[i+13],4,681279174),c,d,e[i],11,-358537222),s,c,e[i+3],16,-722521979),u,s,e[i+6],23,76029189),d=m(d,u=m(u,s=m(s,c,d,u,e[i+9],4,-640364487),c,d,e[i+12],11,-421815835),s,c,e[i+15],16,530742520),u,s,e[i+2],23,-995338651),d=g(d,u=g(u,s=g(s,c,d,u,e[i],6,-198630844),c,d,e[i+7],10,1126891415),s,c,e[i+14],15,-1416354905),u,s,e[i+5],21,-57434055),d=g(d,u=g(u,s=g(s,c,d,u,e[i+12],6,1700485571),c,d,e[i+3],10,-1894986606),s,c,e[i+10],15,-1051523),u,s,e[i+1],21,-2054922799),d=g(d,u=g(u,s=g(s,c,d,u,e[i+8],6,1873313359),c,d,e[i+15],10,-30611744),s,c,e[i+6],15,-1560198380),u,s,e[i+13],21,1309151649),d=g(d,u=g(u,s=g(s,c,d,u,e[i+4],6,-145523070),c,d,e[i+11],10,-1120210379),s,c,e[i+2],15,718787259),u,s,e[i+9],21,-343485551),s=l(s,o),c=l(c,r),d=l(d,n),u=l(u,a);return[s,c,d,u]}function d(e){var t,i="",o=32*e.length;for(t=0;t<o;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function u(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function o(e){var t,i,o="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),o+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return o}function i(e){return unescape(encodeURIComponent(e))}function r(e){return d(c(u(t=i(e)),8*t.length));var t}function n(e,t){return function(e,t){var i,o,r=u(e),n=[],a=[];for(n[15]=a[15]=void 0,16<r.length&&(r=c(r,8*e.length)),i=0;i<16;i+=1)n[i]=909522486^r[i],a[i]=1549556828^r[i];return o=c(n.concat(u(t)),512+8*t.length),d(c(a.concat(o),640))}(i(e),i(t))}function t(e,t,i){return t?i?n(t,e):o(n(t,e)):i?r(e):o(r(e))}"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.md5=t,"undefined"!=typeof window&&(window.md5=t)}(this),window.YS.MD5=window.YS.MD5||window.md5,!window.YS.MD5)try{window.YS.MD5=md5}catch(e){console.error("Encryption method missing, please check if an encrypted file is introduced,please link MD5,for example: window.YS.MD5 = md5")}if(window.YS=window.YS||{},window.L=window.L||{},function(){("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=function n(a,s,c){function d(i,e){if(!s[i]){if(!a[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(u)return u(i,!0);var o=new Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}var r=s[i]={exports:{}};a[i][0].call(r.exports,function(e){var t=a[i][1][e];return d(t||e)},r,r.exports,n,a,s,c)}return s[i].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(e,t,i){var M=e("sdp");function c(e,t,i,o,r){var n=M.writeRtpDescription(e.kind,t);if(n+=M.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=M.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":r||"active"),n+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(o?o.id:"-")+" "+a+"\r\n";n+="a="+s,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+M.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+M.localCName+"\r\n"),n}function g(d,u){var l={codecs:[],headerExtensions:[],fecMechanisms:[]},p=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]};return d.codecs.forEach(function(i){for(var e=0;e<u.codecs.length;e++){var t=u.codecs[e];if(i.name.toLowerCase()===t.name.toLowerCase()&&i.clockRate===t.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&t.parameters.apt&&(o=i,r=t,n=d.codecs,a=u.codecs,c=s=void 0,s=p(o.parameters.apt,n),c=p(r.parameters.apt,a),!s||!c||s.name.toLowerCase()!==c.name.toLowerCase()))continue;(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(i.numChannels,t.numChannels),l.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var o,r,n,a,s,c}),d.headerExtensions.forEach(function(e){for(var t=0;t<u.headerExtensions.length;t++){var i=u.headerExtensions[t];if(e.uri===i.uri){l.headerExtensions.push(i);break}}}),l}function n(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function O(e,t){var i=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return i||e.addRemoteCandidate(t),!i}function l(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}t.exports=function(U,Y){function P(e,t){t.addTrack(e),t.dispatchEvent(new U.MediaStreamTrackEvent("addtrack",{track:e}))}function r(e,t,i,o){var r=new Event("track");r.track=t,r.receiver=i,r.transceiver={receiver:i},r.streams=o,U.setTimeout(function(){e._dispatchEvent("track",r)})}var o=function(e){var t=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=function(e,o){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?r=!0:0===e.indexOf("stun:")&&14393<=o&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?t[0]:t,!!t.length}})}(e.iceServers||[],Y),this._iceGatherers=[],e.iceCandidatePoolSize)for(var o=e.iceCandidatePoolSize;0<o;o--)this._iceGatherers.push(new U.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=M.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},o.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(e,t){var i=0<this.transceivers.length,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();o.iceTransport=r.iceTransport,o.dtlsTransport=r.dtlsTransport}return t||this.transceivers.push(o),o},o.prototype.addTrack=function(t,e){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i,o=this.transceivers.find(function(e){return e.track===t});if(o)throw l("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i=i||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),i.track=t,i.stream=e,i.rtpSender=new U.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},o.prototype.addStream=function(t){var o,i=this;15025<=Y?t.getTracks().forEach(function(e){i.addTrack(e,t)}):(o=U&&U.L&&U.L.Utils&&"function"==typeof U.L.Utils.cloneMediaStream?U.L.Utils.cloneMediaStream(t,!0,!0):t.clone(),t.getTracks().forEach(function(e,t){var i=o.getTracks()[t];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),o.getTracks().forEach(function(e){i.addTrack(e,o)}))},o.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof U.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw l("InvalidAccessError","Sender was not created by this connection.");var i=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null;var o=this.transceivers.map(function(e){return e.stream});-1===o.indexOf(i)&&-1<this.localStreams.indexOf(i)&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(e){var i=this;e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});e&&i.removeTrack(e)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},o.prototype._createIceGatherer=function(i,e){var o=this;if(e&&0<i)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new U.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[i].bufferedCandidateEvents=[],this.transceivers[i].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;r.state=t?"completed":"gathering",null!==o.transceivers[i].bufferedCandidateEvents&&o.transceivers[i].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[i].bufferCandidates),r},o.prototype._gather=function(s,c){var d=this,u=this.transceivers[c].iceGatherer;if(!u.onlocalcandidate){var e=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),u.onlocalcandidate=function(e){if(!(d.usingBundle&&0<c)){var t=new Event("icecandidate");t.candidate={sdpMid:s,sdpMLineIndex:c};var i=e.candidate,o=!i||0===Object.keys(i).length;if(o)"new"!==u.state&&"gathering"!==u.state||(u.state="completed");else{"new"===u.state&&(u.state="gathering"),i.component=1,i.ufrag=u.getLocalParameters().usernameFragment;var r=M.writeCandidate(i);t.candidate=Object.assign(t.candidate,M.parseCandidate(r)),t.candidate.candidate=r,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}}var n=M.getMediaSections(d._localDescription.sdp);n[t.candidate.sdpMLineIndex]+=o?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",d._localDescription.sdp=M.getDescription(d._localDescription.sdp)+n.join("");var a=d.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),o||d._dispatchEvent("icecandidate",t),a&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},U.setTimeout(function(){e.forEach(function(e){u.onlocalcandidate(e)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var e=this,t=new U.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var i=new U.RTCDtlsTransport(t);return i.ondtlsstatechange=function(){e._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:i}},o.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},o.prototype._transceive=function(e,t,i){var o=g(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:M.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&0<o.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&Y<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},o.prototype.setLocalDescription=function(e){var t,p,f=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(l("TypeError",'Unsupported type "'+e.type+'"'));if(!n("setLocalDescription",e.type,f.signalingState)||f._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+e.type+" in state "+f.signalingState));if("offer"===e.type)t=M.splitSections(e.sdp),p=t.shift(),t.forEach(function(e,t){var i=M.parseRtpParameters(e);f.transceivers[t].localCapabilities=i}),f.transceivers.forEach(function(e,t){f._gather(e.mid,t)});else if("answer"===e.type){t=M.splitSections(f._remoteDescription.sdp),p=t.shift();var m=0<M.matchPrefix(p,"a=ice-lite").length;t.forEach(function(e,t){var i=f.transceivers[t],o=i.iceGatherer,r=i.iceTransport,n=i.dtlsTransport,a=i.localCapabilities,s=i.remoteCapabilities,c=M.isRejected(e)&&0===M.matchPrefix(e,"a=bundle-only").length;if(!c&&!i.rejected){var d=M.getIceParameters(e,p),u=M.getDtlsParameters(e,p);m&&(u.role="server"),f.usingBundle&&0!==t||(f._gather(i.mid,t),"new"===r.state&&r.start(o,d,m?"controlling":"controlled"),"new"===n.state&&n.start(u));var l=g(a,s);f._transceive(i,0<l.codecs.length,!1)}})}return f._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(E){var A=this;if(-1===["offer","answer"].indexOf(E.type))return Promise.reject(l("TypeError",'Unsupported type "'+E.type+'"'));if(!n("setRemoteDescription",E.type,A.signalingState)||A._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+E.type+" in state "+A.signalingState));var k={};A.remoteStreams.forEach(function(e){k[e.id]=e});var R=[],e=M.splitSections(E.sdp),C=e.shift(),D=0<M.matchPrefix(C,"a=ice-lite").length,N=0<M.matchPrefix(C,"a=group:BUNDLE ").length;A.usingBundle=N;var t=M.matchPrefix(C,"a=ice-options:")[0];return A.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var i=M.splitLines(e),o=M.getKind(e),r=M.isRejected(e)&&0===M.matchPrefix(e,"a=bundle-only").length,n=i[0].substr(2).split(" ")[2],a=M.getDirection(e,C),s=M.parseMsid(e),c=M.getMid(e)||M.generateIdentifier();if(r||"application"===o&&("DTLS/SCTP"===n||"UDP/DTLS/SCTP"===n))A.transceivers[t]={mid:c,kind:o,protocol:n,rejected:!0};else{var d,u,l,p,f,m,g,v,h;!r&&A.transceivers[t]&&A.transceivers[t].rejected&&(A.transceivers[t]=A._createTransceiver(o,!0));var S,y,_=M.parseRtpParameters(e);r||(S=M.getIceParameters(e,C),(y=M.getDtlsParameters(e,C)).role="client"),g=M.parseRtpEncodingParameters(e);var L=M.parseRtcpParameters(e),b=0<M.matchPrefix(e,"a=end-of-candidates",C).length,w=M.matchPrefix(e,"a=candidate:").map(function(e){return M.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===E.type||"answer"===E.type)&&!r&&N&&0<t&&A.transceivers[t]&&(A._disposeIceAndDtlsTransports(t),A.transceivers[t].iceGatherer=A.transceivers[0].iceGatherer,A.transceivers[t].iceTransport=A.transceivers[0].iceTransport,A.transceivers[t].dtlsTransport=A.transceivers[0].dtlsTransport,A.transceivers[t].rtpSender&&A.transceivers[t].rtpSender.setTransport(A.transceivers[0].dtlsTransport),A.transceivers[t].rtpReceiver&&A.transceivers[t].rtpReceiver.setTransport(A.transceivers[0].dtlsTransport)),"offer"!==E.type||r)"answer"!==E.type||r||(d=A.transceivers[t],u=d.iceGatherer,l=d.iceTransport,p=d.dtlsTransport,f=d.rtpReceiver,m=d.sendEncodingParameters,v=d.localCapabilities,A.transceivers[t].recvEncodingParameters=g,A.transceivers[t].remoteCapabilities=_,A.transceivers[t].rtcpParameters=L,w.length&&"new"===l.state&&(!D&&!b||N&&0!==t?w.forEach(function(e){O(d.iceTransport,e)}):l.setRemoteCandidates(w)),N&&0!==t||("new"===l.state&&l.start(u,S,"controlling"),"new"===p.state&&p.start(y)),A._transceive(d,"sendrecv"===a||"recvonly"===a,"sendrecv"===a||"sendonly"===a),!f||"sendrecv"!==a&&"sendonly"!==a?delete d.rtpReceiver:(h=f.track,s?(k[s.stream]||(k[s.stream]=new U.MediaStream),P(h,k[s.stream]),R.push([h,f,k[s.stream]])):(k.default||(k.default=new U.MediaStream),P(h,k.default),R.push([h,f,k.default]))));else{(d=A.transceivers[t]||A._createTransceiver(o)).mid=c,d.iceGatherer||(d.iceGatherer=A._createIceGatherer(t,N)),w.length&&"new"===d.iceTransport.state&&(!b||N&&0!==t?w.forEach(function(e){O(d.iceTransport,e)}):d.iceTransport.setRemoteCandidates(w)),v=U.RTCRtpReceiver.getCapabilities(o),Y<15019&&(v.codecs=v.codecs.filter(function(e){return"rtx"!==e.name})),m=d.sendEncodingParameters||[{ssrc:1001*(2*t+2)}];var I,T=!1;if("sendrecv"===a||"sendonly"===a){if(T=!d.rtpReceiver,f=d.rtpReceiver||new U.RTCRtpReceiver(d.dtlsTransport,o),T)h=f.track,s&&"-"===s.stream||(I=s?(k[s.stream]||(k[s.stream]=new U.MediaStream,Object.defineProperty(k[s.stream],"id",{get:function(){return s.stream}})),Object.defineProperty(h,"id",{get:function(){return s.track}}),k[s.stream]):(k.default||(k.default=new U.MediaStream),k.default)),I&&(P(h,I),d.associatedRemoteMediaStreams.push(I)),R.push([h,f,I])}else d.rtpReceiver&&d.rtpReceiver.track&&(d.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===d.rtpReceiver.track.id});t&&function(e,t){t.removeTrack(e),t.dispatchEvent(new U.MediaStreamTrackEvent("removetrack",{track:e}))}(t,e)}),d.associatedRemoteMediaStreams=[]);d.localCapabilities=v,d.remoteCapabilities=_,d.rtpReceiver=f,d.rtcpParameters=L,d.sendEncodingParameters=m,d.recvEncodingParameters=g,A._transceive(A.transceivers[t],!1,T)}}}),void 0===A._dtlsRole&&(A._dtlsRole="offer"===E.type?"active":"passive"),A._remoteDescription={type:E.type,sdp:E.sdp},"offer"===E.type?A._updateSignalingState("have-remote-offer"):A._updateSignalingState("stable"),Object.keys(k).forEach(function(e){var o=k[e];if(o.getTracks().length){if(-1===A.remoteStreams.indexOf(o)){A.remoteStreams.push(o);var t=new Event("addstream");t.stream=o,U.setTimeout(function(){A._dispatchEvent("addstream",t)})}R.forEach(function(e){var t=e[0],i=e[1];o.id===e[2].id&&r(A,t,i,[o])})}}),R.forEach(function(e){e[2]||r(A,e[0],e[1],[])}),U&&U.L&&U.L.Utils&&L.Utils.getBrowserInfo&&"edge"===L.Utils.getBrowserInfo(!0).info.browserName?U.setTimeout(function(){A&&A.transceivers&&A.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.info("edge ignore Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},0):U.setTimeout(function(){A&&A.transceivers&&A.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},o.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,U.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},o.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},o.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},o.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var t=s.transceivers.filter(function(e){return"audio"===e.kind}).length,i=s.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(i=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(s.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});0<t||0<i;)0<t&&(s._createTransceiver("audio"),t--),0<i&&(s._createTransceiver("video"),i--);var o=M.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(i,e){var t=i.track,o=i.kind,r=i.mid||M.generateIdentifier();i.mid=r,i.iceGatherer||(i.iceGatherer=s._createIceGatherer(e,s.usingBundle));var n=U.RTCRtpSender.getCapabilities(o);Y<15019&&(n.codecs=n.codecs.filter(function(e){return"rtx"!==e.name})),n.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),n.headerExtensions.forEach(function(t){var e=i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[];e.forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});var a=i.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];t&&15019<=Y&&"video"===o&&!a[0].rtx&&(a[0].rtx={ssrc:a[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new U.RTCRtpReceiver(i.dtlsTransport,o)),i.localCapabilities=n,i.sendEncodingParameters=a}),"max-compat"!==s._config.bundlePolicy&&(o+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",s.transceivers.forEach(function(e,t){o+=c(e,e.localCapabilities,"offer",e.stream,s._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,o+="a="+M.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))});var r=new U.RTCSessionDescription({type:"offer",sdp:o});return Promise.resolve(r)},o.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=M.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=M.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,t){if(!(s<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var i;if(e.stream)"audio"===e.kind?i=e.stream.getAudioTracks()[0]:"video"===e.kind&&(i=e.stream.getVideoTracks()[0]),i&&15019<=Y&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var o=g(e.localCapabilities,e.remoteCapabilities),r=o.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!r&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=c(e,o,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var e=new U.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(e)},o.prototype.addIceCandidate=function(c){var d,u=this;return c&&void 0===c.sdpMLineIndex&&!c.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!u._remoteDescription)return t(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(c&&""!==c.candidate){var i=c.sdpMLineIndex;if(c.sdpMid)for(var o=0;o<u.transceivers.length;o++)if(u.transceivers[o].mid===c.sdpMid){i=o;break}var r=u.transceivers[i];if(!r)return t(l("OperationError","Can not add ICE candidate"));if(r.rejected)return e();var n=0<Object.keys(c.candidate).length?M.parseCandidate(c.candidate):{};if("tcp"===n.protocol&&(0===n.port||9===n.port))return e();if(n.component&&1!==n.component)return e();if((0===i||0<i&&r.iceTransport!==u.transceivers[0].iceTransport)&&!O(r.iceTransport,n))return t(l("OperationError","Can not add ICE candidate"));var a=c.candidate.trim();0===a.indexOf("a=")&&(a=a.substr(2)),(d=M.getMediaSections(u._remoteDescription.sdp))[i]+="a="+(n.type?a:"end-of-candidates")+"\r\n",u._remoteDescription.sdp=M.getDescription(u._remoteDescription.sdp)+d.join("")}else for(var s=0;s<u.transceivers.length&&(u.transceivers[s].rejected||(u.transceivers[s].iceTransport.addRemoteCandidate({}),(d=M.getMediaSections(u._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",u._remoteDescription.sdp=M.getDescription(u._remoteDescription.sdp)+d.join(""),!u.usingBundle));s++);e()})},o.prototype.getStats=function(t){if(t&&t instanceof U.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)}),!i)throw l("InvalidAccessError","Invalid selector.");return i.getStats()}var o=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&o.push(t[e].getStats())})}),Promise.all(o).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t=U[e];if(t&&t.prototype&&t.prototype.getStats){var i=t.prototype.getStats;t.prototype.getStats=function(){return i.apply(this).then(function(t){var i=new Map;return Object.keys(t).forEach(function(e){t[e].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(t[e]),i.set(e,t[e])}),i})}}});var e=["createOffer","createAnswer"];return e.forEach(function(e){var i=o.prototype[e];o.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?i.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):i.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var i=o.prototype[e];o.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?i.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):i.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),o}},{sdp:2}],2:[function(e,t,i){var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},u.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},u.getDescription=function(e){var t=u.splitSections(e);return t&&t[0]},u.getMediaSections=function(e){var t=u.splitSections(e);return t.shift(),t},u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},u.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":i.relatedAddress=t[o+1];break;case"rport":i.relatedPort=parseInt(t[o+1],10);break;case"tcptype":i.tcpType=t[o+1];break;case"ufrag":i.ufrag=t[o+1],i.usernameFragment=t[o+1];break;default:i[t[o]]=t[o+1]}return i},u.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},u.parseIceOptions=function(e){return e.substr(14).split(" ")},u.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},u.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},u.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},u.parseFmtp=function(e){for(var t,i={},o=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<o.length;r++)t=o[r].trim().split("="),i[t[0].trim()]=t[1];return i},u.writeFmtp=function(t){var e="",i=t.payloadType;if(void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var o=[];Object.keys(t.parameters).forEach(function(e){t.parameters[e]?o.push(e+"="+t.parameters[e]):o.push(e)}),e+="a=fmtp:"+i+" "+o.join(";")+"\r\n"}return e},u.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},u.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},u.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return-1<o?(i.attribute=e.substr(t+1,o-t-1),i.value=e.substr(o+1)):i.attribute=e.substr(t+1),i},u.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},u.getMid=function(e){var t=u.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},u.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},u.getDtlsParameters=function(e,t){var i=u.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:i.map(u.parseFingerprint)}},u.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},u.getIceParameters=function(e,t){var i=u.splitLines(e),o={usernameFragment:(i=i.concat(u.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return o},u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=u.splitLines(e),o=i[0].split(" "),r=3;r<o.length;r++){var n=o[r],a=u.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(a){var s=u.parseRtpMap(a),c=u.matchPrefix(e,"a=fmtp:"+n+" ");switch(s.parameters=c.length?u.parseFmtp(c[0]):{},s.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(u.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return u.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(u.parseExtmap(e))}),t},u.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=0<t.codecs.length?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=u.writeRtpMap(e),i+=u.writeFmtp(e),i+=u.writeRtcpFb(e)});var o=0;return t.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),0<o&&(i+="a=maxptime:"+o+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){i+=u.writeExtmap(e)}),i},u.parseRtpEncodingParameters=function(e){var i,o=[],t=u.parseRtpParameters(e),r=-1!==t.fecMechanisms.indexOf("RED"),n=-1!==t.fecMechanisms.indexOf("ULPFEC"),a=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<a.length&&a[0].ssrc,c=u.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});0<c.length&&1<c[0].length&&c[0][0]===s&&(i=c[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&i&&(t.rtx={ssrc:i}),o.push(t),r&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:i,mechanism:n?"red+ulpfec":"red"},o.push(t))}}),0===o.length&&s&&o.push({ssrc:s});var d=u.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,o.forEach(function(e){e.maxBitrate=d})),o},u.parseRtcpParameters=function(e){var t={},i=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var o=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<o.length,t.compound=0===o.length;var r=u.matchPrefix(e,"a=rtcp-mux");return t.mux=0<r.length,t},u.parseMsid=function(e){var t,i=u.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var o=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<o.length?{stream:(t=o[0].value.split(" "))[0],track:t[1]}:void 0},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(e,t){var i=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||u.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.writeMediaSection=function(e,t,i,o){var r=u.writeRtpDescription(e.kind,t);if(r+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var n="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+n,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),r},u.getDirection=function(e,t){for(var i=u.splitLines(e),o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substr(2)}return t?u.getDirection(t):"sendrecv"},u.getKind=function(e){var t=u.splitLines(e),i=t[0].split(" ");return i[0].substr(2)},u.isRejected=function(e){return"0"===e.split(" ",2)[1]},u.parseMLine=function(e){var t=u.splitLines(e),i=t[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},u.parseOLine=function(e){var t=u.matchPrefix(e,"o=")[0],i=t.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},u.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=u.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=u)},{}],3:[function(i,o,e){(function(e){var t=i("./adapter_factory.js");o.exports=t({window:e.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(f,e,t){var m=f("./utils");e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var r in t)hasOwnProperty.call(t,r)&&(o[r]=t[r]);var n=m.log,a=m.detectBrowser(i),s=f("./chrome/chrome_shim")||null,c=f("./edge/edge_shim")||null,d=f("./firefox/firefox_shim")||null,u=f("./safari/safari_shim")||null,l=f("./common_shim")||null,p={browserDetails:a,commonShim:l,extractVersion:m.extractVersion,disableLog:m.disableLog,disableWarnings:m.disableWarnings};switch(a.browser){case"chrome":if(!s||!s.shimPeerConnection||!o.shimChrome)return n("Chrome shim is not included in this adapter release."),p;n("adapter.js shimming chrome."),p.browserShim=s,l.shimCreateObjectURL(i),s.shimGetUserMedia(i),s.shimMediaStream(i),s.shimSourceObject(i),s.shimPeerConnection(i),s.shimOnTrack(i),s.shimAddTrackRemoveTrack(i),s.shimGetSendersWithDtmf(i),s.shimSenderReceiverGetStats(i),s.fixNegotiationNeeded(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"firefox":if(!d||!d.shimPeerConnection||!o.shimFirefox)return n("Firefox shim is not included in this adapter release."),p;n("adapter.js shimming firefox."),p.browserShim=d,l.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimRemoveStream(i),d.shimSenderGetStats(i),d.shimReceiverGetStats(i),d.shimRTCDataChannel(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"edge":if(!c||!c.shimPeerConnection||!o.shimEdge)return n("MS edge shim is not included in this adapter release."),p;n("adapter.js shimming edge."),p.browserShim=c,l.shimCreateObjectURL(i),c.shimGetUserMedia(i),c.shimPeerConnection(i),c.shimReplaceTrack(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"safari":if(!u||!o.shimSafari)return n("Safari shim is not included in this adapter release."),p;n("adapter.js shimming safari."),p.browserShim=u,l.shimCreateObjectURL(i),u.shimRTCIceServerUrls(i),u.shimCreateOfferLegacy(i),u.shimCallbacksAPI(i),u.shimLocalStreamsAPI(i),u.shimRemoteStreamsAPI(i),u.shimTrackEventTransceiver(i),u.shimGetUserMedia(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;default:n("Unsupported browser!")}return p}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(e,t,i){var c=e("../utils.js"),o=c.log;function r(i,t,e){var o=e?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var n=[];return i.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&n.push(e)}),n.forEach(function(t){i.forEach(function(e){e.type===o&&e.trackId===t.id&&!function t(i,o,r){if(!o||r.has(o.id))return;r.set(o.id,o);Object.keys(o).forEach(function(e){e.endsWith("Id")?t(i,i.get(o[e]),r):e.endsWith("Ids")&&o[e].forEach(function(e){t(i,i.get(e),r)})})}(i,e,r)})}),r}t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(n){if("object"!=typeof n||!n.RTCPeerConnection||"ontrack"in n.RTCPeerConnection.prototype)"RTCRtpTransceiver"in n||c.wrapPeerConnectionEvent(n,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(o){o.stream.addEventListener("addtrack",function(t){var e;e=n.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track};var i=new Event("track");i.track=t.track,i.receiver=e,i.transceiver={receiver:e},i.streams=[o.stream],r.dispatchEvent(i)}),o.stream.getTracks().forEach(function(t){var e;e=n.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t};var i=new Event("track");i.track=t,i.receiver=e,i.transceiver={receiver:e},i.streams=[o.stream],r.dispatchEvent(i)})},r.addEventListener("addstream",r._ontrackpoly)),e.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var o=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var i=r.apply(this,arguments);return i||(i=o(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[],n.apply(t,[e]),e.getTracks().forEach(function(e){t._senders.push(o(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var i=this;i._senders=i._senders||[],t.apply(i,[e]),e.getTracks().forEach(function(t){var e=i._senders.find(function(e){return e.track===t});e&&i._senders.splice(i._senders.indexOf(e),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(t,[]);return e.forEach(function(e){e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return r(e,t.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=o.apply(t,[]);return e.forEach(function(e){e._pc=t}),e}),c.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return r(e,t.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t,i,o,r=arguments[0];return this.getSenders().forEach(function(e){e.track===r&&(t?o=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===r&&(i?o=!0:i=e),e.track===r}),o||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}},shimSourceObject:function(e){var i=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&i.revokeObjectURL(this.src),e?(this.src=i.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&i.revokeObjectURL(t.src),t.src=i.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&i.revokeObjectURL(t.src),t.src=i.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=o.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(i)&&this._shimmedLocalStreams[t.id].push(i):this._shimmedLocalStreams[t.id]=[t,i],i};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});if(e)throw new DOMException("Track already exists.","InvalidAccessError")});var t=i.getSenders();r.apply(this,arguments);var o=i.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(o)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(i){var o=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},i&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=o._shimmedLocalStreams[e].indexOf(i);-1!==t&&o._shimmedLocalStreams[e].splice(t,1),1===o._shimmedLocalStreams[e].length&&delete o._shimmedLocalStreams[e]}),n.apply(this,arguments)}},shimAddTrackRemoveTrack:function(s){var e=c.detectBrowser(s);if(s.RTCPeerConnection.prototype.addTrack&&65<=e.version)return this.shimAddTrackRemoveTrackWithNative(s);var i=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=i.apply(this);return t._reverseStreams=t._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var o=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(e){var i=this;if(i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},e.getTracks().forEach(function(t){var e=i.getSenders().find(function(e){return e.track===t});if(e)throw new DOMException("Track already exists.","InvalidAccessError")}),!i._reverseStreams[e.id]){var t=new s.MediaStream(e.getTracks());i._streams[e.id]=t,i._reverseStreams[t.id]=e,e=t}o.apply(i,[e])};var r=s.RTCPeerConnection.prototype.removeStream;function n(o,e){var r=e.sdp;return Object.keys(o._reverseStreams||[]).forEach(function(e){var t=o._reverseStreams[e],i=o._streams[t.id];r=r.replace(new RegExp(i.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:r})}s.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},r.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},s.RTCPeerConnection.prototype.addTrack=function(t,e){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var r=i.getSenders().find(function(e){return e.track===t});if(r)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var n=i._streams[e.id];if(n)n.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var a=new s.MediaStream([t]);i._streams[e.id]=a,i._reverseStreams[a.id]=e,i.addStream(a)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){var i=this,o=arguments,e=arguments.length&&"function"==typeof arguments[0];return e?t.apply(i,[function(e){var t=n(i,e);o[0].apply(null,[t])},function(e){o[1]&&o[1].apply(null,e)},arguments[2]]):t.apply(i,arguments).then(function(e){return n(i,e)})}});var t=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=function(o,e){var r=e.sdp;return Object.keys(o._reverseStreams||[]).forEach(function(e){var t=o._reverseStreams[e],i=o._streams[t.id];r=r.replace(new RegExp(t.id,"g"),i.id)}),new RTCSessionDescription({type:e.type,sdp:r})}(this,arguments[0])),t.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:n(this,e)}}),s.RTCPeerConnection.prototype.removeTrack=function(i){var o=this;if("closed"===o.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!i._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r,e=i._pc===o;if(!e)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");o._streams=o._streams||{},Object.keys(o._streams).forEach(function(e){var t=o._streams[e].getTracks().find(function(e){return i.track===e});t&&(r=o._streams[e])}),r&&(1===r.getTracks().length?o.removeStream(o._reverseStreams[r.id]):r.removeTrack(i.track),o.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(i){var e=c.detectBrowser(i);if(!i.RTCPeerConnection&&i.webkitRTCPeerConnection)i.RTCPeerConnection=function(e,t){return o("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new i.webkitRTCPeerConnection(e,t)},i.RTCPeerConnection.prototype=i.webkitRTCPeerConnection.prototype,i.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return i.webkitRTCPeerConnection.generateCertificate}});else{var n=i.RTCPeerConnection;i.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,i.push(r)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},i.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var s=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(e,t,i){var o=this,r=arguments;if(0<arguments.length&&"function"==typeof e)return s.apply(this,arguments);var n=function(e){var o={},t=e.result();return t.forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){i[e]=t.stat(e)}),o[i.id]=i}),o},a=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};if(2<=arguments.length){return s.apply(this,[function(e){r[1](a(n(e)))},arguments[0]])}return new Promise(function(t,e){s.apply(o,[function(e){t(a(n(e)))},e])}).then(t,i)},e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var r=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){var i=arguments,o=this,e=new Promise(function(e,t){r.apply(o,[i[0],e,t])});return i.length<2?e:e.then(function(){i[1].apply(null,[])},function(e){3<=i.length&&i[2].apply(null,[e])})}}),e.version<52&&["createOffer","createAnswer"].forEach(function(e){var r=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){var i=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var o=1===arguments.length?arguments[0]:void 0;return new Promise(function(e,t){r.apply(i,[e,t,o])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=i.RTCPeerConnection.prototype[e];i.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var t=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){c.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})},shimGetDisplayMedia:function(e,i){"getDisplayMedia"in e.navigator||("function"==typeof i?navigator.getDisplayMedia=function(t){return i(t).then(function(e){return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:t.video.frameRate||3}},navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},{"../utils.js":14,"./getusermedia":6}],6:[function(e,t,i){var d=e("../utils.js"),u=d.log;t.exports=function(o){var a=d.detectBrowser(o),s=o&&o.navigator,c=function(r){if("object"!=typeof r||r.mandatory||r.optional)return r;var n={};return Object.keys(r).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var i="object"==typeof r[t]?r[t]:{ideal:r[t]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){n.optional=n.optional||[];var e={};"number"==typeof i.ideal?(e[o("min",t)]=i.ideal,n.optional.push(e),(e={})[o("max",t)]=i.ideal):e[o("",t)]=i.ideal,n.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(n.mandatory=n.mandatory||{},n.mandatory[o("",t)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(n.mandatory=n.mandatory||{},n.mandatory[o(e,t)]=i[e])})}}),r.advanced&&(n.optional=(n.optional||[]).concat(r.advanced)),n},r=function(i,o){if(61<=a.version)return o(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"==typeof i.audio){var e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","googAutoGainControl"),e(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=c(i.audio)}if(i&&"object"==typeof i.video){var r=i.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});var n,t=a.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||t))if(delete i.video.facingMode,"environment"===r.exact||"environment"===r.ideal?n=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(n=["front"]),n)return s.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return n.some(function(e){return-1!==t.label.toLowerCase().indexOf(e)})});return!t&&e.length&&-1!==n.indexOf("back")&&(t=e[e.length-1]),t&&(i.video.deviceId=r.exact?{exact:t.deviceId}:{ideal:t.deviceId}),i.video=c(i.video),u("chrome: "+JSON.stringify(i)),o(i)});i.video=c(i.video)}return u("chrome: "+JSON.stringify(i)),o(i)},n=function(e){return 64<=a.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};s.getUserMedia=function(e,t,i){r(e,function(e){s.webkitGetUserMedia(e,t,function(e){if(i){i(n(e))}})})};var t=function(i){return new Promise(function(e,t){s.getUserMedia(i,e,t)})};if(s.mediaDevices||(s.mediaDevices={getUserMedia:t,enumerateDevices:function(){return new Promise(function(t){var i={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:i[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),s.mediaDevices.getUserMedia){var i=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(e){return r(e,function(t){return i(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){o&&o.L&&o.L.Utils&&"function"==typeof o.L.Utils.stopTrack?o.L.Utils.stopTrack(e):e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(n(e))})})}}else s.mediaDevices.getUserMedia=function(e){return t(e)};void 0===s.mediaDevices.addEventListener&&(s.mediaDevices.addEventListener=function(){u("Dummy mediaDevices.addEventListener called.")}),void 0===s.mediaDevices.removeEventListener&&(s.mediaDevices.removeEventListener=function(){u("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(e,t,i){var s=e("sdp"),c=e("./utils");t.exports={shimRTCIceCandidate:function(t){if(t.RTCIceCandidate&&!(t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)){var r=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new r(e),i=s.parseCandidate(e.candidate),o=Object.assign(t,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new r(e)},t.RTCIceCandidate.prototype=r.prototype,c.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var i=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),r=new Map,n=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++n;return r.set(t,e),c.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return i(e)},t.revokeObjectURL=function(e){o(e),r.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){return this.srcObject=r.get(e)||null,a.set.apply(this,[e])}});var s=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=r.get(arguments[1])||null),s.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var n=c.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,function(e){var t=s.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=s.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var e,t=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(t===null||t.length<2){return-1}var i=parseInt(t[1],10);return i!==i?-1:i}(arguments[0]),i=function(e){var t=65536;if(n.browser==="firefox"){if(n.version<57){if(e===-1){t=16384}else{t=2147483637}}else if(n.version<60){t=n.version===57?65535:65536}else{t=2147483637}}return t}(t),o=function(e,t){var i=65536;if(n.browser==="firefox"&&n.version===57){i=65535}var o=s.matchPrefix(e.sdp,"a=max-message-size:");if(o.length>0){i=parseInt(o[0].substr(19),10)}else if(n.browser==="firefox"&&t!==-1){i=2147483637}return i}(arguments[0],t);e=0===i&&0===o?Number.POSITIVE_INFINITY:0===i||0===o?Math.max(i,o):Math.min(i,o);var r={};Object.defineProperty(r,"maxMessageSize",{get:function(){return e}}),this._sctp=r}return a.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return i(e,this),e},c.wrapPeerConnectionEvent(e,"datachannel",function(e){return i(e.channel,e.target),e})}function i(i,o){var r=i.send;i.send=function(){var e=arguments[0],t=e.length||e.size||e.byteLength;if("open"===i.readyState&&o.sctp&&t>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}}}},{"./utils":14,sdp:2}],8:[function(e,t,i){var r=e("../utils"),n=e("./filtericeservers"),a=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var i=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){i.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=a(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=n(e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(e,t,i){var n=e("../utils");t.exports=function(e,o){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){var t=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r;return t?r=!0:0===e.indexOf("stun:")&&14393<=o&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?t[0]:t,!!t.length}})}},{"../utils":14}],10:[function(e,t,i){t.exports=function(e){var t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,i){var n=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(i){i.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.transceiver={receiver:t.receiver},t.streams=[i.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(s){var c=n.detectBrowser(s);if("object"==typeof s&&(s.RTCPeerConnection||s.mozRTCPeerConnection)){s.RTCPeerConnection||(s.RTCPeerConnection=function(e,t){if(c.version<38&&e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];if(r.hasOwnProperty("urls"))for(var n=0;n<r.urls.length;n++){var a={url:r.urls[n]};0===r.urls[n].indexOf("turn")&&(a.username=r.username,a.credential=r.credential),i.push(a)}else i.push(e.iceServers[o])}e.iceServers=i}return new s.mozRTCPeerConnection(e,t)},s.RTCPeerConnection.prototype=s.mozRTCPeerConnection.prototype,s.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:function(){return s.mozRTCPeerConnection.generateCertificate}}),s.RTCSessionDescription=s.mozRTCSessionDescription,s.RTCIceCandidate=s.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=s.RTCPeerConnection.prototype[e];s.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=s.RTCPeerConnection.prototype.addIceCandidate;s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(e,t,i){return r.apply(this,[e||null]).then(function(i){if(c.version<48&&(i=function(t){var i=new Map;return Object.keys(t).forEach(function(e){i.set(e,t[e]),i[e]=t[e]}),i}(i)),c.version<53&&!t)try{i.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;i.forEach(function(e,t){i.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return i}).then(t,i)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(t,[]);return e.forEach(function(e){e._pc=t}),e}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var i=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&-1!==t.getTracks().indexOf(e.track)&&i.removeTrack(e)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,i){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:i}:e.video.mediaSource=i,navigator.mediaDevices.getUserMedia(e);var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)})}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,i){var p=e("../utils"),f=p.log;t.exports=function(i){var r=p.detectBrowser(i),n=i&&i.navigator,e=i&&i.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,t,i){var o=function(o){if("object"!=typeof o||o.require)return o;var r=[];return Object.keys(o).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var t=o[e]="object"==typeof o[e]?o[e]:{ideal:o[e]};if(void 0===t.min&&void 0===t.max&&void 0===t.exact||r.push(e),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:o[e]=t.exact,delete t.exact),void 0!==t.ideal){o.advanced=o.advanced||[];var i={};"number"==typeof t.ideal?i[e]={min:t.ideal,max:t.ideal}:i[e]=t.ideal,o.advanced.push(i),delete t.ideal,Object.keys(t).length||delete o[e]}}}),r.length&&(o.require=r),o};return e=JSON.parse(JSON.stringify(e)),r.version<38&&(f("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),f("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,t,function(e){i(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(i){return new Promise(function(e,t){o(i,e,t)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},r.version<41){var t=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(r.version<49){var s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return s(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){i&&i.L&&i.L.Utils&&"function"==typeof i.L.Utils.stopTrack?i.L.Utils.stopTrack(e):e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(e){return Promise.reject(a(e))})}}if(!(55<r.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var c=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),c(e.audio,"autoGainControl","mozAutoGainControl"),c(e.audio,"noiseSuppression","mozNoiseSuppression")),d(e)},e&&e.prototype.getSettings){var u=e.prototype.getSettings;e.prototype.getSettings=function(){var e=u.apply(this,arguments);return c(e,"mozAutoGainControl","autoGainControl"),c(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){var l=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),c(e,"autoGainControl","mozAutoGainControl"),c(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}n.getUserMedia=function(e,t,i){if(r.version<44)return o(e,t,i);p.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)}}},{"../utils":14}],13:[function(e,t,i){var a=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(t){var i=null;return this._localStreams&&this._localStreams.forEach(function(e){e.id===t&&(i=e)}),this._remoteStreams&&this._remoteStreams.forEach(function(e){e.id===t&&(i=e)}),i}),!("addStream"in e.RTCPeerConnection.prototype)){var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(t)&&this._localStreams.push(t);var i=this;t.getTracks().forEach(function(e){o.call(i,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e,t){return t&&(this._localStreams?-1===this._localStreams.indexOf(t)&&this._localStreams.push(t):this._localStreams=[t]),o.call(this,e,t)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var i=this,o=e.getTracks();this.getSenders().forEach(function(e){-1!==o.indexOf(e.track)&&i.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(i._remoteStreams||(i._remoteStreams=[]),!(0<=i._remoteStreams.indexOf(e))){i._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,i.dispatchEvent(t)}})}),t.apply(i,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,a=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var i=2<=arguments.length?arguments[2]:arguments[0],o=r.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var i=2<=arguments.length?arguments[2]:arguments[0],o=n.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o};var i=function(e,t,i){var o=a.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o};t.setLocalDescription=i,i=function(e,t,i){var o=s.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.setRemoteDescription=i,i=function(e,t,i){var o=c.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.addIceCandidate=i}},shimGetUserMedia:function(e){var o=e&&e.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=function(e,t,i){o.mediaDevices.getUserMedia(e).then(t,i)}.bind(o)))},shimRTCIceServerUrls:function(e){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,i.push(r)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var o=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return o.apply(this,arguments)}}}},{"../utils":14}],14:[function(e,t,i){var o=!0,r=!0;function n(e,t,i){var o=e.match(t);return o&&o.length>=i&&parseInt(o[i],10)}t.exports={extractVersion:n,wrapPeerConnectionEvent:function(e,o,r){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,n=t.addEventListener;t.addEventListener=function(e,i){if(e!==o)return n.apply(this,arguments);function t(e){var t=r(e);t&&i(t)}return this._eventMap=this._eventMap||{},this._eventMap[i]=t,n.apply(this,[e,t])};var a=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==o||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);var i=this._eventMap[t];return delete this._eventMap[t],a.apply(this,[e,i])},Object.defineProperty(t,"on"+o,{get:function(){return this["_on"+o]},set:function(e){this["_on"+o]&&(this.removeEventListener(o,this["_on"+o]),delete this["_on"+o]),e&&this.addEventListener(o,this["_on"+o]=e)},enumerable:!0,configurable:!0})},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){r&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,i={browser:null,version:null};if(void 0===e||!e.navigator)return i.browser="Not a browser.",i;if(t.mozGetUserMedia)i.browser="firefox",i.version=n(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)i.browser="chrome",i.version=n(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=n(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=n(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return i}}},{}]},{},[3])(3)}(),window.YS=window.YS||{},window.L=window.L||{},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t(),("undefined"!=typeof window?window:"undefined"!=typeof self?self:this).Promise=t()}(this,function(){function d(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,t=void 0,r=void 0,a=function(e,t){p[o]=e,p[o+1]=t,2===(o+=2)&&(r?r(f):S())};var e="undefined"!=typeof window?window:void 0,n=e||{},s=n.MutationObserver||n.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function l(){var e=setTimeout;return function(){return e(f,1)}}var p=new Array(1e3);function f(){for(var e=0;e<o;e+=2){(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0}o=0}var m,g,v,h,S=void 0;function y(e,t){var i=this,o=new this.constructor(b);void 0===o[L]&&x(o);var r=i._state;if(r){var n=arguments[r-1];a(function(){return M(r,o,n,i._result)})}else Y(i,o,e,t);return o}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(b);return C(t,e),t}S=c?function(){return process.nextTick(f)}:s?(g=0,v=new s(f),h=document.createTextNode(""),v.observe(h,{characterData:!0}),function(){h.data=g=++g%2}):u?((m=new MessageChannel).port1.onmessage=f,function(){return m.port2.postMessage(0)}):void 0===e&&"function"==typeof require?function(){try{var e=Function("return this")().require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(f)}:l()}catch(e){return l()}}():l();var L=Math.random().toString(36).substring(2);function b(){}var w=void 0,I=1,T=2,E={error:null};function A(e){try{return e.then}catch(e){return E.error=e,E}}function k(e,o,r){a(function(t){var i=!1,e=function(e,t,i,o){try{e.call(t,i,o)}catch(e){return e}}(r,o,function(e){i||(i=!0,o!==e?C(t,e):N(t,e))},function(e){i||(i=!0,U(t,e))},t._label);!i&&e&&(i=!0,U(t,e))},e)}function R(e,t,i){var o,r;t.constructor===e.constructor&&i===y&&t.constructor.resolve===_?(o=e,(r=t)._state===I?N(o,r._result):r._state===T?U(o,r._result):Y(r,void 0,function(e){return C(o,e)},function(e){return U(o,e)})):i===E?(U(e,E.error),E.error=null):void 0===i?N(e,t):d(i)?k(e,t,i):N(e,t)}function C(e,t){var i,o;e===t?U(e,new TypeError("You cannot resolve a promise with itself")):(o=typeof(i=t),null===i||"object"!=o&&"function"!=o?N(e,t):R(e,t,A(t)))}function D(e){e._onerror&&e._onerror(e._result),P(e)}function N(e,t){e._state===w&&(e._result=t,e._state=I,0!==e._subscribers.length&&a(P,e))}function U(e,t){e._state===w&&(e._state=T,e._result=t,a(D,e))}function Y(e,t,i,o){var r=e._subscribers,n=r.length;e._onerror=null,r[n]=t,r[n+I]=i,r[n+T]=o,0===n&&e._state&&a(P,e)}function P(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var o=void 0,r=void 0,n=e._result,a=0;a<t.length;a+=3)o=t[a],r=t[a+i],o?M(i,o,r,n):r(n);e._subscribers.length=0}}function M(e,t,i,o){var r=d(i),n=void 0,a=void 0,s=void 0,c=void 0;if(r){if((n=function(e,t){try{return e(t)}catch(e){return E.error=e,E}}(i,o))===E?(c=!0,a=n.error,n.error=null):s=!0,t===n)return void U(t,new TypeError("A promises callback cannot return that same promise."))}else n=o,s=!0;t._state!==w||(r&&s?C(t,n):c?U(t,a):e===I?N(t,n):e===T&&U(t,n))}var O=0;function x(e){e[L]=O++,e._state=void 0,e._result=void 0,e._subscribers=[]}var V=(F.prototype._enumerate=function(e){for(var t=0;this._state===w&&t<e.length;t++)this._eachEntry(e[t],t)},F.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,o=i.resolve;if(o===_){var r=A(t);if(r===y&&t._state!==w)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===B){var n=new i(b);R(n,t,r),this._willSettleAt(n,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(o(t),e)},F.prototype._settledAt=function(e,t,i){var o=this.promise;o._state===w&&(this._remaining--,e===T?U(o,i):this._result[t]=i),0===this._remaining&&N(o,this._result)},F.prototype._willSettleAt=function(e,t){var i=this;Y(e,void 0,function(e){return i._settledAt(I,t,e)},function(e){return i._settledAt(T,t,e)})},F);function F(e,t){this._instanceConstructor=e,this.promise=new e(b),this.promise[L]||x(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&N(this.promise,this._result))):U(this.promise,new Error("Array Methods must be provided an Array"))}var B=(j.prototype.catch=function(e){return this.then(null,e)},j.prototype.finally=function(t){var i=this.constructor;return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})},j);function j(e){this[L]=O++,this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof j?function(t,e){try{e(function(e){C(t,e)},function(e){U(t,e)})}catch(e){U(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return B.prototype.then=y,B.all=function(e){return new V(this,e).promise},B.race=function(r){var n=this;return i(r)?new n(function(e,t){for(var i=r.length,o=0;o<i;o++)n.resolve(r[o]).then(e,t)}):new n(function(e,t){return t(new TypeError("You must pass an array to race."))})},B.resolve=_,B.reject=function(e){var t=new this(b);return U(t,e),t},B._setScheduler=function(e){r=e},B._setAsap=function(e){a=e},B._asap=a,B.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=B},(B.Promise=B).polyfill(),B}),window.YS=window.YS||{},window.L=window.L||{},function(){var t=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"==typeof window.__SDKDEV__)try{t=window.__SDKDEV__}catch(e){t=!1}var e,i,o,r,n,a,s=t||(e="debug",i=decodeURIComponent(window.location.href),o=i.indexOf("?"),r=i.substring(o+1),n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),null!=(a=r.match(n))?a[2]:"");window.__YsSdkBuild__=!s;try{if(window.localStorage){var c=s?"*":"none";window.localStorage.setItem("debug",c)}else console.warn("window.localStorage is not exist!")}catch(e){console.warn("Browser does not support localStorage!")}}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():e.io=t(),window&&!window.io&&(window.io=t())}(this||window,function(){return r={},i.m=o=[function(e,t,i){function o(e,t){"object"===(void 0===e?"undefined":c(e))&&(t=e,e=void 0),t=t||{};var i,o=d(e),r=o.source,n=o.id,a=o.path,s=p[n]&&a in p[n].nsps;return i=t.forceNew||t["force new connection"]||!1===t.multiplex||s?(l("ignoring socket cache for %s",r),u(r,t)):(p[n]||(l("new io instance for %s",r),p[n]=u(r,t)),p[n]),o.query&&!t.query&&(t.query=o.query),i.socket(o.path,t)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=i(1),r=i(7),u=i(13),l=i(3)("socket.io-client");e.exports=t=o;var p=t.managers={};t.protocol=r.protocol,t.connect=o,t.Manager=i(13),t.Socket=i(39)},function(e,t,i){(function(r){var n=i(2),a=i(3)("socket.io-client:url");e.exports=function(e,t){var i=e;t=t||r.location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),a("parse %s",e),i=n(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";var o=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port,i.href=i.protocol+"://"+o+(t&&t.port===i.port?"":":"+i.port),i}}).call(t,function(){return this||window}())},function(e,t){var s=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var r=s.exec(e||""),n={},a=14;a--;)n[c[a]]=r[a]||"";return-1!=i&&-1!=o&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n}},function(i,n,o){(function(t){function e(){var e;try{e=n.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(n=i.exports=o(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),t){var i="color: "+this.color;e.splice(1,0,i,"color: inherit");var o=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(r=o))}),e.splice(r,0,i)}},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=e,n.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(e())}).call(n,o(4))},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(d===setTimeout)return setTimeout(t,0);if((d===i||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function n(){m&&p&&(m=!1,p.length?f=p.concat(f):g=-1,f.length&&a())}function a(){if(!m){var e=r(n);m=!0;for(var t=f.length;t;){for(p=f,f=[];++g<t;)p&&p[g].run();g=-1,t=f.length}p=null,m=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===o||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var d,u,l=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:i}catch(e){d=i}try{u="function"==typeof clearTimeout?clearTimeout:o}catch(e){u=o}}();var p,f=[],m=!1,g=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];f.push(new s(e,t)),1!==f.length||m||r(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,s,t){function i(e){function o(){if(o.enabled){var r=o,e=+new Date,t=e-(c||e);r.diff=t,r.prev=c,r.curr=e,c=e;for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];n[0]=s.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;a++;var i=s.formatters[t];if("function"==typeof i){var o=n[a];e=i.call(r,o),n.splice(a,1),a--}return e}),s.formatArgs.call(r,n),(o.log||s.log||console.log.bind(console)).apply(r,n)}}return o.namespace=e,o.enabled=s.enabled(e),o.useColors=s.useColors(),o.color=function(e){var t,i=0;for(t in e)i=(i<<5)-i+e.charCodeAt(t),i|=0;return s.colors[Math.abs(i)%s.colors.length]}(e),"function"==typeof s.init&&s.init(o),o}var c;(s=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e),s.names=[],s.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),i=t.length,o=0;o<i;o++)t[o]&&("-"===(e=t[o].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,i;for(t=0,i=s.skips.length;t<i;t++)if(s.skips[t].test(e))return!1;for(t=0,i=s.names.length;t<i;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=t(6),s.names=[],s.skips=[],s.formatters={}},function(e,t){function n(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}e.exports=function(e,t){t=t||{};var i,o,r=typeof e;if("string"==r&&0<e.length)return function(e){if(!(100<(e=String(e)).length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"==r&&!1===isNaN(e))return t.long?n(o=e,864e5,"day")||n(o,36e5,"hour")||n(o,6e4,"minute")||n(o,1e3,"second")||o+" ms":864e5<=(i=e)?Math.round(i/864e5)+"d":36e5<=i?Math.round(i/36e5)+"h":6e4<=i?Math.round(i/6e4)+"m":1e3<=i?Math.round(i/1e3)+"s":i+"ms";throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,a,t){function i(){}function n(e){var t=""+e.type;return a.BINARY_EVENT!==e.type&&a.BINARY_ACK!==e.type||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),u("encoded %j as %s",e,t),t}function o(e,r){f.removeBlobs(e,function(e){var t=f.deconstructPacket(e),i=n(t.packet),o=t.buffers;o.unshift(i),r(o)})}function r(){this.reconstructor=null}function s(e){var t=0,i={type:Number(e.charAt(0))};if(null==a.types[i.type])return d();if(a.BINARY_EVENT===i.type||a.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++t)&&(o+=e.charAt(t),t!=e.length););if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(t+1))for(i.nsp="";++t;){if(","===(n=e.charAt(t)))break;if(i.nsp+=n,t===e.length)break}else i.nsp="/";var r=e.charAt(t+1);if(""!==r&&Number(r)==r){for(i.id="";++t;){var n;if(null==(n=e.charAt(t))||Number(n)!=n){--t;break}if(i.id+=e.charAt(t),t===e.length)break}i.id=Number(i.id)}return e.charAt(++t)&&(i=function(e,t){try{e.data=JSON.parse(t)}catch(e){return d()}return e}(i,e.substr(t))),u("decoded %s as %j",e,i),i}function c(e){this.reconPack=e,this.buffers=[]}function d(){return{type:a.ERROR,data:"parser error"}}var u=t(3)("socket.io-parser"),l=t(8),p=t(9),f=t(11),m=t(12);a.protocol=4,a.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],a.CONNECT=0,a.DISCONNECT=1,a.EVENT=2,a.ACK=3,a.ERROR=4,a.BINARY_EVENT=5,a.BINARY_ACK=6,a.Encoder=i,a.Decoder=r,i.prototype.encode=function(e,t){(e.type!==a.EVENT&&e.type!==a.ACK||!p(e.data)||(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),u("encoding packet %j",e),a.BINARY_EVENT===e.type||a.BINARY_ACK===e.type)?o(e,t):t([n(e)])},l(r.prototype),r.prototype.add=function(e){var t;if("string"==typeof e)t=s(e),a.BINARY_EVENT===t.type||a.BINARY_ACK===t.type?(this.reconstructor=new c(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!m(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},c.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length!==this.reconPack.attachments)return null;var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t},c.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,i){function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}(e.exports=o).prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o,r=0;r<i.length;r++)if((o=i[r])===t||o.fn===t){i.splice(r,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),i=this._callbacks["$"+e];if(i)for(var o=0,r=(i=i.slice(0)).length;o<r;++o)i[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(t,e,i){(function(n){var a=i(10),e=Object.prototype.toString,s="function"==typeof n.Blob||"[object BlobConstructor]"===e.call(n.Blob),c="function"==typeof n.File||"[object FileConstructor]"===e.call(n.File);t.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(a(t)){for(var i=0,o=t.length;i<o;i++)if(e(t[i]))return!0;return!1}if("function"==typeof n.Buffer&&n.Buffer.isBuffer&&n.Buffer.isBuffer(t)||"function"==typeof n.ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||c&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return!0;return!1}}).call(e,function(){return this||window}())},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,i,o){(function(e){var u=o(10),l=o(12),t=Object.prototype.toString,p="function"==typeof e.Blob||"[object BlobConstructor]"===t.call(e.Blob),f="function"==typeof e.File||"[object FileConstructor]"===t.call(e.File);i.deconstructPacket=function(e){var t=[],i=e.data,o=e;return o.data=function e(t,i){if(!t)return t;if(l(t)){var o={_placeholder:!0,num:i.length};return i.push(t),o}if(u(t)){for(var r=new Array(t.length),n=0;n<t.length;n++)r[n]=e(t[n],i);return r}if("object"!=typeof t||t instanceof Date)return t;r={};for(var a in t)r[a]=e(t[a],i);return r}(i,t),o.attachments=t.length,{packet:o,buffers:t}},i.reconstructPacket=function(e,t){return e.data=function e(t,i){if(!t)return t;if(t&&t._placeholder)return i[t.num];if(u(t))for(var o=0;o<t.length;o++)t[o]=e(t[o],i);else if("object"==typeof t)for(var r in t)t[r]=e(t[r],i);return t}(e.data,t),e.attachments=void 0,e},i.removeBlobs=function(e,s){var c=0,d=e;(function e(t,i,o){if(!t)return t;if(p&&t instanceof Blob||f&&t instanceof File){c++;var r=new FileReader;r.onload=function(){o?o[i]=this.result:d=this.result,--c||s(d)},r.readAsArrayBuffer(t)}else if(u(t))for(var n=0;n<t.length;n++)e(t[n],n,t);else if("object"==typeof t&&!l(t))for(var a in t)e(t[a],a,t)})(d),c||s(d)}}).call(i,function(){return this||window}())},function(e,t){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(t,function(){return this||window}())},function(e,t,i){function o(e,t){if(!(this instanceof o))return new o(e,t);e&&"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new f({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var i=t.parser||s;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=i(14),n=i(39),a=i(8),s=i(7),d=i(41),u=i(42),l=i(3)("socket.io-client:manager"),p=i(37),f=i(43),m=Object.prototype.hasOwnProperty;(e.exports=o).prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)m.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},o.prototype.updateSocketIds=function(){for(var e in this.nsps)m.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},o.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(o.prototype),o.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},o.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},o.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(i,e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=c(this.uri,this.opts);var t=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var r=d(t,"open",function(){o.onopen(),i&&i()}),n=d(t,"error",function(e){if(l("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",e),i){var t=new Error("Connection error");t.data=e,i(t)}else o.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var s=setTimeout(function(){l("connect attempt timed out after %d",a),r.destroy(),t.close(),t.emit("error","timeout"),o.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(r),this.subs.push(n),this},o.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(d(e,"data",u(this,"ondata"))),this.subs.push(d(e,"ping",u(this,"onping"))),this.subs.push(d(e,"pong",u(this,"onpong"))),this.subs.push(d(e,"error",u(this,"onerror"))),this.subs.push(d(e,"close",u(this,"onclose"))),this.subs.push(d(this.decoder,"decoded",u(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(e){this.decoder.add(e)},o.prototype.ondecoded=function(e){this.emit("packet",e)},o.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},o.prototype.socket=function(e,t){function i(){~p(r.connecting,o)||r.connecting.push(o)}var o=this.nsps[e];if(!o){o=new n(this,e,t),this.nsps[e]=o;var r=this;o.on("connecting",i),o.on("connect",function(){o.id=r.generateId(e)}),this.autoConnect&&i()}return o},o.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},o.prototype.packet=function(i){l("writing packet %j",i);var o=this;i.query&&0===i.type&&(i.nsp+="?"+i.query),o.encoding?o.packetBuffer.push(i):(o.encoding=!0,this.encoder.encode(i,function(e){for(var t=0;t<e.length;t++)o.engine.write(e[t],i.options);o.encoding=!1,o.processPacketQueue()}))},o.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},o.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();l("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var i=setTimeout(function(){t.skipReconnect||(l("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(l("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(l("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(i)}})}},o.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,i){e.exports=i(15)},function(e,t,i){e.exports=i(16),e.exports.parser=i(23)},function(t,e,d){(function(o){function l(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=s(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=s(t.host).host),this.secure=null!=t.secure?t.secure:o.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(o.location?location.hostname:"localhost"),this.port=t.port||(o.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode;var i="object"==typeof o&&o;i.global===i&&(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}var r=d(17),e=d(8),p=d(3)("engine.io-client:socket"),n=d(37),a=d(23),s=d(2),i=d(38),c=d(31);(t.exports=l).priorWebsocketSuccess=!1,e(l.prototype),l.protocol=a.protocol,(l.Socket=l).Transport=d(22),l.transports=d(17),l.parser=d(23),l.prototype.createTransport=function(e){p('creating transport "%s"',e);var t=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var i=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new r[e]({query:t,socket:this,agent:i.agent||this.agent,hostname:i.hostname||this.hostname,port:i.port||this.port,secure:i.secure||this.secure,path:i.path||this.path,forceJSONP:i.forceJSONP||this.forceJSONP,jsonp:i.jsonp||this.jsonp,forceBase64:i.forceBase64||this.forceBase64,enablesXDR:i.enablesXDR||this.enablesXDR,timestampRequests:i.timestampRequests||this.timestampRequests,timestampParam:i.timestampParam||this.timestampParam,policyPort:i.policyPort||this.policyPort,pfx:i.pfx||this.pfx,key:i.key||this.key,passphrase:i.passphrase||this.passphrase,cert:i.cert||this.cert,ca:i.ca||this.ca,ciphers:i.ciphers||this.ciphers,rejectUnauthorized:i.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:i.perMessageDeflate||this.perMessageDeflate,extraHeaders:i.extraHeaders||this.extraHeaders,forceNode:i.forceNode||this.forceNode,localAddress:i.localAddress||this.localAddress,requestTimeout:i.requestTimeout||this.requestTimeout,protocols:i.protocols||void 0})},l.prototype.open=function(){var e;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},l.prototype.setTransport=function(e){p("setting transport %s",e.name);var t=this;this.transport&&(p("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=e).on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},l.prototype.probe=function(i){function e(){if(u.onlyBinaryUpgrades){var e=!this.supportsBinary&&u.transport.supportsBinary;d=d||e}d||(p('probe transport "%s" opened',i),c.send([{type:"ping",data:"probe"}]),c.once("packet",function(e){if(!d)if("pong"===e.type&&"probe"===e.data){if(p('probe transport "%s" pong',i),u.upgrading=!0,u.emit("upgrading",c),!c)return;l.priorWebsocketSuccess="websocket"===c.name,p('pausing current transport "%s"',u.transport.name),u.transport.pause(function(){d||"closed"!==u.readyState&&(p("changing transport and sending upgrade packet"),s(),u.setTransport(c),c.send([{type:"upgrade"}]),u.emit("upgrade",c),c=null,u.upgrading=!1,u.flush())})}else{p('probe transport "%s" failed',i);var t=new Error("probe error");t.transport=c.name,u.emit("upgradeError",t)}}))}function o(){d||(d=!0,s(),c.close(),c=null)}function t(e){var t=new Error("probe error: "+e);t.transport=c.name,o(),p('probe transport "%s" failed because of error: %s',i,e),u.emit("upgradeError",t)}function r(){t("transport closed")}function n(){t("socket closed")}function a(e){c&&e.name!==c.name&&(p('"%s" works - aborting "%s"',e.name,c.name),o())}function s(){c.removeListener("open",e),c.removeListener("error",t),c.removeListener("close",r),u.removeListener("close",n),u.removeListener("upgrading",a)}p('probing transport "%s"',i);var c=this.createTransport(i,{probe:1}),d=!1,u=this;l.priorWebsocketSuccess=!1,c.once("open",e),c.once("error",t),c.once("close",r),this.once("close",n),this.once("upgrading",a),c.open()},l.prototype.onOpen=function(){if(p("socket open"),this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){p("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},l.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(p('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(i(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else p('packet received with socket readyState "%s"',this.readyState)},l.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},l.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},l.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){p("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},l.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},l.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(p("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},l.prototype.write=l.prototype.send=function(e,t,i){return this.sendPacket("message",e,t,i),this},l.prototype.sendPacket=function(e,t,i,o){if("function"==typeof t&&(o=t,t=void 0),"function"==typeof i&&(o=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){(i=i||{}).compress=!1!==i.compress;var r={type:e,data:t,options:i};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},l.prototype.close=function(){function e(){o.onClose("forced close"),p("socket closing - telling transport to close"),o.transport.close()}function t(){o.removeListener("upgrade",t),o.removeListener("upgradeError",t),e()}function i(){o.once("upgrade",t),o.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():e()}):this.upgrading?i():e()}return this},l.prototype.onError=function(e){p("socket error %j",e),l.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},l.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){p('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},l.prototype.filterUpgrades=function(e){for(var t=[],i=0,o=e.length;i<o;i++)~n(this.transports,e[i])&&t.push(e[i]);return t}}).call(e,function(){return this||window}())},function(e,t,i){(function(a){var s=i(18),c=i(20),d=i(34),e=i(35);t.polling=function(e){var t=!1,i=!1,o=!1!==e.jsonp;if(a.location){var r="https:"===location.protocol,n=location.port;n=n||(r?443:80),t=e.hostname!==location.hostname||n!==e.port,i=e.secure!==r}if(e.xdomain=t,e.xscheme=i,"open"in new s(e)&&!e.forceJSONP)return new c(e);if(!o)throw new Error("JSONP disabled");return new d(e)},t.websocket=e}).call(t,function(){return this||window}())},function(e,t,i){(function(r){var n=i(19);e.exports=function(e){var t=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!t)try{return new(r[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this||window}())},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(u,e,l){(function(r){function t(){}function e(e){if(o.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,r.location){var t="https:"===location.protocol,i=location.port;i=i||(t?443:80),this.xd=e.hostname!==r.location.hostname||i!==e.port,this.xs=e.secure!==t}}function n(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function i(){for(var e in n.requests)n.requests.hasOwnProperty(e)&&n.requests[e].abort()}var a=l(18),o=l(21),s=l(8),c=l(32),d=l(3)("engine.io-client:polling-xhr");u.exports=e,u.exports.Request=n,c(e,o),e.prototype.supportsBinary=!0,e.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new n(e)},e.prototype.doWrite=function(e,t){var i="string"!=typeof e&&void 0!==e,o=this.request({method:"POST",data:e,isBinary:i}),r=this;o.on("success",t),o.on("error",function(e){r.onError("xhr post error",e)}),this.sendXhr=o},e.prototype.doPoll=function(){d("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},s(n.prototype),n.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),i=this;try{d("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState){var e;try{e=t.getResponseHeader("Content-Type")}catch(e){}"application/octet-stream"===e&&(t.responseType="arraybuffer")}4===t.readyState&&(200===t.status||1223===t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},d("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}r.document&&(this.index=n.requestsCount++,n.requests[this.index]=this)},n.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},n.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},n.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},n.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=t:this.xhr.onreadystatechange=t,e)try{this.xhr.abort()}catch(e){}r.document&&delete n.requests[this.index],this.xhr=null}},n.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},n.prototype.hasXDR=function(){return void 0!==r.XDomainRequest&&!this.xs&&this.enablesXDR},n.prototype.abort=function(){this.cleanup()},n.requestsCount=0,n.requests={},r.document&&(r.attachEvent?r.attachEvent("onunload",i):r.addEventListener&&r.addEventListener("beforeunload",i,!1))}).call(e,function(){return this||window}())},function(e,t,i){function o(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}var r=i(22),n=i(31),a=i(23),s=i(32),c=i(33),d=i(3)("engine.io-client:polling");e.exports=o;var u=null!=new(i(18))({xdomain:!1}).responseType;s(o,r),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(e){function t(){d("paused"),i.readyState="paused",e()}var i=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(d("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){d("pre-pause polling complete"),--o||t()})),this.writable||(d("we are currently writing - waiting to pause"),o++,this.once("drain",function(){d("pre-pause writing complete"),--o||t()}))}else t()},o.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(e){var o=this;d("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,function(e,t,i){return"opening"===o.readyState&&o.onOpen(),"close"===e.type?(o.onClose(),!1):void o.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},o.prototype.write=function(e){var t=this;this.writable=!1;function i(){t.writable=!0,t.emit("drain")}a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,i)})},o.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",i="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=n.encode(e),this.port&&("https"==t&&443!==Number(this.port)||"http"==t&&80!==Number(this.port))&&(i=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+e}},function(e,t,i){function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var r=i(23);i(8)((e.exports=o).prototype),o.prototype.onError=function(e,t){var i=new Error(e);return i.type="TransportError",i.description=t,this.emit("error",i),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,h,o){(function(d){function s(e,t,i){if(!t)return h.encodeBase64Packet(e,i);if(l)return function(e,t,i){if(!t)return h.encodeBase64Packet(e,i);var o=new FileReader;return o.onload=function(){e.data=o.result,h.encodePacket(e,t,!0,i)},o.readAsArrayBuffer(e.data)}(e,t,i);var o=new Uint8Array(1);return o[0]=f[e.type],i(new v([o.buffer,e.data]))}function r(e,t,i){for(var r=new Array(e.length),o=c(e.length,i),n=function(i,e,o){t(e,function(e,t){r[i]=t,o(e,r)})},a=0;a<e.length;a++)n(a,e[a],o)}var n,e=o(24),a=o(9),p=o(25),c=o(26),u=o(27);d&&d.ArrayBuffer&&(n=o(29));var t="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),i="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=t||i;h.protocol=3;var f=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=e(f),g={type:"error",data:"parser error"},v=o(30);h.encodePacket=function(e,t,i,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof i&&(o=i,i=null);var r,n=void 0===e.data?void 0:e.data.buffer||e.data;if(d.ArrayBuffer&&n instanceof ArrayBuffer)return function(e,t,i){if(!t)return h.encodeBase64Packet(e,i);var o=e.data,r=new Uint8Array(o),n=new Uint8Array(1+o.byteLength);n[0]=f[e.type];for(var a=0;a<r.length;a++)n[a+1]=r[a];return i(n.buffer)}(e,t,o);if(v&&n instanceof d.Blob)return s(e,t,o);if(n&&n.base64)return r=e,o("b"+h.packets[r.type]+r.data.data);var a=f[e.type];return void 0!==e.data&&(a+=i?u.encode(String(e.data),{strict:!1}):String(e.data)),o(""+a)},h.encodeBase64Packet=function(t,i){var o,r="b"+h.packets[t.type];if(v&&t.data instanceof d.Blob){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];i(r+e)},n.readAsDataURL(t.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];o=String.fromCharCode.apply(null,s)}return r+=d.btoa(o),i(r)},h.decodePacket=function(e,t,i){if(void 0===e)return g;if("string"==typeof e){if("b"===e.charAt(0))return h.decodeBase64Packet(e.substr(1),t);if(i&&!1===(e=function(e){try{e=u.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return g;var o=e.charAt(0);return Number(o)==o&&m[o]?1<e.length?{type:m[o],data:e.substring(1)}:{type:m[o]}:g}o=new Uint8Array(e)[0];var r=p(e,1);return v&&"blob"===t&&(r=new v([r])),{type:m[o],data:r}},h.decodeBase64Packet=function(e,t){var i=m[e.charAt(0)];if(!n)return{type:i,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&v&&(o=new v([o])),{type:i,data:o}},h.encodePayload=function(e,t,i){"function"==typeof t&&(i=t,t=null);var o=a(e);return t&&o?v&&!l?h.encodePayloadAsBlob(e,i):h.encodePayloadAsArrayBuffer(e,i):e.length?void r(e,function(e,i){h.encodePacket(e,!!o&&t,!1,function(e){var t;i(null,(t=e).length+":"+t)})},function(e,t){return i(t.join(""))}):i("0:")},h.decodePayload=function(e,t,i){if("string"!=typeof e)return h.decodePayloadAsBinary(e,t,i);var o;if("function"==typeof t&&(i=t,t=null),""===e)return i(g,0,1);for(var r,n,a="",s=0,c=e.length;s<c;s++){var d=e.charAt(s);if(":"===d){if(""===a||a!=(r=Number(a)))return i(g,0,1);if(a!=(n=e.substr(s+1,r)).length)return i(g,0,1);if(n.length){if(o=h.decodePacket(n,t,!1),g.type===o.type&&g.data===o.data)return i(g,0,1);if(!1===i(o,s+r,c))return}s+=r,a=""}else a+=d}return""!==a?i(g,0,1):void 0},h.encodePayloadAsArrayBuffer=function(e,o){return e.length?void r(e,function(e,t){h.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,t){var i=t.reduce(function(e,t){var i;return e+(i="string"==typeof t?t.length:t.byteLength).toString().length+i+2},0),a=new Uint8Array(i),s=0;return t.forEach(function(e){var t="string"==typeof e,i=e;if(t){for(var o=new Uint8Array(e.length),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);i=o.buffer}a[s++]=t?0:1;var n=i.byteLength.toString();for(r=0;r<n.length;r++)a[s++]=parseInt(n[r]);a[s++]=255;for(o=new Uint8Array(i),r=0;r<o.length;r++)a[s++]=o[r]}),o(a.buffer)}):o(new ArrayBuffer(0))},h.encodePayloadAsBlob=function(e,i){r(e,function(e,s){h.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);e=i.buffer,t[0]=0}var r=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),n=new Uint8Array(r.length+1);for(o=0;o<r.length;o++)n[o]=parseInt(r[o]);if(n[r.length]=255,v){var a=new v([t.buffer,n.buffer,e]);s(null,a)}})},function(e,t){return i(new v(t))})},h.decodePayloadAsBinary=function(e,i,o){"function"==typeof i&&(o=i,i=null);for(var t=e,r=[];0<t.byteLength;){for(var n=new Uint8Array(t),a=0===n[0],s="",c=1;255!==n[c];c++){if(310<s.length)return o(g,0,1);s+=n[c]}t=p(t,2+s.length),s=parseInt(s);var d=p(t,0,s);if(a)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var u=new Uint8Array(d);d="";for(c=0;c<u.length;c++)d+=String.fromCharCode(u[c])}r.push(d),t=p(t,s)}var l=r.length;r.forEach(function(e,t){o(h.decodePacket(e,i,!0),t,l)})}}).call(h,function(){return this||window}())},function(e,t){e.exports=Object.keys||function(e){var t=[],i=Object.prototype.hasOwnProperty;for(var o in e)i.call(e,o)&&t.push(o);return t}},function(e,t){e.exports=function(e,t,i){var o=e.byteLength;if(t=t||0,i=i||o,e.slice)return e.slice(t,i);if(t<0&&(t+=o),i<0&&(i+=o),o<i&&(i=o),o<=t||i<=t||0===o)return new ArrayBuffer(0);for(var r=new Uint8Array(e),n=new Uint8Array(i-t),a=t,s=0;a<i;a++,s++)n[s]=r[a];return n.buffer}},function(e,t){function a(){}e.exports=function(e,i,o){function r(e,t){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(n=!0,i(e),i=o):0!==r.count||n||i(null,t)}var n=!1;return o=o||a,0===(r.count=e)?i():r}},function(e,m,g){var v;(function(i,f){!function(){function s(e){for(var t,i,o=[],r=0,n=e.length;r<n;)55296<=(t=e.charCodeAt(r++))&&t<=56319&&r<n?56320==(64512&(i=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&i)+65536):(o.push(t),r--):o.push(t);return o}function o(e,t){if(55296<=e&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function r(e,t){return p(e>>t&63|128)}function c(e,t){if(0==(4294967168&e))return p(e);var i="";return 0==(4294965248&e)?i=p(e>>6&31|192):0==(4294901760&e)?(o(e,t)||(e=65533),i=p(e>>12&15|224),i+=r(e,6)):0==(4292870144&e)&&(i=p(e>>18&7|240),i+=r(e,12),i+=r(e,6)),i+p(63&e|128)}function n(){if(u<=l)throw Error("Invalid byte index");var e=255&d[l];if(l++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(e){var t,i;if(u<l)throw Error("Invalid byte index");if(l==u)return!1;if(t=255&d[l],l++,0==(128&t))return t;if(192==(224&t)){if(128<=(i=(31&t)<<6|n()))return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(i=(15&t)<<12|n()<<6|n()))return o(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(65536<=(i=(7&t)<<18|n()<<12|n()<<6|n())&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}var e=("object"==typeof i&&i&&i.exports,"object"==typeof f&&f);e.global!==e&&e.window;var d,u,l,p=String.fromCharCode,t={version:"2.1.2",encode:function(e,t){for(var i=!1!==(t=t||{}).strict,o=s(e),r=o.length,n=-1,a="";++n<r;)a+=c(o[n],i);return a},decode:function(e,t){var i=!1!==(t=t||{}).strict;d=s(e),u=d.length,l=0;for(var o,r=[];!1!==(o=a(i));)r.push(o);return function(e){for(var t,i=e.length,o=-1,r="";++o<i;)65535<(t=e[o])&&(r+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=p(t);return r}(r)}};void 0===(v=function(){return t}.call(m,g,m,i))||(i.exports=v)}()}).call(m,g(28)(e),function(){return this||window}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){!function(){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256),e=0;e<n.length;e++)l[n.charCodeAt(e)]=e;t.encode=function(e){var t,i=new Uint8Array(e),o=i.length,r="";for(t=0;t<o;t+=3)r+=n[i[t]>>2],r+=n[(3&i[t])<<4|i[t+1]>>4],r+=n[(15&i[t+1])<<2|i[t+2]>>6],r+=n[63&i[t+2]];return o%3==2?r=r.substring(0,r.length-1)+"=":o%3==1&&(r=r.substring(0,r.length-2)+"=="),r},t.decode=function(e){var t,i,o,r,n,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<s;t+=4)i=l[e.charCodeAt(t)],o=l[e.charCodeAt(t+1)],r=l[e.charCodeAt(t+2)],n=l[e.charCodeAt(t+3)],u[c++]=i<<2|o>>4,u[c++]=(15&o)<<4|r>>2,u[c++]=(3&r)<<6|63&n;return d}}()},function(c,e){(function(e){function r(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.buffer instanceof ArrayBuffer){var o=i.buffer;if(i.byteLength!==o.byteLength){var r=new Uint8Array(i.byteLength);r.set(new Uint8Array(o,i.byteOffset,i.byteLength)),o=r.buffer}e[t]=o}}}function t(e,t){t=t||{};var i=new n;r(e);for(var o=0;o<e.length;o++)i.append(e[o]);return t.type?i.getBlob(t.type):i.getBlob()}function i(e,t){return r(e),new Blob(e,t||{})}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;c.exports=o?a?e.Blob:i:s?t:void 0}).call(e,function(){return this||window}())},function(e,t){t.encode=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t},t.decode=function(e){for(var t={},i=e.split("&"),o=0,r=i.length;o<r;o++){var n=i[o].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}},function(e,t){e.exports=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t){function i(e){for(var t="";t=n[e%a]+t,0<(e=Math.floor(e/a)););return t}function o(){var e=i(+new Date);return e!==r?(c=0,r=e):e+"."+i(c++)}for(var r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,s={},c=0,d=0;d<a;d++)s[n[d]]=d;o.encode=i,o.decode=function(e){var t=0;for(d=0;d<e.length;d++)t=t*a+s[e.charAt(d)];return t},e.exports=o},function(a,e,s){(function(i){function o(){}function e(e){r.call(this,e),this.query=this.query||{},n||(i.___eio||(i.___eio=[]),n=i.___eio),this.index=n.length;var t=this;n.push(function(e){t.onData(e)}),this.query.j=this.index,i.document&&i.addEventListener&&i.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=o)},!1)}var r=s(21),t=s(32);a.exports=e;var n,d=/\n/g,u=/\\n/g;t(e,r),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},e.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(e,i):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},e.prototype.doWrite=function(e,t){function i(){o(),t()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}var r=this;if(!this.form){var n,a=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=c,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),o(),e=e.replace(u,"\\\n"),this.area.value=e.replace(d,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&i()}:this.iframe.onload=i}}).call(e,function(){return this||window}())},function(l,e,p){(function(n){function e(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=d&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(u=t),i.call(this,e)}var t,i=p(22),a=p(23),o=p(31),r=p(32),s=p(33),c=p(3)("engine.io-client:websocket"),d=n.WebSocket||n.MozWebSocket;if("undefined"==typeof window)try{t=p(36)}catch(e){}var u=d;u||"undefined"!=typeof window||(u=t),r(l.exports=e,i),e.prototype.name="websocket",e.prototype.supportsBinary=!0,e.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,i={agent:this.agent,perMessageDeflate:this.perMessageDeflate};i.pfx=this.pfx,i.key=this.key,i.passphrase=this.passphrase,i.cert=this.cert,i.ca=this.ca,i.ciphers=this.ciphers,i.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(i.headers=this.extraHeaders),this.localAddress&&(i.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new u(e,t):new u(e):new u(e,t,i)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},e.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},e.prototype.write=function(e){var o=this;this.writable=!1;for(var r=e.length,t=0,i=r;t<i;t++)!function(i){a.encodePacket(i,o.supportsBinary,function(e){if(!o.usingBrowserWebSocket){var t={};if(i.options&&(t.compress=i.options.compress),o.perMessageDeflate)("string"==typeof e?n.Buffer.byteLength(e):e.length)<o.perMessageDeflate.threshold&&(t.compress=!1)}try{o.usingBrowserWebSocket?o.ws.send(e):o.ws.send(e,t)}catch(e){c("websocket closed before onclose event")}--r||(o.emit("flush"),setTimeout(function(){o.writable=!0,o.emit("drain")},0))})}(e[t])},e.prototype.onClose=function(){i.prototype.onClose.call(this)},e.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},e.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",i="";return this.port&&("wss"==t&&443!==Number(this.port)||"ws"==t&&80!==Number(this.port))&&(i=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+i+this.path+e},e.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===e.prototype.name)}}).call(e,function(){return this||window}())},function(e,t){},function(e,t){var o=[].indexOf;e.exports=function(e,t){if(o)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}},function(e,t){(function(t){var i=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,n=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(a,"").replace(s,""),t.JSON&&JSON.parse?JSON.parse(e):i.test(e.replace(o,"@").replace(r,"]").replace(n,""))?new Function("return "+e)():void 0):null}}).call(t,function(){return this||window}())},function(e,t,i){function o(e,t,i){this.io=e,this.nsp=t,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,i&&i.query&&(this.query=i.query),this.io.autoConnect&&this.open()}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(7),a=i(8),s=i(40),c=i(41),d=i(42),u=i(3)("socket.io-client:socket"),l=i(31);e.exports=o;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=a.prototype.emit;a(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[c(e,"open",d(this,"onopen")),c(e,"packet",d(this,"onpacket")),c(e,"close",d(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},o.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(p.hasOwnProperty(e))return f.apply(this,arguments),this;var t=s(arguments),i={type:n.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===r(this.query)?l.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},o.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(t){var i=this,o=!1;return function(){if(!o){o=!0;var e=s(arguments);u("sending ack %j",e),i.packet({type:n.ACK,id:t,data:e})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t){e.exports=function(e,t){for(var i=[],o=(t=t||0)||0;o<e.length;o++)i[o-t]=e[o];return i}},function(e,t){e.exports=function(e,t,i){return e.on(t,i),{destroy:function(){e.removeListener(t,i)}}}},function(e,t){var o=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var i=o.call(arguments,2);return function(){return t.apply(e,i.concat(o.call(arguments)))}}},function(e,t){function i(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(e.exports=i).prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),i=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-i:e+i}return 0|Math.min(e,this.max)},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(e){this.ms=e},i.prototype.setMax=function(e){this.max=e},i.prototype.setJitter=function(e){this.jitter=e}}],i.c=r,i.p="",i(0);function i(e){if(r[e])return r[e].exports;var t=r[e]={exports:{},id:e,loaded:!1};return o[e].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}var o,r}),window.YS.socketIO=window.YS.socketIO||window.io,!window.YS.socketIO)try{window.YS.socketIO=io}catch(e){console.error("socket.io registration failed,please link socket.io,for example: window.ys.SocketIO = io (io is the socket.io that you want to associate with)!")}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Logline=t()}(this,function(){function e(e,t){var i={};"string"==typeof e?i[e]=t:"[object Object]"===Object.prototype.toString.call(e)&&(i=e),o(c,i)}function u(e){f&&console.error("Logline: "+e)}function a(e,t,i){var o;f&&d.get().verbose&&(o=window.console)[m[t.toUpperCase()]||m.INFO].apply(o,[e+" "+t.toUpperCase(),"("+(new Date).toLocaleString("default",{hour12:!1})+") "].concat(s(i||"")))}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:l(r,t,i)}if("value"in o)return o.value;var n=o.get;return void 0!==n?n.call(i):void 0}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var i=function(e,t,i){return t&&p(e.prototype,t),i&&p(e,i),e},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},c=o({},{verbose:!0}),d=e;function p(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}d.set=e,d.get=function(e){return e?c[e]:c};var f=window.console,m={INFO:"log",WARN:"warn",ERROR:"error",CRITICAL:"error"},g=(i(E,[{key:"_record",value:function(e,t,i){u("method _record is not implemented.")}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),r=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["info"].concat(s(o),[r]))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),r=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["warn"].concat(s(o),[r]))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),r=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["error"].concat(s(o),[r]))}},{key:"critical",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=[].concat(t).filter(function(e,t){return 1==t}),r=[].concat(t).filter(function(e,t){return 1!=t});this._record.apply(this,["critical"].concat(s(o),[r]))}}],[{key:"getTargetNowTime",value:function(){return(new Date).getTime()}},{key:"init",value:function(e){return!0}},{key:"transTimeFormat",value:function(e,t){if(!e||/^\d{13}$/.test(e))return+e;if(t&&!/^\d{13}$/.test(t))throw new TypeError("relative time should be standard unix timestamp");return(t||Date.now())-24*e.replace(/d$/,"")*3600*1e3}},{key:"get",value:function(e,t,i){u("method get is not implemented.")}},{key:"keep",value:function(e){u("method keep is not implemented.")}},{key:"keepfrom",value:function(e){}},{key:"reportwarning",value:function(e){}},{key:"clean",value:function(){u("method clean is not implemented.")}},{key:"STATUS",get:function(){return{INITING:1,INITED:2,FAILED:4}}}]),E),v=(i(T,[{key:"push",value:function(e,t){e.context=t,this._pool.push(e)}},{key:"consume",value:function(){for(var e;e=this._pool.shift();)e.call(e.context)}}]),T),h=(t(I,g),i(I,[{key:"_record",value:function(e,t,i){try{if(a(this._namespace,e,i),I.status!==g.STATUS.INITED){if(I._memdb){I._reportWarningFn&&I._memdb.length===I._maxmemdbnum/2&&setTimeout(I._reportWarningFn,1),I._memdb.length>=I._maxmemdbnum&&(I._memdb=I._memdb.slice(I._memdb.length-I._maxmemdbnum/2));var o=I._getStoreSaveObject(e,t,i);o&&I._memdb.push(o)}return}var r=I.db.transaction(["logs"],"readwrite");r.onerror=function(e){u(e.target.error),I.keep&&I.keep()};var n=I._getStoreSaveObject(e,t,i);if(!n)return;r.objectStore("logs").add(n).onerror=function(e){I.status=g.STATUS.FAILED,u(e.target.error),I.keep&&I.keep()}}catch(e){u("failed to write, "+e.message)}}}],[{key:"init",value:function(e){var t=this;try{if(I.support||(I._memdb=[],I._maxmemdbnum=400,u("your platform does not support indexeddb protocol.")),I.status)return!1;I._pool=I._pool||new v,I._database=e||"logline",I.status=l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITING,(I.request=window.indexedDB.open(I._database)).onerror=function(e){I._memdb=[],I._maxmemdbnum=400,u("protocol indexeddb is prevented."),I.keep&&I.keep()},I.request.onsuccess=function(e){I.db=e.target.result,I.status=l(I.__proto__||Object.getPrototypeOf(I),"STATUS",t).INITED,I._pool.consume(),I.db.onerror=function(e){u(e.target.error),I.keep&&I.keep()}},I.request.onupgradeneeded=function(e){var t=e.target.result.createObjectStore("logs",{autoIncrement:!0});t.createIndex("level","level",{unique:!1}),t.createIndex("file","file",{unique:!1}),t.createIndex("log","log",{unique:!1}),t.createIndex("line","line",{unique:!1})}}catch(e){u("failed init, "+e.message)}}},{key:"get",value:function(i,o,r){try{if(i=g.transTimeFormat(i),o=g.transTimeFormat(o),I.status!==l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITED){var e=[];if(I._memdb&&0<I._memdb.length)for(var t=0;t<I._memdb.length;t++)i&&I._memdb[t].ts<i||o&&I._memdb[t].ts>o||e.push(I._memdb[t]);return r(e)}var n=I._getTransactionStore(IDBTransaction.READ_ONLY);if(!n)return r([]);if(n.getAll){var a=void 0,s=[];n.getAll().onsuccess=function(e){a=e.target.result;for(var t=0;t<a.length;t++)i&&a[t].ts<i||o&&a[t].ts>o||s.push(a[t]);r(s)}}else{var c=n.openCursor(),d=[];c.onsuccess=function(e){var t=e.target.result;if(t){if(i&&t.value.ts<i||o&&t.value.ts>o)return t.continue();d.push({ts:t.value.ts,level:t.value.level,descriptor:t.value.descriptor,log:t.value.log,line:null,file:t.value.file}),t.continue()}else r(d)}}}catch(i){u("failed to get logs, "+i.message)}}},{key:"keep",value:function(t){try{if(I.status!==l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITED){if(I._memdb)if(t){for(var e=l(I.__proto__||Object.getPrototypeOf(I),"getTargetNowTime",this).call(this)-24*(t||2)*3600*1e3,i=!0,o=0;o<I._memdb.length;o++)if(I._memdb[o].ts>=e){I._memdb=I._memdb.slice(o),i=!1;break}i&&(I._memdb=[])}else I._memdb=[];return!0}var r=I._getTransactionStore("readwrite");if(!r)return!1;if(t){var n=l(I.__proto__||Object.getPrototypeOf(I),"getTargetNowTime",this).call(this)-24*(t||2)*3600*1e3,a=r.openCursor();a.onsuccess=function(e){var t=e.target.result;t&&t.value.ts<n&&(r.delete(t.primaryKey),t.continue())},a.onerror=function(e){u("unable to locate logs earlier than "+t+"d."),I.keep&&I.keep()}}else r.clear().onerror=function(e){u(e.target.error),I.keep&&I.keep()}}catch(t){u("failed to keep logs, "+t.message)}}},{key:"keepfrom",value:function(e){try{if(I.status!==l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITED){if(I._memdb)if(e){for(var t=e,i=!0,o=0;o<I._memdb.length;o++)if(I._memdb[o].ts>=t){I._memdb=I._memdb.slice(o),i=!1;break}i&&(I._memdb=[])}else I._memdb=[];return!0}var r=I._getTransactionStore("readwrite");if(!r)return!1;if(e){var n=e,a=r.openCursor();a.onsuccess=function(e){var t=e.target.result;t&&t.value.ts<n&&(r.delete(t.primaryKey),t.continue())},a.onerror=function(e){u("unable to locate logs earlier than "+daysToMaintain+"d."),I.keep&&I.keep()}}else r.clear().onerror=function(e){u(e.target.error),I.keep&&I.keep()}}catch(e){u("failed to keepfrom logs, "+e.message)}}},{key:"reportwarning",value:function(e){I._reportWarningFn=e}},{key:"clean",value:function(){try{if(I.status!==l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITED)return I._memdb&&(I._memdb=[]),!0;I.db.close();var e=window.indexedDB.deleteDatabase(I._database);e.onerror=function(e){u(e.target.error),I.keep&&I.keep()},e.onsuccess=function(e){delete I.status,delete I.db}}catch(e){u("failed to cleanup logs, "+e.message)}}},{key:"_getTransactionStore",value:function(e){try{if(I.db){var t=I.db.transaction(["logs"],e||"readwrite");return t.onerror=function(e){u(e.target.error),I.keep&&I.keep()},t.objectStore("logs")}u("log database is not created or connections are closed, considering init it.")}catch(e){return u("failed to generate new transaction, "+e.message),!1}}},{key:"_getStoreSaveObject",value:function(e,t,i){if(!e||!t||!t.peerid)return null;var o="2";if("debug"===e?o="3":"info"===e?o="4":"warn"===e?o="5":"error"===e&&(o="6"),I.status!==l(I.__proto__||Object.getPrototypeOf(I),"STATUS",this).INITED&&Number(o)<4)return null;var r="";return[].concat(Array.prototype.slice.call(arguments)).forEach(function(e,t){t<=1||("string"!=typeof e&&e&&e.constructor?e.constructor===Array?function i(e){e.forEach(function(e,t){"string"!=typeof e&&e&&e.constructor?e.constructor===Array?i(e):r+=JSON.stringify(e):r+=e})}(e):r+=JSON.stringify(e):r+=e)}),{ts:g.getTargetNowTime(),level:o,log:r,file:"",serial:t&&t.serial?t.serial:"",peerid:t&&t.peerid?t.peerid:"",line:null}}},{key:"support",get:function(){return!!(window.indexedDB&&window.IDBTransaction&&window.IDBKeyRange)}}]),I),S=(t(w,g),i(w,[{key:"_record",value:function(e,t,i){var o;try{(o=window.localStorage.getItem(w._database)?JSON.parse(window.localStorage.getItem(w._database)):[]).push([g.getTargetNowTime(),this._namespace,e,t,i]),a(this._namespace,e,t),window.localStorage.setItem(w._database,JSON.stringify(o))}catch(e){window.localStorage.removeItem(w._database),window.localStorage.setItem(w._database,JSON.stringify([])),u("failed to write, may be localStorage is full, "+e.message)}}}],[{key:"init",value:function(e){try{w.support||u("your platform does not support localstorage protocol."),w._database=e||"logline",window.localStorage.getItem(w._database)||window.localStorage.setItem(w._database,JSON.stringify([])),w.status=l(w.__proto__||Object.getPrototypeOf(w),"STATUS",this).INITED}catch(e){u("failed to init, "+e.message)}}},{key:"get",value:function(e,t,i){var o,r;try{for(o=JSON.parse(window.localStorage.getItem(w._database)),e=g.transTimeFormat(e),t=g.transTimeFormat(t),r=0;r<o.length;r++)e&&o[r][0]<e||t&&o[r][0]>t||(o[r]={time:o[r][0],namespace:o[r][1],level:o[r][2],descriptor:o[r][3],data:o[r][4]});i(o)}catch(e){u("failed to get, "+e.message),i([])}}},{key:"keep",value:function(t){var e;try{e=t?(window.localStorage.getItem(w._database)?JSON.parse(window.localStorage.getItem(w._database)):[]).filter(function(e){return e.time>=g.getTargetNowTime()-24*(t||2)*3600*1e3}):[],window.localStorage.setItem(w._database,JSON.stringify(e))}catch(t){u("failed to keep, "+t.message)}}},{key:"keepfrom",value:function(t){var e;try{e=t?(window.localStorage.getItem(w._database)?JSON.parse(window.localStorage.getItem(w._database)):[]).filter(function(e){return e.time>=t}):[],window.localStorage.setItem(w._database,JSON.stringify(e))}catch(t){u("failed to keepfrom, "+t.message)}}},{key:"clean",value:function(){try{delete w.status,window.localStorage.removeItem(w._database)}catch(e){u("failed to clean, "+e.message)}}},{key:"support",get:function(){return"localStorage"in window}}]),w),y=(t(b,g),i(b,[{key:"_record",value:function(t,i,o){var r=this;if(b.status!==g.STATUS.INITED)return b._pool.push(function(){return r._record(t,i,o)}),void(b.status!==g.STATUS.INITING&&b.init());try{a(this._namespace,t,i),b._db.transaction(function(e){e.executeSql("INSERT INTO logs (time, namespace, level, descriptor, data) VALUES(?, ?, ?, ? ,?)",[g.getTargetNowTime(),r._namespace,t,i,void 0===o||""===o?"":JSON.stringify(o)||""],function(){},function(e,t){u("write error, "+t.message)})})}catch(t){u("error inserting record, "+t.message)}}}],[{key:"init",value:function(e){var i=this;if(b.support||u(new Error("your platform does not support websql protocol.")),b.status)return!1;b._pool=b._pool||new v,b._database=e||"logline",b.status=l(b.__proto__||Object.getPrototypeOf(b),"STATUS",this).INITING;try{(b._db=window.openDatabase(b._database,"1.0","cats loves logs",5085593.6)).transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS logs (time, namespace, level, descriptor, data)",[],function(){b.status=l(b.__proto__||Object.getPrototypeOf(b),"STATUS",i).INITED,b._pool.consume()},function(e,t){b.status=l(b.__proto__||Object.getPrototypeOf(b),"STATUS",i).FAILED,u("unable to create table, "+t.message)})})}catch(e){u("unable to init log database, "+e.message)}}},{key:"get",value:function(a,s,c){if(b.status!==l(b.__proto__||Object.getPrototypeOf(b),"STATUS",this).INITED)return b._pool.push(function(){return b.get(a,s,c)});a=g.transTimeFormat(a),s=g.transTimeFormat(s);try{b._db.transaction(function(e){e.executeSql("SELECT * FROM logs ORDER BY time DESC",[],function(e,t){for(var i,o,r=[],n=t.rows.length;0<=--n;)if(o=t.rows.item(n),!(a&&o.time<a||s&&o.time>s)){i=JSON.parse(JSON.stringify(o));try{i.data=JSON.parse(i.data)}catch(e){}r.push(i)}c(r)},function(e,t){u(t.message)})})}catch(a){u("unable to collect logs from database.")}}},{key:"keep",value:function(t){if(b.status!==l(b.__proto__||Object.getPrototypeOf(b),"STATUS",this).INITED)return b._pool.push(function(){return b.keep(t)});try{b._db.transaction(function(e){t?e.executeSql("DELETE FROM logs WHERE time < ?",[g.getTargetNowTime()-24*(t||2)*3600*1e3],function(){},function(e,t){u(t.message)}):e.executeSql("DELETE FROM logs",[],function(){},function(e,t){u(t.message)})})}catch(t){u("unable to clean logs from database.")}}},{key:"keepfrom",value:function(t){if(b.status!==l(b.__proto__||Object.getPrototypeOf(b),"STATUS",this).INITED)return b._pool.push(function(){return b.keep(daysToMaintain)});try{b._db.transaction(function(e){daysToMaintain?e.executeSql("DELETE FROM logs WHERE time < ?",[t],function(){},function(e,t){u(t.message)}):e.executeSql("DELETE FROM logs",[],function(){},function(e,t){u(t.message)})})}catch(t){u("unable to clean logs from database.")}}},{key:"clean",value:function(){if(b.status===l(b.__proto__||Object.getPrototypeOf(b),"STATUS",this).INITED)try{b._db.transaction(function(e){e.executeSql("DROP TABLE logs",[],function(){delete b.status},function(e,t){u(t.message)})})}catch(e){u("unable to clean log database.")}else b._pool.push(function(){return b.clean()})}},{key:"support",get:function(){return"openDatabase"in window}}]),b),_=(i(L,null,[{key:"_initProtocol",value:function(e){(L._protocol=e).init(L._database||"logline")}},{key:"_checkProtocol",value:function(){if(!L._protocol){for(var e=Object.keys(L.PROTOCOL),t=void 0;t=L.PROTOCOL[e.shift()];)if(t.support)return void L._initProtocol(t);u("protocols "+e.join(", ").toLowerCase()+" are not supported on this platform")}}},{key:"get",value:function(e,t,i){switch(L._checkProtocol(),arguments.length){case 1:i=e,e=void 0;break;case 2:i=t,t=void 0}L._protocol.get(e,t,i)}},{key:"all",value:function(e){L.get(e)}},{key:"keep",value:function(e){return L._checkProtocol(),L._protocol.keep(e),this}},{key:"keepfrom",value:function(e){return L._checkProtocol(),L._protocol.keepfrom(e),this}},{key:"reportwarning",value:function(e){L._checkProtocol(),L._protocol.reportwarning(e)}},{key:"clean",value:function(){return L._checkProtocol(),L._protocol.clean(),this}},{key:"using",value:function(e,t){return-1===[h,S,y].indexOf(e)&&u("specialfied protocol "+(e?e+" ":"")+"is not available"),L._protocol||(L.database(t||L._database),L._initProtocol(e)),this}},{key:"database",value:function(e){L._database=e}},{key:"config",get:function(){return d}}]),L);function L(t){if(r(this,L),!(this instanceof L))return new L(t);try{return L._checkProtocol(),new L._protocol(t)}catch(e){return new g(t)}}function b(){var e;r(this,b);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return n(this,(e=b.__proto__||Object.getPrototypeOf(b)).call.apply(e,[this].concat(i)))}function w(){var e;r(this,w);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return n(this,(e=w.__proto__||Object.getPrototypeOf(w)).call.apply(e,[this].concat(i)))}function I(){var e;r(this,I);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return n(this,(e=I.__proto__||Object.getPrototypeOf(I)).call.apply(e,[this].concat(i)))}function T(){r(this,T),this._pool=[]}function E(e){r(this,E),this._namespace=e}return _.PROTOCOL={INDEXEDDB:h,LOCALSTORAGE:S,WEBSQL:y},_.INTERFACE=Object.freeze(g),_.env={verbose:!0},_}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=e(),"undefined"!=typeof window&&(window.pako=e())}(function(){return function n(a,s,c){function d(t,e){if(!s[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var r=s[t]={exports:{}};a[t][0].call(r.exports,function(e){return d(a[t][1][e]||e)},r,r.exports,n,a,s,c)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(e,t,i){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)r=i,n=o,Object.prototype.hasOwnProperty.call(r,n)&&(e[o]=i[o])}}var r,n;return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,i,o,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+o),r);else for(var n=0;n<o;n++)e[r+n]=t[i+n]},flattenChunks:function(e){var t,i,o,r,n,a;for(t=o=0,i=e.length;t<i;t++)o+=e[t].length;for(a=new Uint8Array(o),t=r=0,i=e.length;t<i;t++)n=e[t],a.set(n,r),r+=n.length;return a}},n={arraySet:function(e,t,i,o,r){for(var n=0;n<o;n++)e[r+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(o)},{}],2:[function(e,t,i){function c(e,t){if(t<65537&&(e.subarray&&n||!e.subarray&&r))return String.fromCharCode.apply(null,d.shrinkBuf(e,t));for(var i="",o=0;o<t;o++)i+=String.fromCharCode(e[o]);return i}var d=e("./common"),r=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}for(var u=new d.Buf8(256),o=0;o<256;o++)u[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;u[254]=u[254]=1,i.string2buf=function(e){var t,i,o,r,n,a=e.length,s=0;for(r=0;r<a;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(o-56320),r++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new d.Buf8(s),r=n=0;n<s;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<a&&56320==(64512&(o=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(o-56320),r++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},i.buf2binstring=function(e){return c(e,e.length)},i.binstring2buf=function(e){for(var t=new d.Buf8(e.length),i=0,o=t.length;i<o;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,o,r,n,a=t||e.length,s=new Array(2*a);for(i=o=0;i<a;)if((r=e[i++])<128)s[o++]=r;else if(4<(n=u[r]))s[o++]=65533,i+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&i<a;)r=r<<6|63&e[i++],n--;1<n?s[o++]=65533:r<65536?s[o++]=r:(r-=65536,s[o++]=55296|r>>10&1023,s[o++]=56320|1023&r)}return c(s,o)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;0<=i&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+u[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){t.exports=function(e,t,i,o){for(var r=65535&e|0,n=e>>>16&65535|0,a=0;0!==i;){for(i-=a=2e3<i?2e3:i;n=n+(r=r+t[o++]|0)|0,--a;);r%=65521,n%=65521}return r|n<<16|0}},{}],4:[function(e,t,i){var s=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,o){var r=s,n=o+i;e^=-1;for(var a=o;a<n;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}},{}],5:[function(e,t,i){function c(e,t){return e.msg=I[t],t}function d(e){return(e<<1)-(4<e?9:0)}function l(e){for(var t=e.length;0<=--t;)e[t]=0}function u(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(_.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function p(e,t){L._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,u(e.strm)}function f(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function n(e,t){var i,o,r=e.max_chain_length,n=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-O?e.strstart-(e.w_size-O):0,d=e.window,u=e.w_mask,l=e.prev,p=e.strstart+M,f=d[n+a-1],m=d[n+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(i=t)+a]===m&&d[i+a-1]===f&&d[i]===d[n]&&d[++i]===d[n+1]){n+=2,i++;do{}while(d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&n<p);if(o=M-(p-n),n=p-M,a<o){if(e.match_start=t,s<=(a=o))break;f=d[n+a-1],m=d[n+a]}}}while((t=l[t&u])>c&&0!=--r);return a<=e.lookahead?a:e.lookahead}function g(e){var t,i,o,r,n,a,s,c,d,u,l=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-O)){for(_.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=i=e.hash_size;o=e.head[--t],e.head[t]=l<=o?o-l:0,--i;);for(t=i=l;o=e.prev[--t],e.prev[t]=l<=o?o-l:0,--i;);r+=l}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,c=e.strstart+e.lookahead,d=r,u=void 0,u=a.avail_in,d<u&&(u=d),i=0===u?0:(a.avail_in-=u,_.arraySet(s,a.input,a.next_in,u,c),1===a.state.wrap?a.adler=b(a.adler,s,u,c):2===a.state.wrap&&(a.adler=w(a.adler,s,u,c)),a.next_in+=u,a.total_in+=u,u),e.lookahead+=i,e.lookahead+e.insert>=P)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+P-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<P)););}while(e.lookahead<O&&0!==e.strm.avail_in)}function o(e,t){for(var i,o;;){if(e.lookahead<O){if(g(e),e.lookahead<O&&t===T)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=P&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-O&&(e.match_length=n(e,i)),e.match_length>=P)if(o=L._tr_tally(e,e.strstart-e.match_start,e.match_length-P),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=P){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=L._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<P-1?e.strstart:P-1,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function r(e,t){for(var i,o,r;;){if(e.lookahead<O){if(g(e),e.lookahead<O&&t===T)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=P&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=P-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-O&&(e.match_length=n(e,i),e.match_length<=5&&(1===e.strategy||e.match_length===P&&4096<e.strstart-e.match_start)&&(e.match_length=P-1)),e.prev_length>=P&&e.match_length<=e.prev_length){for(r=e.strstart+e.lookahead-P,o=L._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-P),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+P-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=P-1,e.strstart++,o&&(p(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=L._tr_tally(e,0,e.window[e.strstart-1]))&&p(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=L._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<P-1?e.strstart:P-1,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function a(e,t,i,o,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=o,this.func=r}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*U),this.dyn_dtree=new _.Buf16(2*(2*D+1)),this.bl_tree=new _.Buf16(2*(2*N+1)),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16(Y+1),this.heap=new _.Buf16(2*C+1),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*C+1),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function s(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?x:V,e.adler=2===t.wrap?0:1,t.last_flush=T,L._tr_init(t),E):c(e,A)}function h(e){var t,i=s(e);return i===E&&((t=e.state).window_size=2*t.w_size,l(t.head),t.max_lazy_match=y[t.level].max_lazy,t.good_match=y[t.level].good_length,t.nice_match=y[t.level].nice_length,t.max_chain_length=y[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=P-1,t.match_available=0,t.ins_h=0),i}function S(e,t,i,o,r,n){if(!e)return A;var a=1;if(-1===t&&(t=6),o<0?(a=0,o=-o):15<o&&(a=2,o-=16),r<1||9<r||i!==R||o<8||15<o||t<0||9<t||n<0||4<n)return c(e,A);8===o&&(o=9);var s=new v;return(e.state=s).strm=e,s.wrap=a,s.gzhead=null,s.w_bits=o,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+P-1)/P),s.window=new _.Buf8(2*s.w_size),s.head=new _.Buf16(s.hash_size),s.prev=new _.Buf16(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new _.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=n,s.method=i,h(e)}var y,_=e("../utils/common"),L=e("./trees"),b=e("./adler32"),w=e("./crc32"),I=e("./messages"),T=0,E=0,A=-2,k=2,R=8,C=286,D=30,N=19,U=2*C+1,Y=15,P=3,M=258,O=M+P+1,x=42,V=113;y=[new a(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&t===T)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+i;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,p(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-O&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(p(e,!1),e.strm.avail_out),1)}),new a(4,4,8,4,o),new a(4,5,16,8,o),new a(4,6,32,32,o),new a(4,4,16,16,r),new a(8,16,32,32,r),new a(8,16,128,128,r),new a(8,32,128,256,r),new a(32,128,258,1024,r),new a(32,258,258,4096,r)],i.deflateInit=function(e,t){return S(e,t,R,15,8,0)},i.deflateInit2=S,i.deflateReset=h,i.deflateResetKeep=s,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?A:(e.state.gzhead=t,E):A},i.deflate=function(e,t){var i,o,r,n;if(!e||!e.state||5<t||t<0)return e?c(e,A):A;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||666===o.status&&4!==t)return c(e,0===e.avail_out?-5:A);if(o.strm=e,i=o.last_flush,o.last_flush=t,o.status===x)if(2===o.wrap)e.adler=0,f(o,31),f(o,139),f(o,8),o.gzhead?(f(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),f(o,255&o.gzhead.time),f(o,o.gzhead.time>>8&255),f(o,o.gzhead.time>>16&255),f(o,o.gzhead.time>>24&255),f(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),f(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(f(o,255&o.gzhead.extra.length),f(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=w(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(f(o,0),f(o,0),f(o,0),f(o,0),f(o,0),f(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),f(o,3),o.status=V);else{var a=R+(o.w_bits-8<<4)<<8;a|=(2<=o.strategy||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(a|=32),a+=31-a%31,o.status=V,m(o,a),0!==o.strstart&&(m(o,e.adler>>>16),m(o,65535&e.adler)),e.adler=1}if(69===o.status)if(o.gzhead.extra){for(r=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),u(e),r=o.pending,o.pending!==o.pending_buf_size));)f(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),u(e),r=o.pending,o.pending===o.pending_buf_size)){n=1;break}n=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,f(o,n)}while(0!==n);o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),0===n&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),u(e),r=o.pending,o.pending===o.pending_buf_size)){n=1;break}n=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,f(o,n)}while(0!==n);o.gzhead.hcrc&&o.pending>r&&(e.adler=w(e.adler,o.pending_buf,o.pending-r,r)),0===n&&(o.status=103)}else o.status=103;if(103===o.status&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&u(e),o.pending+2<=o.pending_buf_size&&(f(o,255&e.adler),f(o,e.adler>>8&255),e.adler=0,o.status=V)):o.status=V),0!==o.pending){if(u(e),0===e.avail_out)return o.last_flush=-1,E}else if(0===e.avail_in&&d(t)<=d(i)&&4!==t)return c(e,-5);if(666===o.status&&0!==e.avail_in)return c(e,-5);if(0!==e.avail_in||0!==o.lookahead||t!==T&&666!==o.status){var s=2===o.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(t===T)return 1;break}if(e.match_length=0,i=L._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(o,t):3===o.strategy?function(e,t){for(var i,o,r,n,a=e.window;;){if(e.lookahead<=M){if(g(e),e.lookahead<=M&&t===T)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=P&&0<e.strstart&&((o=a[r=e.strstart-1])===a[++r]&&o===a[++r]&&o===a[++r])){n=e.strstart+M;do{}while(o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&o===a[++r]&&r<n);e.match_length=M-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=P?(i=L._tr_tally(e,1,e.match_length-P),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=L._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(o,t):y[o.level].func(o,t);if(3!==s&&4!==s||(o.status=666),1===s||3===s)return 0===e.avail_out&&(o.last_flush=-1),E;if(2===s&&(1===t?L._tr_align(o):5!==t&&(L._tr_stored_block(o,0,0,!1),3===t&&(l(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),u(e),0===e.avail_out))return o.last_flush=-1,E}return 4!==t?E:o.wrap<=0?1:(2===o.wrap?(f(o,255&e.adler),f(o,e.adler>>8&255),f(o,e.adler>>16&255),f(o,e.adler>>24&255),f(o,255&e.total_in),f(o,e.total_in>>8&255),f(o,e.total_in>>16&255),f(o,e.total_in>>24&255)):(m(o,e.adler>>>16),m(o,65535&e.adler)),u(e),0<o.wrap&&(o.wrap=-o.wrap),0!==o.pending?E:1)},i.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==x&&69!==t&&73!==t&&91!==t&&103!==t&&t!==V&&666!==t?c(e,A):(e.state=null,t===V?c(e,-3):E):A},i.deflateSetDictionary=function(e,t){var i,o,r,n,a,s,c,d,u=t.length;if(!e||!e.state)return A;if(2===(n=(i=e.state).wrap)||1===n&&i.status!==x||i.lookahead)return A;for(1===n&&(e.adler=b(e.adler,t,u,0)),i.wrap=0,u>=i.w_size&&(0===n&&(l(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new _.Buf8(i.w_size),_.arraySet(d,t,u-i.w_size,i.w_size,0),t=d,u=i.w_size),a=e.avail_in,s=e.next_in,c=e.input,e.avail_in=u,e.next_in=0,e.input=t,g(i);i.lookahead>=P;){for(o=i.strstart,r=i.lookahead-(P-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[o+P-1])&i.hash_mask,i.prev[o&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=o,o++,--r;);i.strstart=o,i.lookahead=P-1,g(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=P-1,i.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,i.wrap=n,E},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":4,"./messages":6,"./trees":7}],6:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],7:[function(e,t,i){function o(e){for(var t=e.length;0<=--t;)e[t]=0}function a(e,t,i,o,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=o,this.max_length=r,this.has_stree=e&&e.length}function r(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function c(e){return e<256?Y[e]:Y[256+(e>>>7)]}function d(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function u(e,t,i){e.bi_valid>I-i?(e.bi_buf|=t<<e.bi_valid&65535,d(e,e.bi_buf),e.bi_buf=t>>I-e.bi_valid,e.bi_valid+=i-I):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function l(e,t,i){u(e,i[2*t],i[2*t+1])}function p(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function f(e,t,i){var o,r,n=new Array(w+1),a=0;for(o=1;o<=w;o++)n[o]=a=a+i[o-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=p(n[s]++,s))}}function s(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function m(e){8<e.bi_valid?d(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function n(e,t,i,o){var r=2*t,n=2*i;return e[r]<e[n]||e[r]===e[n]&&o[t]<=o[i]}function g(e,t,i){for(var o=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&n(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!n(t,o,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=o}function v(e,t,i){var o,r,n,a,s=0;if(0!==e.last_lit)for(;o=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===o?l(e,r,t):(l(e,(n=P[r])+256+1,t),0!==(a=k[n])&&u(e,r-=M[n],a),l(e,n=c(--o),i),0!==(a=R[n])&&u(e,o-=O[n],a)),s<e.last_lit;);l(e,256,t)}function h(e,t){var i,o,r,n=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=b,i=0;i<c;i++)0!==n[2*i]?(e.heap[++e.heap_len]=d=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)n[2*(r=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=d,i=e.heap_len>>1;1<=i;i--)g(e,n,i);for(r=c;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=o,n[2*r]=n[2*i]+n[2*o],e.depth[r]=(e.depth[i]>=e.depth[o]?e.depth[i]:e.depth[o])+1,n[2*i+1]=n[2*o+1]=r,e.heap[1]=r++,g(e,n,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,o,r,n,a,s,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0;for(n=0;n<=w;n++)e.bl_count[n]=0;for(c[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<b;i++)(n=c[2*c[2*(o=e.heap[i])+1]+1]+1)>m&&(n=m,g++),c[2*o+1]=n,d<o||(e.bl_count[n]++,a=0,f<=o&&(a=p[o-f]),s=c[2*o],e.opt_len+=s*(n+a),l&&(e.static_len+=s*(u[2*o+1]+a)));if(0!==g){do{for(n=m-1;0===e.bl_count[n];)n--;e.bl_count[n]--,e.bl_count[n+1]+=2,e.bl_count[m]--,g-=2}while(0<g);for(n=m;0!==n;n--)for(o=e.bl_count[n];0!==o;)(r=e.heap[--i])>d||(c[2*r+1]!==n&&(e.opt_len+=(n-c[2*r+1])*c[2*r],c[2*r+1]=n),o--)}}(e,t),f(n,d,e.bl_count)}function S(e,t,i){var o,r,n=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),t[2*(i+1)+1]=65535,o=0;o<=i;o++)r=a,a=t[2*(o+1)+1],++s<c&&r===a||(s<d?e.bl_tree[2*r]+=s:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[2*T]++):s<=10?e.bl_tree[2*E]++:e.bl_tree[2*A]++,n=r,d=(s=0)===a?(c=138,3):r===a?(c=6,3):(c=7,4))}function y(e,t,i){var o,r,n=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),o=0;o<=i;o++)if(r=a,a=t[2*(o+1)+1],!(++s<c&&r===a)){if(s<d)for(;l(e,r,e.bl_tree),0!=--s;);else 0!==r?(r!==n&&(l(e,r,e.bl_tree),s--),l(e,T,e.bl_tree),u(e,s-3,2)):s<=10?(l(e,E,e.bl_tree),u(e,s-3,3)):(l(e,A,e.bl_tree),u(e,s-11,7));n=r,d=(s=0)===a?(c=138,3):r===a?(c=6,3):(c=7,4)}}function _(e,t,i,o){var r,n,a,s;u(e,0+(o?1:0),3),n=t,a=i,s=!0,m(r=e),s&&(d(r,a),d(r,~a)),L.arraySet(r.pending_buf,r.window,n,a,r.pending),r.pending+=a}var L=e("../utils/common"),b=573,w=15,I=16,T=16,E=17,A=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=new Array(576);o(N);var U=new Array(60);o(U);var Y=new Array(512);o(Y);var P=new Array(256);o(P);var M=new Array(29);o(M);var O=new Array(30);o(O);var x,V,F,B=!1;i._tr_init=function(e){B||(function(){var e,t,i,o,r,n=new Array(w+1);for(o=i=0;o<28;o++)for(M[o]=i,e=0;e<1<<k[o];e++)P[i++]=o;for(P[i-1]=o,o=r=0;o<16;o++)for(O[o]=r,e=0;e<1<<R[o];e++)Y[r++]=o;for(r>>=7;o<30;o++)for(O[o]=r<<7,e=0;e<1<<R[o]-7;e++)Y[256+r++]=o;for(t=0;t<=w;t++)n[t]=0;for(e=0;e<=143;)N[2*e+1]=8,e++,n[8]++;for(;e<=255;)N[2*e+1]=9,e++,n[9]++;for(;e<=279;)N[2*e+1]=7,e++,n[7]++;for(;e<=287;)N[2*e+1]=8,e++,n[8]++;for(f(N,287,n),e=0;e<30;e++)U[2*e+1]=5,U[2*e]=p(e,5);x=new a(N,k,257,286,w),V=new a(U,R,0,30,w),F=new a(new Array(0),C,0,19,7)}(),B=!0),e.l_desc=new r(e.dyn_ltree,x),e.d_desc=new r(e.dyn_dtree,V),e.bl_desc=new r(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,s(e)},i._tr_stored_block=_,i._tr_flush_block=function(e,t,i,o){var r,n,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),h(e,e.l_desc),h(e,e.d_desc),a=function(e){var t;for(S(e,e.dyn_ltree,e.l_desc.max_code),S(e,e.dyn_dtree,e.d_desc.max_code),h(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*D[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=r&&(r=n)):r=n=i+5,i+4<=r&&-1!==t?_(e,t,i,o):4===e.strategy||n===r?(u(e,2+(o?1:0),3),v(e,N,U)):(u(e,4+(o?1:0),3),function(e,t,i,o){var r;for(u(e,t-257,5),u(e,i-1,5),u(e,o-4,4),r=0;r<o;r++)u(e,e.bl_tree[2*D[r]+1],3);y(e,e.dyn_ltree,t-1),y(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),v(e,e.dyn_ltree,e.dyn_dtree)),s(e),o&&m(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(P[i]+256+1)]++,e.dyn_dtree[2*c(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){var t;u(e,2,3),l(e,256,N),16===(t=e).bi_valid?(d(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":1}],8:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/deflate.js":[function(e,t,i){function r(e){if(!(this instanceof r))return new r(e);this.options=s.assign({level:p,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==l)throw new Error(n[i]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var o;if(o="string"==typeof t.dictionary?c.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=a.deflateSetDictionary(this.strm,o))!==l)throw new Error(n[i]);this._dict_set=!0}}function o(e,t){var i=new r(t);if(i.push(e,!0),i.err)throw i.msg||n[i.err];return i.result}var a=e("./zlib/deflate"),s=e("./utils/common"),c=e("./utils/strings"),n=e("./zlib/messages"),d=e("./zlib/zstream"),u=Object.prototype.toString,l=0,p=-1,f=0,m=8;r.prototype.push=function(e,t){var i,o,r=this.strm,n=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?r.input=c.string2buf(e):"[object ArrayBuffer]"===u.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new s.Buf8(n),r.next_out=0,r.avail_out=n),1!==(i=a.deflate(r,o))&&i!==l)return this.onEnd(i),!(this.ended=!0);0!==r.avail_out&&(0!==r.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(c.buf2binstring(s.shrinkBuf(r.output,r.next_out))):this.onData(s.shrinkBuf(r.output,r.next_out)))}while((0<r.avail_in||0===r.avail_out)&&1!==i);return 4===o?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l):2!==o||(this.onEnd(l),!(r.avail_out=0))},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=r,i.deflate=o,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,o(e,t)}},{"./utils/common":1,"./utils/strings":2,"./zlib/deflate":5,"./zlib/messages":6,"./zlib/zstream":8}]},{},[])("/lib/deflate.js")});